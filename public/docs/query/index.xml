<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>数据查询 on 中文手册(WIP)</title>
    <link>http://localhost:1313/docs/query/</link>
    <description>Recent content in 数据查询 on 中文手册(WIP)</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <atom:link href="http://localhost:1313/docs/query/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>HTTP 查询接口</title>
      <link>http://localhost:1313/docs/query/http/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/docs/query/http/</guid>
      <description>&lt;h2 id=&#34;单机版&#34;&gt;单机版&lt;/h2&gt;&#xA;&lt;h3 id=&#34;prometheus-查询接口&#34;&gt;Prometheus 查询接口&lt;/h3&gt;&#xA;&lt;p&gt;VictoriaMetrics 支持下面这些 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/&#34;&gt;Prometheus 查询 API&lt;/a&gt;:&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#instant-query&#34;&gt;/api/v1/query&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#range-query&#34;&gt;/api/v1/query_range&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#finding-series-by-label-matchers&#34;&gt;/api/v1/series&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#getting-label-names&#34;&gt;/api/v1/labels&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#querying-label-values&#34;&gt;/api/v1/label/…/values&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#tsdb-stats&#34;&gt;/api/v1/status/tsdb&lt;/a&gt;. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#tsdb-stats&#34;&gt;these docs&lt;/a&gt; for details.&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#targets&#34;&gt;/api/v1/targets&lt;/a&gt; - see &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-scrape-prometheus-exporters-such-as-node-exporter&#34;&gt;these docs&lt;/a&gt; for more details.&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/federation/&#34;&gt;/federate&lt;/a&gt; - see &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#federation&#34;&gt;these docs&lt;/a&gt; for more details.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;这些接口可以被Prometheus兼容的客户端（如Grafana或curl）查询。所有Prometheus查询API处理程序都可以使用&lt;code&gt;/prometheus&lt;/code&gt;前缀进行查询。例如，&lt;code&gt;/prometheus/api/v1/query&lt;/code&gt;和&lt;code&gt;/api/v1/query&lt;/code&gt;都可以正常工作。&lt;/p&gt;&#xA;&lt;h4 id=&#34;查询优化&#34;&gt;查询优化&lt;/h4&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;VictoriaMetrics 接受&lt;code&gt;extra_label=&amp;lt;label_name&amp;gt;=&amp;lt;label_value&amp;gt;&lt;/code&gt;查询参数（可选），可以用于强制使用额外 Label 过滤器执行查询。例如，&lt;code&gt;/api/v1/query_range?extra_label=user_id=123&amp;amp;extra_label=group_id=456&amp;amp;query=&amp;lt;query&amp;gt;&lt;/code&gt;会自动将&lt;code&gt;{user_id=&amp;quot;123&amp;quot;,group_id=&amp;quot;456&amp;quot;}&lt;/code&gt;Label 过滤器添加到给定的查询中。此功能可用于限制给定租户可见的 timeseries 范围。一般&lt;code&gt;extra_label&lt;/code&gt;查询参数由位于 VictoriaMetrics 前面的查询代理服务自动设置。例如，可以参考使用 &lt;a href=&#34;https://docs.victoriametrics.com/vmauth.html&#34;&gt;vmauth&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/vmgateway.html&#34;&gt;vmgateway&lt;/a&gt; 作为查询代理的示例。&lt;/li&gt;&#xA;&lt;li&gt;VictoriaMetrics 接受&lt;code&gt;extra_filters[]=series_selector&lt;/code&gt;查询参数（可选），可用于对查询强制执行任意的 Label 过滤器。例如，&lt;code&gt;/api/v1/query_range?extra_filters[]={env=~&amp;quot;prod|staging&amp;quot;,user=&amp;quot;xyz&amp;quot;}&amp;amp;query=&amp;lt;query&amp;gt;&lt;/code&gt;将自动将&lt;code&gt;{env=~&amp;quot;prod|staging&amp;quot;,user=&amp;quot;xyz&amp;quot;}&lt;/code&gt;Label 过滤器添加到给定的查询中。此功能可用于限制给定租户可见的 timeseries 范围。我们建议在 VictoriaMetrics 前面的查询代理自动设置&lt;code&gt;extra_filters[]&lt;/code&gt;查询参数。您可以将&lt;a href=&#34;https://docs.victoriametrics.com/vmauth.html&#34;&gt;vmauth&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/vmgateway.html&#34;&gt;vmgateway&lt;/a&gt;作为这种代理的示例。&lt;/li&gt;&#xA;&lt;li&gt;VictoriaMetrics 接受多种格式的 &lt;code&gt;time&lt;/code&gt;，&lt;code&gt;start&lt;/code&gt; 和 &lt;code&gt;end&lt;/code&gt; 查询参数，可参考&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#timestamp-formats&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;&#xA;&lt;li&gt;VictoriaMetrics对于&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#instant-query&#34;&gt;/api/v1/query&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#range-query&#34;&gt;/api/v1/query_range&lt;/a&gt;接口支持&lt;code&gt;round_digits&lt;/code&gt;查询参数。它可用于指定返回的指标值的保留小数点位数。例如，&lt;code&gt;/api/v1/query?query=avg_over_time(temperature[1h])&amp;amp;round_digits=2&lt;/code&gt;会将让返回的指标值保留小数点后面 2 位。&lt;/li&gt;&#xA;&lt;li&gt;VictoriaMetrics允许在&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#apiv1labels&#34;&gt;/api/v1/labels&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#apiv1labelvalues&#34;&gt;/api/v1/label/&lt;!-- raw HTML omitted --&gt;/values&lt;/a&gt;接口中使用&lt;code&gt;limit&lt;/code&gt;查询参数来限制返回的条目数量。例如，对&lt;code&gt;/api/v1/labels?limit=5&lt;/code&gt;的查询请求最多返回5个唯一的 Label 值，并忽略其他 Label。如果提供的&lt;code&gt;limit&lt;/code&gt;值超过了相应的&lt;code&gt;-command-line&lt;/code&gt;命令行参数&lt;code&gt;-search.maxTagKeys&lt;/code&gt;或&lt;code&gt;-search.maxTagValues&lt;/code&gt;，则会使用命令行参数中指定的限制。&lt;/li&gt;&#xA;&lt;li&gt;默认情况下，VictoriaMetrics从&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#apiv1series&#34;&gt;/api/v1/series&lt;/a&gt;、&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#apiv1labels&#34;&gt;/api/v1/labels&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#apiv1labelvalues&#34;&gt;/api/v1/label/&lt;!-- raw HTML omitted --&gt;/values&lt;/a&gt;返回最近一天从00:00 UTC开始的 series 数据，而Prometheus API默认返回所有时间的数据。如果要选择特定的时间范围的 series 数据，可使用 &lt;code&gt;start&lt;/code&gt; 和 &lt;code&gt;end&lt;/code&gt; 参数指定。由于性能优化的考虑，VictoriaMetrics会将指定的 &lt;code&gt;start..end&lt;/code&gt; 时间范围舍入到天的粒度。如果您需要在给定时间范围内获取精确的 Label 集合，请将查询发送到&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#instant-query&#34;&gt;/api/v1/query&lt;/a&gt;或&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#range-query&#34;&gt;/api/v1/query_range&lt;/a&gt;。&lt;/li&gt;&#xA;&lt;li&gt;VictoriaMetrics在&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#apiv1series&#34;&gt;/api/v1/series&lt;/a&gt;中接受&lt;code&gt;limit&lt;/code&gt;查询参数，用于限制返回的条目数量。例如，对&lt;code&gt;/api/v1/series?limit=5&lt;/code&gt;的查询将最多返回5个 series，并忽略其余的时间序列。如果提供的&lt;code&gt;limit&lt;/code&gt;值超过了相应的命令行参数&lt;code&gt;-search.maxSeries&lt;/code&gt;的值，则会使用命令行中指定的限制。&lt;/li&gt;&#xA;&lt;li&gt;此外，VictoriaMetrics还提供了以下接口：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;/vmui&lt;/code&gt; - 基本的 Web UI 界面，阅读&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#vmui&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;/api/v1/series/count&lt;/code&gt; - 返回数据库中 time series 的总数量。注意：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;该接口扫描了整个数据库的倒排索引，所以如果数据库包含数千万个 series 时间序列，它可能会变慢。&lt;/li&gt;&#xA;&lt;li&gt;该接口可能把&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-delete-time-series&#34;&gt;删除 time series&lt;/a&gt; 计算在内，这是内部实现导致的。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;/api/v1/status/active_queries&lt;/code&gt; - 返回当前正在执行的查询。&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;/api/v1/status/top_queries&lt;/code&gt; - 返回下面几个查询列表:&#xA;&lt;ul&gt;&#xA;&lt;li&gt;执行最频繁的查询列表 - &lt;code&gt;topByCount&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;平均执行时间最长的查询列表 - &lt;code&gt;topByAvgDuration&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;执行时间最长的查询列表 - &lt;code&gt;topBySumDuration&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;返回的查询个数可以使用 &lt;code&gt;topN&lt;/code&gt; 参数进行限制。历史查询可以使用 &lt;code&gt;maxLifetime&lt;/code&gt; 参数过滤掉。比如，请求&lt;code&gt;/api/v1/status/top_queries?topN=5&amp;amp;maxLifetime=30s&lt;/code&gt;返回最近 30 秒内每个类型的 Top5 个查询列表。VictoriaMetrics 会跟踪统计最近&lt;code&gt;-s earch.queryStats.lastQueriesCount&lt;/code&gt;时间内，且执行时间大于&lt;code&gt;search.queryStats.minQueryDuration&lt;/code&gt;的查询。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 id=&#34;timestamp-格式&#34;&gt;Timestamp 格式&lt;/h4&gt;&#xA;&lt;p&gt;VictoriaMetrics 接受下面这些格式的 &lt;code&gt;time&lt;/code&gt;, &lt;code&gt;start&lt;/code&gt; and &lt;code&gt;end&lt;/code&gt; 参数， 在 &lt;a href=&#34;https://docs.victoriametrics.com/#prometheus-querying-api-usage&#34;&gt;query APIs&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/#how-to-export-time-series&#34;&gt;export APIs&lt;/a&gt; 中皆是如此。&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
