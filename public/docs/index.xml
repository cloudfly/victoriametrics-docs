<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>中文手册 – VictoriaMetrics 中文手册</title>
    <link>http://localhost:1313/docs/</link>
    <description>Recent content in VictoriaMetrics 中文手册 on 中文手册</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <copyright>© 2024 Cloudfly,陈云飞</copyright>
    <lastBuildDate>Sat, 28 Sep 2024 19:11:04 +0800</lastBuildDate>
    
	  <atom:link href="http://localhost:1313/docs/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>基本用法</title>
      <link>http://localhost:1313/docs/query/metricsql/basic/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/query/metricsql/basic/</guid>
      <description>
        
        
        &lt;h2&gt;过滤器&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;过滤器&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e8%bf%87%e6%bb%a4%e5%99%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;在&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/onpelg16wg77xin6&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;数据查询&lt;/a&gt;部分我们已经用 MetricsQL 获取了指标 &lt;code&gt;foo_bar&lt;/code&gt; 的数据。只需在查询中写入指标名称，就能轻松完成：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;foo_bar&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;一个简单的指标名称会得到拥有不同 label 组合的多个 Timeseries 返回响应值。比如：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;requests_total{path=&amp;#34;/&amp;#34;, code=&amp;#34;200&amp;#34;} 
requests_total{path=&amp;#34;/&amp;#34;, code=&amp;#34;403&amp;#34;}&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;要选择具有特定 Label 的 Timeseries，需要在花括号中指定匹配 Label 的过滤器：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;requests_total{code=&amp;#34;200&amp;#34;}&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;上面的查询语句返回所有名字是 &lt;code&gt;requests_total &lt;/code&gt;并且 Label 带有&lt;code&gt;code=&amp;quot;200&amp;quot;&lt;/code&gt;的所有&lt;code&gt;Timeseries&lt;/code&gt;。我们用&lt;code&gt;=&lt;/code&gt;运算符来匹配 Label 值。对于反匹配使用&lt;code&gt;!=&lt;/code&gt;运算符。过滤器也通过&lt;code&gt;=~&lt;/code&gt;实现正则匹配，用&lt;code&gt;!~&lt;/code&gt;实现正则反匹配。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;requests_total{code=~&amp;#34;2.*&amp;#34;}&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;过滤器也可以被组合使用：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;requests_total{code=~&amp;#34;200&amp;#34;, path=&amp;#34;/home&amp;#34;}&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;上面的查询返回所有名字是&lt;code&gt;request_total&lt;/code&gt;，同时带有 &lt;code&gt;code=&amp;quot;200&amp;quot;&lt;/code&gt; 和 &lt;code&gt;path=&amp;quot;/home&amp;quot;&lt;/code&gt; Label 的所有 Timeseries。&lt;/p&gt;
&lt;h3&gt;使用名字过滤&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;使用名字过滤&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e5%90%8d%e5%ad%97%e8%bf%87%e6%bb%a4&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;有时我们可能需要同时返回多个监控指标。就如同&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/usya0z8utkby2rog&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;数据模型&lt;/a&gt;中提到的，Metric 名称本质上也是一个普通的 Label 的值，其 Label 名是&lt;code&gt;__name__&lt;/code&gt;。所以可以通过对 Metric 名使用正则的方式，来过滤出多个指标名的数据：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;{__name__=~&amp;#34;requests_(error|success)_total&amp;#34;}&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;上面的查询语句会返回 2 个 Metric 的 Timeseries：&lt;code&gt;requests_error_total&lt;/code&gt; 和&lt;code&gt;requests_success_total&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;利用 or 使用多个过滤器&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;利用-or-使用多个过滤器&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%88%a9%e7%94%a8-or-%e4%bd%bf%e7%94%a8%e5%a4%9a%e4%b8%aa%e8%bf%87%e6%bb%a4%e5%99%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MetricsQL&lt;/a&gt; 支持查询至少满足多个过滤器中的一个方式来获取 Timeseries。这些过滤器必须在花括号内使用 &lt;code&gt;or&lt;/code&gt; 分割。 比如，下面的查询代表查询 Label 满足 &lt;code&gt;{job=&amp;quot;app1&amp;quot;,env=&amp;quot;prod&amp;quot;}&lt;/code&gt; 或 &lt;code&gt;{job=&amp;quot;app2&amp;quot;,env=&amp;quot;dev&amp;quot;}&lt;/code&gt; 的 Timeseries：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;{job=&amp;#34;app1&amp;#34;,env=&amp;#34;prod&amp;#34; or job=&amp;#34;app2&amp;#34;,env=&amp;#34;dev&amp;#34;}&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;过滤器的个数是没有限制的。这个功能可以对查询到的 series 直接运用 &lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/wxvn5kgfgqsp68bl&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup 函数&lt;/a&gt;（比如 &lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/wxvn5kgfgqsp68bl#RipcU&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rate&lt;/a&gt;），这样就不需要使用&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#subqueries&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;子查询&lt;/a&gt;了：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;rate({job=&amp;#34;app1&amp;#34;,env=&amp;#34;prod&amp;#34; or job=&amp;#34;app2&amp;#34;,env=&amp;#34;dev&amp;#34;}[5m])&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;如果你需要对同一 Label 使用多个过滤器来查询 Timeseries，从性能角度来看，最好使用正则表达式&lt;code&gt;{label=~&amp;quot;value1|...|valueN&amp;quot;}&lt;/code&gt; 而不是使用&lt;code&gt;{label=&amp;quot;value1&amp;quot; or ... or label=&amp;quot;valueN&amp;quot;}&lt;/code&gt;。&lt;/p&gt;
&lt;h2&gt;算数运算&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;算数运算&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%ae%97%e6%95%b0%e8%bf%90%e7%ae%97&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;MetricsQL 支持所有基本的算数运算：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;加法 - &lt;code&gt;+&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;减法 - &lt;code&gt;-&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;乘法 - &lt;code&gt;*&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;除法 - &lt;code&gt;/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;取模 - &lt;code&gt;%&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;指数 - &lt;code&gt;^&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们可以在多个指标之间进行各种计算。比如，下面的查询语句就是计算错误请求率：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;(requests_error_total / (requests_error_total &amp;#43; requests_success_total)) * 100&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h3&gt;合并多个 Timeseries&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;合并多个-timeseries&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%90%88%e5%b9%b6%e5%a4%9a%e4%b8%aa-timeseries&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;要使用算术运算合并多个 Timeseries ，我们需要了解匹配规则。否则，查询会出错或给出错误的结果。匹配规则的逻辑很简单：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MetricsQL引擎在不影响 Label 的情况下，从算术操作左右两侧的所有 Timeseries 中&lt;strong&gt;去除指标名称&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;对于左侧的每个 Timeseries，MetricsQL 引擎会在右侧搜索具有相同 Label Set 的 Timeseries，对每个数据点执行运算操作，并返回具有相同 Label Set 的结果时间序列。&lt;strong&gt;如果没有匹配项，则结果时间序列将从结果中删除。&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;匹配规则可以通过&lt;code&gt;ignore&lt;/code&gt;、&lt;code&gt;on&lt;/code&gt;、&lt;code&gt;group_left&lt;/code&gt;和&lt;code&gt;group_right&lt;/code&gt;运算符进行扩展。详细信息请参阅&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;比较运算&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;比较运算&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%af%94%e8%be%83%e8%bf%90%e7%ae%97&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;MetricsQL 支持下面这些比较运算符：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;等于 - &lt;code&gt;==&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;不等于 - &lt;code&gt;!=&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;大于 - &lt;code&gt;&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;大于等于 - &lt;code&gt;&amp;gt;=&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;小于 - &lt;code&gt;&amp;lt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;小于等于 - &lt;code&gt;&amp;lt;=&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些运算符可以像算术运算符一样应用于任意的 MetricsQL 表达式。比较运算的结果是只包含 value 匹配成功的的 Timeseries。例如，下面的查询将仅返回内存使用超过&lt;code&gt;100MB&lt;/code&gt;的进程列表。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;process_resident_memory_bytes &amp;gt; 100*1024*1024&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h2&gt;聚合与分组函数&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;聚合与分组函数&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e8%81%9a%e5%90%88%e4%b8%8e%e5%88%86%e7%bb%84%e5%87%bd%e6%95%b0&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;MetricsQL 支持对 Timeseries 进行分组聚合。Timeseries 使用指定的一组 Label 进行分组，然后使用指定的聚合方法对每组 Timeseries 的 value 做聚合计算。 比如，下面的查询返回每个 job 的 内存使用率总和：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;sum(process_resident_memory_bytes) by (job)&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;更多参见 MetricsQL 的&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;聚合函数文档&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;计算速率&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;计算速率&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e8%ae%a1%e7%ae%97%e9%80%9f%e7%8e%87&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;对于 &lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/he-xin-gai-nian#counter-ji-shu-qi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Counter&lt;/a&gt; 类型指标使用最广泛的的一个函数是 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rate&lt;/a&gt;。它对每一个 Timeseries 独立计算每秒的平均增长率。比如，下面的查询返回的是每一个 node_exporter 实例监控到的每秒平均入流量， &lt;code&gt;node_network_receive_bytes_total&lt;/code&gt; 指标是它暴露出来的一个监控指标。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;rate(node_network_receive_bytes_total)&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;默认情况下，无论是 &lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/shu-ju-cha-xun#instant-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Instance Query&lt;/a&gt; 还是 &lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/shu-ju-cha-xun#range-query-fan-wei-cha-xun&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Range Query&lt;/a&gt;，VictoriaMetrics 都使用 &lt;code&gt;step&lt;/code&gt; 参数指定的窗口大小，对回溯区间内的样本执行 &lt;code&gt;rate&lt;/code&gt; 计算。&lt;code&gt;rate&lt;/code&gt; 需要计算的时间间隔可以在一个中括号中指定。比如：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;rate(node_network_receive_bytes_total[5m])&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;在这个例子中，VictoriaMetrics 使用指定的回溯窗口 &lt;code&gt;5m&lt;/code&gt;(5分钟)。来计算平均每秒增长。通常情况下回溯窗口越大，曲线图形就约平滑。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;rate&lt;/code&gt; 会保留 timeseries 中的所有 Label，除了 Metric 名称。如果你想要保留 Metric 名称，就需要在 &lt;code&gt;rate(...)&lt;/code&gt; 后面使用 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器。比如，下面的语句就是在计算 &lt;code&gt;rate()&lt;/code&gt; 后保留 Metric 名称：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rate(node_network_receive_bytes_total) keep_metric_names&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;rate()&lt;/code&gt; 能且只能用于 &lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/he-xin-gai-nian#counter-ji-shu-qi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Counter&lt;/a&gt; 类指标。对 &lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/he-xin-gai-nian#gauge-yi-biao&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gauge&lt;/a&gt; 类型指标应用 &lt;code&gt;rate&lt;/code&gt; 是没意义的。&lt;/p&gt;
&lt;h2&gt;keep_metric_names&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;keep_metric_names&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#keep_metric_names&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;默认情况下，Metric 名称会在应用函数或&lt;a href=&#34;#suan-shu-yun-suan&#34; &gt;算数运算&lt;/a&gt;后被丢弃，因为它们会改变原始指标的含义。当函数作用于多个名称不同的时间序列时，可能会导致&lt;code&gt;duplicate time series&lt;/code&gt;错误。这个错误可以使用&lt;code&gt;keep_metric_names&lt;/code&gt;修改器来解决。&lt;/p&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;rate({__name__=~&amp;quot;foo|bar&amp;quot;}) keep_metric_names&lt;/code&gt;会在查询结算结果中保留&lt;code&gt;foo&lt;/code&gt;和&lt;code&gt;bar&lt;/code&gt;这 2 个 Metric 名称。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;({__name__=~&amp;quot;foo|bar&amp;quot;} / 10) keep_metric_names&lt;/code&gt;会在查询结算结果中保留&lt;code&gt;foo&lt;/code&gt;和&lt;code&gt;bar&lt;/code&gt;这 2 个 Metric 名称。&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>如何处理磁盘空间不足</title>
      <link>http://localhost:1313/docs/ops/disk-space/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/ops/disk-space/</guid>
      <description>
        
        
        &lt;p&gt;磁盘空间属于前期规划的，这种事故主要是因为前期规划失误。只能临时补救。具体有如下集中方法&lt;/p&gt;
&lt;h2&gt;强行 merge&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;强行-merge&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%bc%ba%e8%a1%8c-merge&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;让 vmstorage 执行 merge，会将多个 part merge 成一个 part，减少磁盘空间。有数据持续写入的 partition 会自动触发 merge，不要去强制 merge。所以只对历史 partition 进行 merge。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## 参数 partition_prefix 指定 partition，partition 的名字在 $DATA/data/small 下可以看到&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;http://localhost:8442/internal/force_merge?partition_prefix=2022_01&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;效果如图所示：&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../disk-usage.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;磁盘使用率上升是因为 merge 过程创建新的 part 来  merge 老的多个 parts。突然下降代表 merge 结束，删掉老的 parts。&lt;/p&gt;
&lt;p&gt;整个 merge 过程，CPU 和 Memory 几乎没有什么影响。merge 的耗时数个小时，跟数据量大小有关。&lt;/p&gt;
&lt;h2&gt;等待&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;等待&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%ad%89%e5%be%85&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;如上所述，系统对多个 part 进行 merge 时，会临时使用一定的磁盘空间，合并后将老的 part 删除就会释放。&lt;/p&gt;
&lt;p&gt;因此在磁盘不足时，可查看 vmstorage 是否正在执行 merge，如果是，可以等待其执行完毕。一次 merge 可能会执行是个小时甚至数天。&lt;/p&gt;
&lt;h2&gt;删除 cache&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;删除-cache&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%88%a0%e9%99%a4-cache&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;如果 cache 目录比较大，可以删除。但通常不会太大。&lt;/p&gt;
&lt;h2&gt;强制删除历史 partition&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;强制删除历史-partition&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%bc%ba%e5%88%b6%e5%88%a0%e9%99%a4%e5%8e%86%e5%8f%b2-partition&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;删除历史数据是最直接的。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;先 stop 掉 vmstorage 组件。&lt;/li&gt;
&lt;li&gt;删除 &lt;code&gt;$DATA/data/{big,small}/YYYY_MM&lt;/code&gt; 目录。&lt;/li&gt;
&lt;li&gt;启动 vmstorage。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;只有一个 partition ?&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;只有一个-partition-&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%8f%aa%e6%9c%89%e4%b8%80%e4%b8%aa-partition-&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;也就是这一个月而数据磁盘都扛不住，那么只能删除 part。part 的文件夹名称，包含着这个 part 的时间范围。可以根据这些数据删除历史 part。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;./small/2022_02/93109700891_21411093_20220201043320.000_20220204141544.799_16CF806E39D42DF8&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h2&gt;修改 retention&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;修改-retention&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bf%ae%e6%94%b9-retention&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;直接修改 vmstorage 的运行参数，让 retention 更短。然后重启，让 vmstorage 自己去删过期的 partition 也是OK的。&lt;/p&gt;
&lt;p&gt;不过这就是永久生效了，而不是临时删下历史数据清理磁盘。&lt;/p&gt;
&lt;h2&gt;&lt;!-- raw HTML omitted --&gt;不要删 Series&lt;!-- raw HTML omitted --&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;font-stylecolorrgb2165749不要删-seriesfont&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#font-stylecolorrgb2165749%e4%b8%8d%e8%a6%81%e5%88%a0-seriesfont&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;!-- raw HTML omitted --&gt;因为删除 series 会带来额外很大的开销，让系统不稳定。而且它不会释放多少空间。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>核心概念</title>
      <link>http://localhost:1313/docs/concepts/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/concepts/</guid>
      <description>
        
        
        &lt;p&gt;本文主要阐述一些词汇概念的基本定义，如果你对这些基本概念或词汇没有基本的了解，对本书中的大部分内容的理解上都会有一些困难。&lt;/p&gt;
&lt;p&gt;有一些专业英文词汇是不翻译的，比如 Metric、Labels、TimeSeries 等，因为这些专业属于很频繁，强行寻找一个对应的中文词汇反而会增加理解成本。&lt;/p&gt;
&lt;h2&gt;什么是 Metric（度量指标）&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;什么是-metric度量指标&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af-metric%e5%ba%a6%e9%87%8f%e6%8c%87%e6%a0%87&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;不翻译&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;简单来说，&lt;code&gt;metric&lt;/code&gt;是对事物的数值测量或观察。&lt;/p&gt;
&lt;p&gt;Metric 最常见的用途包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;检查系统在特定时间段内的行为；&lt;/li&gt;
&lt;li&gt;将行为变化与其他测量结果相关联；&lt;/li&gt;
&lt;li&gt;观察或预测趋势；&lt;/li&gt;
&lt;li&gt;如果度量标准超过阈值，则触发事件（告警）。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Metric 结构&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;metric-结构&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#metric-%e7%bb%93%e6%9e%84&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;让我们从一个例子开始。为了追踪我们的应用程序处理了多少请求，我们将定义一个名为&lt;code&gt;requests_total&lt;/code&gt;的指标。&lt;/p&gt;
&lt;p&gt;在这里你可以更具体一些，比如说&lt;code&gt;requests_success_total&lt;/code&gt;（仅针对成功的请求）或者&lt;code&gt;request_errors_total&lt;/code&gt;（针对失败的请求）。&lt;/p&gt;
&lt;p&gt;选择一个指标名称非常重要，它应该能够清楚地向每个看到它的人传达正确信息：实际测量到了什么内容；就像编程中的变量名一样。在其他的 tsdb 中，也有使用 &lt;strong&gt;measurement&lt;/strong&gt; 这个单词的，其表达的核心内容是一样的。&lt;/p&gt;
&lt;h2&gt;Labels（标签）&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;labels标签&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#labels%e6%a0%87%e7%ad%be&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;不翻译&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;每个指标都可以包含额外的元信息，以 Label 对的形式呈现：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;requests_total&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;path=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; code=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;200&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;requests_total&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;path=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; code=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;403&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;指标元信息，即一组用花括号括起来的键值对，为我们提供了&lt;code&gt;request&lt;/code&gt;被处理的&lt;code&gt;path&lt;/code&gt;和&lt;code&gt;status code&lt;/code&gt;的上下文。Label 的值始终是&lt;code&gt;string&lt;/code&gt;类型。VictoriaMetrics数据模型是无模式的（No Scheme），即没有预先定义的表结构，用户不需要预先定义指标名称或其标签，而是可以随时添加或更改已采用的指标。&lt;/p&gt;
&lt;p&gt;实际上，指标名称也是一个具有特殊名称&lt;code&gt;__name__&lt;/code&gt;的 Label。因此，以下两个系列是相同的：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;requests_total&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;path=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; code=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;200&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;__name__=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;requests_total&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; path=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; code=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;200&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;Labels可以自动附加到通过vmagent或Prometheus采集的 &lt;a href=&#34;#zZt47&#34; &gt;timeseries&lt;/a&gt; 上。VictoriaMetrics支持对查询API强制执行 Label 过滤器以实现数据的软隔离。然而，真正的数据隔离可以通过&lt;a href=&#34;#S6Dpt&#34; &gt;多租户&lt;/a&gt;实现。&lt;/p&gt;
&lt;h2&gt;Timeseries（时间序列）&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;timeseries时间序列&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#timeseries%e6%97%b6%e9%97%b4%e5%ba%8f%e5%88%97&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;不翻译&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;一个指标名称和其 Label 的组合定义了一个 timeseries。例如，&lt;code&gt;requests_total{path=&amp;quot;/&amp;quot;, code=&amp;quot;200&amp;quot;}&lt;/code&gt; 和&lt;code&gt; requests_total{path=&amp;quot;/&amp;quot;, code=&amp;quot;403&amp;quot;}&lt;/code&gt; 是两个不同的 timeseries，因为它们在&lt;code&gt;code&lt;/code&gt;标签上有不同的值。&lt;/p&gt;
&lt;p&gt;唯一时间序列的数量对数据库资源用量产生影响。详细信息请参阅&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/dh8a9omrcvlana4n#what-is-an-active-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;什么是活跃时间序列&lt;/a&gt;以及&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/dh8a9omrcvlana4n#gao-liu-shilshi-zhi-shen-me&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;什么是高流失率&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;Cardinality（基数）&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;cardinality基数&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#cardinality%e5%9f%ba%e6%95%b0&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;唯一时间序列的数量被称为基数。过多的唯一时间序列被称为&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/dh8a9omrcvlana4n#shen-me-shi-gao-ji-shu&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高基数&lt;/a&gt;。高基数可能导致在VictoriaMetrics中增加资源使用量。请参阅&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/dh8a9omrcvlana4n#shen-me-shi-gao-ji-shu&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这篇文档&lt;/a&gt;以获取更多详细信息。&lt;/p&gt;
&lt;h2&gt;Raw samples（原始样本）&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;raw-samples原始样本&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#raw-samples%e5%8e%9f%e5%a7%8b%e6%a0%b7%e6%9c%ac&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;不翻译&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;每个唯一的时间序列可以由任意数量的&lt;code&gt;（value，timestamp）&lt;/code&gt;数据点（也称为&lt;code&gt;原始样本&lt;/code&gt;）组成，它们按照&lt;code&gt;timestamp&lt;/code&gt;排序。&lt;code&gt;value&lt;/code&gt;是&lt;a href=&#34;https://en.wikipedia.org/wiki/Double-precision_floating-point_format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;双精度浮点数&lt;/a&gt;。&lt;code&gt;timestamp&lt;/code&gt;是具有毫秒精度的 &lt;a href=&#34;https://en.wikipedia.org/wiki/Unix_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Unix 时间戳&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;以下是一个&lt;a href=&#34;https://github.com/prometheus/docs/blob/main/content/docs/instrumenting/exposition_formats.md#text-based-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus文本格式&lt;/a&gt;的单个原始样本的示例：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;requests_total&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;path=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; code=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;200&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;123&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4567890&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;requests_total{path=&amp;quot;/&amp;quot;, code=&amp;quot;200&amp;quot;}&lt;/code&gt; 用于标识给定样本的相关 timeseries。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;123&lt;/code&gt; 是一个样本值。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;4567890&lt;/code&gt; 是可选的样本时间戳。如果缺失，则数据被存储到VictoriaMetrics中时使用数据库的当前时间戳。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Timeseries resolution（时间序列粒度）&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;timeseries-resolution时间序列粒度&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#timeseries-resolution%e6%97%b6%e9%97%b4%e5%ba%8f%e5%88%97%e7%b2%92%e5%ba%a6&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;分辨率是 &lt;a href=&#34;#zZt47&#34; &gt;timeseries&lt;/a&gt; 的 &lt;a href=&#34;#WZ9Ad&#34; &gt;samples&lt;/a&gt; 之间的最小间隔。考虑以下示例：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;----------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;|              &amp;lt;time series&amp;gt;                 | &amp;lt;value&amp;gt; | &amp;lt;timestamp&amp;gt; |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| requests_total&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;path=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/health&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; code=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;200&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; |    &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;    |  &lt;span style=&#34;color:#ae81ff&#34;&gt;1676297640&lt;/span&gt; |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| requests_total&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;path=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/health&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; code=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;200&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; |    &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;    |  &lt;span style=&#34;color:#ae81ff&#34;&gt;1676297670&lt;/span&gt; |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| requests_total&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;path=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/health&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; code=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;200&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; |    &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;    |  &lt;span style=&#34;color:#ae81ff&#34;&gt;1676297700&lt;/span&gt; |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| requests_total&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;path=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/health&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;,&lt;/span&gt; code=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;200&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; |    &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;    |  &lt;span style=&#34;color:#ae81ff&#34;&gt;1676297730&lt;/span&gt; |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;....&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;这里有一个代表请求总数的 timeseries&lt;code&gt;{path=&amp;quot;/health&amp;quot;, code=&amp;quot;200&amp;quot;}&lt;/code&gt;，每30秒更新一次值。这意味着它的分辨率也是30秒。&lt;/p&gt;
&lt;p&gt;在 &lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/nnloeg2kxdz0a1ek#pull-mo-xing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pull 模式&lt;/a&gt;中，分辨率等于抓取间隔，并由监控系统（服务器）控制。对于 &lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/nnloeg2kxdz0a1ek#push-mo-xing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Push 模式&lt;/a&gt;，分辨率是样本时间戳之间的间隔，并由客户端（指标收集器）控制。&lt;/p&gt;
&lt;p&gt;尽量保持时间序列的分辨率一致，因为某些 &lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/hxr2527r9vai0bzm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MetricsQL&lt;/a&gt; 函数可能期望如此，以免计算出『奇怪』的结果。&lt;/p&gt;
&lt;h2&gt;Metric 类型&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;metric-类型&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#metric-%e7%b1%bb%e5%9e%8b&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;在 VictoriaMetrics 内部，并 metric type 的概念。此概念存在是为了帮助用户理解度量是如何测量的。有四种常见的度量类型。&lt;/p&gt;
&lt;h2&gt;Counter（计数器）&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;counter计数器&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#counter%e8%ae%a1%e6%95%b0%e5%99%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Counter&lt;/code&gt; 是一种用于统计某些事件的发生次数的 Metric。它的值是累加的，随着时间增加或保持不变，在一般情况下不会减少。唯一的例外是当计数器重置为零时，例如&lt;code&gt;计数器重置&lt;/code&gt;。当暴露 Counter 指标的服务重新启动时，可能会发生&lt;code&gt;计数器重置&lt;/code&gt;。因此，&lt;code&gt;Counter&lt;/code&gt;指标显示了自服务启动以来观察到的事件数量。&lt;/p&gt;
&lt;p&gt;在编程中，Counter 是一个变量，在每次发生某个事件时递增其值。&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../counter.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vm_http_requests_total&lt;/code&gt; 是一个典型的 Counter 示例。上面图表的解释是，时间序列 &lt;code&gt;vm_http_requests_total{instance=&amp;quot;localhost:8428&amp;quot;, job=&amp;quot;victoriametrics&amp;quot;, path=&amp;quot;api/v1/query_range&amp;quot;}&lt;/code&gt; 在下午1点38分到1点39分之间迅速变化，然后在1点41分之前没有任何变化。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Counter&lt;/code&gt;用于测量事件数量，例如请求、错误、日志、消息等。与计数器一起使用最常见的 &lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/hxr2527r9vai0bzm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MetricsQL&lt;/a&gt; 函数有：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;rate&lt;/code&gt; - 计算指标每秒平均变化速度。例如，&lt;code&gt;rate(requests_total)&lt;/code&gt; 显示平均每秒服务多少个请求；&lt;/li&gt;
&lt;li&gt;&lt;code&gt;increase&lt;/code&gt; - 计算给定时间段内指标的增长情况，时间段由方括号中指定。例如，&lt;code&gt;increase(requests_total[1h])&lt;/code&gt; 显示过去一小时内服务的请求数量。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Counter 可以具有小数值。例如，&lt;code&gt;request_duration_seconds_sum&lt;/code&gt; 计数器可能会对所有请求的持续时间进行求和。每个持续时间可能以秒为单位具有小数值，如&lt;code&gt;0.5&lt;/code&gt; 秒。因此所有请求持续时间的累积总和也可能是小数。&lt;/p&gt;
&lt;p&gt;建议在 &lt;code&gt;Counter&lt;/code&gt; 指标名称中添加 &lt;code&gt;_total&lt;/code&gt;、&lt;code&gt;_sum&lt;/code&gt; 或 &lt;code&gt;_count&lt;/code&gt; 后缀，这样人们就可以轻松区分这些指标与其他类型的指标。&lt;/p&gt;
&lt;h2&gt;Gauge（仪表）&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;gauge仪表&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#gauge%e4%bb%aa%e8%a1%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Gauge 用于测量可以上下变化的值：&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../gauge.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;图表上的度量指标 &lt;code&gt;process_resident_memory_anon_bytes&lt;/code&gt; 显示了应用程序在每个给定时间点的内存使用情况。它经常变化，上下波动，显示进程如何分配和释放内存。在编程中，&lt;code&gt;gauge&lt;/code&gt; 是一个变量，你可以将其设置为随着变化而改变的特定值。&lt;/p&gt;
&lt;p&gt;以下是 &lt;code&gt;gauge&lt;/code&gt; 的使用场景：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;测量温度、内存使用情况、磁盘使用情况等；&lt;/li&gt;
&lt;li&gt;存储某个过程的状态。例如，如果配置重新加载成功，则可以将 gauge &lt;code&gt;config_reloaded_successful&lt;/code&gt; 设置为 &lt;code&gt;1&lt;/code&gt;；如果配置重新加载失败，则设置为 &lt;code&gt;0&lt;/code&gt;；&lt;/li&gt;
&lt;li&gt;存储事件发生时的时间戳。例如，&lt;code&gt;config_last_reload_success_timestamp_seconds&lt;/code&gt; 可以存储最后一次成功配置重新加载的时间戳。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;与 gauges 最常用的 &lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/hxr2527r9vai0bzm&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MetricsQL&lt;/a&gt; 函数是聚合函数和滚动函数。&lt;/p&gt;
&lt;h2&gt;Histogram（直方图）&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;histogram直方图&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#histogram%e7%9b%b4%e6%96%b9%e5%9b%be&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Histogram是一组具有不同&lt;code&gt;vmrange&lt;/code&gt;或&lt;code&gt;le&lt;/code&gt;标签的 Counter 指标。 &lt;code&gt;vmrange&lt;/code&gt;或&lt;code&gt;le&lt;/code&gt;标签定义了特定&lt;code&gt;bucket&lt;/code&gt;（桶）的测量边界。当观察到的测量值命中特定的&lt;code&gt;bucket&lt;/code&gt;时，相应的&lt;code&gt;Counter&lt;/code&gt;会递增。&lt;/p&gt;
&lt;p&gt;直方图桶通常在其名称中带有&lt;code&gt;_bucket&lt;/code&gt;后缀。例如，VictoriaMetrics使用&lt;code&gt;vm_rows_read_per_query&lt;/code&gt;直方图跟踪每个查询处理的行分布情况。该 Histogram 的暴露格式如下：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vm_rows_read_per_query_bucket&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;vmrange=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;4.084e+02...4.642e+02&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vm_rows_read_per_query_bucket&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;vmrange=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;5.275e+02...5.995e+02&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vm_rows_read_per_query_bucket&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;vmrange=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;8.799e+02...1.000e+03&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vm_rows_read_per_query_bucket&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;vmrange=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1.468e+03...1.668e+03&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vm_rows_read_per_query_bucket&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;vmrange=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1.896e+03...2.154e+03&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vm_rows_read_per_query_sum &lt;span style=&#34;color:#ae81ff&#34;&gt;15582&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vm_rows_read_per_query_count &lt;span style=&#34;color:#ae81ff&#34;&gt;11&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;其中 &lt;code&gt;vm_rows_read_per_query_bucket{vmrange=&amp;quot;4.084e+02...4.642e+02&amp;quot;} 2&lt;/code&gt; 这一行表示自上次VictoriaMetrics启动以来，vmrange的值在&lt;code&gt;(408.4 - 464.2]&lt;/code&gt;区间的查询有2个。&lt;/p&gt;
&lt;p&gt;以 &lt;code&gt;_bucket&lt;/code&gt; 后缀结尾的计数器可以使用 &lt;code&gt;histogram_quantile&lt;/code&gt; 函数估算观测测量值的任意百分位数。例如，以下查询返回在过去一小时内每个查询读取的行数的估算第99百分位数（见方括号中的 1h）：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;histogram_quantile(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;.&lt;span style=&#34;color:#ae81ff&#34;&gt;99&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;sum&lt;/span&gt;(increase(vm_rows_read_per_query_bucket[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;h])) &lt;span style=&#34;color:#66d9ef&#34;&gt;by&lt;/span&gt; (vmrange))&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;这个查询的执行逻辑如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;增加&lt;code&gt;(vm_rows_read_per_query_bucket[1h])&lt;/code&gt; 计算每个桶每个实例在过去一小时内的事件数量。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sum(...)&lt;/code&gt; 按 &lt;code&gt;(vmrange)&lt;/code&gt; 计算相同 &lt;code&gt;vmrange&lt;/code&gt; 值的每个实例桶的事件总数。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;histogram_quantile(0.99, ...)&lt;/code&gt; 在步骤 2 返回的 &lt;code&gt;vmrange&lt;/code&gt; 桶上计算第 99 百分位数。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;histogram 类型还暴露了额外两个附加计数器，以 &lt;code&gt;_sum&lt;/code&gt; 和 &lt;code&gt;_count&lt;/code&gt; 后缀结尾。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vm_rows_read_per_query_sum&lt;/code&gt;是所有观测到的测量值的总和，例如自上次VictoriaMetrics启动以来由所有查询服务的行数之和。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vm_rows_read_per_query_count&lt;/code&gt;是观测到的事件总数，例如自上次VictoriaMetrics启动以来观测到的查询总数。&lt;/p&gt;
&lt;p&gt;这些计数器允许在特定回溯窗口内计算平均测量值。例如，以下查询计算最近5分钟（方括号中为5m）每个查询读取行数的平均值：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;increase(vm_rows_read_per_query_sum[&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;m]) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; increase(vm_rows_read_per_query_count[&lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;m])&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;使用 &lt;a href=&#34;https://github.com/VictoriaMetrics/metrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/VictoriaMetrics/metrics&lt;/a&gt; 包，可以通过以下方式在Go应用程序中使用&lt;code&gt;vm_rows_read_per_query&lt;/code&gt;直方图：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// define the histogram
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;rowsReadPerQuery&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;metrics&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;NewHistogram&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;`vm_rows_read_per_query`&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// use the histogram during processing
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;query&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;queries&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;rowsReadPerQuery&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Update&lt;/span&gt;(float64(len(&lt;span style=&#34;color:#a6e22e&#34;&gt;query&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Rows&lt;/span&gt;)))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;我们来看看每次调用&lt;code&gt;rowsReadPerQuery.Update&lt;/code&gt;时，会发生什么：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;计数器&lt;code&gt;vm_rows_read_per_query_sum&lt;/code&gt;的值将增加&lt;code&gt;query.Rows&lt;/code&gt;表达式的长度；&lt;/li&gt;
&lt;li&gt;计数器&lt;code&gt;vm_rows_read_per_query_count&lt;/code&gt;增加&lt;code&gt;1&lt;/code&gt;；&lt;/li&gt;
&lt;li&gt;只有在观察到的值在&lt;code&gt;vmrange&lt;/code&gt;定义的范围（桶）内时，计数器&lt;code&gt;vm_rows_read_per_query_bucket&lt;/code&gt;才会递增。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这样一组计数器指标可以在&lt;a href=&#34;https://grafana.com/docs/grafana/latest/visualizations/heatmap/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grafana中绘制热力图&lt;/a&gt;并计算&lt;a href=&#34;https://prometheus.io/docs/practices/histograms/#quantiles&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;分位数&lt;/a&gt;：&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../histogram.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Grafana对带有vmrange标签的桶不理解，因此在构建Grafana中的热力图之前，必须使用&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/shu-ju-cha-xun/metricql&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prometheus_buckets&lt;/a&gt;函数将带有&lt;code&gt;vmrange&lt;/code&gt;标签的桶转换为带有&lt;code&gt;le&lt;/code&gt;标签的桶。&lt;/p&gt;
&lt;p&gt;histogram 通常用于测量延迟分布、元素大小（例如批处理大小）等。VictoriaMetrics支持两种直方图实现：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Prometheus Histogram。&lt;a href=&#34;https://prometheus.io/docs/instrumenting/clientlibs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;大多数客户端库&lt;/a&gt;都支持这种经典的 Histogram 实现方式。Prometheus Histogram 要求用户静态定义范围（bucket）。&lt;/li&gt;
&lt;li&gt;VictoriaMetrics Histogram 由 &lt;a href=&#34;https://github.com/VictoriaMetrics/metrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics/metrics&lt;/a&gt; 工具库支持。Victoriametrics Histogram 会自动处理桶边界，因此用户无需考虑它们。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们建议您在开始使用直方图之前阅读以下文章：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/concepts/metric_types/#histogram&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus histogram&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/practices/histograms/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Histograms and summaries&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.robustperception.io/how-does-a-prometheus-histogram-work&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How does a Prometheus Histogram work?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://valyala.medium.com/improving-histogram-usability-for-prometheus-and-grafana-bc7e5df0e350&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Improving histogram usability for Prometheus and Grafana&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Summary（摘要）&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;summary摘要&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#summary%e6%91%98%e8%a6%81&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Summary 与 Histogram 非常相似，用于计算&lt;a href=&#34;https://prometheus.io/docs/practices/histograms/#quantiles&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;分位数&lt;/a&gt;。主要区别在于 Summary 是在客户端进行计算的，因此指标公开格式已经包含了预定义的分位数：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-scheme&#34; data-lang=&#34;scheme&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go_gc_duration_seconds&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;quantile=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go_gc_duration_seconds&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;quantile=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.25&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go_gc_duration_seconds&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;quantile=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.5&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go_gc_duration_seconds&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;quantile=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.75&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;8.0696&lt;/span&gt;e-05
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go_gc_duration_seconds&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;quantile=&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.001222168&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go_gc_duration_seconds_sum &lt;span style=&#34;color:#ae81ff&#34;&gt;0.015077078&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;go_gc_duration_seconds_count &lt;span style=&#34;color:#ae81ff&#34;&gt;83&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;Summary 的可视化非常直观：&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../summary.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;这种方法使得 Summary 更易于使用，但与 Histogram 相比也存在显著的限制：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;无法计算多个 Summary 指标的分位数，例如 &lt;code&gt;sum(go_gc_duration_seconds{quantile=&amp;quot;0.75&amp;quot;})&lt;/code&gt;、&lt;code&gt;avg(go_gc_duration_seconds{quantile=&amp;quot;0.75&amp;quot;})&lt;/code&gt; 或 &lt;code&gt;max(go_gc_duration_seconds{quantile=&amp;quot;0.75&amp;quot;})&lt;/code&gt; 不会返回从应用程序的多个实例收集到的 &lt;code&gt;go_gc_duration_seconds&lt;/code&gt; 指标的预期第75百分位数。有关详细信息，请&lt;a href=&#34;https://latencytipoftheday.blogspot.de/2014/06/latencytipoftheday-you-cant-average.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;参阅本文&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;无法计算除已经预先计算过的分位数之外的其他分位数。&lt;/li&gt;
&lt;li&gt;无法针对在任意时间范围内收集到的测量值计算分位数。通常，Summary 分位数是在固定时间范围内（如最近5分钟）计算出来的。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Summary 通常用于跟踪延迟、元素大小（例如批处理大小）等预定义百分比。&lt;/p&gt;
&lt;h2&gt;使用 Metric 对应用进行观测&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;使用-metric-对应用进行观测&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8-metric-%e5%af%b9%e5%ba%94%e7%94%a8%e8%bf%9b%e8%a1%8c%e8%a7%82%e6%b5%8b&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;正如在&lt;a href=&#34;#s1YHu&#34; &gt;Metric类型&lt;/a&gt;部分的开头所说，Metric类型定义了它是如何被测量的。VictoriaMetrics TSDB并不认识Metric类型。它只看到Metric的名称、Label、Value和 Timestamp。这些 Metric 是什么，它们衡量什么以及如何衡量 - 这一切都取决于发出这些指标的应用程序。&lt;/p&gt;
&lt;p&gt;为了使用与VictoriaMetrics兼容的Metric来监控您的应用程序，我们建议使用 &lt;a href=&#34;https://github.com/VictoriaMetrics/metrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/VictoriaMetrics/metrics&lt;/a&gt; 包。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics还与&lt;a href=&#34;https://prometheus.io/docs/instrumenting/clientlibs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus客户端库兼容&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;命名&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;命名&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%91%bd%e5%90%8d&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;我们建议遵循&lt;a href=&#34;https://prometheus.io/docs/practices/naming/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus的指标命名规范&lt;/a&gt;。对于 VictoriaMetrics 来说，没有严格的限制，所以任何指标名称和 Label 名称都是可以接受的。但是遵循这个约定有助于保持名称有意义、描述性强，并且清晰易懂给其他人。遵循这个约定是一个好习惯。&lt;/p&gt;
&lt;h2&gt;Label&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;每个 Metric 都可以包含任意数量的&lt;code&gt;key=&amp;quot;value&amp;quot;&lt;/code&gt;标签。良好的实践是保持这个数量可控。否则，处理包含大量Label的数据将会很困难。默认情况下，VictoriaMetrics将每个Metric的Label数限制为&lt;code&gt;30&lt;/code&gt;，并丢弃其他标签。如果需要，可以通过&lt;code&gt;-maxLabelsPerTimeseries&lt;/code&gt;命令行参数来更改此限制（但不建议这样做）。&lt;/p&gt;
&lt;p&gt;每个Label的值都可以包含任意字符串值。良好的实践是使用简短而有意义的标签值来描述指标属性，而不是讲述它们的故事。例如，&lt;code&gt;environment=&amp;quot;prod&amp;quot;&lt;/code&gt;是可以接受的正常Label，但&lt;code&gt;log_message=&amp;quot;long log message with a lot of details...&amp;quot;&lt;/code&gt;就不是可接受的。默认情况下，VictoriaMetrics将标签值大小限制为&lt;code&gt;16kB&lt;/code&gt;。可以通过&lt;code&gt;-maxLabelValueLen&lt;/code&gt;命令行参数来更改此限制（同样强烈不建议这样做）。&lt;/p&gt;
&lt;p&gt;控制唯一标签值的数量非常重要，因为每个唯一标签值都会导致一个新 &lt;a href=&#34;#zZt47&#34; &gt;timeseries&lt;/a&gt; 产生。尽量避免使用易变性较高的标签值（如会话ID或查询ID），以避免过多资源使用和数据库减速问题发生。&lt;/p&gt;
&lt;h2&gt;多租户&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;多租户&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a4%9a%e7%a7%9f%e6%88%b7&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/viy5b75mqwwrdic1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics的集群版本&lt;/a&gt;支持数据隔离的多租户功能。&lt;/p&gt;
&lt;p&gt;对于&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/nusk0evr8ycpcu1t&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;单机版本的VictoriaMetrics&lt;/a&gt;，可以通过在&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/he-xin-gai-nian#shu-ju-xie-ru&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;写入URL路径&lt;/a&gt;上添加 Label 并在&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/he-xin-gai-nian#shu-ju-cha-xun&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;查询URL路径&lt;/a&gt;上强制进行 &lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#prometheus-querying-api-enhancements&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Label 过滤&lt;/a&gt;来模拟多租户。&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>汇总（Rollup）</title>
      <link>http://localhost:1313/docs/query/metricsql/functions/rollup/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/query/metricsql/functions/rollup/</guid>
      <description>
        
        
        &lt;h2&gt;什么是Rollup&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;什么是rollup&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%afrollup&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Rollup函数（也称为范围函数或窗口函数）在所选 timeseries 的给定回溯窗口上对原始样本的汇总计算。例如，&lt;code&gt;avg_over_time(temperature[24h])&lt;/code&gt;计算过去 24 小时内所有原始样本的平均温度值。&lt;/p&gt;
&lt;p&gt;更多细节：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果在Grafana中使用&lt;code&gt;rollup&lt;/code&gt;函数来构建图形，那么每个点上的&lt;code&gt;rollup&lt;/code&gt;都是独立计算的。例如，&lt;code&gt;avg_over_time(temperature[24h])&lt;/code&gt;图表中的每个点显示了截止到该时间点的过去24小时内的平均温度。点之间的间隔由Grafana传递给&lt;code&gt;/api/v1/query_range&lt;/code&gt;接口作为&lt;code&gt;step&lt;/code&gt;查询参数设置。&lt;/li&gt;
&lt;li&gt;如果给定的查询语句返回多个 timeseries，则每个返回的序列都会单独计算汇总。&lt;/li&gt;
&lt;li&gt;如果方括号中的回溯窗口缺失，则MetricsQL会自动将回溯窗口设置为图表上点之间的间隔（即&lt;code&gt;/api/v1/query_range&lt;/code&gt;中的&lt;code&gt;step&lt;/code&gt;查询参数，Grafana中的&lt;code&gt;$__interval&lt;/code&gt;值或MetricsQL中的&lt;code&gt;1i&lt;/code&gt;持续时间）。例如，&lt;code&gt;rate(http_requests_total)&lt;/code&gt;在Grafana中等同于&lt;code&gt;rate(http_requests_total[$__interval])&lt;/code&gt;。它也等同于&lt;code&gt;rate(http_requests_total[1i])&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;每个在MetricsQL中的系列选择器都必须包装在一个rollup函数中。否则，它会自动被包装成&lt;code&gt;default_rollup&lt;/code&gt;。例如，&lt;code&gt;foo{bar=&amp;quot;baz&amp;quot;}&lt;/code&gt; 在执行计算之前会自动转换为 &lt;code&gt;default_rollup(foo{bar=&amp;quot;baz&amp;quot;}[1i])&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;如果在rollup函数中传递的参数不是series selector，那么内部的参数会自动转换为&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/shu-ju-cha-xun/metricql/zi-cha-xun&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;子查询&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;所有的汇总函数都接受可选的 &lt;code&gt;keep_metric_names&lt;/code&gt; 修饰符。如果设置了该修饰符，函数将在结果中保留指标名称。请参阅&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;更多参见&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#implicit-query-conversions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;隐式查询转换&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;与 Prometheus 的普遍差异&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;与-prometheus-的普遍差异&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%b8%8e-prometheus-%e7%9a%84%e6%99%ae%e9%81%8d%e5%b7%ae%e5%bc%82&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;凡是涉及对回溯窗口样本值首尾样本值进行计算的 rollup 函数，比如 &lt;code&gt;rate&lt;/code&gt;、&lt;code&gt;delta&lt;/code&gt;、&lt;code&gt;increase&lt;/code&gt; 等函数；其MetricsQL 和 PromQL 都存在统一的计算差异。因此 VictoriaMetrics 使用 &lt;code&gt;xxx_prometheus&lt;/code&gt; 的命名提供了兼容 Prometheus 统计方式的 rollup 函数，如 &lt;code&gt;rate_prometheus&lt;/code&gt;、&lt;code&gt;delta_prometheus&lt;/code&gt;、&lt;code&gt;increase_prometheus&lt;/code&gt; 等。而默认则使用 MetricsQL 的统计方式。&lt;/p&gt;
&lt;p&gt;具体的差异细节请阅读&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/qwvgrmtpg77a33a7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这篇文档&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;函数列表&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;函数列表&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%87%bd%e6%95%b0%e5%88%97%e8%a1%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;absent_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;absent_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#absent_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;absent_over_time(series_selector[d])&lt;/code&gt;是一个 rollup 函数，如果给定的向前窗口&lt;code&gt;d&lt;/code&gt;不包含原始样本，则返回1。否则，它将返回一个空结果。&lt;/p&gt;
&lt;p&gt;这个函数在PromQL中得到支持。另请参阅&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#present_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;present_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;aggr_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;aggr_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#aggr_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;aggr_over_time((&amp;quot;rollup_func1&amp;quot;, &amp;quot;rollup_func2&amp;quot;, ...), series_selector[d])&lt;/code&gt; 计算给定回溯窗口 &lt;code&gt;d&lt;/code&gt; 上所有列出的 &lt;code&gt;rollup_func* &lt;/code&gt;对原始样本进行汇总。根据给定的series_selector，对每个返回的时间序列进行单独计算。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;rollup_func*&lt;/code&gt; 可以是任意一个 rollup 函数。比如，&lt;code&gt;aggr_over_time((&amp;quot;min_over_time&amp;quot;, &amp;quot;max_over_time&amp;quot;, &amp;quot;rate&amp;quot;), m[d])&lt;/code&gt; 就会对&lt;code&gt;m[d]&lt;/code&gt;计算 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#min_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;min_over_time&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#max_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;max_over_time&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rate&lt;/a&gt; 。&lt;/p&gt;
&lt;h3&gt;ascent_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;ascent_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ascent_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ascent_over_time(series_selector[d])&lt;/code&gt; 计算给定时间窗口d上原始样本值的上升。针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;该功能用于在GPS跟踪中跟踪高度增益。Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#descent_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;descent_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;avg_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;avg_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#avg_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;avg_over_time(series_selector[d])&lt;/code&gt; 计算给定时间窗口d上原始样本值的平均值。针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;这个函数在 PromQL 中也支持，另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#median_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;median_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;changes&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;changes&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#changes&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;changes(series_selector[d])&lt;/code&gt; 计算给定时间窗口d上原始样本值的变化。针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;不像 Prometheus里的 &lt;code&gt;changes()&lt;/code&gt; ，它考虑了给定时间窗口 d 中最后一个样本的变化，详情请参阅&lt;a href=&#34;https://medium.com/@romanhavronenko/victoriametrics-promql-compliance-d4318203f51e&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这篇文章&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;这个函数 PromQL 中也支持，另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#changes_prometheus&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;changes_prometheus&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;changes_prometheus&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;changes_prometheus&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#changes_prometheus&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;changes_prometheus(series_selector[d])&lt;/code&gt; 计算时间窗口 d 中原始样本值变化的次数。针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;它不考虑在时间窗口 d 之前的最后一个样本值的变化，这和 Prometheus 的逻辑是一样的。详情请参阅&lt;a href=&#34;https://medium.com/@romanhavronenko/victoriametrics-promql-compliance-d4318203f51e&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这篇文章&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;这个函数 PromQL 中也支持，另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#changes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;changes&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;count_eq_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;count_eq_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#count_eq_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;count_eq_over_time(series_selector[d], eq)&lt;/code&gt; 计算时间窗口 d 中原始样本值等于&lt;code&gt;eq&lt;/code&gt;的个数。它针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#count_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;count_gt_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;count_gt_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#count_gt_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;count_gt_over_time(series_selector[d], gt)&lt;/code&gt; 计算时间窗口 d 中原始样本值大于&lt;code&gt;gt&lt;/code&gt;的个数。它针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#count_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;count_le_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;count_le_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#count_le_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;count_le_over_time(series_selector[d], le)&lt;/code&gt; 计算时间窗口 d 中原始样本值小于&lt;code&gt;lt&lt;/code&gt;的个数。它针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#count_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;count_ne_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;count_ne_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#count_ne_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;count_ne_over_time(series_selector[d], ne)&lt;/code&gt; 计算时间窗口 d 中原始样本值不等于&lt;code&gt;ne&lt;/code&gt;的个数。它针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#count_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;count_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;count_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#count_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;count_over_time(series_selector[d])&lt;/code&gt; 计算时间窗口 d 中原始样本值的个数。它针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;这个函数 PromQL 中也支持，另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#count_le_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_le_over_time&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#count_gt_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_gt_over_time&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#count_eq_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_eq_over_time&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#count_ne_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_ne_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;decreases_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;decreases_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#decreases_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;decreases_over_time(series_selector[d])&lt;/code&gt; 计算给定时间窗口d上原始样本值的下降值。针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#increases_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;increases_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;default_rollup&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;default_rollup&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#default_rollup&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;default_rollup(series_selector[d])&lt;/code&gt; 返回给定时间窗口d中最后一个原始样本。针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;h3&gt;delta&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;delta&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#delta&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;delta(series_selector[d])&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#rollup-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup function&lt;/a&gt;,&lt;/p&gt;
&lt;p&gt;计算给定回溯窗口 d 之前的最后一个样本和该窗口的最后一个样本的差异。针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;MetricsQL中 &lt;code&gt;delta()&lt;/code&gt; 函数的计算逻辑和 Prometheus 中的 delta() 函数计算逻辑存在轻微差异，详情看&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/shu-ju-cha-xun/metricql/functions/rollup#yu-prometheus-de-pu-bian-cha-yi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数 PromQL 也支持. 另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#increase&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;increase&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#delta_prometheus&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;delta_prometheus&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;delta_prometheus&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;delta_prometheus&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#delta_prometheus&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;delta_prometheus(series_selector[d])&lt;/code&gt; 计算回溯窗口中第一个样本和最后一个样本的差异。针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;delta_prometheus()&lt;/code&gt; 的计算逻辑和 Prometheus &lt;code&gt;delta()&lt;/code&gt; 一致。 详情看&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/shu-ju-cha-xun/metricql/functions/rollup#yu-prometheus-de-pu-bian-cha-yi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参见 &lt;a href=&#34;#delta&#34; &gt;delta&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;deriv&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;deriv&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#deriv&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;deriv(series_selector[d])&lt;/code&gt; 计算给定回溯窗口 d 中时序数据的每秒导数。针对 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 查询返回的每个时间序列单独执行计算。该导数使用线性回归计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数 PromQL 也支持. 另请参阅 &lt;a href=&#34;#WUsKh&#34; &gt;deriv_fast&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#ideriv&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ideriv&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;deriv_fast&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;deriv_fast&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#deriv_fast&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;deriv_fast(series_selector[d])&lt;/code&gt;使用给定回溯窗口 d 中第一个和最后一个 raw sample 来计算每秒导数。针对&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;查询返回的每个时间序列单独执行计算。该导数使用线性回归计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;#ickEV&#34; &gt;deriv&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#ideriv&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ideriv&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;descent_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;descent_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#descent_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;descent_over_time(series_selector[d])&lt;/code&gt; 计算给定回溯窗口 d 中 raw sample 值的下降量。针对 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 查询查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;这个功能对于追踪GPS定位中的海拔高度损失非常有用。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;#ascent_over_time&#34; &gt;ascent_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;distinct_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;distinct_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#distinct_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;distinct_over_time(series_selector[d])&lt;/code&gt; 返回给定回溯窗口 d 中 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt; 值的种类数。针对 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 查询查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#count_values_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_values_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;duration_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;duration_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#duration_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;duration_over_time(series_selector[d], max_interval)&lt;/code&gt; &lt;!-- raw HTML omitted --&gt;返回给定的 &lt;!-- raw HTML omitted --&gt;&lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; &lt;!-- raw HTML omitted --&gt;返回的时间序列在给定的回溯窗口&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(6, 6, 7);&amp;quot;&amp;gt;d&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;内存在的持续时间，以秒为单位。预期每个序列相邻样本之间的间隔不超过&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(6, 6, 7);&amp;quot;&amp;gt;max_interval&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;。否则，这样的间隔被忽略不计。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参见 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#lifetime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;lifetime&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#lag&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;lag&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;first_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;first_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#first_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;first_over_time(series_selector[d])&lt;/code&gt; 返回给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内的第一个 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt; 值。&lt;/p&gt;
&lt;p&gt;另请参见 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#last_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;last_over_time&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#tfirst_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tfirst_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;geomean_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;geomean_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#geomean_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;geomean_over_time(series_selector[d])&lt;/code&gt; 计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt; 值的&lt;a href=&#34;https://en.wikipedia.org/wiki/Geometric_mean&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;geometric mean&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;这个函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;histogram_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;histogram_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#histogram_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;histogram_over_time(series_selector[d])&lt;/code&gt; 对给定的回溯窗口&lt;code&gt;d&lt;/code&gt;中的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 计算 &lt;a href=&#34;https://godoc.org/github.com/VictoriaMetrics/metrics#Histogram&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics histogram&lt;/a&gt;。针对 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 查询查询返回的每个时间序列单独执行计算。其计算出来的histograms 可被用来传递给&lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_quantile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram_quantile&lt;/a&gt;，用于计算多个&lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;指标的分位值。比如，下面的语句计算每个国家过去 24 小时的温度中位数：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;histogram_quantile(0.5, sum(histogram_over_time(temperature[24h])) by (vmrange,country))&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;holt_winters&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;holt_winters&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#holt_winters&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;holt_winters(series_selector[d], sf, tf)&lt;/code&gt; 使用平滑因子&lt;code&gt;sf&lt;/code&gt;和趋势因子&lt;code&gt;tf&lt;/code&gt;对给定回溯窗口&lt;code&gt;d&lt;/code&gt;中的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 计算 Holt-Winters（通过&lt;a href=&#34;https://en.wikipedia.org/wiki/Exponential_smoothing#Double_exponential_smoothing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;double exponential smoothing&lt;/a&gt;） 值。&lt;code&gt;sf&lt;/code&gt;和&lt;code&gt;tf&lt;/code&gt;的取值范围必须是&lt;code&gt;[0...1]&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;。PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_linear_regression&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_linear_regression&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;idelta&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;idelta&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#idelta&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;idelta(series_selector[d])&lt;/code&gt; 计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内最后 2 个 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt; 值的差异。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#delta&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;delta&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;ideriv&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;ideriv&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ideriv&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ideriv(series_selector[d])&lt;/code&gt;基于给定回溯窗口&lt;code&gt;d&lt;/code&gt;中最后五个 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 计算秒级导数。该导数针对 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#deriv&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;deriv&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;increase&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;increase&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#increase&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;increase(series_selector[d])&lt;/code&gt; 计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内样本值的增量。&lt;/p&gt;
&lt;p&gt;和 Prometheus 不同，它考虑了回溯窗口 d 之前的最后一个 raw sample 值。细节请阅读&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/qwvgrmtpg77a33a7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这篇文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#counter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;counters&lt;/a&gt;.PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#increase_pure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;increase_pure&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#increase_prometheus&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;increase_prometheus&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#delta&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;delta&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;increase_prometheus&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;increase_prometheus&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#increase_prometheus&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;increase_prometheus(series_selector[d])&lt;/code&gt; 计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内样本值的增量。&lt;/p&gt;
&lt;p&gt;计算方式和 Prometheus 一样，它不考虑回溯窗口 d 之前的最后一个 raw sample 值。细节请阅读&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/qwvgrmtpg77a33a7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这篇文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#counter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;counters&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#increase_pure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;increase_pure&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#increase&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;increase&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;increase_pure&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;increase_pure&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#increase_pure&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;increase_pure(series_selector[d])&lt;/code&gt;的工作机制和 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#increase&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;increase&lt;/a&gt; 一样，除了一种情况：它假定 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#counter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;counters&lt;/a&gt; 总是从 0 开始计数，而 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#increase&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;increase&lt;/a&gt; 在第一个值过大时会忽略掉它。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#counter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;counters&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#increas&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;increase&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#increase_prometheus&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;increase_prometheus&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;increases_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;increases_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#increases_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;increases_over_time(series_selector[d])&lt;/code&gt;计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内出现增加的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt; 值的数量。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#decreases_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;decreases_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;integrate&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;integrate&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#integrate&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;integrate(series_selector[d])&lt;/code&gt; 计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt;s 积分。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;irate&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;irate&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#irate&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;irate(series_selector[d])&lt;/code&gt; 使用给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内最后 2 个 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt; 计算出每秒增量。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#counter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;counters&lt;/a&gt;，PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rate&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup_rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup_rate&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;lag&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;lag&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#lag&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;lag(series_selector[d])&lt;/code&gt;返回给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内最后一个样本的时间与当前时间的间隔，以秒为单位。其针对 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#lifetime&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;lifetime&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#duration_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;duration_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;last_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;last_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#last_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;last_over_time(series_selector[d])&lt;/code&gt;返回给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内最后 1 个 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#first_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;first_over_time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#tlast_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tlast_over_time&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;lifetime&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;lifetime&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#lifetime&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;lifetime(series_selector[d])&lt;/code&gt;返回给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内第一个和最后一个 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt; 的时间间隔，以秒为单位。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#duration_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;duration_over_time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#lag&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;lag&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;mad_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;mad_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#mad_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;mad_over_time(series_selector[d])&lt;/code&gt;计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt; 的 &lt;a href=&#34;https://en.wikipedia.org/wiki/Median_absolute_deviation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;median absolute deviation&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#mad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mad&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_mad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_mad&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outlier_iqr_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outlier_iqr_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;max_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;max_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#max_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;max_over_time(series_selector[d])&lt;/code&gt;计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt;s 的最大值。&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;，PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#tmax_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tmax_over_time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#min_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;min_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;median_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;median_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#median_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;median_over_time(series_selector[d])&lt;/code&gt;计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt;s 的中位数。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#avg_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;avg_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;min_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;min_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#min_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;min_over_time(series_selector[d])&lt;/code&gt;计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt;s 的最小值。&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;，PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#tmin_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tmin_over_time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#max_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;max_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;mode_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;mode_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#mode_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;mode_over_time(series_selector[d])&lt;/code&gt; 计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt;s 的&lt;a href=&#34;https://en.wikipedia.org/wiki/Mode_%28statistics%29&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高频值&lt;/a&gt;。它假定 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt; 值都是离散的&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;outlier_iqr_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;outlier_iqr_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#outlier_iqr_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;outlier_iqr_over_time(series_selector[d])&lt;/code&gt; 返回给定回溯窗口 d 中最后一个样本，如果它的值小于 &lt;code&gt;q25-1.5*iqr&lt;/code&gt; 或大于 &lt;code&gt;q75+1.5*iqr&lt;/code&gt;，其中：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;iqr&lt;/code&gt; 回溯窗口&lt;code&gt;d&lt;/code&gt;中 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 的 &lt;a href=&#34;https://en.wikipedia.org/wiki/Interquartile_range&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Interquartile range&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;q25&lt;/code&gt;和&lt;code&gt;q75&lt;/code&gt; 回溯窗口&lt;code&gt;d&lt;/code&gt;中 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 的是 25th and 75th &lt;a href=&#34;https://en.wikipedia.org/wiki/Percentile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;分位值&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;outlier_iqr_over_time()&lt;/code&gt; 主要用于基于 gauge 指标的历史数据来检测异常。例如，&lt;code&gt;outlier_iqr_over_time(memory_usage_bytes[1h])&lt;/code&gt; 会在&lt;code&gt;memory_usage_bytes&lt;/code&gt;指标突然超出过去一小时的平均值时触发。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outliers_iqr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outliers_iqr&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;predict_linear&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;predict_linear&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#predict_linear&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;predict_linear(series_selector[d], t)&lt;/code&gt; 使用回溯窗口 d 中的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 值，使用线性规划计算在未来 t 秒后的指标值。预测值是针对 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_linear_regression&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_linear_regression&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;present_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;present_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#present_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;present_over_time(series_selector[d])&lt;/code&gt; 返回 1 ，如果给定的回溯窗口 d 中至少包含一个 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt;，否则就返回空。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;PromQL 也支持该函数。&lt;/p&gt;
&lt;h3&gt;quantile_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;quantile_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#quantile_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;quantile_over_time(phi, series_selector[d])&lt;/code&gt;计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt;s 的&lt;code&gt;phi&lt;/code&gt;分位值。其中 phi 值的取值范围必须是&lt;code&gt;[0...1]&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;，PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#quantiles_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;quantiles_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;quantiles_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;quantiles_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#quantiles_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;quantiles_over_time(&amp;quot;phiLabel&amp;quot;, phi1, ..., phiN, series_selector[d])&lt;/code&gt; 计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt;s 的&lt;code&gt;phi*&lt;/code&gt;分位值，给函数针对每一个&lt;code&gt;phi*&lt;/code&gt;都返回一个独立的带有&lt;code&gt;{phiLabel=&amp;quot;phi*&amp;quot;}&lt;/code&gt;Label 的序列。&lt;code&gt;phi*&lt;/code&gt; 的取值范围必须是&lt;code&gt;[0...1]&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#quantile_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;quantile_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;range_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;range_over_time(series_selector[d])&lt;/code&gt;计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt;s 的取值范围（最大值-最小值）。它等价于&lt;code&gt;max_over_time(series_selector[d]) - min_over_time(series_selector[d])&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;rate&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rate&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rate&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;rate(series_selector[d])&lt;/code&gt;计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt;s 的平均每秒增长值。&lt;/p&gt;
&lt;p&gt;如果中括号里的回溯窗口大小没有指定，则自动使用&lt;code&gt;max(step, scrape_interval)&lt;/code&gt;，其中 step 是传递给 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#range-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/query_range&lt;/a&gt; 或 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#instant-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/query&lt;/a&gt; 的请求参数，而&lt;code&gt;scrape_interval&lt;/code&gt;则是 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 之间的间隔。这避免当 step 小于&lt;code&gt;scrape_interval&lt;/code&gt;时，图表中出现了非预期的断点现象。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#irate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;irate&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup_rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup_rate&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;rate_over_sum&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rate_over_sum&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rate_over_sum&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;rate_over_sum(series_selector[d])&lt;/code&gt;计算给定回溯窗口&lt;code&gt;d&lt;/code&gt;中 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 总和的每秒增量。该计算针对 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;h3&gt;resets&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;resets&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#resets&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;resets(series_selector[d])&lt;/code&gt;计算给定的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的时间序列在给定的回溯窗口&lt;code&gt;d&lt;/code&gt;内 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt;s 中出现 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#counter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;counter&lt;/a&gt; 重置的次数。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#counter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;counters&lt;/a&gt;，Counter 重置通常代表服务发生了重启。&lt;/p&gt;
&lt;p&gt;PromQL 也支持该函数。&lt;/p&gt;
&lt;h3&gt;rollup&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rollup&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rollup&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;rollup(series_selector[d])&lt;/code&gt; 对给定的回溯窗口&lt;code&gt;d&lt;/code&gt;中的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 计算最小值、最大值和平均值，并在返回的时序数据中带上&lt;code&gt;rollup=&amp;quot;min&amp;quot;&lt;/code&gt;, &lt;code&gt;rollup=&amp;quot;max&amp;quot;&lt;/code&gt; 和 &lt;code&gt;rollup=&amp;quot;avg&amp;quot;&lt;/code&gt;Label。该计算针对 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;支持第二个参数，是可选参数，可传入&lt;code&gt;&amp;quot;min&amp;quot;&lt;/code&gt;, &lt;code&gt;&amp;quot;max&amp;quot;&lt;/code&gt; 或 &lt;code&gt;&amp;quot;avg&amp;quot;&lt;/code&gt; 代表只计算一种值并且不需要追加额外的 rollup label。另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_match&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_match&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup_rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup_rate&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;rollup_candlestick&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rollup_candlestick&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rollup_candlestick&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;rollup_candlestick(series_selector[d])&lt;/code&gt;对给定的回溯窗口&lt;code&gt;d&lt;/code&gt;中的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 使用 OHLC 计算&lt;code&gt;open&lt;/code&gt;, &lt;code&gt;high&lt;/code&gt;, &lt;code&gt;low&lt;/code&gt; and &lt;code&gt;close&lt;/code&gt;，并在返回的时序数据中带上&lt;code&gt;rollup=&amp;quot;open&amp;quot;&lt;/code&gt;, &lt;code&gt;rollup=&amp;quot;high&amp;quot;&lt;/code&gt;, &lt;code&gt;rollup=&amp;quot;low&amp;quot;&lt;/code&gt; and &lt;code&gt;rollup=&amp;quot;close&amp;quot;&lt;/code&gt;Label。该计算针对 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 查询返回的每个时间序列单独执行计算。&lt;/p&gt;
&lt;p&gt;支持第二个参数，是可选参数，可传入&lt;code&gt;&amp;quot;open&amp;quot;&lt;/code&gt;, &lt;code&gt;&amp;quot;high&amp;quot;&lt;/code&gt;或&lt;code&gt;&amp;quot;low&amp;quot;&lt;/code&gt;或&lt;code&gt;&amp;quot;close&amp;quot;&lt;/code&gt; 代表只计算一种值并且不需要追加额外的 rollup label。另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_match&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_match&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;rollup_delta&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rollup_delta&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rollup_delta&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;rollup_delta(series_selector[d]) &lt;/code&gt;计算给定回溯窗口&lt;code&gt;d&lt;/code&gt;上相邻 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 之间的差异，并返回计算出的差异的最小值、最大值和平均值，并在时间序列中附加&lt;code&gt;rollup=&amp;quot;min&amp;quot;&lt;/code&gt;、&lt;code&gt;rollup=&amp;quot;max&amp;quot;&lt;/code&gt; 和 &lt;code&gt;rollup=&amp;quot;avg&amp;quot;&lt;/code&gt; Label。计算是针对从给定 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的每个时间序列单独进行的。&lt;/p&gt;
&lt;p&gt;可以传递可选的第二个参数 &lt;code&gt;&amp;quot;min&amp;quot;&lt;/code&gt;、&lt;code&gt;&amp;quot;max&amp;quot;&lt;/code&gt; 或 &lt;code&gt;&amp;quot;avg&amp;quot;&lt;/code&gt; 来仅保留一个计算结果，并且不添加标签。&lt;/p&gt;
&lt;p&gt;Metric 名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup_increase&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup_increase&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;rollup_deriv&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rollup_deriv&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rollup_deriv&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;rollup_deriv(series_selector[d]) &lt;/code&gt;计算给定回溯窗口&lt;code&gt;d&lt;/code&gt;上相邻 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 之间的每秒导数，并返回计算出的差异的最小值、最大值和平均值，并在时间序列中附加&lt;code&gt;rollup=&amp;quot;min&amp;quot;&lt;/code&gt;、&lt;code&gt;rollup=&amp;quot;max&amp;quot;&lt;/code&gt; 和 &lt;code&gt;rollup=&amp;quot;avg&amp;quot;&lt;/code&gt; Label。计算是针对从给定 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的每个时间序列单独进行的。&lt;/p&gt;
&lt;p&gt;可以传递可选的第二个参数 &lt;code&gt;&amp;quot;min&amp;quot;&lt;/code&gt;、&lt;code&gt;&amp;quot;max&amp;quot;&lt;/code&gt; 或 &lt;code&gt;&amp;quot;avg&amp;quot;&lt;/code&gt; 来仅保留一个计算结果，并且不添加标签。另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_match&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_match&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup_rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup_rate&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;rollup_increase&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rollup_increase&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rollup_increase&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;rollup_increase(series_selector[d]) &lt;/code&gt;计算给定回溯窗口&lt;code&gt;d&lt;/code&gt;上相邻 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 之间的增加值，并返回计算出的差异的最小值、最大值和平均值，并在时间序列中附加&lt;code&gt;rollup=&amp;quot;min&amp;quot;&lt;/code&gt;、&lt;code&gt;rollup=&amp;quot;max&amp;quot;&lt;/code&gt; 和 &lt;code&gt;rollup=&amp;quot;avg&amp;quot;&lt;/code&gt; Label。计算是针对从给定 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的每个时间序列单独进行的。&lt;/p&gt;
&lt;p&gt;可以传递可选的第二个参数 &lt;code&gt;&amp;quot;min&amp;quot;&lt;/code&gt;、&lt;code&gt;&amp;quot;max&amp;quot;&lt;/code&gt; 或 &lt;code&gt;&amp;quot;avg&amp;quot;&lt;/code&gt; 来仅保留一个计算结果，并且不添加标签。另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_match&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_match&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。 另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup_delta&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup_delta&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#counter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;counters&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup_rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup_rate&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;rollup_rate&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rollup_rate&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rollup_rate&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;rollup_rate(series_selector[d]) &lt;/code&gt;计算给定回溯窗口&lt;code&gt;d&lt;/code&gt;上相邻 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 之间的每秒变化量，并返回计算出的差异的最小值、最大值和平均值，并在时间序列中附加&lt;code&gt;rollup=&amp;quot;min&amp;quot;&lt;/code&gt;、&lt;code&gt;rollup=&amp;quot;max&amp;quot;&lt;/code&gt; 和 &lt;code&gt;rollup=&amp;quot;avg&amp;quot;&lt;/code&gt; Label。计算是针对从给定 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的每个时间序列单独进行的。&lt;/p&gt;
&lt;p&gt;可以传递可选的第二个参数 &lt;code&gt;&amp;quot;min&amp;quot;&lt;/code&gt;、&lt;code&gt;&amp;quot;max&amp;quot;&lt;/code&gt; 或 &lt;code&gt;&amp;quot;avg&amp;quot;&lt;/code&gt; 来仅保留一个计算结果，并且不添加标签。另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_match&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_match&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#counter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;counters&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup_increase&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup_increase&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;rollup_scrape_interval&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rollup_scrape_interval&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rollup_scrape_interval&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;rollup_scrape_interval(series_selector[d]) &lt;/code&gt;计算给定回溯窗口&lt;code&gt;d&lt;/code&gt;上相邻 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 之间的间隔的秒数（通常是数据的采集间隔），并返回计算出的差异的最小值、最大值和平均值，并在时间序列中附加&lt;code&gt;rollup=&amp;quot;min&amp;quot;&lt;/code&gt;、&lt;code&gt;rollup=&amp;quot;max&amp;quot;&lt;/code&gt; 和 &lt;code&gt;rollup=&amp;quot;avg&amp;quot;&lt;/code&gt; Label。计算是针对从给定 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的每个时间序列单独进行的。&lt;/p&gt;
&lt;p&gt;可以传递可选的第二个参数 &lt;code&gt;&amp;quot;min&amp;quot;&lt;/code&gt;、&lt;code&gt;&amp;quot;max&amp;quot;&lt;/code&gt; 或 &lt;code&gt;&amp;quot;avg&amp;quot;&lt;/code&gt; 来仅保留一个计算结果，并且不添加标签。另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_match&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_match&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。 另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#scrape_interval&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;scrape_interval&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;scrape_interval&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;scrape_interval&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#scrape_interval&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;scrape_interval(series_selector[d]) &lt;/code&gt;计算给定回溯窗口&lt;code&gt;d&lt;/code&gt;上相邻 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 之间的间隔的平均秒数（通常是数据的采集间隔）并返回。计算是针对从给定 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt; 返回的每个时间序列单独进行的。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup_scrape_interval&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup_scrape_interval&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;share_gt_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;share_gt_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#share_gt_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;share_gt_over_time(series_selector[d], gt)&lt;/code&gt; 返回给定回溯窗口&lt;code&gt;d&lt;/code&gt;上大于&lt;code&gt;gt&lt;/code&gt;的原始样本的比例（范围在&lt;code&gt;[0...1]&lt;/code&gt;之间）。该比例是针对从给定&lt;code&gt;series_selector&lt;/code&gt;返回的每个时间序列独立计算的。&lt;/p&gt;
&lt;p&gt;此函数对于计算 SLI 和 SLO 非常有用。例如：&lt;code&gt;share_gt_over_time(up[24h], 0)&lt;/code&gt; - 返回过去 24 小时的服务可用性。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#share_le_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;share_le_over_time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#count_gt_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_gt_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;share_le_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;share_le_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#share_le_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;share_le_over_time(series_selector[d], le)&lt;/code&gt; 返回给定回溯窗口&lt;code&gt;d&lt;/code&gt;上小于&lt;code&gt;le&lt;/code&gt;的原始样本的比例（范围在&lt;code&gt;[0...1]&lt;/code&gt;之间）。该比例是针对从给定&lt;code&gt;series_selector&lt;/code&gt;返回的每个时间序列独立计算的。&lt;/p&gt;
&lt;p&gt;此函数对于计算 SLI 和 SLO 非常有用。例如：&lt;code&gt;share_le_over_time(memory_usage_bytes[24h], 100*1024*1024)&lt;/code&gt; - 返回过去 24 小时的内存使用率小于等于&lt;code&gt;100MB&lt;/code&gt;的时间占比。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 keep_metric_names 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#share_gt_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;share_gt_over_time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#count_le_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_le_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;share_eq_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;share_eq_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#share_eq_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;share_eq_over_time(series_selector[d], eq)&lt;/code&gt; 返回给定回溯窗口&lt;code&gt;d&lt;/code&gt;上等于&lt;code&gt;eq&lt;/code&gt;的原始样本的比例（范围在&lt;code&gt;[0...1]&lt;/code&gt;之间）。该比例是针对从给定&lt;code&gt;series_selector&lt;/code&gt;返回的每个时间序列独立计算的。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#count_eq_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_eq_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;stddev_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;stddev_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#stddev_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;stddev_over_time(series_selector[d])&lt;/code&gt; 对 &lt;code&gt;series_selector&lt;/code&gt;返回的每个时间序列计算给定回溯窗口&lt;code&gt;d&lt;/code&gt;上原始样本的标准差。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#stdvar_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;stdvar_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;stdvar_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;stdvar_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#stdvar_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;stdvar_over_time(series_selector[d])&lt;/code&gt; 针对&lt;code&gt;series_selector&lt;/code&gt;返回的每条时间序列独立计算，算出给定回溯窗口&lt;code&gt;d&lt;/code&gt;上 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 的方差并返回。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#stddev_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;stddev_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;sum_eq_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sum_eq_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sum_eq_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;sum_eq_over_time(series_selector[d], eq)&lt;/code&gt; 针对 &lt;code&gt;series_selector&lt;/code&gt; 返回的每条时间序列独立计算，算出给定回溯窗口 &lt;code&gt;d&lt;/code&gt; 上等于 &lt;code&gt;eq&lt;/code&gt; 的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 值的总和并返回。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sum_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sum_over_time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#count_eq_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_eq_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;sum_gt_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sum_gt_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sum_gt_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;sum_gt_over_time(series_selector[d], gt)&lt;/code&gt; 针对&lt;code&gt;series_selector&lt;/code&gt;返回的每条时间序列独立计算，算出给定回溯窗口 &lt;code&gt;d&lt;/code&gt; 上大于 &lt;code&gt;gt&lt;/code&gt; 的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 值的总和并返回。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sum_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sum_over_time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#count_gt_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_gt_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;sum_le_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sum_le_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sum_le_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;sum_le_over_time(series_selector[d], le)&lt;/code&gt; 针对&lt;code&gt;series_selector&lt;/code&gt;返回的每条时间序列独立计算，算出给定回溯窗口&lt;code&gt;d&lt;/code&gt;上小于或等于 &lt;code&gt;le&lt;/code&gt; 的 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 值的总和并返回。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sum_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sum_over_time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#count_le_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_le_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;sum_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sum_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sum_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;sum_over_time(series_selector[d])&lt;/code&gt;是一个汇总函数，它针对 &lt;code&gt;series_selector&lt;/code&gt; 返回的每条时间序列独立计算，算出给定回溯窗口&lt;code&gt;d&lt;/code&gt;上 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 值的总和并返回。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;PromQL 也支持该函数。&lt;/p&gt;
&lt;h3&gt;sum2_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sum2_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sum2_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;sum2_over_time(series_selector[d])&lt;/code&gt;针对&lt;code&gt;series_selector&lt;/code&gt;返回的每条时间序列独立计算，算出给定回溯窗口&lt;code&gt;d&lt;/code&gt;上 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; 值的平方和并返回。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;timestamp&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;timestamp&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#timestamp&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;timestamp(series_selector[d])&lt;/code&gt; 针对 &lt;code&gt;series_selector&lt;/code&gt; 返回的每条时间序列独立计算，返回给定回溯窗口 &lt;code&gt;d&lt;/code&gt; 上最后一个 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt; 的时间戳（以秒为单位，精确到毫秒）。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;PromQL 也支持该函数。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#now&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;now&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;timestamp_with_name&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;timestamp_with_name&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#timestamp_with_name&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;timestamp_with_name(series_selector[d])&lt;/code&gt;针对 &lt;code&gt;series_selector&lt;/code&gt; 返回的每条时间序列独立计算，返回给定回溯窗口 &lt;code&gt;d&lt;/code&gt; 上最后一个 &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw sample&lt;/a&gt; 的时间戳（以秒为单位，精确到毫秒）。&lt;/p&gt;
&lt;p&gt;和 timestamp 函数区别是在汇总结果中保留了 Metric  名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#timestamp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;timestamp&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器.&lt;/p&gt;
&lt;h3&gt;tfirst_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;tfirst_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#tfirst_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;tfirst_over_time(series_selector[d])&lt;/code&gt;针对 &lt;code&gt;series_selector&lt;/code&gt; 返回的每条时间序列独立计算，返回给定回溯窗口 &lt;code&gt;d&lt;/code&gt; 上第一个 raw sample 的时间戳（以秒为单位，精确到毫秒）。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#first_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;first_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;tlast_change_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;tlast_change_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#tlast_change_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;tlast_change_over_time (series_selector [d])&lt;/code&gt; 针对 &lt;code&gt;series_selector&lt;/code&gt; 返回的每条时间序列独立计算，返回给定回溯窗口 &lt;code&gt;d&lt;/code&gt; 上最后一次变化的时间戳（以秒为单位，精确到毫秒）。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#last_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;last_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;tlast_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;tlast_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#tlast_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;tlast_over_time&lt;/code&gt; 是 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#timestamp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;timestamp&lt;/a&gt; 函数的别名。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#tlast_change_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tlast_change_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;tmax_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;tmax_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#tmax_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;tmax_over_time(series_selector[d])&lt;/code&gt;返回给定回溯窗口 &lt;code&gt;d&lt;/code&gt; 上具有最大值的 raw sample 的时间戳（以秒为单位，精确到毫秒）。它针对 &lt;code&gt;series_selector&lt;/code&gt; 返回的每条时间序列独立计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#max_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;max_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;tmin_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;tmin_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#tmin_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;tmin_over_time(series_selector[d])&lt;/code&gt;返回给定回溯窗口 &lt;code&gt;d&lt;/code&gt; 上具有最小值的 raw sample 的时间戳（以秒为单位，精确到毫秒）。它针对 &lt;code&gt;series_selector&lt;/code&gt; 返回的每条时间序列独立计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#min_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;min_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;zscore_over_time&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;zscore_over_time&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#zscore_over_time&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;zscore_over_time(series_selector[d])&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Standard_score&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;z-score&lt;/a&gt; for &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;raw samples&lt;/a&gt; on the given lookbehind window &lt;code&gt;d&lt;/code&gt;. It is calculated independently per each time series returned from the given &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;zscore_over_time(series_selector[d])&lt;/code&gt;返回给定回溯窗口 &lt;code&gt;d&lt;/code&gt; 上 raw samples 的 &lt;a href=&#34;https://en.wikipedia.org/wiki/Standard_score&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;z-score&lt;/a&gt;。它针对 &lt;code&gt;series_selector&lt;/code&gt; 返回的每条时间序列独立计算。&lt;/p&gt;
&lt;p&gt;Metric名称将从计算结果中剥离。增加 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; 修改器来保留 Metric 名称。&lt;/p&gt;
&lt;p&gt;该函数通常应用于  &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;gauges&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#zscore&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;zscore&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_trim_zscore&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_trim_zscore&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outlier_iqr_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outlier_iqr_over_time&lt;/a&gt;.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>如何对集群版进行扩缩容</title>
      <link>http://localhost:1313/docs/ops/cluster-resize/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/ops/cluster-resize/</guid>
      <description>
        
        
        
      </description>
    </item>
    
    <item>
      <title>快速开始</title>
      <link>http://localhost:1313/docs/quickstart/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/quickstart/</guid>
      <description>
        
        
        &lt;h2&gt;如何安装&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何安装&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e5%ae%89%e8%a3%85&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;VictoriaMetrics 有 2 种发布形式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/nusk0evr8ycpcu1t&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;单机版本&lt;/a&gt; - ALL-IN-ONE 的二进制形式，非常易于使用和维护。可完美地垂直扩展，并且轻松处理百万级的QPS写入。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/viy5b75mqwwrdic1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群版本&lt;/a&gt; - 一套组件，可用于构建水平可扩展集群。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;单机版的 VictoriaMetrics 有以下几种提供方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/marketplace/pp/prodview-4tbfq5icmbmyc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Managed VictoriaMetrics at AWS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://hub.docker.com/r/victoriametrics/victoria-metrics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker&lt;/a&gt; 镜像&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://snapcraft.io/victoriametrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Snap packages&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/VictoriaMetrics/helm-charts#list-of-charts&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm Charts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;二进制&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;源代码&lt;/a&gt;。 参见&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#how-to-build-from-sources&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;如何构建源代码&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.linode.com/marketplace/apps/victoriametrics/victoriametrics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics on Linode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://marketplace.digitalocean.com/apps/victoriametrics-single&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics on DigitalOcean&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;只需要下载 VictoriaMetrics 然后跟随&lt;a href=&#34;https://www.yuque.com/icloudfly/xs51ky/nusk0evr8ycpcu1t#F6gyu&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些步骤&lt;/a&gt;把 VictoriaMetrics 运行起来，然后再阅读 &lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#prometheus-setup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus&lt;/a&gt; 和 &lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#grafana-setup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grafana 配置&lt;/a&gt;文档。&lt;/p&gt;
&lt;h3&gt;使用 Docker 启动单机版VM&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;使用-docker-启动单机版vm&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8-docker-%e5%90%af%e5%8a%a8%e5%8d%95%e6%9c%ba%e7%89%88vm&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;使用下面的命令下载最新版本的 VictoriaMetrics Docker 镜像，然后使用 8482 端口运行，并将数据存储在当前目录中的 &lt;code&gt;victoria-metrics-data&lt;/code&gt; 目录下。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker pull victoriametrics/victoria-metrics:latest
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;docker run -it --rm -v &lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;pwd&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;/victoria-metrics-data:/victoria-metrics-data -p 8428:8428 victoriametrics/victoria-metrics:latest&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;用浏览器打开 &lt;a href=&#34;http://localhost:8428/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;http://localhost:8428&lt;/a&gt; 然后阅读&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#operation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;使用 Docker 启动集群版VM&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;使用-docker-启动集群版vm&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8-docker-%e5%90%af%e5%8a%a8%e9%9b%86%e7%be%a4%e7%89%88vm&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;下面的命令 clone 最新版本的 VictoriaMetrics 仓库，然后使用命令&lt;code&gt;make docker-cluster-up&lt;/code&gt;启动 Docker 容器。更多的自定义启动项可以通过编辑&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/blob/master/deployment/docker/docker-compose-cluster.yml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;docker-compose-cluster.yml&lt;/a&gt;实现。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git clone https://github.com/VictoriaMetrics/VictoriaMetrics &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; cd VictoriaMetrics
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;make docker-cluster-up&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;更多详情&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/tree/master/deployment/docker#readme&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;请看这个文档&lt;/a&gt;和&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#ji-qun-an-zhuang&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群安装文档&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;数据写入&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;数据写入&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e5%86%99%e5%85%a5&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;数据采集有 2 种主要模式：Push 和 Pull。当今监控领域都会使用，VictoriaMetrics 也全都支持。&lt;/p&gt;
&lt;p&gt;更多数据写入详情，请&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/shu-ju-xie-ru&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;参考这里&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;数据查询&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;数据查询&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e6%9f%a5%e8%af%a2&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;VictoriaMetrics 提供了 HTTP 接口来处理查询请求。这些接口会被各种联合使用，比如 &lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#grafana-setup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grafana&lt;/a&gt;。这些 API 通用会被 &lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#vmui&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VMUI&lt;/a&gt; （用来查看并绘制请求数据的用户界面）使用。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/shu-ju-cha-xun/metricql&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MetricsQL&lt;/a&gt; - 是用来在 VictoriaMetrics 上查询数据的一种查询语言。 MetricsQL 是一个类 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PromQL&lt;/a&gt; 的查询语言，但它拥有很多强大的处理函数和特性来处理时序数据。&lt;/p&gt;
&lt;p&gt;更多数据查询详情，请&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/shu-ju-cha-xun&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;参考这里&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;告警&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;告警&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%91%8a%e8%ad%a6&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;我们不可能一直盯着监控图表来跟踪所有变化，这就是我们需要告警的原因。&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/xi-tong-zu-jian/vmalert&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmalert&lt;/a&gt; 可以基于 PromQL 或 MetricsQL 查询语句创建一系列条件，当条件触发时候会发送自动发送通知。&lt;/p&gt;
&lt;h2&gt;数据迁移&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;数据迁移&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;将数据从其他的 TSDB 迁移到 VictoriaMetrics 就像使用&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/shu-ju-xie-ru#push-mo-xing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;支持的数据格式&lt;/a&gt;导入数据一样简单。&lt;/p&gt;
&lt;p&gt;使用&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/xi-tong-zu-jian/vmctl&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmctl&lt;/a&gt;迁移数据会很简单（一个 VictoriaMetrics 命令行工具）。它支持将一下几种数据库的数据迁移到 VictoriaMetrics。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/vmctl.html#migrating-data-from-prometheus&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus using snapshot API&lt;/a&gt;;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/vmctl.html#migrating-data-from-thanos&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Thanos&lt;/a&gt;;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/vmctl.html#migrating-data-from-influxdb-1x&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;InfluxDB&lt;/a&gt;;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/vmctl.html#migrating-data-from-opentsdb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenTSDB&lt;/a&gt;;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/vmctl.html#migrating-data-from-victoriametrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Migrate data between VictoriaMetrics single and cluster versions&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;发布到生产&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;发布到生产&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%8f%91%e5%b8%83%e5%88%b0%e7%94%9f%e4%ba%a7&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;如果要在生产环境真正使用 VictoriaMetrics，我们有以下一些建议。&lt;/p&gt;
&lt;h3&gt;监控&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;监控&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%9b%91%e6%8e%a7&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;每个VictoriaMetrics组件都会暴露自己的指标，其中包含有关性能和健康状态的各种详细信息。组件的文档中都有一板块专门介绍监控，其中解释了组件的监控指标的含义，以及如何去监控。&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#jian-kong&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;比如这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics 团队为核心组件准备了一系列的 &lt;a href=&#34;https://grafana.com/orgs/victoriametrics/dashboards&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grafana Dashboard&lt;/a&gt;。每个 Dashboard 中都包含很多有用的信息和提示。建议使用安装这些 Dashboard 并保持更新。&lt;/p&gt;
&lt;p&gt;针对&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;单机版&lt;/a&gt;和&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群版&lt;/a&gt;的VM，还有一系列的告警规则来帮助我们定义和通知系统问题。&lt;/p&gt;
&lt;p&gt;有一个经验是：使用额外的一套独立的监控系统，去监控生产环境的VictoriaMetrics。而不是让它自己监控自己。&lt;/p&gt;
&lt;p&gt;更多详细内容请参考&lt;a href=&#34;https://victoriametrics.com/blog/victoriametrics-monitoring&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这篇文章&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;容量规划&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;容量规划&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;请阅读&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#rong-liang-gui-hua&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群版&lt;/a&gt;和&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#rong-liang-gui-hua&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;单机版&lt;/a&gt;文档中的容量规划部分。&lt;/p&gt;
&lt;p&gt;容量规划需要依赖于&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/kuai-su-kai-shi#monitoring&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;监控&lt;/a&gt;，所以你应该首先配置下监控。搞清楚资源使用情况以及VictoriaMetrics的性能的前提是，需要知道&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/faq#what-is-an-active-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;活跃时序系列&lt;/a&gt;，&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/faq#gao-liu-shi-lv-shi-zhi-shen-me&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高流失率&lt;/a&gt;，&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/faq#shen-me-shi-gao-ji-shu&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;基数&lt;/a&gt;，&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/faq#shen-me-shi-man-xie-ru&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;慢写入&lt;/a&gt;这些基础技术概念，他们都会在 &lt;a href=&#34;https://grafana.com/orgs/victoriametrics/dashboards&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grafana Dashboard&lt;/a&gt; 中呈现。&lt;/p&gt;
&lt;h3&gt;数据安全&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;数据安全&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e5%ae%89%e5%85%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;建议阅读下面几篇内容：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#replication-and-data-safety&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;多副本和数据可靠性&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://valyala.medium.com/speeding-up-backups-for-big-time-series-databases-533c1a927883&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Why replication doesn&amp;rsquo;t save from disaster?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#bei-fen&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;数据备份&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;配置限制&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;配置限制&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%85%8d%e7%bd%ae%e9%99%90%e5%88%b6&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;为了避免资源使用过度或性能下降，必须设置限制：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/faq#ru-he-xian-zhi-victoriametrics-zu-jian-de-nei-cun&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;资源使用限制&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#ji-shu-xian-zhi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;基数限制&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;安全建议&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;安全建议&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%ae%89%e5%85%a8%e5%bb%ba%e8%ae%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#an-quan&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;单机版安全建议&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#an-quan&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群版安全建议&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>操作 Label</title>
      <link>http://localhost:1313/docs/query/metricsql/functions/label/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/query/metricsql/functions/label/</guid>
      <description>
        
        
        &lt;p&gt;&lt;!-- raw HTML omitted --&gt;Label 操作函数对选定的 Rollup 计算结果进行 Label 转换。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;!-- raw HTML omitted --&gt;附加细节：&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;!-- raw HTML omitted --&gt;如果 Label 操作函数直接应用于&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(34, 34, 34);&amp;quot;&amp;gt;series_selector&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;，那么在执行 Label 转换之前，会自动应用&lt;!-- raw HTML omitted --&gt;&lt;code&gt;[default_rollup](https://docs.victoriametrics.com/metricsql/#default_rollup)&amp;lt;font style=&amp;quot;color:rgb(34, 34, 34);&amp;quot;&amp;gt;()&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;函数。例如，&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(34, 34, 34);&amp;quot;&amp;gt;alias(temperature, &amp;quot;foo&amp;quot;)&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 会被隐式转换为 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(34, 34, 34);&amp;quot;&amp;gt;alias(default_rollup(temperature), &amp;quot;foo&amp;quot;)&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;。&lt;!-- raw HTML omitted --&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;!-- raw HTML omitted --&gt;请参阅&lt;!-- raw HTML omitted --&gt;[隐式查询转换](implicit query conversions)&lt;!-- raw HTML omitted --&gt;。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;支持的 Label 操作函数如下：&lt;/p&gt;
&lt;h3&gt;alias&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;alias&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#alias&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;alias(q, &amp;quot;name&amp;quot;)&lt;/code&gt; 将&lt;code&gt;q&lt;/code&gt;返回的所有时间序列更名为&lt;code&gt;name&lt;/code&gt;。例如，&lt;code&gt;alias(up, &amp;quot;foobar&amp;quot;)&lt;/code&gt; 会将&lt;code&gt;up&lt;/code&gt;序列重命名为&lt;code&gt;foobar&lt;/code&gt; 序列。&lt;/p&gt;
&lt;h3&gt;drop_common_labels&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;drop_common_labels&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#drop_common_labels&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;drop_common_labels(q1, ...., qN)&lt;/code&gt;会删除 &lt;code&gt;q1, ..., qN&lt;/code&gt; 返回的时间序列中共有的&lt;code&gt;label=&amp;quot;value&amp;quot;&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;label_copy&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_copy&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_copy&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_copy(q, &amp;quot;src_label1&amp;quot;, &amp;quot;dst_label1&amp;quot;, ..., &amp;quot;src_labelN&amp;quot;, &amp;quot;dst_labelN&amp;quot;)&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;将&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;src_label*&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;的 Label 值复制到&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;q&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;返回的所有时间序列的&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;dst_label*&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;。如果&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;src_label&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;为空，则相应的 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;dst_label&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;保持不变。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3&gt;label_del&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_del&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_del&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_del(q, &amp;quot;label1&amp;quot;, ..., &amp;quot;labelN&amp;quot;)&lt;/code&gt; &lt;!-- raw HTML omitted --&gt;删除&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;q&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;返回的所有时间序列中名为&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;label*&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;的所有 Label。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3&gt;label_join&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_join&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_join&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_join(q, &amp;quot;dst_label&amp;quot;, &amp;quot;separator&amp;quot;, &amp;quot;src_label1&amp;quot;, ..., &amp;quot;src_labelN&amp;quot;)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;!-- raw HTML omitted --&gt;它将&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;src_label*&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;的值用给定的&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;separator&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;连接起来，并将结果存储在&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;dst_label&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;中。这是针对 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;q&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 返回的每条时间序列独立执行的。例如，&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;label_join(up{instance=&amp;quot;xxx&amp;quot;,job=&amp;quot;yyy&amp;quot;}, &amp;quot;foo&amp;quot;, &amp;quot;-&amp;quot;, &amp;quot;instance&amp;quot;, &amp;quot;job&amp;quot;)&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 会将&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;xxx-yyy&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;标签值存储到&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;foo&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;标签中。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;!-- raw HTML omitted --&gt;该函数在 PromQL 中也支持。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3&gt;label_keep&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_keep&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_keep&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_keep(q, &amp;quot;label1&amp;quot;, ..., &amp;quot;labelN&amp;quot;)&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;删除 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;q&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 返回的所有时间序列中除列出的 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;label*&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; Label 之外的其他所有 Label。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3&gt;label_lowercase&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_lowercase&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_lowercase&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_lowercase(q, &amp;quot;label1&amp;quot;, ..., &amp;quot;labelN&amp;quot;)&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;将 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;q&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 返回的所有时间序列中名为&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;label*&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;的 Label 值转换成小写字母。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3&gt;label_map&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_map&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_map&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_map(q, &amp;quot;label&amp;quot;, &amp;quot;src_value1&amp;quot;, &amp;quot;dst_value1&amp;quot;, ..., &amp;quot;src_valueN&amp;quot;, &amp;quot;dst_valueN&amp;quot;)&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;遍历 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;q&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 返回的所有时间序列，将所有 Label 值是&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;src_value*&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;的 Label 值对应的&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;dst_value*&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3&gt;label_match&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_match&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_match&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_match(q, &amp;quot;label&amp;quot;, &amp;quot;regexp&amp;quot;)&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;会删除 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(34, 34, 34);&amp;quot;&amp;gt;q&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 中&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(34, 34, 34);&amp;quot;&amp;gt;label&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;值不匹配给定正则表达式&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(34, 34, 34);&amp;quot;&amp;gt;regexp&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;的时间序列。&lt;!-- raw HTML omitted --&gt;&lt;strong&gt;&lt;!-- raw HTML omitted --&gt;此函数在类 rollup 函数之后会比较有用，因为这些类 rollup 函数可能会为每个输入序列返回多个时间序列。&lt;!-- raw HTML omitted --&gt;&lt;/strong&gt;&lt;br&gt;
&lt;!-- raw HTML omitted --&gt;另请参见 &lt;!-- raw HTML omitted --&gt;&lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_mismatch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_mismatch&lt;/a&gt;&lt;!-- raw HTML omitted --&gt; 和 &lt;!-- raw HTML omitted --&gt;&lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#labels_equal&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;labels_equal&lt;/a&gt;&lt;!-- raw HTML omitted --&gt;。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3&gt;label_mismatch&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_mismatch&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_mismatch&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_mismatch(q, &amp;quot;label&amp;quot;, &amp;quot;regexp&amp;quot;)&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;会删除 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(34, 34, 34);&amp;quot;&amp;gt;q&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 中&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(34, 34, 34);&amp;quot;&amp;gt;label&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;值匹配给定正则表达式&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(34, 34, 34);&amp;quot;&amp;gt;regexp&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;的时间序列。&lt;!-- raw HTML omitted --&gt;&lt;strong&gt;&lt;!-- raw HTML omitted --&gt;此函数在类 rollup 函数之后会比较有用，因为这些类 rollup 函数可能会为每个输入序列返回多个时间序列。&lt;!-- raw HTML omitted --&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_match&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_match&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#labels_equal&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;labels_equal&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;label_move&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_move&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_move&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_move(q, &amp;quot;src_label1&amp;quot;, &amp;quot;dst_label1&amp;quot;, ..., &amp;quot;src_labelN&amp;quot;, &amp;quot;dst_labelN&amp;quot;)&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;它将&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;src_label*&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;的 Label 值移动到&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;q&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;返回的所有时间序列的&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;dst_label*&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;。如果 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;src_label&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 为空，则相应的 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;dst_label&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 保持不变。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3&gt;label_replace&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_replace&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_replace&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_replace(q, &amp;quot;dst_label&amp;quot;, &amp;quot;replacement&amp;quot;, &amp;quot;src_label&amp;quot;, &amp;quot;regex&amp;quot;)&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;它将给定的正则表达式 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;regexp&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 应用于 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;src_label&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;，如果给定的正则表达式匹配 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;src_label&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;，则将替换内容存储在 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;dst_label&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 中。替换内容可以包含对正则表达式捕获组的引用，例如 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;$1&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;、&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;$2&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 等。这些引用会被相应的正则表达式捕获组替换。例如，&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;label_replace(up{job=&amp;quot;node-exporter&amp;quot;}, &amp;quot;foo&amp;quot;, &amp;quot;bar-$1&amp;quot;, &amp;quot;job&amp;quot;, &amp;quot;node-(.+)&amp;quot;)&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 会将 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;bar-exporter&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 标签值存储到 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;foo&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 标签中。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;!-- raw HTML omitted --&gt;该函数在 PromQL 中也支持。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3&gt;label_set&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_set&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_set&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_set(q, &amp;quot;label1&amp;quot;, &amp;quot;value1&amp;quot;, ..., &amp;quot;labelN&amp;quot;, &amp;quot;valueN&amp;quot;)&lt;/code&gt;将&lt;code&gt;{label1=&amp;quot;value1&amp;quot;, ..., labelN=&amp;quot;valueN&amp;quot;}&lt;/code&gt;这些 Label 添加到&lt;code&gt;q&lt;/code&gt;返回的每条时间序列数据里。&lt;/p&gt;
&lt;h3&gt;label_transform&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_transform&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_transform&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_transform(q, &amp;quot;label&amp;quot;, &amp;quot;regexp&amp;quot;, &amp;quot;replacement&amp;quot;)&lt;/code&gt; &lt;!-- raw HTML omitted --&gt;将给定 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;label&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 中所有匹配正则表达式 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;regexp&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 的部分替换为指定的 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;replacement&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3&gt;label_uppercase&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_uppercase&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_uppercase&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_uppercase(q, &amp;quot;label1&amp;quot;, ..., &amp;quot;labelN&amp;quot;)&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;将 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;q&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 返回的所有时间序列中名为&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;label*&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;的 Label 值转换成大写字母。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;另请参见 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_lowercase&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_lowercase&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;label_value&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;label_value&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#label_value&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;label_value(q, &amp;quot;label&amp;quot;)&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;它为 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;q&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 返回的每条时间序列中的给定 label 的值作为指标 value 返回（原指标 value 被忽略）。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;!-- raw HTML omitted --&gt;例如，如果 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;label_value(foo, &amp;quot;bar&amp;quot;)&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 应用于 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;foo{bar=&amp;quot;1.234&amp;quot;}&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;，那么它将返回一个值为&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;1.234&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;的时间序列&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;foo{bar=&amp;quot;1.234&amp;quot;}&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;. 对于 label 值是非数值类型情况，该函数将不返回数据。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3&gt;labels_equal&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;labels_equal&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#labels_equal&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;labels_equal(q, &amp;quot;label1&amp;quot;, &amp;quot;label2&amp;quot;, ...)&lt;/code&gt;在 q &lt;!-- raw HTML omitted --&gt;返回每条时间序列里，寻找 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(34, 34, 34);&amp;quot;&amp;gt;“label1”&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;、&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(34, 34, 34);&amp;quot;&amp;gt;“label2”&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 值相等的时间序列，并返回。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_match&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_match&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_mismatch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_mismatch&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;sort_by_label&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sort_by_label&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sort_by_label&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;sort_by_label(q, &amp;quot;label1&amp;quot;, ... &amp;quot;labelN&amp;quot;)&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;根据给定的一组 Label 按升序排序序列。例如，&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;sort_by_label(foo, &amp;quot;bar&amp;quot;)&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 会根据这些序列中 Label &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;bar&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;的值对&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;foo&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;序列进行排序。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sort_by_label_desc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sort_by_label_desc&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sort_by_label_numeric&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sort_by_label_numeric&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;sort_by_label_desc&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sort_by_label_desc&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sort_by_label_desc&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;sort_by_label&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 的反向操作，即降序排列。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;h3&gt;sort_by_label_numeric&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sort_by_label_numeric&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sort_by_label_numeric&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;sort_by_label_numeric(q, &amp;quot;label1&amp;quot;, ... &amp;quot;labelN&amp;quot;)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label-manipulation-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label manipulation function&lt;/a&gt;, which sorts series in ascending order by the given set of labels using &lt;a href=&#34;https://www.gnu.org/software/coreutils/manual/html_node/Version-sort-is-not-the-same-as-numeric-sort.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;numeric sort&lt;/a&gt;. For example, if &lt;code&gt;foo&lt;/code&gt; series have &lt;code&gt;bar&lt;/code&gt; label with values &lt;code&gt;1&lt;/code&gt;, &lt;code&gt;101&lt;/code&gt;, &lt;code&gt;15&lt;/code&gt; and &lt;code&gt;2&lt;/code&gt;, then &lt;code&gt;sort_by_label_numeric(foo, &amp;quot;bar&amp;quot;)&lt;/code&gt; would return series in the following order of &lt;code&gt;bar&lt;/code&gt; label values: &lt;code&gt;1&lt;/code&gt;, &lt;code&gt;2&lt;/code&gt;, &lt;code&gt;15&lt;/code&gt; and &lt;code&gt;101&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;sort_by_label_numeric(q, &amp;quot;label1&amp;quot;, ... &amp;quot;labelN&amp;quot;)&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;根据给定的一组 Label 使用数值排序，按升序排序序列。例如，如果 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;foo&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 序列的 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;bar&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 标签值为 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;1&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;、&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;101&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;、&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;15&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 和 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;2&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;，那么 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;sort_by_label_numeric(foo, &amp;quot;bar&amp;quot;)&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;会按 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;bar&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 标签值的以下顺序返回序列：&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;1&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;、&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;2&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;、&lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;15&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt; 和 &lt;!-- raw HTML omitted --&gt;&lt;code&gt;&amp;lt;font style=&amp;quot;color:rgb(31, 35, 41);&amp;quot;&amp;gt;101&amp;lt;/font&amp;gt;&lt;/code&gt;&lt;!-- raw HTML omitted --&gt;。&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;另请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sort_by_label_numeric_desc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sort_by_label_numeric_desc&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sort_by_label&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sort_by_label&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;sort_by_label_numeric_desc&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sort_by_label_numeric_desc&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sort_by_label_numeric_desc&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;sort_by_label_numeric&lt;/code&gt;的反向操作，即降序排列。&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>PromQL 新手入门</title>
      <link>http://localhost:1313/docs/query/metricsql/promql/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/query/metricsql/promql/</guid>
      <description>
        
        
        &lt;p&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PromQL&lt;/a&gt; 是 &lt;a href=&#34;https://prometheus.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus&lt;/a&gt; 系统的查询语言。它是为绘图、告警或派生 Timeseries（通过 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/configuration/recording_rules/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;recording rules&lt;/a&gt;） 场景而设计的强大且简单的语言。PromQL 是从零开始设计的，与其他在时间序列数据库中使用的查询语言（比如 &lt;a href=&#34;https://www.timescale.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TimescaleDB 的 SQ&lt;/a&gt;L，&lt;a href=&#34;https://docs.influxdata.com/influxdb/v1.7/query_language/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;InfluxQL&lt;/a&gt; 或者 &lt;a href=&#34;https://github.com/influxdata/flux&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Flux&lt;/a&gt;）没有任何共同之处。&lt;/p&gt;
&lt;p&gt;这样做可以为典型的 TSDB 查询创建一个清晰的语言。但是它也有代价 - 初学者通常需要花费几个小时阅读官方的&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PromQL文档&lt;/a&gt;，才能理解其工作原理。让我们简化和缩短 PromQL 的学习曲线。&lt;/p&gt;
&lt;h2&gt;查询一个 Timeseries&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;查询一个-timeseries&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%9f%a5%e8%af%a2%e4%b8%80%e4%b8%aa-timeseries&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;选择使用 PromQL 查询 Timeseries 就像在查询中写入一个时间序列名称一样简单。例如，下面的查询将返回所有名称为&lt;code&gt;node_network_receive_bytes_total&lt;/code&gt;的 timeseries：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;node_network_receive_bytes_total&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;这个名称源自于&lt;a href=&#34;https://github.com/prometheus/node_exporter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;node_exporter指标&lt;/a&gt;，它包含了在各种网络接口上接收的字节数。这样一个简单的查询可能会返回具有相同名称但带有不同 Label Set 的多个 Timeseries。例如，上面的查询可能会返回以下 &lt;code&gt;device&lt;/code&gt; Label 等于&lt;code&gt;eth0&lt;/code&gt;、&lt;code&gt;eth1&lt;/code&gt;和&lt;code&gt;eth2&lt;/code&gt;的 Timeseries：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;node_network_receive_bytes_total{device=&amp;#34;eth0&amp;#34;}
node_network_receive_bytes_total{device=&amp;#34;eth1&amp;#34;}
node_network_receive_bytes_total{device=&amp;#34;eth2&amp;#34;}&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;不通的Label被放在了花括号中：&lt;code&gt;{device=&amp;quot;eth0&amp;quot;}&lt;/code&gt;, &lt;code&gt;{device=&amp;quot;eth1&amp;quot;}&lt;/code&gt;, &lt;code&gt;{device=&amp;quot;eth2&amp;quot;}&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;让我们来看下 TimescaleDB 的 SQL 来达到同样的效果：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;SELECT
  ts.metric_name_plus_tags,
  r.timestamps,
  r.values
FROM (
  (SELECT
   time_series_id,
   array_agg(timestamp ORDER BY timestamp) AS timestamps,
   array_agg(value ORDER BY timestamp) AS values
   FROM
   metrics
   WHERE
   time_series_id IN (
     SELECT id FROM time_series
     WHERE metric_name = &amp;#39;node_network_receive_bytes_total&amp;#39;
   )
   GROUP BY
   time_series_id
  )
) AS r JOIN time_series AS ts ON (r.time_series_id = ts.id)&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;对比下来是不是觉得很简单。SQL 不得不写得更加复杂，才能与上述的PromQL查询结果相媲美。因为 SQL 不会自带时间范围和降采样机制，但这些都会被 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#range-queries&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PromQL 的 /query_range&lt;/a&gt; 接口 使用&lt;code&gt;start&lt;/code&gt;，&lt;code&gt;end&lt;/code&gt;和&lt;code&gt;step&lt;/code&gt;参数自动完成。&lt;/p&gt;
&lt;h2&gt;使用Label过滤&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;使用label过滤&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8label%e8%bf%87%e6%bb%a4&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;一个指标名称可能返回多个具有不同 Label Set 的 timeseries，就像上面的例子一样。如何选择只匹配&lt;code&gt;{device=&amp;quot;eth1&amp;quot;}&lt;/code&gt;的 timeseries？只需在查询中提及所需的 Label 即可：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;node_network_receive_bytes_total{device=&amp;#34;eth1&amp;#34;}&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;如果你想要查询除了 &lt;code&gt;eth1&lt;/code&gt; 的所有 timeseries，只需要把语句里的&lt;code&gt;=&lt;/code&gt;换成&lt;code&gt;!=&lt;/code&gt;就可以：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;node_network_receive_bytes_total{device!=&amp;#34;eth1&amp;#34;}&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;如何选择&lt;code&gt;device&lt;/code&gt;以 &lt;code&gt;eth&lt;/code&gt; 开头的所有 timeseries 呢？只需要使用正则表达式：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;node_network_receive_bytes_total{device=~&amp;#34;eth.&amp;#43;&amp;#34;}&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;这个正则过滤器支持 &lt;a href=&#34;https://golang.org/pkg/regexp/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Go 语言&lt;/a&gt;（RE2）支持的所有写法。&lt;/p&gt;
&lt;p&gt;要查询所有&lt;code&gt;device&lt;/code&gt;不以 &lt;code&gt;eth&lt;/code&gt; 开头的 timeseries，则只需要把 &lt;code&gt;=~&lt;/code&gt; 替换为 &lt;code&gt;!~&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;node_network_receive_bytes_total{device!~&amp;#34;eth.&amp;#43;&amp;#34;}&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h2&gt;使用多个Label过滤&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;使用多个label过滤&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8%e5%a4%9a%e4%b8%aalabel%e8%bf%87%e6%bb%a4&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Label 过滤器可以被联合使用。举个例子：下面的查询语句只会返回&lt;code&gt;node42:9100&lt;/code&gt;实例中&lt;code&gt;device&lt;/code&gt;以&lt;code&gt;eth&lt;/code&gt;开头的 timeseries。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;node_network_receive_bytes_total{instance=&amp;#34;node42:9100&amp;#34;, device=~&amp;#34;eth.+&amp;#34;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;这些 Label 过滤器之间是与运算关系。意思是『返回即匹配这个过滤器，又匹配那个过滤器的数据』。&lt;/p&gt;
&lt;p&gt;那如果实现或运算逻辑呢？当前的 PromQL 是不支持或运算的，但大多数场景是可以通过正则表达式来解决的。举个例子，下面的查询语句就会返回 &lt;code&gt;device&lt;/code&gt; 是 &lt;code&gt;eth1&lt;/code&gt; 或 &lt;code&gt;lo&lt;/code&gt; 的 timeseries。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;node_network_receive_bytes_total{device=~&amp;#34;eth1|lo&amp;#34;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h2&gt;对 Metric 名称使用正则过滤&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;对-metric-名称使用正则过滤&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%af%b9-metric-%e5%90%8d%e7%a7%b0%e4%bd%bf%e7%94%a8%e6%ad%a3%e5%88%99%e8%bf%87%e6%bb%a4&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;有时我们可能需要同时返回多个监控指标。Metric 名称本质上也是一个普通的 Label 的值，其 Label 名是&lt;code&gt;__name__&lt;/code&gt;。所以可以通过对 Metric 名使用正则的方式，来过滤出多个指标名的数据。举个例子，下面的查询语句会返回 &lt;code&gt;node_network_receive_bytes_total&lt;/code&gt; 和&lt;code&gt;node_network_transmit_bytes_total&lt;/code&gt;两个指标的 timeseries 数据：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;{__name__=~&amp;#34;node_network_(receive|transmit)_bytes_total&amp;#34;}&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h2&gt;对比最新数据和历史数据&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;对比最新数据和历史数据&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%af%b9%e6%af%94%e6%9c%80%e6%96%b0%e6%95%b0%e6%8d%ae%e5%92%8c%e5%8e%86%e5%8f%b2%e6%95%b0%e6%8d%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;PromQL 支持查询历史数据，并将它与当前最新数据进行合并或对比。只需要给查询语句增加一个 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics/#offset-modifier&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;offset&lt;/a&gt;。举个例子，下面的查询语句会返回一周前名字是&lt;code&gt;node_network_receive_bytes_total&lt;/code&gt;的所有 timeseries：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;node_network_receive_bytes_total offset 7d&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;The following query would return points where the current GC overhead exceeds hour-old GC overhead by 1.5x.&lt;/p&gt;
&lt;p&gt;下面的查询将返回当前GC开销超过一小时前GC开销1.5倍的数据点。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;go_memstats_gc_cpu_fraction &amp;gt; 1.5 * (go_memstats_gc_cpu_fraction offset 1h)&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;运算符 &lt;code&gt;&amp;gt;&lt;/code&gt; 和 &lt;code&gt;*&lt;/code&gt; 在下面会有介绍。&lt;/p&gt;
&lt;h2&gt;计算速率&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;计算速率&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e8%ae%a1%e7%ae%97%e9%80%9f%e7%8e%87&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;细心的读者会注意到上面的查询语句在 &lt;a href=&#34;http://docs.grafana.org/features/datasources/prometheus/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grafana&lt;/a&gt; 上绘制的线条都是下面这样递增的样式：&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../promql-demo-1.png&#34; alt=&#34;Counter 类型&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;这样的图表实用性几乎为零，因为它们显示的是难以解释的不断增长的Counter值，而我们想要的是网络带宽图表 —— 在图表左侧看到&lt;code&gt;MB/s&lt;/code&gt;。PromQL有一个神奇的函数可以实现这个功能 —— &lt;code&gt;rate()&lt;/code&gt;。它可以计算所有匹配时间序列的每秒速率：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;rate(node_network_receive_bytes_total[5m])&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;这样监控图就变正确了：&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../promql-demo-2.png&#34; alt=&#34;rate(counter[5m])&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;查询语句中的 &lt;code&gt;[5m]&lt;/code&gt; 是什么意思呢？这是一个代表 &lt;code&gt;5m&lt;/code&gt;（5分钟）时间区间。在这个场景中，在计算每个时间点的每秒平均增长率时， 会往回看&lt;code&gt;5m&lt;/code&gt;的数据，即最近5分钟的每秒平均增长。每个数据点的计算公式可以简化为&lt;code&gt;(Vcurr-Vprev)/(Tcurr-Tprev)&lt;/code&gt;，&lt;code&gt;Vcurr&lt;/code&gt; 代表当前时间&lt;code&gt;Tcurr&lt;/code&gt;上的数值，&lt;code&gt;Vprev&lt;/code&gt; 代表在时间&lt;code&gt;Tprev&lt;/code&gt; 上的数值，其中&lt;code&gt;Tprev=Tcurr-5m&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;如果这看起来太复杂，那么就记住，这个时间区间越大，监控图就会约平滑；而更小的时间区间会让监控图变得更加跳跃（抖动）。VictoriaMetrics 对 PromQL 进行了扩展，这个时间区间&lt;code&gt;[d]&lt;/code&gt;可以省略不写，缺省情况下就是2个数据点之间的间隔（通过&lt;code&gt;step&lt;/code&gt;参数指定的），而&lt;code&gt;step&lt;/code&gt;的默认缺省值是&lt;code&gt;5m&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;rate(node_network_receive_bytes_total)&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h2&gt;速率(rate)的缺陷&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;速率rate的缺陷&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%80%9f%e7%8e%87rate%e7%9a%84%e7%bc%ba%e9%99%b7&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Rate 删除度量名称，同时保留内部时间序列的所有 Label。&lt;/p&gt;
&lt;p&gt;不要对可能上下波动的时间序列使用 Rate。此类时间序列称为 &lt;a href=&#34;https://prometheus.io/docs/concepts/metric_types/#gauge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Gauge&lt;/a&gt;。Rate 只能应用于 &lt;a href=&#34;https://prometheus.io/docs/concepts/metric_types/#counter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Counter&lt;/a&gt;，Counter 总是上升的，但有时可能会重置为零（例如，服务重启时）。&lt;/p&gt;
&lt;p&gt;不要用&lt;code&gt;irate&lt;/code&gt;代替&lt;code&gt;rate&lt;/code&gt;，因为它不能&lt;a href=&#34;https://medium.com/@valyala/why-irate-from-prometheus-doesnt-capture-spikes-45f9896d7832&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;捕捉尖峰&lt;/a&gt;，而且查询速度也比&lt;code&gt;rate&lt;/code&gt;快不了多少。&lt;/p&gt;
&lt;h2&gt;算术运算&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;算术运算&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%ae%97%e6%9c%af%e8%bf%90%e7%ae%97&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;PromQL 支持所有基础的算术运算&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;加法 (+)&lt;/li&gt;
&lt;li&gt;减法 (-)&lt;/li&gt;
&lt;li&gt;乘法 (*)&lt;/li&gt;
&lt;li&gt;除法 (/)&lt;/li&gt;
&lt;li&gt;取模 (%)&lt;/li&gt;
&lt;li&gt;指数 (^)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这样就可以进行各种数据转换。比如，将&lt;code&gt;bytes/s&lt;/code&gt;转换成&lt;code&gt;bits/s&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;rate(node_network_receive_bytes_total[5m]) * 8&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;此外，也可以进行跨指标运算。例如，&lt;a href=&#34;https://www.influxdata.com/blog/practical-uses-of-cross-measurement-math-in-flux/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;该文中巨大的 Flux 查询&lt;/a&gt;就可以简单地用下面的 PromQL 语句表达：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;co2 * (((temp_c &amp;#43; 273.15) * 1013.25) / (pressure * 298.15))&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;将多个时间序列与算术运算结合起来需要了解&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;匹配规则&lt;/a&gt;。否则查询可能会导致数据中断或不正确的结果。匹配规则的基础很简单：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PromQL 引擎从算术运算左侧和右侧的所有时间序列中剥离指标名称（Metric Name），但不触及标签（Label）&lt;/li&gt;
&lt;li&gt;对于左侧的每个时间序列，PromQL 引擎搜索右侧具有相同标签集（Label Set）的相应时间序列，对每个数据点应用运算操作，并返回具有相同标签集（Label Set）的运算结果。如果没有找到匹配的标签集合（Label Set），则时间序列会被从结果中忽略丢弃。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;匹配规则可以通过 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ignoring&lt;/a&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;,&lt;/a&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;on&lt;/a&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;,&lt;/a&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;group_left&lt;/a&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;和&lt;/a&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;group_right&lt;/a&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;修饰符&lt;/a&gt;进行增强。不过其逻辑非常复杂，大多数场景都不需要使用。&lt;/p&gt;
&lt;h2&gt;比较运算&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;比较运算&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%af%94%e8%be%83%e8%bf%90%e7%ae%97&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;PromQL 支持下面几种&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#comparison-binary-operators&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;比较运算&lt;/a&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;等于 (==)&lt;/li&gt;
&lt;li&gt;不等于 (!=)&lt;/li&gt;
&lt;li&gt;大于 (&amp;gt;)&lt;/li&gt;
&lt;li&gt;大于等于 (&amp;gt;=)&lt;/li&gt;
&lt;li&gt;小于 (&amp;lt;)&lt;/li&gt;
&lt;li&gt;小于等于 (&amp;lt;=)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些运算符可以像算术运算符一样应用于任意 PromQL 表达式。 比较操作的结果是具有唯一匹配数据点的时间序列。 例如，以下查询将仅返回小于 2300 字节/秒的带宽&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;rate(node_network_receive_bytes_total[5m]) &amp;lt; 2300&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;其结果如下图所示，图中会出现带宽超过 2300 字节/秒的间隙：&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../promql-demo-3.png&#34; alt=&#34;rate(node_network_receive_bytes_total[5m]) &amp;lt; 2300&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;比较运算符的结果可以使用 bool 修饰符进行修改：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;rate(node_network_receive_bytes_total[5m]) &amp;lt; bool 2300&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;在这个例子中，对于有数据的部分会被转化为&lt;code&gt;true（1）&lt;/code&gt;，没有数据的转换成&lt;code&gt;false（0）&lt;/code&gt;：&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../promql-demo-4.png&#34; alt=&#34;rate(node_network_receive_bytes_total[5m]) &amp;lt; bool 2300&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;h2&gt;分组聚合函数&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;分组聚合函数&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%88%86%e7%bb%84%e8%81%9a%e5%90%88%e5%87%bd%e6%95%b0&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;PromQL 支持对时间序列进行&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;分组聚合&lt;/a&gt;。时间序列按给定的标签集（Labels）进行分组，然后将给定的聚合函数应用于每个组。 例如，以下查询将返回按实例分组的所有网络接口的入口流量总和：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;sum(rate(node_network_receive_bytes_total[5m])) by (instance)&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h2&gt;使用 Gauge&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;使用-gauge&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8-gauge&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Gauge 是随时可能上下波动的时间序列。 例如，内存使用情况、温度或压力。 绘制仪表图表时，预计会看到图表上每个点的最小值、最大值、平均值和/或分位数值。PromQL 支持使用下面的函数完成这些：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#min_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;min_over_time&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#max_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;max_over_time&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#avg_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;avg_over_time&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#quantile_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;quantile_over_time&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;比如，以下查询将在图表上绘制每个时间序列的可用内存的最小值：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;min_over_time(node_memory_MemFree_bytes[5m])&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;VictoriaMetrics 为 PromQL 增添了 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#rollup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup_*&lt;/a&gt; 函数，当处理 Gauge 时，它会自动返回 &lt;code&gt;min&lt;/code&gt;, &lt;code&gt;max&lt;/code&gt; 和 &lt;code&gt;avg&lt;/code&gt; 值，例如:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;rollup(node_memory_MemFree_bytes)&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h2&gt;操纵Label&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;操纵label&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%93%8d%e7%ba%b5label&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;PromQL 提供了 2 个函数用于 Label 修改，丰富、删除或创建：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#label_replace&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_replace&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#label_join&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_join&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;尽管这些函数使用起来很困难，但它们允许对所选时间序列上的标签进行强大的动态操作。 label_ 函数的主要用例是将标签转换为所需的值。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics 提供了&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#label-manipulation-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;更丰富的而方便的 Label 改写方法&lt;/a&gt;了扩展了这方面的能力。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#label_set&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_set&lt;/a&gt; — 为时间序列额外增加 Label&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#label_del&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_del&lt;/a&gt; — 从时间序列中删除指定的 Label&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#label_keep&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_keep&lt;/a&gt; — 从时间序列中保留指定的 Label，而删除其他所有 Label&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#label_copy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_copy&lt;/a&gt; — 把某个 Label Values 复制成其他 Label&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#label_move&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_move&lt;/a&gt;— 重命名 Label Name&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#label_transform&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_transform&lt;/a&gt; — 将所有匹配了正则表达式的子串，替换到模板中。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#label_value&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_value&lt;/a&gt; — 将规定 Label 的 Value 转换为数字，作为 Value 返回。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;一个查询返回多个结果&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;一个查询返回多个结果&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%b8%80%e4%b8%aa%e6%9f%a5%e8%af%a2%e8%bf%94%e5%9b%9e%e5%a4%9a%e4%b8%aa%e7%bb%93%e6%9e%9c&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;有时候我们需要使用一个 PromQl 语句查询多个时间序列结果。可以使用 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#logical-set-binary-operators&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;or&lt;/a&gt; 操作符。比如，下面的语句将会返回名为 &lt;code&gt;metric1&lt;/code&gt;、&lt;code&gt;metric2&lt;/code&gt; 和 &lt;code&gt;metric3&lt;/code&gt; 的时序数据结果：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;metric1 or metric2 or metric3&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;VictoriaMetrics 简化了语句的写法，只需要把这些指标用括号（）包围起来：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;(metric1, metric2, metric3)&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;请注意，这里可以放置任何 PromQL 语句，而不仅仅只是指标名称。&lt;/p&gt;
&lt;p&gt;使用组合表达式 or 时候时，经常会掉进一个陷阱：具有重复标签集（Label Set）的数据结果将被跳过。 例如，以下查询将跳过 sum(b)，因为 sum(a) 和 sum(b) 具有相同的标签集（它们根本没有标签）：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;pre&gt;&lt;code&gt;sum(a) or sum(b)&lt;/code&gt;&lt;/pre&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h2&gt;总结&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;总结&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%80%bb%e7%bb%93&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;PromQL 是一种简单但功能强大的时间序列数据库查询语言。 它允许以简洁而清晰的方式编写典型的 TSDB 查询，特别是与 SQL、InfluxQL 或 Flux 进行比较时。 虽然它可能不支持一些查询，而这些场景是由强大的 SQL 查询支持的，但这些场景在实践中非常罕见，以至于我现在至少记不起一个。 如果您知道此类情况，请在评论中提及。&lt;/p&gt;
&lt;p&gt;本文并没有提及 PromQL 中所有的功能，因为本文仅针对初学者：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;本文没有提及很多&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/functions/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;函数&lt;/a&gt;和&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/operators/#logical-set-binary-operators&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;逻辑运算符&lt;/a&gt; 。&lt;/li&gt;
&lt;li&gt;本文没有包含&lt;a href=&#34;https://medium.com/@valyala/prometheus-subqueries-in-victoriametrics-9b1492b720b3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;子查询&lt;/a&gt;内容。&lt;/li&gt;
&lt;li&gt;本文没有包含查询模板(通过 &lt;code&gt;CTE&lt;/code&gt; or &lt;a href=&#34;https://victoriametrics.com/promql/expand-with-exprs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;WITH templates&lt;/a&gt;), 它可以大大简化复杂的 PromQL 语句。&lt;/li&gt;
&lt;li&gt;本味没有提及很多 VictoriaMetrics 所支持的 &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MetricsQL&lt;/a&gt; 诸多有用特性。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我建议可以通过这个&lt;a href=&#34;https://promlabs.com/promql-cheat-sheet/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;备忘单&lt;/a&gt;来学习 PromQL。&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>单机版本</title>
      <link>http://localhost:1313/docs/single/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/single/</guid>
      <description>
        
        
        &lt;h2&gt;安装部署&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;安装部署&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85%e9%83%a8%e7%bd%b2&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;安装&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;安装&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%ae%89%e8%a3%85&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;要快速尝试VictoriaMetrics，只需下载&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics可执行文件&lt;/a&gt;或&lt;a href=&#34;https://hub.docker.com/r/victoriametrics/victoria-metrics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker镜像&lt;/a&gt;，并使用所需的运行参数启动它。还可以参考&lt;a href=&#34;http://localhost:1313/docs/quickstart/&#34; &gt;快速开始&lt;/a&gt;指南获取更多信息。&lt;/p&gt;
&lt;p&gt;此外，也可以通过以下方法来安装VictoriaMetrics：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/VictoriaMetrics/helm-charts&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm charts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/VictoriaMetrics/operator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes operator&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/VictoriaMetrics/ansible-playbooks&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;安装集群版本的 Ansible Role（官方）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Slapper/ansible-victoriametrics-cluster-role&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;安装集群版本的 Ansible Role（社区）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/dreamteam-gg/ansible-victoriametrics-role&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;安装单机版的 Ansible Role（社区）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://snapcraft.io/victoriametrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Snap package&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;运行&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;运行&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e8%bf%90%e8%a1%8c&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;下面的几个运行参数是最常用的：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-storageDataPath&lt;/code&gt;：VictoriaMetrics 把所有的数据都保存在这个目录。默认的路径是当前工作目录中的&lt;code&gt;victoria-metrics-data&lt;/code&gt; 子目录。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-retentionPeriod&lt;/code&gt;：数据的保留时间。历史的数据会被自动清理删除。默认的保留时间是 1 个月。最小的保留时间是 1 天（即 24 小时）。&lt;a href=&#34;#deduplication&#34; &gt;点击了解更多详情&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;其他的运行参数，基本使用默认值就可以了，所以只有在有特殊需求的时候再修改他们就行。用&lt;code&gt;-help&lt;/code&gt; 参数看下&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#list-of-command-line-flags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;所有可用参数及他们描述和默认值&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;正因 VictoriaMetrics 的配置参数都是通过命令行传递的，所以它不支持动态修改配置。如果要修改配置就只能用新的命令行对 VictoriaMetrics 进行重启。步骤如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;向VictoriaMetrics进程发送&lt;code&gt;SIGINT&lt;/code&gt;信号以正常停止它。请参阅&lt;a href=&#34;https://stackoverflow.com/questions/33239959/send-signal-to-process-from-command-line&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;如何向进程发送信号&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;等待进程停止。这可能需要几秒钟时间。&lt;/li&gt;
&lt;li&gt;启动已升级的VictoriaMetrics。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面的几个文档，对初始化 VictoriaMetrics 可能会有些帮助：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/#how-to-scrape-prometheus-exporters-such-as-node-exporter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How to set up scraping of Prometheus-compatible targets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-time-series-data&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How to ingest data to VictoriaMetrics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/#prometheus-setup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How to set up Prometheus to write data to VictoriaMetrics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#grafana-setup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How to query VictoriaMetrics via Grafana&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#graphite-api-usage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How to query VictoriaMetrics via Graphite API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#alerting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How to handle alerts&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;VictoriaMetrics 默认使用 8428 端口处理 &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#prometheus-querying-api-usage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus 查询请求&lt;/a&gt;。建议为 VictoriaMetrics 搭建&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#jian-kong&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;监控&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;环境变量&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;环境变量&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;所有的 VictoriaMetrics 组件都支持在命令行参数中使用语法&lt;code&gt;%{ENV_VAR}&lt;/code&gt;引用环境变量。比如，&lt;/p&gt;
&lt;p&gt;在 VictoriaMetrics 启动时，如果环境变量中存在&lt;code&gt;METRICS_AUTH_KEY=top-secret&lt;/code&gt;，那么&lt;code&gt;-metricsAuthKey=%{METRICS_AUTH_KEY}&lt;/code&gt;就会自动转换成&lt;code&gt;metricsAuthKey=top-secret&lt;/code&gt;。这个转换是 VictoriaMetrics 自动做的。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics 会递归的转换环境变量。比如我们有 2 个环境变量 &lt;code&gt;BAR=a%{BAZ}&lt;/code&gt; 和 &lt;code&gt;BAZ=bc&lt;/code&gt;。那对于 &lt;code&gt;FOO=%{BAR}&lt;/code&gt; 就会自动被转换成&lt;code&gt;FOO=abc&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;此外，所有的VictoriaMetrics组件都允许根据以下规则通过环境变量设置参数：&lt;/p&gt;
&lt;p&gt;Additionally, all the VictoriaMetrics components allow setting flag values via environment variables according to these rules:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-envflag.enable&lt;/code&gt; 参数必须开启。&lt;/li&gt;
&lt;li&gt;参数名中的每一个&lt;code&gt;.&lt;/code&gt;字符都会被用&lt;code&gt;_&lt;/code&gt;替代（比如&lt;code&gt;-insert.maxQueueDuration &amp;lt;duration&amp;gt;&lt;/code&gt; 会被转换成&lt;code&gt;insert_maxQueueDuration=&amp;lt;duration&amp;gt;&lt;/code&gt;）。&lt;/li&gt;
&lt;li&gt;对于重复参数，有一个替代方式就是用逗号&lt;code&gt;,&lt;/code&gt;把多个参数值链接起来（比如 &lt;code&gt;-storageNode &amp;lt;nodeA&amp;gt; -storageNode &amp;lt;nodeB&amp;gt;&lt;/code&gt; 会被转换成 &lt;code&gt;storageNode=&amp;lt;nodeA&amp;gt;,&amp;lt;nodeB&amp;gt;&lt;/code&gt;）。&lt;/li&gt;
&lt;li&gt;环境变量的前缀可以通过参数 &lt;code&gt;-envflag.prefix&lt;/code&gt; 设定. 比如，如果&lt;code&gt;-envflag.prefix=VM_&lt;/code&gt;, 那么所有环境变量名都要以 &lt;code&gt;VM_&lt;/code&gt;开头。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;使用 Snap 包&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;使用-snap-包&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8-snap-%e5%8c%85&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics 的 Snap 包在 &lt;a href=&#34;https://snapcraft.io/victoriametrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这里&lt;/a&gt; 可以找到。&lt;/p&gt;
&lt;p&gt;可以使用以下命令设置Snap软件包的命令行参数：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &amp;#39;FLAGS=&amp;#34;-selfScrapeInterval=10s -search.logSlowQueryDuration=20s&amp;#34;&amp;#39; &amp;gt; $SNAP_DATA/var/snap/victoriametrics/current/extra_flags
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;snap restart victoriametrics&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;不要修改 &lt;code&gt;-storageDataPath&lt;/code&gt; 的参数值， 因为 snap 包对宿主机的文件系统有访问限制。&lt;/p&gt;
&lt;p&gt;可以使用一个文本编辑器修改采集配置：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vi $SNAP_DATA/var/snap/victoriametrics/current/etc/victoriametrics-scrape-config.yaml&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;上面步骤完成后， 使用命令 &lt;code&gt;curl 127.0.0.1:8428/-/reload&lt;/code&gt;触发一下配置中心加载。&lt;/p&gt;
&lt;h3&gt;升级 VictoriaMetrics&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;升级-victoriametrics&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%8d%87%e7%ba%a7-victoriametrics&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;除非&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;发布说明&lt;/a&gt;另有说明，升级VictoriaMetrics到新版本是安全的。在升级过程中跳过多个版本也是安全的，除非&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;发布说明&lt;/a&gt;另有说明。建议定期升级到最新版本，因为它可能包含重要的错误修复、性能优化或新功能。&lt;/p&gt;
&lt;p&gt;除非&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;发布说明&lt;/a&gt;另有说明，降级到旧版本也是安全的。&lt;/p&gt;
&lt;p&gt;在升级/降级过程中必须执行以下步骤：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;向VictoriaMetrics进程发送&lt;code&gt;SIGINT&lt;/code&gt;信号以正常停止它。请参阅&lt;a href=&#34;https://stackoverflow.com/questions/33239959/send-signal-to-process-from-command-line&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;如何向进程发送信号&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;等待进程停止。这可能需要几秒钟时间。&lt;/li&gt;
&lt;li&gt;启动已升级的VictoriaMetrics。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Prometheus在重新启动VictoriaMetrics时不会丢失数据。详细信息请&lt;a href=&#34;https://grafana.com/blog/2019/03/25/whats-new-in-prometheus-2.8-wal-based-remote-write/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;参阅本文&lt;/a&gt;。对于&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent&lt;/a&gt;也适用相同规则。&lt;/p&gt;
&lt;h3&gt;如何构建源代码&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何构建源代码&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e6%ba%90%e4%bb%a3%e7%a0%81&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;我们建议使用&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;发布的二进制&lt;/a&gt; 或者 &lt;a href=&#34;https://hub.docker.com/r/victoriametrics/victoria-metrics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker 镜像&lt;/a&gt;，而不是使用源代码进行构建。构建源代码一般是在你要开发一些定制化需求或者测试 BUG 修复时候才需要。&lt;/p&gt;
&lt;h4&gt;构建开发环境&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;构建开发环境&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%9e%84%e5%bb%ba%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://golang.org/doc/install&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;安装 Go&lt;/a&gt;。 要求最低版本是 Go 1.19。&lt;/li&gt;
&lt;li&gt;在&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;仓库&lt;/a&gt;的根目录运行命令 &lt;code&gt;make victoria-metrics&lt;/code&gt; 。命令会构建 &lt;code&gt;victoria-metrics&lt;/code&gt; 二进制然后把它放到 &lt;code&gt;bin&lt;/code&gt; 目录中。&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;构建生产环境&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;构建生产环境&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%9e%84%e5%bb%ba%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.docker.com/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;安装 docker&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;在&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;仓库&lt;/a&gt;的跟目录执行命令&lt;code&gt;make victoria-metrics-prod&lt;/code&gt; 。 命令会构建 &lt;code&gt;victoria-metrics-prod&lt;/code&gt; 二进制，并把它放到 &lt;code&gt;bin&lt;/code&gt; 目录中.&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;ARM build&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;arm-build&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#arm-build&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;ARM 的构建可以在树莓派或 &lt;a href=&#34;https://blog.cloudflare.com/arm-takes-wing/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;energy-efficient ARM servers&lt;/a&gt;上执行。&lt;/p&gt;
&lt;h4&gt;Development ARM build&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;development-arm-build&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#development-arm-build&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://golang.org/doc/install&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Install Go&lt;/a&gt;. 要求最低版本是 Go 1.19。&lt;/li&gt;
&lt;li&gt;Run &lt;code&gt;make victoria-metrics-linux-arm&lt;/code&gt; or &lt;code&gt;make victoria-metrics-linux-arm64&lt;/code&gt; from the root folder of &lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the repository&lt;/a&gt;. It builds &lt;code&gt;victoria-metrics-linux-arm&lt;/code&gt; or &lt;code&gt;victoria-metrics-linux-arm64&lt;/code&gt; binary respectively and puts it into the &lt;code&gt;bin&lt;/code&gt; folder.&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;Production ARM build&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;production-arm-build&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#production-arm-build&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.docker.com/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Install docker&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Run &lt;code&gt;make victoria-metrics-linux-arm-prod&lt;/code&gt; or &lt;code&gt;make victoria-metrics-linux-arm64-prod&lt;/code&gt; from the root folder of &lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the repository&lt;/a&gt;. It builds &lt;code&gt;victoria-metrics-linux-arm-prod&lt;/code&gt; or &lt;code&gt;victoria-metrics-linux-arm64-prod&lt;/code&gt; binary respectively and puts it into the &lt;code&gt;bin&lt;/code&gt; folder.&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;纯 Go 构建 (CGO_ENABLED=0)&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;纯-go-构建-cgo_enabled0&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%ba%af-go-%e6%9e%84%e5%bb%ba-cgo_enabled0&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;纯Go&lt;/code&gt; 模式构建就是只构建没有 &lt;a href=&#34;https://golang.org/cmd/cgo/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cgo&lt;/a&gt; 的依赖的 Go 代码。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://golang.org/doc/install&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;安装Go&lt;/a&gt;。 要求最低版本是 Go 1.19。&lt;/li&gt;
&lt;li&gt;在&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;仓库&lt;/a&gt;的根目录执行命令 &lt;code&gt;make victoria-metrics-pure&lt;/code&gt; ，命令会构建出二进制 &lt;code&gt;victoria-metrics-pure&lt;/code&gt; ，并把它放到 &lt;code&gt;bin&lt;/code&gt; 目录中。&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;构建 Docker 镜像&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;构建-docker-镜像&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%9e%84%e5%bb%ba-docker-%e9%95%9c%e5%83%8f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;执行命令 &lt;code&gt;make package-victoria-metrics&lt;/code&gt;。 命令会在本地构建 &lt;code&gt;victoriametrics/victoria-metrics:&amp;lt;PKG_TAG&amp;gt;&lt;/code&gt; 的镜像。 &lt;code&gt;&amp;lt;PKG_TAG&amp;gt;&lt;/code&gt; 是使用仓库的源代码自动生成的镜像 Tag。 The &lt;code&gt;&amp;lt;PKG_TAG&amp;gt;&lt;/code&gt; 可以通过命令 &lt;code&gt;PKG_TAG=foobar make package-victoria-metrics&lt;/code&gt;手动指定。&lt;/p&gt;
&lt;p&gt;Base Image 用的是 &lt;a href=&#34;https://hub.docker.com/_/alpine&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;alpine&lt;/a&gt;，但是可以使用 &lt;code&gt;&amp;lt;ROOT_IMAGE&amp;gt;&lt;/code&gt;环境变量选择使用其他 Base Image。比如，下面的命令就是使用 &lt;a href=&#34;https://hub.docker.com/_/scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;scratch&lt;/a&gt; 镜像作为我们的 Base Image:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ROOT_IMAGE=scratch make package-victoria-metrics&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h3&gt;使用 docker-compose 启动&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;使用-docker-compose-启动&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bd%bf%e7%94%a8-docker-compose-%e5%90%af%e5%8a%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/blob/master/deployment/docker/docker-compose.yml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker-compose&lt;/a&gt; 能帮助我们用一条命令加速启动 VictoriaMetrics, &lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent&lt;/a&gt; 和 Grafana。更多详细信息请查阅&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/tree/master/deployment/docker#folder-contains-basic-images-and-tools-for-building-and-running-victoria-metrics-in-docker&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;Systemd Service&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;systemd-service&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#systemd-service&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;参考&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/issues/43&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这里&lt;/a&gt;将 VictoriaMetrics 设置为一个系统 Service。 一个 &lt;a href=&#34;https://snapcraft.io/victoriametrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;snap 包&lt;/a&gt; 可在 Ubuntu 上直接使用。&lt;/p&gt;
&lt;h3&gt;容量规划&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;容量规划&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics在我们的&lt;a href=&#34;https://docs.victoriametrics.com/CaseStudies.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;案例研究&lt;/a&gt;中表明，与竞争解决方案（Prometheus、Thanos、Cortex、TimescaleDB、InfluxDB、QuestDB和M3DB）相比，在生产工作负载上使用更少的CPU、RAM和存储空间。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics的容量与可用资源呈线性扩展。所需的CPU和RAM数量高度依赖于工作负载 - &lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-an-active-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;活跃时间序列&lt;/a&gt;的数量、指标&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;流失率&lt;/a&gt;、查询类型、查询每秒请求数等等。建议根据&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#troubleshooting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;故障排除&lt;/a&gt;文档，为您的生产工作负载设置一个测试VictoriaMetrics，并迭代地调整CPU和RAM资源，直到其稳定运行。根据我们的&lt;a href=&#34;https://docs.victoriametrics.com/CaseStudies.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;案例研究&lt;/a&gt;，单节点VictoriaMetrics可以完美地处理以下生产工作负载：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;写入速率: 150万/秒+ 的样本数。&lt;/li&gt;
&lt;li&gt;活跃 time series 总量: 5000万+&lt;/li&gt;
&lt;li&gt;time series 总量: 50亿+&lt;/li&gt;
&lt;li&gt;Time series 流失率: 每天1.5亿+&lt;/li&gt;
&lt;li&gt;样本总数: 10万亿&lt;/li&gt;
&lt;li&gt;查询：200+ qps&lt;/li&gt;
&lt;li&gt;查询延时 (P99): 1 second&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;根据测试运行期间的磁盘空间使用情况，可以推算出所需的存储空间（保留期通过&lt;code&gt;-retentionPeriod&lt;/code&gt;命令行标志设置）。例如，如果在生产工作负载上进行了为期一天的测试运行后，&lt;code&gt;-storageDataPath&lt;/code&gt;目录大小变为&lt;code&gt;10GB&lt;/code&gt;，则对于&lt;code&gt;-retentionPeriod=100d&lt;/code&gt;（100天保留期），至少需要&lt;code&gt;10GB*100=1TB&lt;/code&gt;的磁盘空间。&lt;/p&gt;
&lt;p&gt;建议保留以下数量的备用资源：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;为了降低工作负载暂时性峰值期间内存溢出（OOM）崩溃和减速的概率，建议保留50%的空闲RAM。&lt;/li&gt;
&lt;li&gt;为了在工作负载暂时激增期间降低减速的可能性，将50%的空闲CPU用于分配。&lt;/li&gt;
&lt;li&gt;至少保留 &lt;code&gt;-storageDataPath&lt;/code&gt; 命令行标志指定的目录中 &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#storage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;20% 的可用存储空间&lt;/a&gt;。详见&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#list-of-command-line-flags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;此处&lt;/a&gt;&lt;code&gt;-storage.minFreeDiskSpaceBytes&lt;/code&gt; 命令行参数说明。&lt;/li&gt;
&lt;li&gt;At least &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#storage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;20% of free storage space&lt;/a&gt; at the directory pointed by &lt;code&gt;-storageDataPath&lt;/code&gt; command-line flag. See also &lt;code&gt;-storage.minFreeDiskSpaceBytes&lt;/code&gt; command-line flag description &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#list-of-command-line-flags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;here&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参见&lt;a href=&#34;http://localhost:1313/o/132gTaNIXiiCk9qpfjsj/s/vRBuMkJtXHBycCjZtWfn/~/changes/34/victoriametrics/dan-ji-ban-ben/~/page#resource-usage-limits&#34; &gt;资源使用限制&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;保存期&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;保存期&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bf%9d%e5%ad%98%e6%9c%9f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;保留期是通过 -retentionPeriod 命令行标志进行配置的，该标志后面跟着一个数字和时间单位字符 - h(小时), d(天), w(周), y(年)。如果未指定时间单位，则默认为月份。例如，-retentionPeriod=3 表示数据将被存储 3 个月然后删除。默认的保留期为一个月。最小的保留期为 24 小时或者 1 天。&lt;/p&gt;
&lt;p&gt;数据被分割成每月的分区，存储在&amp;lt;-storageDataPath&amp;gt;/data/{small,big}文件夹中。超出配置保留期限的数据分区会在新月的第一天被删除。每个分区由一个或多个数据部分组成。超出配置保留期限的数据part最终会在&lt;/p&gt;
&lt;p&gt;后台合并&lt;/p&gt;
&lt;p&gt;过程中被删除。数据part所覆盖的时间范围不受保留期单位限制。一个数据part可以涵盖几小时或几天的数据。因此，只有当完全超出配置保留期时才能删除一个数据部分。请点击&lt;/p&gt;
&lt;p&gt;这里&lt;/p&gt;
&lt;p&gt;了解更多关于分区和部件。&lt;/p&gt;
&lt;p&gt;给定的保留期（&lt;code&gt;-retentionPeriod&lt;/code&gt;）对应的最大磁盘空间使用量将是（&lt;code&gt;-retentionPeriod&lt;/code&gt; + 1）个月。例如，如果 &lt;code&gt;-retentionPeriod&lt;/code&gt; 设置为 1，则一月份的数据将在三月一日被删除。&lt;/p&gt;
&lt;p&gt;在现有数据上延长保留期是安全的。如果将保留期（&lt;code&gt;-retentionPeriod&lt;/code&gt;）设置为比之前更低的值，则配置周期外的数据最终将被删除。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics不支持无限保留时间，但您可以指定一个任意长的持续时间，例如&lt;code&gt;-retentionPeriod=100&lt;/code&gt;年。&lt;/p&gt;
&lt;h3&gt;资源使用限制&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;资源使用限制&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e8%b5%84%e6%ba%90%e4%bd%bf%e7%94%a8%e9%99%90%e5%88%b6&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;默认情况下，VictoriaMetrics针对典型工作负载进行了优化，以实现最佳资源使用。某些工作负载可能需要细粒度的资源使用限制。在这些情况下，以下命令行标志可能会有用：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-memory.allowedPercent&lt;/code&gt; 和 &lt;code&gt;-memory.allowedBytes&lt;/code&gt; 限制 VictoriaMetrics 内部缓存使用的内存量。请注意，VictoriaMetrics 可能会使用更多的内存，因为这些标志不限制每个查询所需的额外内存。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxMemoryPerQuery&lt;/code&gt; 限制了用于处理单个查询的内存量。需要更多内存的查询将被拒绝。选择大量时间序列的重型查询可能会略微超过每个查询的内存限制。同时执行的查询的总内存限制可以估计为&lt;code&gt;-search.maxMemoryPerQuery&lt;/code&gt;乘以&lt;code&gt;-search.maxConcurrentRequests&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxUniqueTimeseries&lt;/code&gt; 限制了单个查询可以找到和处理的唯一时间序列的数量。VictoriaMetrics在内存中保留有关每个查询定位到的时间序列的一些元信息，并花费一些CPU时间来处理找到的时间序列。这意味着单个查询可以使用的最大内存使用量和CPU使用量与&lt;code&gt;-search.maxUniqueTimeseries&lt;/code&gt;成比例。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxQueryDuration&lt;/code&gt; 限制了单个查询的持续时间。如果查询超过给定的持续时间，那么它将被取消。这样可以在执行意外繁重的查询时节省CPU和内存。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxConcurrentRequests&lt;/code&gt; 限制了VictoriaMetrics可以处理的并发请求数量。更多的并发请求通常意味着更大的内存使用量。例如，如果单个查询在执行过程中需要100 MiB的额外内存，则可能需要100个并发查询需要&lt;code&gt;100 * 100 MiB = 10 GiB&lt;/code&gt; 的额外内存。因此，在达到并发限制时，最好限制并发查询的数量，并暂停进入的附加查询。VictoriaMetrics提供了&lt;code&gt;-search.maxQueueDuration&lt;/code&gt;命令行标志来限制挂起查询的最长等待时间。另请参阅&lt;code&gt;-search.maxMemoryPerQuery&lt;/code&gt;命令行标志。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxSamplesPerSeries&lt;/code&gt; 每个时间序列查询可以处理的原始样本数量。VictoriaMetrics在查询期间按顺序处理每个找到的时间序列的原始样本。它将所选时间范围内每个时间序列的原始样本解压缩到内存中，然后应用给定的&lt;a href=&#34;http://localhost:1313/o/132gTaNIXiiCk9qpfjsj/s/vRBuMkJtXHBycCjZtWfn/~/changes/34/victoriametrics/shu-ju-cha-xun/metricql/functions/~/page&#34; &gt;汇总函数&lt;/a&gt;。当查询在包含数亿条原始样本的时间范围上执行时，&lt;code&gt;-search.maxSamplesPerSeries&lt;/code&gt;命令行标志允许限制内存使用量。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxSamplesPerQuery&lt;/code&gt; 限制单个查询可以处理的原始样本数量。这样可以限制重负载查询的CPU使用率。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxPointsPerTimeseries&lt;/code&gt; 限制每个范围查询匹配时间序列返回的计算点数。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxPointsSubqueryPerTimeseries&lt;/code&gt;限制了在子查询评估过程中，每个匹配时间序列可以生成的计算点数。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxSeriesPerAggrFunc&lt;/code&gt; 限制了在单个查询中由&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MetricsQL聚合函数&lt;/a&gt;生成的时间序列数量。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxSeries&lt;/code&gt; 限制了从&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#finding-series-by-label-matchers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/series&lt;/a&gt;返回的时间序列数量。这个端点主要被Grafana用于自动完成指标名称、标签名称和标签值。当数据库包含大量唯一时间序列时，对该端点的查询可能会消耗大量的CPU时间和内存，因为存在&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高频率变化&lt;/a&gt;。在这种情况下，将&lt;code&gt;-search.maxSeries&lt;/code&gt;设置为较低的值可能有助于限制CPU和内存使用。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxTagKeys&lt;/code&gt; 限制从&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#getting-label-names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/labels&lt;/a&gt;返回的项目数量。此端点主要用于Grafana自动完成标签名称。当数据库包含大量唯一时间序列时，对此端点的查询可能会消耗大量的CPU时间和内存，因为存在&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高频率变化&lt;/a&gt;。在这种情况下，将-search.maxTagKeys设置为较低值可能有助于限制CPU和内存使用。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxTagValues&lt;/code&gt; 限制从&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#querying-label-values&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/label/&amp;hellip;/values&lt;/a&gt;返回的项目数量。此端点主要用于Grafana自动完成标签值。由于&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高频率更改&lt;/a&gt;，当数据库包含大量唯一时间序列时，对该端点的查询可能会消耗大量CPU时间和内存。在这种情况下，将&lt;code&gt;-search.maxTagValues&lt;/code&gt;设置为较低的值可能有助于限制CPU和内存使用。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxTagValueSuffixesPerSearch&lt;/code&gt; 限制了从&lt;code&gt;/metrics/find&lt;/code&gt;端点返回的条目数量。请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#graphite-metrics-api-usage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Graphite Metrics API使用文档&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;参见 &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#cardinality-limiter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cardinality limiter&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#capacity-planning&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;capacity planning docs&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;高可用&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;高可用&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%ab%98%e5%8f%af%e7%94%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;在不同的数据中心（可用区）安装多个VictoriaMetrics实例。&lt;/li&gt;
&lt;li&gt;将这些实例的地址通过 &lt;code&gt;-remoteWrite.url&lt;/code&gt; 命令行标志传递给 &lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/path/to/vmagent -remoteWrite.url=http://&amp;lt;victoriametrics-addr-1&amp;gt;:8428/api/v1/write -remoteWrite.url=http://&amp;lt;victoriametrics-addr-2&amp;gt;:8428/api/v1/write&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;或者这些地址可以传递给Prometheus配置中的&lt;code&gt;remote_write&lt;/code&gt;部分：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;remote_write:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - url: http://&amp;lt;victoriametrics-addr-1&amp;gt;:8428/api/v1/write
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    queue_config:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      max_samples_per_send: 10000
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  # ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - url: http://&amp;lt;victoriametrics-addr-N&amp;gt;:8428/api/v1/write
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    queue_config:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      max_samples_per_send: 10000&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;应用更新的配置：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kill -HUP `pidof prometheus`&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;建议在高负载环境中使用&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent&lt;/a&gt;而不是Prometheus。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;现在Prometheus应该并行地将数据写入所有配置的&lt;code&gt;remote_write&lt;/code&gt; URL。&lt;/li&gt;
&lt;li&gt;在所有的VictoriaMetrics副本前面设置&lt;a href=&#34;https://github.com/jacksontj/promxy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Promxy&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;在Grafana中设置一个指向Promxy的Prometheus数据源。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果您在每个Prometheus HA对中有副本&lt;code&gt;r1&lt;/code&gt;和&lt;code&gt;r2&lt;/code&gt;，那么请将每个r1配置为将数据写入&lt;code&gt;victoriametrics-addr-1&lt;/code&gt;，而每个&lt;code&gt;r2&lt;/code&gt;应该将数据写入&lt;code&gt;victoriametrics-addr-2&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;另一种选择是从Prometheus HA对同时向一对启用了去重功能的VictoriaMetrics实例写入数据。有关详细信息，请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#deduplication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;此部分&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;监控&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;监控&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%9b%91%e6%8e%a7&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics在&lt;code&gt;/metrics&lt;/code&gt;页面以Prometheus公开格式导出内部指标。这些指标可以通过&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent&lt;/a&gt;或Prometheus进行抓取。另外，当&lt;code&gt;-selfScrapeInterval&lt;/code&gt;命令行标志设置为大于0的持续时间时，单节点的VictoriaMetrics可以自动抓取指标。例如，&lt;code&gt;-selfScrapeInterval=10s&lt;/code&gt;将启用每10秒一次的自动抓取&lt;code&gt;/metrics&lt;/code&gt;页面。&lt;/p&gt;
&lt;p&gt;官方提供了适用于&lt;a href=&#34;https://grafana.com/grafana/dashboards/10229-victoriametrics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;单节点&lt;/a&gt;和&lt;a href=&#34;https://grafana.com/grafana/dashboards/11176-victoriametrics-cluster/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群&lt;/a&gt; VictoriaMetrics 的 Grafana 仪表板。还可以查看由社区创建的适用于&lt;a href=&#34;https://grafana.com/grafana/dashboards/11831&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群 VictoriaMetrics 的替代仪表板&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;仪表板上的图表包含有用的提示 - 将鼠标悬停在每个图表左上角的 &lt;code&gt;i&lt;/code&gt; 图标上以阅读它。&lt;/p&gt;
&lt;p&gt;我们建议通过&lt;a href=&#34;https://docs.victoriametrics.com/vmalert.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmalert&lt;/a&gt;或Prometheus设置警报。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics 在&lt;code&gt;/api/v1/status/active_queries&lt;/code&gt; 页面中展示当前正在执行的查询以及它们的运行时间。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics &lt;code&gt;/api/v1/status/top_queries&lt;/code&gt; 页面展示执行时间最长的查询语句。&lt;/p&gt;
&lt;p&gt;参见 &lt;a href=&#34;https://victoriametrics.com/blog/victoriametrics-monitoring/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics Monitoring&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/Troubleshooting.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;troubleshooting docs&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;Push Metrics&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;push-metrics&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#push-metrics&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;所有的VictoriaMetrics组件都支持将其在/metrics页面上公开的指标以Prometheus文本格式推送到远程存储。如果VictoriaMetrics组件位于隔离网络中，无法被本地&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent&lt;/a&gt;抓取，则可以使用此功能来替代&lt;a href=&#34;https://docs.victoriametrics.com/#how-to-scrape-prometheus-exporters-such-as-node-exporter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;经典的类Prometheus指标抓取&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;以下命令行参数与从VictoriaMetrics组件推送指标相关：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-pushmetrics.url&lt;/code&gt; - push 的目标 URL 地址。比如， &lt;code&gt;-pushmetrics.url=http://victoria-metrics:8428/api/v1/import/prometheus&lt;/code&gt; 表示把内部指标 Push 到 &lt;code&gt;/api/v1/import/prometheus&lt;/code&gt; 中，参见&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-data-in-prometheus-exposition-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这个文档&lt;/a&gt;。 &lt;code&gt;-pushmetrics.url&lt;/code&gt; 参数可以被指定多次。这种情况下 metrics 会被 Push 到所有目标 URL 地址上。URL 中也可以包含上 Basic Auth 信息，格式是&lt;code&gt;http://user:pass@hostname/api/v1/import/prometheus&lt;/code&gt;。Metrics 是以压缩的形式被 Push 到 &lt;code&gt;-pushmetrics.url&lt;/code&gt; 中的，请求头中带有&lt;code&gt;Content-Encoding: gzip&lt;/code&gt; 。这可以减少 Push 所需的网络带宽。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-pushmetrics.extraLabel&lt;/code&gt; - 在把 metrics 数据 Push 到&lt;code&gt;-pushmetrics.url&lt;/code&gt;之前追加一些 Label 。每一个Label都是用&lt;code&gt;label=&amp;quot;value&amp;quot;&lt;/code&gt;的格式指定。命令行参数 &lt;code&gt;-pushmetrics.extraLabel&lt;/code&gt; 也是可以被多次指定的。这种情况下会将指定的多个Label 全都追加到 metrics 数据中，再 Push 给 &lt;code&gt;-pushmetrics.url&lt;/code&gt;地址。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-pushmetrics.interval&lt;/code&gt; - Push 动作的间隔，默认是 10t秒一次。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;例如，以下命令指示VictoriaMetrics将&lt;code&gt;/metrics&lt;/code&gt;页面的指标推送到&lt;code&gt;https://maas.victoriametrics.com/api/v1/import/prometheus&lt;/code&gt;，并使用&lt;code&gt;user:pass&lt;/code&gt;基本身份验证。在将指标发送到远程存储之前，会添加&lt;code&gt;instance=&amp;quot;foobar&amp;quot;&lt;/code&gt;和&lt;code&gt;job=&amp;quot;vm&amp;quot;&lt;/code&gt;标签给所有的指标：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;/path/to/victoria-metrics \
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  -pushmetrics.url=https://user:pass@maas.victoriametrics.com/api/v1/import/prometheus \
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  -pushmetrics.extraLabel=&amp;#39;instance=&amp;#34;foobar&amp;#34;&amp;#39; \
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  -pushmetrics.extraLabel=&amp;#39;job=&amp;#34;vm&amp;#34;&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h3&gt;调整？&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;调整&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e8%b0%83%e6%95%b4&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;不需要调整VictoriaMetrics - 它使用合理的默认命令行标志，这些标志会自动根据可用的CPU和RAM资源进行调整。&lt;/li&gt;
&lt;li&gt;操作系统不需要调优 - VictoriaMetrics已经针对默认的操作系统设置进行了优化。唯一的选项是增加操作系统中&lt;a href=&#34;https://medium.com/@muhammadtriwibowo/set-permanently-ulimit-n-open-files-in-ubuntu-4d61064429a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;打开文件数量的限制&lt;/a&gt;。这个建议不仅适用于VictoriaMetrics，也适用于任何处理大量HTTP连接并将数据存储在磁盘上的服务。&lt;/li&gt;
&lt;li&gt;VictoriaMetrics是一个写入密集型应用程序，其性能取决于磁盘性能。因此，请注意其他可能&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/issues/1521&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;耗尽磁盘资源&lt;/a&gt;的应用程序或实用工具（如&lt;a href=&#34;http://manpages.ubuntu.com/manpages/bionic/man8/fstrim.8.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;fstrim&lt;/a&gt;）。&lt;/li&gt;
&lt;li&gt;推荐使用ext4文件系统，并且&lt;a href=&#34;https://cloud.google.com/compute/docs/disks/#pdspecs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;推荐在GCP上使用基于持久HDD硬盘作为持久存储&lt;/a&gt;，因为它通过内部复制受到硬件故障保护，并且可以&lt;a href=&#34;https://cloud.google.com/compute/docs/disks/add-persistent-disk#resize_pd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;动态调整大小&lt;/a&gt;。如果您计划在ext4分区上存储超过1TB的数据或者计划将其扩展到超过16TB，则建议传递以下选项给mkfs.ext4：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkfs.ext4 ... -O 64bit,huge_file,extent -T huge&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h2&gt;数据运维&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;数据运维&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e8%bf%90%e7%bb%b4&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;如何运用 snapshots&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何运用-snapshots&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e8%bf%90%e7%94%a8-snapshots&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics可以为存储在&lt;code&gt;-storageDataPath&lt;/code&gt;目录下的所有数据创建&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#how-to-work-with-snapshots&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;即时快照&lt;/a&gt;。请访问&lt;code&gt;http://:8428/snapshot/create&lt;/code&gt;以创建即时快照。该页面将返回以下JSON响应：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{&amp;#34;status&amp;#34;:&amp;#34;ok&amp;#34;,&amp;#34;snapshot&amp;#34;:&amp;#34;&amp;lt;snapshot-name&amp;gt;&amp;#34;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;快照是在&lt;code&gt;&amp;lt;-storageDataPath&amp;gt;/snapshots&lt;/code&gt;目录下创建的，其中&lt;code&gt;&amp;lt;-storageDataPath&amp;gt;&lt;/code&gt;是命令行参数。可以随时使用&lt;a href=&#34;https://docs.victoriametrics.com/vmbackup.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmbackup&lt;/a&gt;将快照归档到备份存储中。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;http://&amp;lt;victoriametrics-addr&amp;gt;:8428/snapshot/list&lt;/code&gt; 页面包含了可用快照列表。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;http://&amp;lt;victoriametrics-addr&amp;gt;:8428/snapshot/delete?snapshot=&amp;lt;snapshot-name&amp;gt;&lt;/code&gt; 则可删除 &lt;code&gt;&amp;lt;snapshot-name&amp;gt;&lt;/code&gt; 快照.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;http://&amp;lt;victoriametrics-addr&amp;gt;:8428/snapshot/delete_all&lt;/code&gt; 可删除所有快照。&lt;/p&gt;
&lt;p&gt;从快照中恢复数据的步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使用命令 &lt;code&gt;kill -INT&lt;/code&gt;停掉 VictoriaMetrics。&lt;/li&gt;
&lt;li&gt;使用 &lt;a href=&#34;https://docs.victoriametrics.com/vmrestore.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmrestore&lt;/a&gt; 将快照内容恢复到 &lt;code&gt;-storageDataPath&lt;/code&gt;.参数指定的目录。&lt;/li&gt;
&lt;li&gt;启动 VictoriaMetrics.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;如何删除 Timeseries&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何删除-timeseries&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e5%88%a0%e9%99%a4-timeseries&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;发送一个请求到&lt;code&gt;http://:8428/api/v1/admin/tsdb/delete_series&lt;/code&gt;，其中&lt;code&gt;&amp;lt;timeseries_selector_for_delete&amp;gt;&lt;/code&gt;可以包含任何用于删除指标的时间序列选择器。删除API不支持删除特定的时间范围，timeseries 只能完全删除。已删除时间序列的存储空间不会立即释放 - 它在后续数据文件的后台 Merge 过程中释放。&lt;/p&gt;
&lt;p&gt;请注意，对于以前月份的数据可能永远不会进行后台合并，因此历史数据将无法释放存储空间。在这种情况下，强制合并可能有助于释放存储空间。&lt;/p&gt;
&lt;p&gt;建议在实际删除指标之前使用调用&lt;code&gt;http://:8428/api/v1/series?match[]=&amp;lt;timeseries_selector_for_delete&amp;gt;&lt;/code&gt;验证将要被删除的指标。默认情况下，此查询仅扫描过去5分钟内的系列，因此您可能需要调整开始和结束时间以获得匹配结果。&lt;/p&gt;
&lt;p&gt;如果设置了&lt;code&gt;-deleteAuthKey&lt;/code&gt;命令行参数，则可以使用&lt;code&gt;authKey&lt;/code&gt;保护/api/v1/admin/tsdb/delete_series处理程序。&lt;/p&gt;
&lt;p&gt;Delete API主要适用于以下情况：&lt;/p&gt;
&lt;p&gt;一次性删除意外写入的无效（或不需要）时间序列。 由于GDPR而一次性删除用户数据。 以下情况不建议使用delete API，因为它会带来非零开销：&lt;/p&gt;
&lt;p&gt;定期清理不需要的数据。只需防止将不需要的数据写入VictoriaMetrics即可。可以通过重新标记来实现。有关详细信息，请参阅本文。 通过删除不需要的时间序列来减少磁盘空间使用情况。这种方法无法达到预期效果，因为已删除的时间序列占用磁盘空间直到下一次合并操作，而当删除过旧数据时可能永远不会发生合并操作。强制合并可用于释放由旧数据占用的磁盘空间。请注意，VictoriaMetrics不会从倒排索引（也称为indexdb）中删除已删除时间序列的条目。倒排索引每配置保留期清理一次。&lt;/p&gt;
&lt;p&gt;最好使用&lt;code&gt;-retentionPeriod&lt;/code&gt;命令行参数以有效地修剪旧数据。&lt;/p&gt;
&lt;h3&gt;强制合并&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;强制合并&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%bc%ba%e5%88%b6%e5%90%88%e5%b9%b6&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics在&lt;a href=&#34;https://medium.com/@valyala/how-victoriametrics-makes-instant-snapshots-for-multi-terabyte-time-series-data-e1f3fb0e0282&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;后台执行数据压缩&lt;/a&gt;，以保持在接受新数据时的良好性能特征。这些压缩（合并）是独立地针对每个月份分区进行的。这意味着如果没有将新数据注入到这些分区中，则会停止对每个月份分区进行压缩。有时需要触发旧分区的压缩，例如为了释放被&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#ru-he-shan-chu-timeseries&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;删除Timeseries&lt;/a&gt;占用的磁盘空间。在这种情况下，可以通过向&lt;code&gt;/internal/force_merge&lt;/code&gt;发送请求来启动指定的每月分区上的强制合并操作?&lt;code&gt;partition_prefix=YYYY_MM&lt;/code&gt;，其中&lt;code&gt;YYYY_MM&lt;/code&gt;是每月分区名称。例如，&lt;code&gt;http://victoriametrics:8428/internal/force_merge?partition_prefix=2020_08&lt;/code&gt;将会启动2020年8月份分区的强制合并操作。调用&lt;code&gt;/internal/force_merge&lt;/code&gt;会立即返回，而相应的强制合并操作将继续在后台运行。 强制合并可能需要额外的CPU、磁盘IO和存储空间资源。在正常情况下不必运行强制合并操作，因为当有新数据注入时，VictoriaMetrics会自动在后台执行&lt;a href=&#34;https://medium.com/@valyala/how-victoriametrics-makes-instant-snapshots-for-multi-terabyte-time-series-data-e1f3fb0e0282&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;最佳合并操作&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;导出 timeseries&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;导出-timeseries&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%af%bc%e5%87%ba-timeseries&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics 提供了下面的 API 接口来导出数据&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/api/v1/export&lt;/code&gt; 将数据一以 JSON 格式导出。参见 &lt;a href=&#34;https://docs.victoriametrics.com/#how-to-export-data-in-json-line-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这篇文档&lt;/a&gt; 获取更多信息。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/api/v1/export/csv&lt;/code&gt; 将数据以 CSV 格式导出。参见 &lt;a href=&#34;https://docs.victoriametrics.com/#how-to-export-csv-data&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这篇文档&lt;/a&gt; 获取更多信息。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/api/v1/export/native&lt;/code&gt; 将数据以原生二进制格式导出。这是性能最好的数据导出格式。参见 &lt;a href=&#34;https://docs.victoriametrics.com/#how-to-export-data-in-native-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;获取更多信息。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;如何导出 JSON 格式&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何导出-json-格式&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e5%af%bc%e5%87%ba-json-%e6%a0%bc%e5%bc%8f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;发送一个请求到 &lt;code&gt;http://:8428/api/v1/export?match[]=&amp;lt;timeseries_selector_for_export&amp;gt;&lt;/code&gt;，其中 &lt;code&gt;&amp;lt;timeseries_selector_for_export&amp;gt;&lt;/code&gt; 可以是任何用于导出指标的&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics/#time-series-selectors&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;时间序列选择器&lt;/a&gt;。使用 &lt;code&gt;{__name__!=&amp;quot;&amp;quot;}&lt;/code&gt; 选择器来获取所有时间序列。响应将以 &lt;a href=&#34;http://ndjson.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;JSON 流格式&lt;/a&gt;包含所选时间序列的所有数据。每个 JSON 行都包含单个时间序列的样本。示例输出如下：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{&amp;#34;metric&amp;#34;:{&amp;#34;__name__&amp;#34;:&amp;#34;up&amp;#34;,&amp;#34;job&amp;#34;:&amp;#34;node_exporter&amp;#34;,&amp;#34;instance&amp;#34;:&amp;#34;localhost:9100&amp;#34;},&amp;#34;values&amp;#34;:[0,0,0],&amp;#34;timestamps&amp;#34;:[1549891472010,1549891487724,1549891503438]}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{&amp;#34;metric&amp;#34;:{&amp;#34;__name__&amp;#34;:&amp;#34;up&amp;#34;,&amp;#34;job&amp;#34;:&amp;#34;prometheus&amp;#34;,&amp;#34;instance&amp;#34;:&amp;#34;localhost:9090&amp;#34;},&amp;#34;values&amp;#34;:[1,1,1],&amp;#34;timestamps&amp;#34;:[1549891461511,1549891476511,1549891491511]}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;Optional &lt;code&gt;start&lt;/code&gt; and &lt;code&gt;end&lt;/code&gt; args may be added to the request in order to limit the time frame for the exported data. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#timestamp-formats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;allowed formats&lt;/a&gt; for these args.&lt;/p&gt;
&lt;p&gt;可选的&lt;code&gt;start&lt;/code&gt;和&lt;code&gt;end&lt;/code&gt;参数可以添加到请求中，以限制导出数据的时间范围。请参阅这些参数的&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#timestamp-formats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;允许格式&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;例如：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://&amp;lt;victoriametrics-addr&amp;gt;:8428/api/v1/export -d &amp;#39;match[]=&amp;lt;timeseries_selector_for_export&amp;gt;&amp;#39; -d &amp;#39;start=1654543486&amp;#39; -d &amp;#39;end=1654543486&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://&amp;lt;victoriametrics-addr&amp;gt;:8428/api/v1/export -d &amp;#39;match[]=&amp;lt;timeseries_selector_for_export&amp;gt;&amp;#39; -d &amp;#39;start=2022-06-06T19:25:48&amp;#39; -d &amp;#39;end=2022-06-06T19:29:07&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;可选的&lt;code&gt;max_rows_per_line&lt;/code&gt;参数可以添加到请求中，以限制每个JSON行导出的最大行数。当导出大量时间序列数据时，可以添加可选的&lt;code&gt;reduce_mem_usage=1&lt;/code&gt;参数来减少内存使用。在这种情况下，输出可能包含多行同一时间序列的样本。&lt;/p&gt;
&lt;p&gt;在向&lt;code&gt;/api/v1/export&lt;/code&gt;发送请求时，请传递&lt;code&gt;Accept-Encoding: gzip&lt;/code&gt; HTTP头部，以便在导出大量时间序列数据时减少网络带宽。这将为导出的数据启用gzip压缩。以下是导出gzipped数据的示例：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -H &amp;#39;Accept-Encoding: gzip&amp;#39; http://localhost:8428/api/v1/export -d &amp;#39;match[]={__name__!=&amp;#34;&amp;#34;}&amp;#39; &amp;gt; data.jsonl.gz&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;每个对&lt;code&gt;/api/v1/export&lt;/code&gt;的请求的最长持续时间受&lt;code&gt;-search.maxExportDuration&lt;/code&gt;命令行标志限制。&lt;/p&gt;
&lt;p&gt;导出的数据可以通过将其POST到&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-data-in-json-line-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/import&lt;/a&gt;来导入。&lt;/p&gt;
&lt;p&gt;默认情况下，对通过&lt;code&gt;/api/v1/export&lt;/code&gt;导出的数据应用&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#deduplication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;去重&lt;/a&gt;。如果在请求中传递了&lt;code&gt;reduce_mem_usage=1&lt;/code&gt;查询参数，则不会应用去重。&lt;/p&gt;
&lt;h4&gt;如何导出 CSV 数据&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何导出-csv-数据&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e5%af%bc%e5%87%ba-csv-%e6%95%b0%e6%8d%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;发送请求到 &lt;code&gt;http://&amp;lt;victoriametrics-addr&amp;gt;:8428/api/v1/export/csv?format=&amp;lt;format&amp;gt;&amp;amp;match=&amp;lt;timeseries_selector_for_export&amp;gt;，&lt;/code&gt; 这里：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;format&amp;gt;&lt;/code&gt; 必须包含逗号分隔的标签名称，用于导出CSV文件。支持以下特殊标签名称：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;__name__&lt;/code&gt; - metric 名称&lt;/li&gt;
&lt;li&gt;&lt;code&gt;__value__&lt;/code&gt; - 样本值&lt;/li&gt;
&lt;li&gt;&lt;code&gt;__timestamp__:&amp;lt;ts_format&amp;gt;&lt;/code&gt; - 样本时间戳. &lt;code&gt;&amp;lt;ts_format&amp;gt;&lt;/code&gt; 可以包含以下值:
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;unix_s&lt;/code&gt; - unix 秒&lt;/li&gt;
&lt;li&gt;&lt;code&gt;unix_ms&lt;/code&gt; - unix 毫秒&lt;/li&gt;
&lt;li&gt;&lt;code&gt;unix_ns&lt;/code&gt; - unix 纳秒&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rfc3339&lt;/code&gt; - &lt;a href=&#34;https://www.ietf.org/rfc/rfc3339.txt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC3339&lt;/a&gt; 格式时间&lt;/li&gt;
&lt;li&gt;&lt;code&gt;custom:&amp;lt;layout&amp;gt;&lt;/code&gt; - 自定义时间格式，可由Go的&lt;a href=&#34;https://golang.org/pkg/time/#Time.Format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time.Format&lt;/a&gt;函数支持。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;timeseries_selector_for_export&amp;gt;&lt;/code&gt; 用于过滤导出数据的 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics/#time-series-selectors&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time series selector&lt;/a&gt; 。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;start&lt;/code&gt; and &lt;code&gt;end&lt;/code&gt; 参数是可选的，可以加到请求中以限制下导出的数据量，关于该参数可阅读系9啊 &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#timestamp-formats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;allowed formats&lt;/a&gt; 。&lt;/p&gt;
&lt;p&gt;举例：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://&amp;lt;victoriametrics-addr&amp;gt;:8428/api/v1/export/csv -d &amp;#39;format=&amp;lt;format&amp;gt;&amp;#39; -d &amp;#39;match[]=&amp;lt;timeseries_selector_for_export&amp;gt;&amp;#39; -d &amp;#39;start=1654543486&amp;#39; -d &amp;#39;end=1654543486&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://&amp;lt;victoriametrics-addr&amp;gt;:8428/api/v1/export/csv -d &amp;#39;format=&amp;lt;format&amp;gt;&amp;#39; -d &amp;#39;match[]=&amp;lt;timeseries_selector_for_export&amp;gt;&amp;#39; -d &amp;#39;start=2022-06-06T19:25:48&amp;#39; -d &amp;#39;end=2022-06-06T19:29:07&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;通过 &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-csv-data&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/import/csv&lt;/a&gt;，可以将导出的 CSV 数据导入到 VictoriaMetrics。&lt;/p&gt;
&lt;p&gt;默认情况下，对于以 CSV 导出的数据应用了&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#deduplication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;去重功能&lt;/a&gt;。如果要导出原始数据而不进行去重操作，则可以在 &lt;code&gt;/api/v1/export/csv&lt;/code&gt; 中传递 &lt;code&gt;reduce_mem_usage=1&lt;/code&gt; 查询参数。&lt;/p&gt;
&lt;h4&gt;如何导出原生数据&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何导出原生数据&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e5%af%bc%e5%87%ba%e5%8e%9f%e7%94%9f%e6%95%b0%e6%8d%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;发送请求到 &lt;code&gt;http://&amp;lt;victoriametrics-addr&amp;gt;:8428/api/v1/export/native?match[]=&amp;lt;timeseries_selector_for_export&amp;gt;，&lt;/code&gt; 这里的 &lt;code&gt;&amp;lt;timeseries_selector_for_export&amp;gt;&lt;/code&gt; 可以设置任意的 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics/#time-series-selectors&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time series selector&lt;/a&gt; 来过滤要导出的 metrics。 使用 &lt;code&gt;{__name__=~&amp;quot;.*&amp;quot;}&lt;/code&gt; 选择所有的 metric。&lt;/p&gt;
&lt;p&gt;在大型数据库上，您可能会遇到导出时间序列数量限制的问题。在这种情况下，您需要调整&lt;code&gt;-search.maxExportSeries&lt;/code&gt;命令行参数：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# count unique time series in database
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget -O- -q &amp;#39;http://your_victoriametrics_instance:8428/api/v1/series/count&amp;#39; | jq &amp;#39;.data[0]&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# relaunch victoriametrics with search.maxExportSeries more than value from previous command&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;可选的&lt;code&gt;start&lt;/code&gt;和&lt;code&gt;end&lt;/code&gt;参数可以添加到请求中，以限制导出数据的时间范围。请参阅这些参数的&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#timestamp-formats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;允许格式&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;举例:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://&amp;lt;victoriametrics-addr&amp;gt;:8428/api/v1/export/native -d &amp;#39;match[]=&amp;lt;timeseries_selector_for_export&amp;gt;&amp;#39; -d &amp;#39;start=1654543486&amp;#39; -d &amp;#39;end=1654543486&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://&amp;lt;victoriametrics-addr&amp;gt;:8428/api/v1/export/native -d &amp;#39;match[]=&amp;lt;timeseries_selector_for_export&amp;gt;&amp;#39; -d &amp;#39;start=2022-06-06T19:25:48&amp;#39; -d &amp;#39;end=2022-06-06T19:29:07&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;通过&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-data-in-native-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/import/native&lt;/a&gt;，可以将导出的数据导入到VictoriaMetrics中。原生导出格式在不同版本的VictoriaMetrics之间可能会以不兼容的方式发生变化，因此从X版本导出的数据可能无法成功导入到Y版本的VictoriaMetrics中。&lt;/p&gt;
&lt;p&gt;原生格式导出的数据不会应用&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#deduplication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;去重操作&lt;/a&gt;。预期在数据导入过程中进行去重处理。&lt;/p&gt;
&lt;h3&gt;如何导入 timeseries 数据&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何导入-timeseries-数据&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e5%af%bc%e5%85%a5-timeseries-%e6%95%b0%e6%8d%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics可以从与Prometheus兼容的目标（也称为“pull”协议）中发现和抓取指标-请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-scrape-prometheus-exporters-such-as-node-exporter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。此外，VictoriaMetrics还可以通过以下流行的数据摄入协议（也称为“push”协议）接收指标：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/configuration/configuration/#remote_write&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus remote_write API&lt;/a&gt;. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#prometheus-setup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for details.&lt;/li&gt;
&lt;li&gt;DataDog &lt;code&gt;submit metrics&lt;/code&gt; API. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-send-data-from-datadog-agent&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for details.&lt;/li&gt;
&lt;li&gt;InfluxDB line protocol. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-send-data-from-influxdb-compatible-agents-such-as-telegraf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for details.&lt;/li&gt;
&lt;li&gt;Graphite plaintext protocol. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-send-data-from-graphite-compatible-agents-such-as-statsd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for details.&lt;/li&gt;
&lt;li&gt;OpenTSDB telnet put protocol. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#sending-data-via-telnet-put-protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for details.&lt;/li&gt;
&lt;li&gt;OpenTSDB http &lt;code&gt;/api/put&lt;/code&gt; protocol. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#sending-opentsdb-data-via-http-apiput-requests&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for details.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/api/v1/import&lt;/code&gt; for importing data obtained from &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-export-data-in-json-line-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/export&lt;/a&gt;. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-data-in-json-line-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for details.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/api/v1/import/native&lt;/code&gt; for importing data obtained from &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-export-data-in-native-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/export/native&lt;/a&gt;. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-data-in-native-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for details.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/api/v1/import/csv&lt;/code&gt; for importing arbitrary CSV data. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-csv-data&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for details.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/api/v1/import/prometheus&lt;/code&gt; for importing data in Prometheus exposition format and in &lt;a href=&#34;https://github.com/prometheus/pushgateway#url&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pushgateway format&lt;/a&gt;. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-data-in-prometheus-exposition-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for details.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;请注意，大多数摄取 API（除了 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/configuration/configuration/#remote_write&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus remote_write API&lt;/a&gt;）都经过性能优化，并以流式处理方式处理数据。这意味着客户端可以通过开放的连接传输无限量的数据。因此，导入 API 可能不会将解析错误返回给客户端，因为预期数据流不会中断。相反，请在服务器端（VictoriaMetrics 单节点或 vminsert）查找解析错误，或者检查 &lt;code&gt;vm_rows_invalid_total&lt;/code&gt; 指标是否发生变化（由服务器端导出）。&lt;/p&gt;
&lt;h4&gt;如何导入 JSON 格式数据&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何导入-json-格式数据&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e5%af%bc%e5%85%a5-json-%e6%a0%bc%e5%bc%8f%e6%95%b0%e6%8d%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;导入从 &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-export-data-in-json-line-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/export&lt;/a&gt;获取到的数据的示例：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Export the data from &amp;lt;source-victoriametrics&amp;gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://source-victoriametrics:8428/api/v1/export -d &amp;#39;match={__name__!=&amp;#34;&amp;#34;}&amp;#39; &amp;gt; exported_data.jsonl
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Import the data to &amp;lt;destination-victoriametrics&amp;gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -X POST http://destination-victoriametrics:8428/api/v1/import -T exported_data.jsonl&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;将 &lt;code&gt;Content-Encoding: gzip&lt;/code&gt; 的 HTTP 请求头传递给 &lt;code&gt;/api/v1/import&lt;/code&gt;，用于导入经过压缩的数据：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Export gzipped data from &amp;lt;source-victoriametrics&amp;gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -H &amp;#39;Accept-Encoding: gzip&amp;#39; http://source-victoriametrics:8428/api/v1/export -d &amp;#39;match={__name__!=&amp;#34;&amp;#34;}&amp;#39; &amp;gt; exported_data.jsonl.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Import gzipped data to &amp;lt;destination-victoriametrics&amp;gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -X POST -H &amp;#39;Content-Encoding: gzip&amp;#39; http://destination-victoriametrics:8428/api/v1/import -T exported_data.jsonl.gz&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;可以通过传递&lt;code&gt;extra_label=name=value&lt;/code&gt;查询参数，为所有导入的时间序列添加额外标签。例如，&lt;code&gt;/api/v1/import?extra_label=foo=bar&lt;/code&gt;会将&lt;code&gt;&amp;quot;foo&amp;quot;:&amp;quot;bar&amp;quot;&lt;/code&gt;标签添加到所有导入的时间序列中。&lt;/p&gt;
&lt;p&gt;请注意，在导入历史数据后可能需要清除响应缓存。详细信息请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#backfilling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;相关文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics逐行解析输入的JSON数据。它将整个JSON行加载到内存中，然后解析并将解析后的样本保存到持久存储中。这意味着当导入过长的JSON行时，VictoriaMetrics可能占用大量RAM。解决方法是将过长的JSON行拆分成较小的行。如果单个时间序列的样本被拆分在多个JSON行中也是可以接受的。&lt;/p&gt;
&lt;h4&gt;如何导入原生二进制数据&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何导入原生二进制数据&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e5%af%bc%e5%85%a5%e5%8e%9f%e7%94%9f%e4%ba%8c%e8%bf%9b%e5%88%b6%e6%95%b0%e6%8d%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;VictoriaMetrics的本地格式规范可能会发生变化，并且尚未正式文档化。因此，我们目前不建议外部客户尝试将自己的指标打包成本地格式文件。&lt;/p&gt;
&lt;p&gt;但是，如果您通过&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-export-data-in-native-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/export/native&lt;/a&gt;获取了一个本地格式文件，则这是导入数据最高效的协议。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Export the data from &amp;lt;source-victoriametrics&amp;gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://source-victoriametrics:8428/api/v1/export/native -d &amp;#39;match={__name__!=&amp;#34;&amp;#34;}&amp;#39; &amp;gt; exported_data.bin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Import the data to &amp;lt;destination-victoriametrics&amp;gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -X POST http://destination-victoriametrics:8428/api/v1/import/native -T exported_data.bin&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;通过传递额外的查询参数 &lt;code&gt;extra_label=name=value&lt;/code&gt;，可以为所有导入的时间序列添加额外的标签。例如，&lt;code&gt;/api/v1/import/native?extra_label=foo=bar&lt;/code&gt; 将在所有导入的时间序列中添加 &lt;code&gt;&amp;quot;foo&amp;quot;:&amp;quot;bar&amp;quot;&lt;/code&gt; 标签。&lt;/p&gt;
&lt;p&gt;请注意，在导入历史数据后可能需要清除响应缓存。详细信息请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#backfilling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;h4&gt;如何导入 CSV 数据&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何导入-csv-数据&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e5%af%bc%e5%85%a5-csv-%e6%95%b0%e6%8d%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;任意的CSV数据可以通过&lt;code&gt;/api/v1/import/csv&lt;/code&gt;导入。CSV数据根据提供的格式查询参数进行导入。格式查询参数必须包含逗号分隔的解析规则列表，用于指定CSV字段的解析方式。每个规则由三部分组成，以冒号分隔：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;column_pos&amp;gt;:&amp;lt;type&amp;gt;:&amp;lt;context&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;column_pos&amp;gt;&lt;/code&gt; CSV列（字段）的位置是什么。列编号从1开始。解析规则的顺序可能是任意的。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;type&amp;gt;&lt;/code&gt; 描述列类型。支持的类型有：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;metric&lt;/code&gt; - 对应的CSV列在&lt;code&gt;&amp;lt;column_pos&amp;gt;&lt;/code&gt;位置包含度量值，该值必须是整数或浮点数。度量名称从&lt;code&gt;&amp;lt;context&amp;gt;&lt;/code&gt;中读取。CSV行至少必须有一个度量字段。每个CSV行可以有多个度量字段。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;label&lt;/code&gt; -对应的CSV列在&lt;code&gt;&amp;lt;column_pos&amp;gt;&lt;/code&gt;位置包含标签值。标签名称从&lt;code&gt;&amp;lt;context&amp;gt;&lt;/code&gt;中读取。CSV行可能有任意数量的标签字段。所有这些标签都附加到所有配置的指标上。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;time&lt;/code&gt; - 对应的CSV列在&amp;lt;column_pos&amp;gt;位置包含度量时间。CSV行可能包含一个或零个带有时间的列。如果CSV行没有时间，则使用当前时间。该时间适用于所有配置的指标。通过&lt;code&gt;&amp;lt;context&amp;gt;&lt;/code&gt;来配置时间格式。支持的时间格式有：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;unix_s&lt;/code&gt; - unix 秒&lt;/li&gt;
&lt;li&gt;&lt;code&gt;unix_ms&lt;/code&gt; - unix 毫秒&lt;/li&gt;
&lt;li&gt;&lt;code&gt;unix_ns&lt;/code&gt; - unix 纳秒&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rfc3339&lt;/code&gt; - &lt;a href=&#34;https://www.ietf.org/rfc/rfc3339.txt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RFC3339&lt;/a&gt; 格式时间&lt;/li&gt;
&lt;li&gt;&lt;code&gt;custom:&amp;lt;layout&amp;gt;&lt;/code&gt; - 自定义时间格式，可由Go的&lt;a href=&#34;https://golang.org/pkg/time/#Time.Format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time.Format&lt;/a&gt;函数支持。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;每个对&lt;code&gt;/api/v1/import/csv&lt;/code&gt;的请求可能包含任意数量的CSV行。&lt;/p&gt;
&lt;p&gt;通过 /api/v1/import/csv 导入 CSV 数据的示例：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -d &amp;#34;GOOG,1.23,4.56,NYSE&amp;#34; &amp;#39;http://localhost:8428/api/v1/import/csv?format=2:metric:ask,3:metric:bid,1:label:ticker,4:label:market&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -d &amp;#34;MSFT,3.21,1.67,NASDAQ&amp;#34; &amp;#39;http://localhost:8428/api/v1/import/csv?format=2:metric:ask,3:metric:bid,1:label:ticker,4:label:market&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;之后，数据可以通过&lt;code&gt;/api/v1/export&lt;/code&gt;端点进行读取：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -G &amp;#39;http://localhost:8428/api/v1/export&amp;#39; -d &amp;#39;match[]={ticker!=&amp;#34;&amp;#34;}&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;应该得到如下响应：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{&amp;#34;metric&amp;#34;:{&amp;#34;__name__&amp;#34;:&amp;#34;bid&amp;#34;,&amp;#34;market&amp;#34;:&amp;#34;NASDAQ&amp;#34;,&amp;#34;ticker&amp;#34;:&amp;#34;MSFT&amp;#34;},&amp;#34;values&amp;#34;:[1.67],&amp;#34;timestamps&amp;#34;:[1583865146520]}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{&amp;#34;metric&amp;#34;:{&amp;#34;__name__&amp;#34;:&amp;#34;bid&amp;#34;,&amp;#34;market&amp;#34;:&amp;#34;NYSE&amp;#34;,&amp;#34;ticker&amp;#34;:&amp;#34;GOOG&amp;#34;},&amp;#34;values&amp;#34;:[4.56],&amp;#34;timestamps&amp;#34;:[1583865146495]}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{&amp;#34;metric&amp;#34;:{&amp;#34;__name__&amp;#34;:&amp;#34;ask&amp;#34;,&amp;#34;market&amp;#34;:&amp;#34;NASDAQ&amp;#34;,&amp;#34;ticker&amp;#34;:&amp;#34;MSFT&amp;#34;},&amp;#34;values&amp;#34;:[3.21],&amp;#34;timestamps&amp;#34;:[1583865146520]}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{&amp;#34;metric&amp;#34;:{&amp;#34;__name__&amp;#34;:&amp;#34;ask&amp;#34;,&amp;#34;market&amp;#34;:&amp;#34;NYSE&amp;#34;,&amp;#34;ticker&amp;#34;:&amp;#34;GOOG&amp;#34;},&amp;#34;values&amp;#34;:[1.23],&amp;#34;timestamps&amp;#34;:[1583865146495]}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;通过传递 &lt;code&gt;extra_label=name=value&lt;/code&gt; 查询参数，可以为所有导入的行添加额外标签。例如，&lt;code&gt;/api/v1/import/csv?extra_label=foo=bar&lt;/code&gt; 将在所有导入的行中添加 &lt;code&gt;&amp;quot;foo&amp;quot;:&amp;quot;bar&amp;quot;&lt;/code&gt; 标签。&lt;/p&gt;
&lt;p&gt;请注意，在导入历史数据后可能需要清除响应缓存。详细信息请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#backfilling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;如何导入 Prometheus Exporter 格式数据&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何导入-prometheus-exporter-格式数据&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e5%af%bc%e5%85%a5-prometheus-exporter-%e6%a0%bc%e5%bc%8f%e6%95%b0%e6%8d%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics接受以&lt;a href=&#34;https://github.com/prometheus/docs/blob/master/content/docs/instrumenting/exposition_formats.md#text-based-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus暴露格式&lt;/a&gt;、&lt;a href=&#34;https://github.com/OpenObservability/OpenMetrics/blob/master/specification/OpenMetrics.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenMetrics格式&lt;/a&gt;和&lt;a href=&#34;https://github.com/prometheus/pushgateway#url&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pushgateway&lt;/a&gt;格式的数据，通过&lt;code&gt;/api/v1/import/prometheus&lt;/code&gt;路径进行传输。&lt;/p&gt;
&lt;p&gt;例如，以下命令将以Prometheus导出格式的单行数据导入到VictoriaMetrics中：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -d &amp;#39;foo{bar=&amp;#34;baz&amp;#34;} 123&amp;#39; -X POST &amp;#39;http://localhost:8428/api/v1/import/prometheus&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;以下命令可用于验证导入的数据：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -G &amp;#39;http://localhost:8428/api/v1/export&amp;#39; -d &amp;#39;match={__name__=~&amp;#34;foo&amp;#34;}&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;应该返回类似以下的内容：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{&amp;#34;metric&amp;#34;:{&amp;#34;__name__&amp;#34;:&amp;#34;foo&amp;#34;,&amp;#34;bar&amp;#34;:&amp;#34;baz&amp;#34;},&amp;#34;values&amp;#34;:[123],&amp;#34;timestamps&amp;#34;:[1594370496905]}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;以下命令使用&lt;a href=&#34;https://github.com/prometheus/pushgateway#url&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pushgateway&lt;/a&gt;格式导入带有&lt;code&gt;{job=&amp;quot;my_app&amp;quot;,instance=&amp;quot;host123&amp;quot;}&lt;/code&gt;标签的单个指标：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -d &amp;#39;metric{label=&amp;#34;abc&amp;#34;} 123&amp;#39; -X POST &amp;#39;http://localhost:8428/api/v1/import/prometheus/metrics/job/my_app/instance/host123&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;将 &lt;code&gt;Content-Encoding: gzip&lt;/code&gt; 的 HTTP 请求头传递给 &lt;code&gt;/api/v1/import/prometheus&lt;/code&gt; 以导入经过gzip压缩的数据：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Import gzipped data to &amp;lt;destination-victoriametrics&amp;gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -X POST -H &amp;#39;Content-Encoding: gzip&amp;#39; http://destination-victoriametrics:8428/api/v1/import/prometheus -T prometheus_data.gz&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;可以通过&lt;a href=&#34;https://github.com/prometheus/pushgateway#url&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pushgateway格式&lt;/a&gt;或通过传递&lt;code&gt;extra_label=name=value&lt;/code&gt;查询参数向所有导入的指标添加额外的标签。例如，&lt;code&gt;/api/v1/import/prometheus?extra_label=foo=bar&lt;/code&gt;将在所有导入的指标中添加&lt;code&gt;{foo=&amp;quot;bar&amp;quot;}&lt;/code&gt;标签。&lt;/p&gt;
&lt;p&gt;如果在Prometheus暴露格式行中缺少&lt;code&gt;&amp;lt;metric&amp;gt; &amp;lt;value&amp;gt; &amp;lt;timestamp&amp;gt;&lt;/code&gt;时间戳，则在数据摄取过程中使用当前时间戳。可以通过传递以毫秒为单位的Unix时间戳来覆盖它，例如，&lt;code&gt;/api/v1/import/prometheus?timestamp=1594370496905&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics接受单个请求中任意数量的行到&lt;code&gt;/api/v1/import/prometheus&lt;/code&gt;，即支持数据流式传输。&lt;/p&gt;
&lt;p&gt;请注意，在导入历史数据后可能需要刷新响应缓存。有关详细信息，请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#backfilling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics还可以抓取Prometheus目标-请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-scrape-prometheus-exporters-such-as-node-exporter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;高级特性&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;高级特性&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%ab%98%e7%ba%a7%e7%89%b9%e6%80%a7&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Relabeling&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;relabeling&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#relabeling&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics支持对所有接收到的指标进行与Prometheus兼容的重标签处理，只需使用&lt;code&gt;-relabelConfig&lt;/code&gt;命令行参数指定一个包含&lt;code&gt;relabel_config&lt;/code&gt;条目列表的文件即可。&lt;code&gt;-relabelConfig&lt;/code&gt;也可以指向http或https URL。例如，&lt;code&gt;-relabelConfig=https://config-server/relabel_config.yml&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;以下文档可能对理解重标签处理有所帮助：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/relabeling.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cookbook for common relabeling tasks&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://valyala.medium.com/how-to-use-relabeling-in-prometheus-and-victoriametrics-8b90fc22c4b2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Relabeling tips and tricks&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;-relabelConfig&lt;/code&gt;文件中可以包含特殊的占位符，形式为&lt;code&gt;%{ENV_VAR}&lt;/code&gt;，它们将被相应的环境变量值替换。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-relabelConfig&lt;/code&gt;文件示例内容：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Add {cluster=&amp;#34;dev&amp;#34;} label.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- target_label: cluster
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  replacement: dev
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;# Drop the metric (or scrape target) with `{__meta_kubernetes_pod_container_init=&amp;#34;true&amp;#34;}` label.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- action: drop
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  source_labels: [__meta_kubernetes_pod_container_init]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  regex: true&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;VictoriaMetrics提供了额外的重标签功能，例如Graphite风格的重标签。有关更多详细信息，请参阅&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html#relabeling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;可以在http://victoriametrics:8428/metric-relabel-debug页面或我们的&lt;a href=&#34;https://play.victoriametrics.com/select/accounting/1/6a716b0f-38bc-4856-90ce-448fd713e3fe/prometheus/graph/#/relabeling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;公共游乐场&lt;/a&gt;上调试重标签。有关更多详细信息，请参阅&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html#relabel-debug&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;Cache removal&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;cache-removal&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#cache-removal&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics使用各种内部缓存。这些缓存在优雅关闭时（例如通过发送&lt;code&gt;SIGINT&lt;/code&gt;信号停止VictoriaMetrics）被存储到&lt;code&gt;&amp;lt;-storageDataPath&amp;gt;/cache&lt;/code&gt;目录中。下次启动VictoriaMetrics时会读取这些缓存。有时需要在下次启动时删除此类缓存。可以通过以下方式完成：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过在 VictoriaMetrics 停止时手动删除 &lt;code&gt;&amp;lt;-storageDataPath&amp;gt;/cache&lt;/code&gt; 目录。&lt;/li&gt;
&lt;li&gt;通过在重新启动VictoriaMetrics之前将&lt;code&gt;reset_cache_on_startup&lt;/code&gt;文件放置在&lt;code&gt;&amp;lt;-storageDataPath&amp;gt;/cache&lt;/code&gt;目录中。 在这种情况下，VictoriaMetrics将自动在下次启动时删除所有缓存。 有关详细信息，请参阅此&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/issues/1447&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;issue&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Cache tuning&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;cache-tuning&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#cache-tuning&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics使用各种内存缓存来加快数据摄取和查询性能。每种类型的缓存都在/metrics路径下暴露以下指标。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;vm_cache_size_bytes&lt;/code&gt; - 实际的 cache 大小&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vm_cache_size_max_bytes&lt;/code&gt; - cache 最大限制 limit&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vm_cache_requests_total&lt;/code&gt; - cache 的请求数&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vm_cache_misses_total&lt;/code&gt; - cache miss 的数量&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vm_cache_entries&lt;/code&gt; - cache 中的实体数&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;单节点VictoriaMetrics和集群VictoriaMetrics的Grafana仪表板都包含了缓存部分，其中展示了缓存指标的可视化。面板显示了每种类型缓存的当前内存使用情况，以及缓存命中率。如果命中率接近100%，则表示缓存效率已经非常高，不需要进行任何调整。在故障排除部分的面板&amp;quot;&lt;code&gt;Cache usage %&lt;/code&gt;&amp;ldquo;显示了按类型使用的缓存大小与允许大小之间的百分比。如果百分比低于100%，则无需进一步调整。&lt;/p&gt;
&lt;p&gt;请注意，默认缓存大小已根据最实际的场景和工作负载进行了精心调整。只有在您理解其影响并且vmstorage具有足够空闲内存来容纳新的缓存大小时才更改默认值。&lt;/p&gt;
&lt;p&gt;要覆盖默认值，请参阅带有&lt;code&gt;-storage.cacheSize&lt;/code&gt;前缀的命令行标志。可以在&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#list-of-command-line-flags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;此处&lt;/a&gt;查看所有标志的完整描述。&lt;/p&gt;
&lt;h3&gt;补数据&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;补数据&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e8%a1%a5%e6%95%b0%e6%8d%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics通过&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-time-series-data&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;任何支持的摄取方法&lt;/a&gt;以任意时间顺序接受历史数据。请参阅&lt;a href=&#34;https://docs.victoriametrics.com/vmalert.html#rules-backfilling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;如何使用vmalert中的记录规则回填数据&lt;/a&gt;。确保配置的&lt;code&gt;-retentionPeriod&lt;/code&gt;覆盖了回填数据的时间戳。&lt;/p&gt;
&lt;p&gt;建议在写入过去时间戳的历史数据时，使用&lt;code&gt;-search.disableCache&lt;/code&gt;命令行标志禁用查询缓存，因为缓存假设数据是使用当前时间戳编写的。可以在回填完成后启用查询缓存。&lt;/p&gt;
&lt;p&gt;另一种解决方案是在回填完成后查询&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#internalresetRollupResultCache&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/internal/resetRollupResultCache&lt;/a&gt;处理程序。这将重置查询缓存，其中可能包含在回填期间缓存的不完整数据。&lt;/p&gt;
&lt;p&gt;还有一种解决方案是增加&lt;code&gt;-search.cacheTimestampOffset&lt;/code&gt;标志值，以禁用与当前时间接近的时间戳数据的缓存。单节点VictoriaMetrics会自动在其上摄取早于&lt;code&gt;now - search.cacheTimestampOffset&lt;/code&gt; 的样本时重置响应缓存。&lt;/p&gt;
&lt;h3&gt;数据更新&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;数据更新&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%95%b0%e6%8d%ae%e6%9b%b4%e6%96%b0&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics不支持将已存在的样本值更新为新值。它会将所有被摄取的数据点存储在具有相同时间戳的同一时间序列中。虽然可以通过&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-delete-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;删除旧时间序列&lt;/a&gt;并&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#backfilling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;写入新时间序列&lt;/a&gt;来替换旧时间序列，但这种方法只适用于一次性更新。由于与数据删除相关的非零开销，不应频繁使用此方法进行更新。&lt;/p&gt;
&lt;h3&gt;备份&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;备份&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a4%87%e4%bb%bd&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics 支持使用 &lt;a href=&#34;https://docs.victoriametrics.com/vmbackup.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmbackup&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/vmrestore.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmrestore&lt;/a&gt; 工具执行备份和恢复。&lt;/p&gt;
&lt;h3&gt;去重特性&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;去重特性&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%8e%bb%e9%87%8d%e7%89%b9%e6%80%a7&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics每个时间序列在每个&lt;code&gt;-dedup.minScrapeInterval&lt;/code&gt;离散间隔内只保留一个具有最大时间戳的原始样本，如果&lt;code&gt;-dedup.minScrapeInterval&lt;/code&gt;设置为正持续时间。例如，&lt;code&gt;-dedup.minScrapeInterval=60s&lt;/code&gt;将在每个离散的60秒间隔内保留一个具有最大时间戳的原始样本。这与&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics/#staleness&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus中的过期规则&lt;/a&gt;相一致。&lt;/p&gt;
&lt;p&gt;如果给定的&lt;code&gt;-dedup.minScrapeInterval&lt;/code&gt;离散间隔上有多个具有相同时间戳的原始样本，则保留值最大的样本。&lt;/p&gt;
&lt;p&gt;请注意，要进行去重操作，原始样本的标签必须完全相同。例如，这就是为什么&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html#high-availability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagents HA&lt;/a&gt;对需要配置完全相同。&lt;/p&gt;
&lt;p&gt;如果启用了降采样功能，则&lt;code&gt;-dedup.minScrapeInterval=D&lt;/code&gt;等效于&lt;code&gt;-downsampling.period=0s:D&lt;/code&gt;。因此可以同时使用去重和&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#downsampling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;降采样&lt;/a&gt;而不会出现问题。&lt;/p&gt;
&lt;p&gt;建议将 &lt;code&gt;-dedup.minScrapeInterval&lt;/code&gt; 的推荐值设置为 Prometheus 配置文件中 &lt;code&gt;scrape_interval&lt;/code&gt; 的值。建议所有抓取目标都使用统一的抓取间隔，请参阅详细信息&lt;a href=&#34;https://www.robustperception.io/keep-it-simple-scrape_interval-id&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;文章&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;通过去重操作可以减少磁盘空间占用量，特别是当多个配置完全相同的 vmagent 或 Prometheus 实例以 HA 对形式写入数据到同一个 VictoriaMetrics 实例时更加有效。这些 vmagent 或 Prometheus 实例必须在其配置文件中具有相同的&lt;code&gt;external_labels&lt;/code&gt; 部分，以便将数据写入同一个时间序列。另请参阅&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html#scraping-big-number-of-targets&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;如何设置多个 vmagent 实例来抓取相同目标&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;建议为每个不同的 vmagent HA 对实例传递不同的 &lt;code&gt;-promscrape.cluster.name &lt;/code&gt;值，这样去重操作就会一致地保留一个 vmagent 实例的样本，并从其他 &lt;code&gt;vmagent&lt;/code&gt; 实例中删除重复样本。请参阅&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html#high-availability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;详细文档&lt;/a&gt;了解更多信息。&lt;/p&gt;
&lt;h3&gt;Storage&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;storage&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#storage&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics将接收的数据缓存在内存中，最多一秒钟。然后将缓冲的数据写入内存部分，在查询期间可以进行搜索。这些in-memory &lt;code&gt;part&lt;/code&gt;定期持久化到磁盘上，以便在发生不正常关闭（如内存崩溃、硬件断电或&lt;code&gt;SIGKILL&lt;/code&gt;信号）时能够恢复。刷新内存数据到磁盘的时间间隔可以通过&lt;code&gt;-inmemoryDataFlushInterval&lt;/code&gt;命令行标志进行配置（请注意，过短的刷新间隔可能会显著增加磁盘IO）。&lt;/p&gt;
&lt;p&gt;将内存部分持久化到磁盘时，它们被保存在&lt;code&gt;&amp;lt;-storageDataPath&amp;gt;/data/small/YYYY_MM/&lt;/code&gt;文件夹下的&lt;code&gt;part&lt;/code&gt;目录中，其中&lt;code&gt;YYYY_MM&lt;/code&gt;是所保存数据的月份分区。例如，&lt;code&gt;2022_11&lt;/code&gt;是包含来&lt;code&gt;自2022年11月&lt;/code&gt;&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#raw-samples&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;原始样本&lt;/a&gt;的部分所属的分区。每个分区目录都包含一个&lt;code&gt;parts.json&lt;/code&gt;文件，其中列出了该分区中实际存在的部分。&lt;/p&gt;
&lt;p&gt;每个 &lt;code&gt;part&lt;/code&gt; 目录还包含一个&lt;code&gt;metadata.json&lt;/code&gt;文件，其中包含以下字段：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;RowsCount&lt;/code&gt; - 存储在零件中的原始样本数量。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;BlocksCount&lt;/code&gt; - 存储在该部分中的块数量（有关块的详细信息请参见下文）。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;MinTimestamp&lt;/code&gt;和&lt;code&gt;MaxTimestamp&lt;/code&gt; - 存储在该部分中原始样本的最小和最大时间戳。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;MinTimestamp&lt;/code&gt; and &lt;code&gt;MaxTimestamp&lt;/code&gt; - minimum and maximum timestamps across raw samples stored in the part&lt;/li&gt;
&lt;li&gt;&lt;code&gt;MinDedupInterval&lt;/code&gt; - 给定部分应用的&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#deduplication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;去重间隔&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;每个 part 由按内部时间序列ID（也称为&lt;code&gt;TSID&lt;/code&gt;）排序的 &lt;code&gt;block&lt;/code&gt; 组成。每个 &lt;code&gt;block&lt;/code&gt; 包含最多&lt;code&gt;8K&lt;/code&gt;个原始样本，这些样本属于单个时间序列。每个 &lt;code&gt;block&lt;/code&gt; 中的原始样本按照时间戳进行排序。同一时间序列的块按第一个样本的时间戳进行排序。所有块的时间戳和值以&lt;a href=&#34;https://faun.pub/victoriametrics-achieving-better-compression-for-time-series-data-than-gorilla-317bc1f95932&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;压缩形式&lt;/a&gt;存储在 &lt;code&gt;part&lt;/code&gt; 目录下的单独文件中 - &lt;code&gt;timestamps.bin&lt;/code&gt;和&lt;code&gt;values.bin&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;part&lt;/code&gt; 目录还包含&lt;code&gt;index.bin&lt;/code&gt;和&lt;code&gt;metaindex.bin&lt;/code&gt;文件 - 这些文件包含了快速块查找的索引，这些块属于给定的&lt;code&gt;TSID&lt;/code&gt;并覆盖给定的时间范围。&lt;/p&gt;
&lt;p&gt;部分会周期性地在后台合并成更大的part。后台合并提供以下好处：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;保持数据文件数量在控制范围内，以免超过打开文件的限制。&lt;/li&gt;
&lt;li&gt;改进的数据压缩，因为通常较大的部分比较小的部分更容易被压缩。&lt;/li&gt;
&lt;li&gt;查询速度提升了，因为对较少部分的查询执行更快。&lt;/li&gt;
&lt;li&gt;各种后台维护任务都是在合并过程中发生的，比如&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#deduplication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;de-duplication&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#downsampling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;downsampling&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-delete-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;freeing up disk space for the deleted time series&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;新添加的 part 要么成功出现在存储中，要么无法出现。新添加的 part 在完全写入并通过&lt;a href=&#34;https://man7.org/linux/man-pages/man2/fsync.2.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;fsync&lt;/a&gt;同步到存储后，会自动注册到相应分区下的&lt;code&gt;parts.json&lt;/code&gt;文件中。由于这个算法，即使在将part写入磁盘过程中发生硬件断电，在下一次VictoriaMetrics启动时也会自动删除这些未完全写入的部分，因此存储永远不会包含部分创建的part。&lt;/p&gt;
&lt;p&gt;合并过程也是如此——parts 要么完全合并为一个新的部分，要么无法合并，使得源部分保持不变。然而，由于硬件问题，在VictoriaMetrics处理过程中可能会导致磁盘上的数据损坏。VictoriaMetrics可以在解压缩、解码或对数据块进行健康检查时检测到损坏。但它无法修复已损坏的数据。启动时加载失败的数据部分需要被删除或从备份中恢复。因此建议&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#backups&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;定期进行备份&lt;/a&gt;操作。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics在存储数据块时不使用校验和。请&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/issues/3011&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;点击此处&lt;/a&gt;了解原因。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics在合并部分时，如果它们的摘要大小超过了可用磁盘空间，则不会进行合并。这样可以防止在合并过程中出现磁盘空间不足的错误。在磁盘空间紧缺的情况下，部分数量可能会显著增加。这会增加数据查询时的开销，因为VictoriaMetrics需要从更多的部分中读取数据来处理每个请求。因此建议使用&lt;code&gt;-storageDataPath&lt;/code&gt;命令行标志指定的目录下至少保留20% 的可用磁盘空间。&lt;/p&gt;
&lt;p&gt;关于合并的处理过程可以参见 &lt;a href=&#34;https://grafana.com/grafana/dashboards/10229-victoriametrics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the dashboard for single-node VictoriaMetrics&lt;/a&gt; 和 &lt;a href=&#34;https://grafana.com/grafana/dashboards/11176-victoriametrics-cluster/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the dashboard for VictoriaMetrics cluster&lt;/a&gt;. 更多详情参见&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#monitoring&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;监控文档&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;更多详情可阅读 &lt;a href=&#34;https://valyala.medium.com/how-victoriametrics-makes-instant-snapshots-for-multi-terabyte-time-series-data-e1f3fb0e0282&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这篇文章&lt;/a&gt;，也可以阅读 &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-work-with-snapshots&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;how to work with snapshots&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;多租户&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;多租户&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a4%9a%e7%a7%9f%e6%88%b7&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;单节点的VictoriaMetrics不支持多租户。请使用&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#multitenancy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群版本&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;多副本&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;多副本&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a4%9a%e5%89%af%e6%9c%ac&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;单节点的VictoriaMetrics不支持应用级别的复制。请使用集群版本代替。详细信息请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#replication-and-data-safety&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;存储级别的复制可以转移到持久性存储，如&lt;a href=&#34;https://cloud.google.com/compute/docs/disks#pdspecs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Cloud磁盘&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;还可以查看&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#high-availability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高可用性文档&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#backups&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;备份文档&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;可扩展和集群版本&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;可扩展和集群版本&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%8f%af%e6%89%a9%e5%b1%95%e5%92%8c%e9%9b%86%e7%be%a4%e7%89%88%e6%9c%ac&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;尽管单节点的VictoriaMetrics无法扩展到多个节点，但它在资源使用方面进行了优化 - 存储大小/带宽/IOPS、RAM和CPU。这意味着一个单节点的VictoriaMetrics可以在垂直方向上扩展，并替代使用竞争解决方案（如Thanos、Uber M3、InfluxDB或TimescaleDB）构建的中等规模集群。请参阅垂直可伸缩性&lt;a href=&#34;https://medium.com/@valyala/measuring-vertical-scalability-for-time-series-databases-in-google-cloud-92550d78d8ae&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;基准测试结果&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;首先尝试使用单节点的VictoriaMetrics，如果您仍然需要针对大型Prometheus部署进行横向扩展的长期远程存储，则可以切换到&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/tree/cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群版本&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;基数限制&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;基数限制&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%9f%ba%e6%95%b0%e9%99%90%e5%88%b6&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;默认情况下，VictoriaMetrics不限制存储的时间序列数量。可以通过设置以下命令行标志来强制执行限制：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-storage.maxHourlySeries&lt;/code&gt; - 限制了在最后一个小时内可以添加的时间序列数量。对于限制&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-an-active-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;活动时间序列&lt;/a&gt;的数量非常有用。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-storage.maxDailySeries&lt;/code&gt; - 限制了最后一天可以添加的时间序列数量。对于限制每日&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;流失率&lt;/a&gt;非常有用。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;同时可以设置这两个限制。如果达到任何一个限制，那么新时间序列的输入样本将被丢弃。被丢弃的系列样本会以警告级别记录在日志中。&lt;/p&gt;
&lt;p&gt;超出限制的情况可以通过以下指标进行监控：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;vm_hourly_series_limit_rows_dropped_total&lt;/code&gt; - 由于超过每小时限制的唯一时间序列数量，指标数量减少了。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vm_hourly_series_limit_max_series&lt;/code&gt; - 每小时系列限制通过&lt;code&gt;-storage.maxHourlySeries&lt;/code&gt;命令行参数设置。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;vm_hourly_series_limit_current_series&lt;/code&gt; - 过去一小时内独特系列的当前数量。当过去一小时内独特系列的数量超过 &lt;code&gt;-storage.maxHourlySeries&lt;/code&gt; 的90%时，以下查询可能会有用于警报：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vm_hourly_series_limit_current_series / vm_hourly_series_limit_max_series &amp;gt; 0.9&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;vm_daily_series_limit_rows_dropped_total&lt;/code&gt; - 由于超过每日唯一时间序列数量限制，指标数量下降。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vm_daily_series_limit_max_series&lt;/code&gt; - 每日系列限制是通过&lt;code&gt;-storage.maxDailySeries&lt;/code&gt;命令行标志设置的。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;vm_daily_series_limit_current_series&lt;/code&gt; - 在过去的一天中，唯一系列的当前数量。当唯一系列在过去的一天内超过 &lt;code&gt;-storage.maxDailySeries&lt;/code&gt; 的90%时，以下查询可能会有用于警报：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vm_daily_series_limit_current_series / vm_daily_series_limit_max_series &amp;gt; 0.9&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;这些限制是近似值，所以VictoriaMetrics可以在限制范围内溢出/下溢一个小百分比（通常小于1%）。&lt;/p&gt;
&lt;p&gt;更多进阶内容参见 &lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html#cardinality-limiter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cardinality limiter in vmagent&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#cardinality-explorer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cardinality explorer docs&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;TSDB状态&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;tsdb状态&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#tsdb%e7%8a%b6%e6%80%81&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics在&lt;code&gt;/api/v1/status/tsdb&lt;/code&gt;页面以类似Prometheus的方式返回TSDB统计信息-请参阅这些&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#tsdb-stats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus文档&lt;/a&gt;。VictoriaMetrics在&lt;code&gt;/api/v1/status/tsdb&lt;/code&gt;页面接受以下可选查询参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;topN=N&lt;/code&gt;表示在响应中返回的前&lt;code&gt;N&lt;/code&gt;个顶级条目数量。默认情况下，返回前10个条目。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;date=YYYY-MM-DD&lt;/code&gt; 是收集统计数据的日期，其中 &lt;code&gt;YYYY-MM-DD&lt;/code&gt; 代表具体的日期。默认情况下，统计数据是针对当天进行收集的。如果要跨所有日期收集全局统计数据，请传递 &lt;code&gt;date=1970-01-01&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;focusLabel=LABEL_NAME&lt;/code&gt;在&lt;code&gt;seriesCountByFocusLabelValue&lt;/code&gt;列表中返回具有最高时间序列数量的给定&lt;code&gt;LABEL_NAME&lt;/code&gt;的标签值。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;match[]=SELECTOR&lt;/code&gt; where &lt;code&gt;SELECTOR&lt;/code&gt; is an arbitrary &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics/#time-series-selectors&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time series selector&lt;/a&gt; for series to take into account during stats calculation. By default all the series are taken into account.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;match[]=SELECTOR&lt;/code&gt; 是一个任意的&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics/#time-series-selectors&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;时间序列选择器&lt;/a&gt;，用于在统计计算中考虑的系列。默认情况下，所有系列都会被纳入考虑范围内。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;extra_label=LABEL=VALUE&lt;/code&gt;. 更多信息参见 &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#prometheus-querying-api-enhancements&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics的集群版本&lt;/a&gt;中，每个vmstorage都会单独跟踪存储的时间序列。vmselect通过从每个vmstorage节点请求&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#tsdb-stats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/status/tsdb&lt;/a&gt; API来获取统计信息，并通过对每个系列的统计数据进行求和来合并结果。当相同时间序列的样本分布在多个vmstorage节点上时，可能会导致值被夸大，这是由于&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#replication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;复制&lt;/a&gt;或&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html?highlight=re-routes#cluster-availability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;重定向&lt;/a&gt;造成的。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics &lt;code&gt;/api/v1/status/tsdb&lt;/code&gt; 之上提供了-UI支持，具体参见 &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#cardinality-explorer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cardinality explorer docs&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Query 追踪&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;query-追踪&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#query-%e8%bf%bd%e8%b8%aa&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics支持查询追踪，可用于确定查询处理过程中的瓶颈。这类似于Postgresql的&lt;code&gt;EXPLAIN ANALYZE&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;可以通过传递trace=1查询参数来启用特定查询的查询追踪。在这种情况下，VictoriaMetrics将查询跟踪放入输出JSON的trace字段中。&lt;/p&gt;
&lt;p&gt;例如，以下命令：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://localhost:8428/api/v1/query_range -d &amp;#39;query=2*rand()&amp;#39; -d &amp;#39;start=-1h&amp;#39; -d &amp;#39;step=1m&amp;#39; -d &amp;#39;trace=1&amp;#39; | jq &amp;#39;.trace&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;会返回下面的 trace 信息:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;#34;duration_msec&amp;#34;: 0.099,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;#34;message&amp;#34;: &amp;#34;/api/v1/query_range: start=1654034340000, end=1654037880000, step=60000, query=\&amp;#34;2*rand()\&amp;#34;: series=1&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &amp;#34;children&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &amp;#34;duration_msec&amp;#34;: 0.034,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &amp;#34;message&amp;#34;: &amp;#34;eval: query=2 * rand(), timeRange=[1654034340000..1654037880000], step=60000, mayCache=true: series=1, points=60, pointsPerSeries=60&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &amp;#34;children&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &amp;#34;duration_msec&amp;#34;: 0.032,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &amp;#34;message&amp;#34;: &amp;#34;binary op \&amp;#34;*\&amp;#34;: series=1&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &amp;#34;children&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &amp;#34;duration_msec&amp;#34;: 0.009,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &amp;#34;message&amp;#34;: &amp;#34;eval: query=2, timeRange=[1654034340000..1654037880000], step=60000, mayCache=true: series=1, points=60, pointsPerSeries=60&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &amp;#34;duration_msec&amp;#34;: 0.017,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &amp;#34;message&amp;#34;: &amp;#34;eval: query=rand(), timeRange=[1654034340000..1654037880000], step=60000, mayCache=true: series=1, points=60, pointsPerSeries=60&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &amp;#34;children&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &amp;#34;duration_msec&amp;#34;: 0.015,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  &amp;#34;message&amp;#34;: &amp;#34;transform rand(): series=1&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &amp;#34;duration_msec&amp;#34;: 0.004,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &amp;#34;message&amp;#34;: &amp;#34;sort series by metric name and labels&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &amp;#34;duration_msec&amp;#34;: 0.044,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &amp;#34;message&amp;#34;: &amp;#34;generate /api/v1/query_range response for series=1, points=60&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;所有跟踪中的持续时间和时间戳都以毫秒为单位。&lt;/p&gt;
&lt;p&gt;查询跟踪默认是允许的。可以通过在VictoriaMetrics上传递&lt;code&gt;-denyQueryTracing&lt;/code&gt;命令行标志来禁止它。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#vmui&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VMUI&lt;/a&gt; 提供了一个 UI 界面:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;对于 query 追踪 - 只需要选中 &lt;code&gt;Trace query&lt;/code&gt; 复选框，然后重新跑一下查询语句就可以得到执行 Trace。&lt;/li&gt;
&lt;li&gt;对于探索自定义追踪 - 进入 &lt;code&gt;Trace analyzer&lt;/code&gt; 页面，然后上传或粘贴 trace 的 JSON 数据信息。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;安全&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;安全&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%ae%89%e5%85%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;一般安全建议：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;所有的VictoriaMetrics组件必须在受保护的私有网络中运行，不能直接从不可信任的网络（如互联网）访问。例外情况是&lt;a href=&#34;https://docs.victoriametrics.com/vmauth.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmauth&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/vmgateway.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmgateway&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;来自不可信任网络到达VictoriaMetrics组件的所有请求都必须通过认证代理（例如vmauth或vmgateway）进行。代理必须设置适当的身份验证和授权。&lt;/li&gt;
&lt;li&gt;在配置位于VictoriaMetrics组件前面的认证代理时，最好使用允许API端点列表，并禁止对其他端点进行访问。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;VictoriaMetrics 提供了下面这些安全相关的命令行参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-tls&lt;/code&gt;, &lt;code&gt;-tlsCertFile&lt;/code&gt; and &lt;code&gt;-tlsKeyFile&lt;/code&gt; 用来开启 HTTPS.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-httpAuth.username&lt;/code&gt; and &lt;code&gt;-httpAuth.password&lt;/code&gt; 使用 &lt;a href=&#34;https://en.wikipedia.org/wiki/Basic_access_authentication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP Basic Authentication&lt;/a&gt; 来保护所有的 HTTP 接口。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-deleteAuthKey&lt;/code&gt; 用来保护 &lt;code&gt;/api/v1/admin/tsdb/delete_series&lt;/code&gt; 接口。参见 &lt;a href=&#34;https://docs.victoriametrics.com/#how-to-delete-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;how to delete time series&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-snapshotAuthKey&lt;/code&gt; 用来保护 &lt;code&gt;/snapshot*&lt;/code&gt; 一系列接口。参见 &lt;a href=&#34;https://docs.victoriametrics.com/#how-to-work-with-snapshots&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;how to work with snapshots&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-forceMergeAuthKey&lt;/code&gt; 用来保护 &lt;code&gt;/internal/force_merge&lt;/code&gt; 接口。参见 &lt;a href=&#34;https://docs.victoriametrics.com/#forced-merge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;force merge docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.resetCacheAuthKey&lt;/code&gt; 用来保护 &lt;code&gt;/internal/resetRollupResultCache&lt;/code&gt; 接口。 更多详情参见 &lt;a href=&#34;https://docs.victoriametrics.com/#backfilling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;backfilling&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-configAuthKey&lt;/code&gt; 用来保护 &lt;code&gt;/config&lt;/code&gt; 接口，因为它可能包含一些敏感的信息，比如密码。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-flagsAuthKey&lt;/code&gt; 用来保护 &lt;code&gt;/flags&lt;/code&gt; 接口。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-pprofAuthKey&lt;/code&gt; 用来保护 &lt;code&gt;/debug/pprof/*&lt;/code&gt; 接口，这是用来做性能分析的 &lt;a href=&#34;https://docs.victoriametrics.com/#profiling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;profiling&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-denyQueryTracing&lt;/code&gt; 用来禁用 &lt;a href=&#34;https://docs.victoriametrics.com/#query-tracing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;query tracing&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Explicitly set internal network interface for TCP and UDP ports for data ingestion with Graphite and OpenTSDB formats. For example, substitute &lt;code&gt;-graphiteListenAddr=:2003&lt;/code&gt; with &lt;code&gt;-graphiteListenAddr=&amp;lt;internal_iface_ip&amp;gt;:2003&lt;/code&gt;. This protects from unexpected requests from untrusted network interfaces.&lt;/p&gt;
&lt;p&gt;明确设置用于使用Graphite和OpenTSDB格式进行数据摄取的TCP和UDP端口的内部网络接口。例如，将&lt;code&gt;-graphiteListenAddr=:2003&lt;/code&gt;替换为&lt;code&gt;-graphiteListenAddr=&amp;lt;internal_iface_ip&amp;gt;:2003&lt;/code&gt;。这样可以防止来自不受信任的网络接口的意外请求。&lt;/p&gt;
&lt;p&gt;参见 &lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#security&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;security recommendation for VictoriaMetrics cluster&lt;/a&gt; and &lt;a href=&#34;https://victoriametrics.com/security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the general security page at VictoriaMetrics website&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;其他&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;其他&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%85%b6%e4%bb%96&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;压测&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;压测&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%8e%8b%e6%b5%8b&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;请注意，供应商（包括VictoriaMetrics在内）在进行此类测试时往往存在偏见。例如，他们会试图突出自己产品的优点，同时强调竞争产品的缺点。因此，我们鼓励用户和所有独立第三方对他们正在评估的各种产品进行生产环境下的基准测试，并公布结果。&lt;/p&gt;
&lt;p&gt;作为参考，请查看VictoriaMetrics团队进行的&lt;a href=&#34;https://docs.victoriametrics.com/Articles.html#benchmarks&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;基准测试&lt;/a&gt;。还请查看使用node_exporter指标运行摄取基准测试的&lt;a href=&#34;https://github.com/VictoriaMetrics/benchmark&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;helm chart&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;Profiling&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;profiling&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#profiling&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics提供了用于收集以下 &lt;a href=&#34;https://blog.golang.org/profiling-go-programs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Go profiles&lt;/a&gt; 内容的处理程序 :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;内存配置文件。可以使用以下命令收集（如有需要，请将0.0.0.0替换为主机名）：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://0.0.0.0:8428/debug/pprof/heap &amp;gt; mem.pprof&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;CPU配置文件。可以使用以下命令收集（如有需要，请将0.0.0.0替换为主机名）：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl http://0.0.0.0:8428/debug/pprof/profile &amp;gt; cpu.pprof&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;收集 CPU 个人资料的命令会在等待 30 秒后返回。 可以使用 &lt;a href=&#34;https://github.com/google/pprof&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;go tool pprof&lt;/a&gt; 分析收集到的个人资料。从安全角度来看，共享这些收集到的个人资料是安全的，因为它们不包含敏感信息。&lt;/p&gt;
&lt;h3&gt;常见问题建议&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;常见问题建议&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%b8%b8%e8%a7%81%e9%97%ae%e9%a2%98%e5%bb%ba%e8%ae%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;建议在不需要调整标志值的情况下使用默认命令行标志值（即不要显式设置它们）。&lt;/li&gt;
&lt;li&gt;建议在故障排除过程中检查日志，因为它们可能包含有用的信息。&lt;/li&gt;
&lt;li&gt;建议从此页面升级到最新可用版本，因为遇到的问题可能已经在那里修复了。&lt;/li&gt;
&lt;li&gt;建议至少保留50%的CPU、磁盘IO和RAM资源作为备用，这样VictoriaMetrics就可以处理工作负载中的短暂峰值而无性能问题。&lt;/li&gt;
&lt;li&gt;VictoriaMetrics需要空闲磁盘空间将数据文件合并成更大的文件。当没有足够的剩余空间时，它可能会变慢。因此，请确保&lt;code&gt;-storageDataPath&lt;/code&gt;目录至少有20%的可用空间。剩余可用空间量可以通过&lt;code&gt;vm_free_disk_space_bytes&lt;/code&gt;指标进行监控。存储在磁盘上的数据总大小可以通过vm_data_size_bytes指标之和进行监控。还可以查看&lt;code&gt;vm_merge_need_free_disk_space&lt;/code&gt;指标，如果由于缺乏免费磁盘空间而无法启动后台合并，则其值将设置为大于0.该值显示每月分区数，在拥有更多免费磁盘空间时将启动后台合并。&lt;/li&gt;
&lt;li&gt;VictoriaMetrics会将传入数据缓冲到内存中，并在几秒钟后将其刷新到持久存储中。这可能会导致以下“问题”：
&lt;ul&gt;
&lt;li&gt;插入后的几秒钟数据才能进行查询。可以通过请求&lt;code&gt;/internal/force_flush &lt;/code&gt;http处理程序将内存缓冲区刷新到可搜索部分。此处理程序主要用于测试和调试目的。&lt;/li&gt;
&lt;li&gt;在非正常关闭（即OOM、kill -9或硬件重置）时，最后几秒钟插入的数据可能会丢失。&lt;code&gt;-inmemoryDataFlushInterval&lt;/code&gt;命令行标志允许控制将内存中的数据刷新到持久存储的频率。有关更多详细信息，请参阅存储文档和本文。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;如果VictoriaMetrics工作缓慢，并且每秒摄取100K个数据点占用超过一个CPU核心，则很可能是当前RAM量对于太多活动时间序列来说不足够了。VictoriaMetrics公开了&lt;code&gt;vm_slow_*&lt;/code&gt;指标，例如&lt;code&gt;vm_slow_row_inserts_total&lt;/code&gt;和&lt;code&gt;vm_slow_metric_name_loads_total&lt;/code&gt;，它们可以用作RAM数量不足的指示器。建议增加节点上VictoriaMetrics所使用的RAM量以改善摄取和查询性能。&lt;/li&gt;
&lt;li&gt;如果同一度量标签顺序随时间变化（例如&lt;code&gt;metric{k1=&amp;quot;v1&amp;quot;,k2=&amp;quot;v2&amp;quot;}&lt;/code&gt;可能变为&lt;code&gt;metric{k2=&amp;quot;v2&amp;quot;,k1=&amp;quot;v1&amp;quot;}&lt;/code&gt;），则建议使用-sortLabels命令行标志运行VictoriaMetrics，以减少内存使用和CPU使用率。&lt;/li&gt;
&lt;li&gt;VictoriaMetrics优先考虑数据摄取而不是数据查询。因此，如果没有足够的资源进行数据摄取，则数据查询可能会显著减慢。&lt;/li&gt;
&lt;li&gt;如果VictoriaMetrics由于磁盘错误导致某些部分损坏而无法工作，则只需删除带有损坏部分的目录即可。在VictoriaMetrics未运行时，安全地删除&lt;code&gt;&amp;lt;-storageDataPath&amp;gt;/data/{big,small}/YYYY_MM&lt;/code&gt;目录下的子目录可以恢复VictoriaMetrics，但会丢失已存储在被删除损坏部分中的数据。将来将创建vmrecover工具以自动从此类错误中恢复。&lt;/li&gt;
&lt;li&gt;如果您在图表上看到间隙，请尝试通过向&lt;code&gt;/internal/resetRollupResultCache&lt;/code&gt;发送请求来重置缓存。如果这样可以消除图表上的间隙，则很可能是将早于&lt;code&gt;-search.cacheTimestampOffset&lt;/code&gt;时间戳的数据。&lt;/li&gt;
&lt;li&gt;如果您从InfluxDB或TimescaleDB切换过来，可能需要设置&lt;code&gt;-search.setLookbackToStep&lt;/code&gt;命令行标志。这将抑制VictoriaMetrics使用的默认间隙填充算法-默认情况下，它假设每个时间序列是连续的而不是离散的，因此会用固定间隔填补真实样本之间的空白。&lt;/li&gt;
&lt;li&gt;通过&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#cardinality-explorer&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cardinality explorer&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#tsdb-stats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/status/tsdb&lt;/a&gt;端点可以确定导致高基数或高变动率的指标和标签。&lt;/li&gt;
&lt;li&gt;如果要在VictoriaMetrics中记录新时间序列，请传递&lt;code&gt;-logNewSeries&lt;/code&gt;命令行标志。&lt;/li&gt;
&lt;li&gt;VictoriaMetrics通过&lt;code&gt;-maxLabelsPerTimeseries&lt;/code&gt;命令行标志限制每个度量指标的标签数量。这可以防止摄入具有太多标签的指标。建议监视&lt;code&gt;vm_metrics_with_dropped_labels_total&lt;/code&gt;度量以确定是否需要根据工作负载调整&lt;code&gt;-maxLabelsPerTimeseries&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;如果您在VictoriaMetrics中存储Graphite指标（如&lt;code&gt;foo.bar.baz&lt;/code&gt;），则可以使用&lt;code&gt;{__graphite__=&amp;quot;foo.*.baz&amp;quot;}&lt;/code&gt;过滤器选择此类指标。详细信息请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#selecting-graphite-metrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;相关文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;在数据摄取期间，VictoriaMetrics会忽略&lt;code&gt;NaN&lt;/code&gt;值。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;更多参见&lt;a href=&#34;https://docs.victoriametrics.com/Troubleshooting.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;故障排查文档&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;运行参数&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;运行参数&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e8%bf%90%e8%a1%8c%e5%8f%82%e6%95%b0&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;使用&lt;code&gt;-help&lt;/code&gt;参数来查看支持的所有运行参数列表和参数功能描述。&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-bigMergeConcurrency int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Deprecated: this flag does nothing
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-blockcache.missesBeforeCaching int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The number of cache misses before putting the block into cache. Higher values may reduce indexdb/dataBlocks cache size at the cost of higher CPU and disk read usage &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 2&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-cacheExpireDuration duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Items are removed from in-memory caches after they aren&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;t accessed for this duration. Lower values may reduce memory usage at the cost of higher CPU usage. See also -prevCacheRemovalPercent (default 30m0s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-configAuthKey value
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Authorization key for accessing /config page. It must be passed via authKey query arg. It overrides -httpAuth.*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Flag value can be read from the given file when using -configAuthKey=file:///abs/path/to/file or -configAuthKey=file://./relative/path/to/file . Flag value can be read from the given http/https url when using -configAuthKey=http://host/path or -configAuthKey=https://host/path
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-csvTrimTimestamp duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Trim timestamps when importing csv data to this duration. Minimum practical duration is 1ms. Higher duration (i.e. 1s) may be used for reducing disk space usage for timestamp data (default 1ms)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-datadog.maxInsertRequestSize size
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum size in bytes of a single DataDog POST request to /datadog/api/v2/series
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports the following optional suffixes for size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB (default 67108864)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-datadog.sanitizeMetricName
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Sanitize metric names for the ingested DataDog data to comply with DataDog behaviour described at https://docs.datadoghq.com/metrics/custom_metrics/#naming-custom-metrics (default true)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-dedup.minScrapeInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Leave only the last sample in every time series per each discrete interval equal to -dedup.minScrapeInterval &amp;gt; 0. See also -streamAggr.dedupInterval and https://docs.victoriametrics.com/#deduplication
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-deleteAuthKey value
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   authKey for metrics&amp;#39;&lt;/span&gt; deletion via /api/v1/admin/tsdb/delete_series and /tags/delSeries
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Flag value can be read from the given file when using -deleteAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file:///abs/path/to/file or -deleteAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file://./relative/path/to/file . Flag value can be read from the given http/https url when using -deleteAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;http://host/path or -deleteAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://host/path
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-denyQueriesOutsideRetention
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to deny queries outside the configured -retentionPeriod. When set, &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt; /api/v1/query_range would &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;503 Service Unavailable&amp;#39;&lt;/span&gt; error &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; queries with &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;from&amp;#39;&lt;/span&gt; value outside -retentionPeriod. This may be useful when multiple data sources with distinct retentions are hidden behind query-tee
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-denyQueryTracing
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to disable the ability to trace queries. See https://docs.victoriametrics.com/#query-tracing
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-downsampling.period array
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Comma-separated downsampling periods in the format &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;offset:period&amp;#39;&lt;/span&gt;. For example, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;30d:10m&amp;#39;&lt;/span&gt; instructs to leave a single sample per &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt; minutes &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; samples older than &lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt; days. When setting multiple downsampling periods, it is necessary &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; the periods to be multiples of each other. See https://docs.victoriametrics.com/#downsampling &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details. This flag is available only in VictoriaMetrics enterprise. See https://docs.victoriametrics.com/enterprise/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Value can contain comma inside single-quoted or double-quoted string, &lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; and &lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; braces.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-dryRun
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to check config files without running VictoriaMetrics. The following config files are checked: -promscrape.config, -relabelConfig and -streamAggr.config. Unknown config entries aren&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;t allowed in -promscrape.config by default. This can be changed with -promscrape.config.strictParse=false command-line flag
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-enableTCP6
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to enable IPv6 for listening and dialing. By default, only IPv4 TCP and UDP are used
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-envflag.enable
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to enable reading flags from environment variables in addition to the command line. Command line flag values have priority over values from environment vars. Flags are read only from the command line if this flag isn&amp;#39;&lt;/span&gt;t set. See https://docs.victoriametrics.com/#environment-variables &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; more details
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-envflag.prefix string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Prefix &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; environment variables &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; -envflag.enable is set
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-eula
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Deprecated, please use -license or -licenseFile flags instead. By specifying this flag, you confirm that you have an enterprise license and accept the ESA https://victoriametrics.com/legal/esa/ . This flag is available only in Enterprise binaries. See https://docs.victoriametrics.com/enterprise/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-filestream.disableFadvise
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to disable fadvise&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; syscall when reading large data files. The fadvise&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; syscall prevents from eviction of recently accessed data from OS page cache during background merges and backups. In some rare cases it is better to disable the syscall &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; it uses too much CPU
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-finalMergeDelay duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Deprecated: this flag does nothing
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-flagsAuthKey value
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Auth key &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; /flags endpoint. It must be passed via authKey query arg. It overrides -httpAuth.*
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Flag value can be read from the given file when using -flagsAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file:///abs/path/to/file or -flagsAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file://./relative/path/to/file . Flag value can be read from the given http/https url when using -flagsAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;http://host/path or -flagsAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://host/path
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-forceFlushAuthKey value
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   authKey, which must be passed in query string to /internal/force_flush pages
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Flag value can be read from the given file when using -forceFlushAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file:///abs/path/to/file or -forceFlushAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file://./relative/path/to/file . Flag value can be read from the given http/https url when using -forceFlushAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;http://host/path or -forceFlushAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://host/path
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-forceMergeAuthKey value
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   authKey, which must be passed in query string to /internal/force_merge pages
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Flag value can be read from the given file when using -forceMergeAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file:///abs/path/to/file or -forceMergeAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file://./relative/path/to/file . Flag value can be read from the given http/https url when using -forceMergeAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;http://host/path or -forceMergeAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://host/path
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-fs.disableMmap
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to use pread&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; instead of mmap&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; reading data files. By default, mmap&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; is used &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; 64-bit arches and pread&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; is used &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; 32-bit arches, since they cannot read data files bigger than 2^32 bytes in memory. mmap&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; is usually faster &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; reading small data chunks than pread&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-graphite.sanitizeMetricName
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Sanitize metric names &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; the ingested Graphite data. See https://docs.victoriametrics.com/#how-to-send-data-from-graphite-compatible-agents-such-as-statsd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-graphiteListenAddr string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   TCP and UDP address to listen &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; Graphite plaintext data. Usually :2003 must be set. Doesn&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;t work if empty. See also -graphiteListenAddr.useProxyProtocol
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-graphiteListenAddr.useProxyProtocol
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to use proxy protocol for connections accepted at -graphiteListenAddr . See https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-graphiteTrimTimestamp duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Trim timestamps for Graphite data to this duration. Minimum practical duration is 1s. Higher duration (i.e. 1m) may be used for reducing disk space usage for timestamp data (default 1s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-http.connTimeout duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Incoming connections to -httpListenAddr are closed after the configured timeout. This may help evenly spreading load among a cluster of services behind TCP-level load balancer. Zero value disables closing of incoming connections (default 2m0s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-http.disableResponseCompression
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Disable compression of HTTP responses to save CPU resources. By default, compression is enabled to save network bandwidth
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-http.header.csp string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Value for &amp;#39;&lt;/span&gt;Content-Security-Policy&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; header, recommended: &amp;#34;default-src &amp;#39;&lt;/span&gt;self&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-http.header.frameOptions string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Value for &amp;#39;&lt;/span&gt;X-Frame-Options&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; header
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-http.header.hsts string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Value for &amp;#39;&lt;/span&gt;Strict-Transport-Security&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; header, recommended: &amp;#39;&lt;/span&gt;max-age&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;31536000; includeSubDomains&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-http.idleConnTimeout duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Timeout for incoming idle http connections (default 1m0s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-http.maxGracefulShutdownDuration duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum duration for a graceful shutdown of the HTTP server. A highly loaded server may require increased value for a graceful shutdown (default 7s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-http.pathPrefix string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   An optional prefix to add to all the paths handled by http server. For example, if &amp;#39;&lt;/span&gt;-http.pathPrefix&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/foo/bar&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; is set, then all the http requests will be handled on &amp;#39;&lt;/span&gt;/foo/bar/*&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; paths. This may be useful for proxied requests. See https://www.robustperception.io/using-external-urls-and-proxies-with-prometheus
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-http.shutdownDelay duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Optional delay before http server shutdown. During this delay, the server returns non-OK responses from /health page, so load balancers can route new requests to other servers
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-httpAuth.password value
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Password for HTTP server&amp;#39;&lt;/span&gt;s Basic Auth. The authentication is disabled &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; -httpAuth.username is empty
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Flag value can be read from the given file when using -httpAuth.password&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file:///abs/path/to/file or -httpAuth.password&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file://./relative/path/to/file . Flag value can be read from the given http/https url when using -httpAuth.password&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;http://host/path or -httpAuth.password&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://host/path
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-httpAuth.username string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Username &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; HTTP server&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s Basic Auth. The authentication is disabled if empty. See also -httpAuth.password
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-httpListenAddr array
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   TCP addresses to listen for incoming http requests. See also -tls and -httpListenAddr.useProxyProtocol
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Value can contain comma inside single-quoted or double-quoted string, {}, [] and () braces.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-httpListenAddr.useProxyProtocol array
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to use proxy protocol for connections accepted at the corresponding -httpListenAddr . See https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt . With enabled proxy protocol http server cannot serve regular /metrics endpoint. Use -pushmetrics.url for metrics pushing
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Empty values are set to false.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-import.maxLineLen size
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum length in bytes of a single line accepted by /api/v1/import; the line length can be limited with &amp;#39;&lt;/span&gt;max_rows_per_line&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; query arg passed to /api/v1/export
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports the following optional suffixes for size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB (default 10485760)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-influx.databaseNames array
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Comma-separated list of database names to return from /query and /influx/query API. This can be needed for accepting data from Telegraf plugins such as https://github.com/fangli/fluent-plugin-influxdb
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Value can contain comma inside single-quoted or double-quoted string, {}, [] and () braces.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-influx.maxLineSize size
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum size in bytes for a single InfluxDB line during parsing
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports the following optional suffixes for size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB (default 262144)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-influxDBLabel string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Default label for the DB name sent over &amp;#39;&lt;/span&gt;?db&lt;span style=&#34;color:#f92672&#34;&gt;={&lt;/span&gt;db_name&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; query parameter (default &amp;#34;db&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-influxListenAddr string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   TCP and UDP address to listen for InfluxDB line protocol data. Usually :8089 must be set. Doesn&amp;#39;&lt;/span&gt;t work &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; empty. This flag isn&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;t needed when ingesting data over HTTP - just send it to http://&amp;lt;victoriametrics&amp;gt;:8428/write . See also -influxListenAddr.useProxyProtocol
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-influxListenAddr.useProxyProtocol
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to use proxy protocol for connections accepted at -influxListenAddr . See https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-influxMeasurementFieldSeparator string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Separator for &amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;measurement&lt;span style=&#34;color:#f92672&#34;&gt;}{&lt;/span&gt;separator&lt;span style=&#34;color:#f92672&#34;&gt;}{&lt;/span&gt;field_name&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; metric name when inserted via InfluxDB line protocol (default &amp;#34;_&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-influxSkipMeasurement
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Uses &amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;field_name&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; as a metric name while ignoring &amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;measurement&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; and &amp;#39;&lt;/span&gt;-influxMeasurementFieldSeparator&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-influxSkipSingleField
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Uses &amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;measurement&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; instead of &amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;measurement&lt;span style=&#34;color:#f92672&#34;&gt;}{&lt;/span&gt;separator&lt;span style=&#34;color:#f92672&#34;&gt;}{&lt;/span&gt;field_name&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; for metric name if InfluxDB line contains only a single field
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-influxTrimTimestamp duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Trim timestamps for InfluxDB line protocol data to this duration. Minimum practical duration is 1ms. Higher duration (i.e. 1s) may be used for reducing disk space usage for timestamp data (default 1ms)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-inmemoryDataFlushInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The interval for guaranteed saving of in-memory data to disk. The saved data survives unclean shutdowns such as OOM crash, hardware reset, SIGKILL, etc. Bigger intervals may help increase the lifetime of flash storage with limited write cycles (e.g. Raspberry PI). Smaller intervals increase disk IO load. Minimum supported value is 1s (default 5s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-insert.maxQueueDuration duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum duration to wait in the queue when -maxConcurrentInserts concurrent insert requests are executed (default 1m0s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-internStringCacheExpireDuration duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The expiry duration for caches for interned strings. See https://en.wikipedia.org/wiki/String_interning . See also -internStringMaxLen and -internStringDisableCache (default 6m0s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-internStringDisableCache
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to disable caches for interned strings. This may reduce memory usage at the cost of higher CPU usage. See https://en.wikipedia.org/wiki/String_interning . See also -internStringCacheExpireDuration and -internStringMaxLen
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-internStringMaxLen int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum length for strings to intern. A lower limit may save memory at the cost of higher CPU usage. See https://en.wikipedia.org/wiki/String_interning . See also -internStringDisableCache and -internStringCacheExpireDuration (default 500)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-license string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   License key for VictoriaMetrics Enterprise. See https://victoriametrics.com/products/enterprise/ . Trial Enterprise license can be obtained from https://victoriametrics.com/products/enterprise/trial/ . This flag is available only in Enterprise binaries. The license key can be also passed via file specified by -licenseFile command-line flag
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-license.forceOffline
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to enable offline verification for VictoriaMetrics Enterprise license key, which has been passed either via -license or via -licenseFile command-line flag. The issued license key must support offline verification feature. Contact info@victoriametrics.com if you need offline license verification. This flag is available only in Enterprise binaries
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-licenseFile string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Path to file with license key for VictoriaMetrics Enterprise. See https://victoriametrics.com/products/enterprise/ . Trial Enterprise license can be obtained from https://victoriametrics.com/products/enterprise/trial/ . This flag is available only in Enterprise binaries. The license key can be also passed inline via -license command-line flag
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-logNewSeries
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to log new series. This option is for debug purposes only. It can lead to performance issues when big number of new series are ingested into VictoriaMetrics
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-loggerDisableTimestamps
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to disable writing timestamps in logs
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-loggerErrorsPerSecondLimit int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Per-second limit on the number of ERROR messages. If more than the given number of errors are emitted per second, the remaining errors are suppressed. Zero values disable the rate limit
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-loggerFormat string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Format for logs. Possible values: default, json (default &amp;#34;default&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-loggerJSONFields string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Allows renaming fields in JSON formatted logs. Example: &amp;#34;ts:timestamp,msg:message&amp;#34; renames &amp;#34;ts&amp;#34; to &amp;#34;timestamp&amp;#34; and &amp;#34;msg&amp;#34; to &amp;#34;message&amp;#34;. Supported fields: ts, level, caller, msg
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-loggerLevel string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Minimum level of errors to log. Possible values: INFO, WARN, ERROR, FATAL, PANIC (default &amp;#34;INFO&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-loggerMaxArgLen int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum length of a single logged argument. Longer arguments are replaced with &amp;#39;&lt;/span&gt;arg_start..arg_end&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;, where &amp;#39;&lt;/span&gt;arg_start&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; and &amp;#39;&lt;/span&gt;arg_end&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; is prefix and suffix of the arg with the length not exceeding -loggerMaxArgLen / 2 (default 1000)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-loggerOutput string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Output for the logs. Supported values: stderr, stdout (default &amp;#34;stderr&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-loggerTimezone string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Timezone to use for timestamps in logs. Timezone must be a valid IANA Time Zone. For example: America/New_York, Europe/Berlin, Etc/GMT+3 or Local (default &amp;#34;UTC&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-loggerWarnsPerSecondLimit int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Per-second limit on the number of WARN messages. If more than the given number of warns are emitted per second, then the remaining warns are suppressed. Zero values disable the rate limit
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-maxConcurrentInserts int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum number of concurrent insert requests. Set higher value when clients send data over slow networks. Default value depends on the number of available CPU cores. It should work fine in most cases since it minimizes resource usage. See also -insert.maxQueueDuration (default 32)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-maxInsertRequestSize size
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum size in bytes of a single Prometheus remote_write API request
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports the following optional suffixes for size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB (default 33554432)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-maxLabelValueLen int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum length of label values in the accepted time series. Longer label values are truncated. In this case the vm_too_long_label_values_total metric at /metrics page is incremented (default 4096)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-maxLabelsPerTimeseries int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum number of labels accepted per time series. Superfluous labels are dropped. In this case the vm_metrics_with_dropped_labels_total metric at /metrics page is incremented (default 30)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-memory.allowedBytes size
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Allowed size of system memory VictoriaMetrics caches may occupy. This option overrides -memory.allowedPercent if set to a non-zero value. Too low a value may increase the cache miss rate usually resulting in higher CPU and disk IO usage. Too high a value may evict too much data from the OS page cache resulting in higher disk IO usage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports the following optional suffixes for size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB (default 0)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-memory.allowedPercent float
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Allowed percent of system memory VictoriaMetrics caches may occupy. See also -memory.allowedBytes. Too low a value may increase cache miss rate usually resulting in higher CPU and disk IO usage. Too high a value may evict too much data from the OS page cache which will result in higher disk IO usage (default 60)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-metrics.exposeMetadata
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to expose TYPE and HELP metadata at the /metrics page, which is exposed at -httpListenAddr . The metadata may be needed when the /metrics page is consumed by systems, which require this information. For example, Managed Prometheus in Google Cloud - https://cloud.google.com/stackdriver/docs/managed-prometheus/troubleshooting#missing-metric-type
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-metricsAuthKey value
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Auth key for /metrics endpoint. It must be passed via authKey query arg. It overrides -httpAuth.*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Flag value can be read from the given file when using -metricsAuthKey=file:///abs/path/to/file or -metricsAuthKey=file://./relative/path/to/file . Flag value can be read from the given http/https url when using -metricsAuthKey=http://host/path or -metricsAuthKey=https://host/path
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-mtls array
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to require valid client certificate for https requests to the corresponding -httpListenAddr . This flag works only if -tls flag is set. See also -mtlsCAFile . This flag is available only in Enterprise binaries. See https://docs.victoriametrics.com/enterprise/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Empty values are set to false.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-mtlsCAFile array
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Optional path to TLS Root CA for verifying client certificates at the corresponding -httpListenAddr when -mtls is enabled. By default the host system TLS Root CA is used for client certificate verification. This flag is available only in Enterprise binaries. See https://docs.victoriametrics.com/enterprise/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Value can contain comma inside single-quoted or double-quoted string, {}, [] and () braces.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-newrelic.maxInsertRequestSize size
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum size in bytes of a single NewRelic request to /newrelic/infra/v2/metrics/events/bulk
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports the following optional suffixes for size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB (default 67108864)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-opentelemetry.usePrometheusNaming
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to convert metric names and labels into Prometheus-compatible format for the metrics ingested via OpenTelemetry protocol; see https://docs.victoriametrics.com/#sending-data-via-opentelemetry
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-opentsdbHTTPListenAddr string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   TCP address to listen for OpenTSDB HTTP put requests. Usually :4242 must be set. Doesn&amp;#39;&lt;/span&gt;t work &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; empty. See also -opentsdbHTTPListenAddr.useProxyProtocol
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-opentsdbHTTPListenAddr.useProxyProtocol
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to use proxy protocol &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; connections accepted at -opentsdbHTTPListenAddr . See https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-opentsdbListenAddr string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   TCP and UDP address to listen &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; OpenTSDB metrics. Telnet put messages and HTTP /api/put messages are simultaneously served on TCP port. Usually :4242 must be set. Doesn&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;t work if empty. See also -opentsdbListenAddr.useProxyProtocol
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-opentsdbListenAddr.useProxyProtocol
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to use proxy protocol for connections accepted at -opentsdbListenAddr . See https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-opentsdbTrimTimestamp duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Trim timestamps for OpenTSDB &amp;#39;&lt;/span&gt;telnet put&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; data to this duration. Minimum practical duration is 1s. Higher duration (i.e. 1m) may be used for reducing disk space usage for timestamp data (default 1s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-opentsdbhttp.maxInsertRequestSize size
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum size of OpenTSDB HTTP put request
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports the following optional suffixes for size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB (default 33554432)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-opentsdbhttpTrimTimestamp duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Trim timestamps for OpenTSDB HTTP data to this duration. Minimum practical duration is 1ms. Higher duration (i.e. 1s) may be used for reducing disk space usage for timestamp data (default 1ms)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-pprofAuthKey value
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Auth key for /debug/pprof/* endpoints. It must be passed via authKey query arg. It overrides -httpAuth.*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Flag value can be read from the given file when using -pprofAuthKey=file:///abs/path/to/file or -pprofAuthKey=file://./relative/path/to/file . Flag value can be read from the given http/https url when using -pprofAuthKey=http://host/path or -pprofAuthKey=https://host/path
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-precisionBits int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The number of precision bits to store per each value. Lower precision bits improves data compression at the cost of precision loss (default 64)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-prevCacheRemovalPercent float
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Items in the previous caches are removed when the percent of requests it serves becomes lower than this value. Higher values reduce memory usage at the cost of higher CPU usage. See also -cacheExpireDuration (default 0.1)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.azureSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Interval for checking for changes in Azure. This works only if azure_sd_configs is configured in &amp;#39;&lt;/span&gt;-promscrape.config&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; file. See https://docs.victoriametrics.com/sd_configs/#azure_sd_configs for details (default 1m0s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.cluster.memberLabel string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   If non-empty, then the label with this name and the -promscrape.cluster.memberNum value is added to all the scraped metrics. See https://docs.victoriametrics.com/vmagent/#scraping-big-number-of-targets for more info
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.cluster.memberNum string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The number of vmagent instance in the cluster of scrapers. It must be a unique value in the range 0 ... promscrape.cluster.membersCount-1 across scrapers in the cluster. Can be specified as pod name of Kubernetes StatefulSet - pod-name-Num, where Num is a numeric part of pod name. See also -promscrape.cluster.memberLabel . See https://docs.victoriametrics.com/vmagent/#scraping-big-number-of-targets for more info (default &amp;#34;0&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.cluster.memberURLTemplate string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   An optional template for URL to access vmagent instance with the given -promscrape.cluster.memberNum value. Every %d occurrence in the template is substituted with -promscrape.cluster.memberNum at urls to vmagent instances responsible for scraping the given target at /service-discovery page. For example -promscrape.cluster.memberURLTemplate=&amp;#39;&lt;/span&gt;http://vmagent-%d:8429/targets&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;. See https://docs.victoriametrics.com/vmagent/#scraping-big-number-of-targets for more details
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.cluster.membersCount int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The number of members in a cluster of scrapers. Each member must have a unique -promscrape.cluster.memberNum in the range 0 ... promscrape.cluster.membersCount-1 . Each member then scrapes roughly 1/N of all the targets. By default, cluster scraping is disabled, i.e. a single scraper scrapes all the targets. See https://docs.victoriametrics.com/vmagent/#scraping-big-number-of-targets for more info (default 1)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.cluster.name string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Optional name of the cluster. If multiple vmagent clusters scrape the same targets, then each cluster must have unique name in order to properly de-duplicate samples received from these clusters. See https://docs.victoriametrics.com/vmagent/#scraping-big-number-of-targets for more info
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.cluster.replicationFactor int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The number of members in the cluster, which scrape the same targets. If the replication factor is greater than 1, then the deduplication must be enabled at remote storage side. See https://docs.victoriametrics.com/vmagent/#scraping-big-number-of-targets for more info (default 1)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.config string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Optional path to Prometheus config file with &amp;#39;&lt;/span&gt;scrape_configs&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; section containing targets to scrape. The path can point to local file and to http url. See https://docs.victoriametrics.com/#how-to-scrape-prometheus-exporters-such-as-node-exporter for details
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.config.dryRun
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Checks -promscrape.config file for errors and unsupported fields and then exits. Returns non-zero exit code on parsing errors and emits these errors to stderr. See also -promscrape.config.strictParse command-line flag. Pass -loggerLevel=ERROR if you don&amp;#39;&lt;/span&gt;t need to see info messages in the output.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.config.strictParse
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to deny unsupported fields in -promscrape.config . Set to false in order to silently skip unsupported fields &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default true&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.configCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in -promscrape.config file. By default, the checking is disabled. See how to reload -promscrape.config file at https://docs.victoriametrics.com/vmagent/#configuration-update
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.consul.waitTime duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Wait time used by Consul service discovery. Default value is used &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; not set
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.consulSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in Consul. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; consul_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#consul_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.consulagentSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in Consul Agent. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; consulagent_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#consulagent_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.digitaloceanSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in digital ocean. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; digitalocean_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#digitalocean_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 1m0s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.disableCompression
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to disable sending &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Accept-Encoding: gzip&amp;#39;&lt;/span&gt; request headers to all the scrape targets. This may reduce CPU usage on scrape targets at the cost of higher network bandwidth utilization. It is possible to set &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;disable_compression: true&amp;#39;&lt;/span&gt; individually per each &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;scrape_config&amp;#39;&lt;/span&gt; section in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; fine-grained control
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.disableKeepAlive
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to disable HTTP keep-alive connections when scraping all the targets. This may be useful when targets has no support &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; HTTP keep-alive connection. It is possible to set &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;disable_keepalive: true&amp;#39;&lt;/span&gt; individually per each &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;scrape_config&amp;#39;&lt;/span&gt; section in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; fine-grained control. Note that disabling HTTP keep-alive may increase load on both vmagent and scrape targets
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.discovery.concurrency int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of concurrent requests to Prometheus autodiscovery API &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;Consul, Kubernetes, etc.&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 100&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.discovery.concurrentWaitTime duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum duration &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; waiting to perform API requests &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; more than -promscrape.discovery.concurrency requests are simultaneously performed &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 1m0s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.dnsSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in dns. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; dns_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#dns_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.dockerSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in docker. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; docker_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#docker_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.dockerswarmSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in dockerswarm. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; dockerswarm_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#dockerswarm_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.dropOriginalLabels
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to drop original labels &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; scrape targets at /targets and /api/v1/targets pages. This may be needed &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; reducing memory usage when original labels &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; big number of scrape targets occupy big amounts of memory. Note that this reduces debuggability &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; improper per-target relabeling configs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.ec2SDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in ec2. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ec2_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#ec2_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 1m0s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.eurekaSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in eureka. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; eureka_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#eureka_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.fileSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;file_sd_config&amp;#39;&lt;/span&gt;. See https://docs.victoriametrics.com/sd_configs/#file_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 1m0s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.gceSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in gce. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; gce_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#gce_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 1m0s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.hetznerSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in Hetzner API. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; hetzner_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#hetzner_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 1m0s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.httpSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in http endpoint service discovery. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; http_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#http_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 1m0s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.kubernetes.apiServerTimeout duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   How frequently to reload the full state from Kubernetes API server &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30m0s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.kubernetes.attachNodeMetadataAll
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to set attach_metadata.node&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;true &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; all the kubernetes_sd_configs at -promscrape.config . It is possible to set attach_metadata.node&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;false individually per each kubernetes_sd_configs . See https://docs.victoriametrics.com/sd_configs/#kubernetes_sd_configs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.kubernetesSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in Kubernetes API server. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; kubernetes_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#kubernetes_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.kumaSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; checking &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; changes in kuma service discovery. This works only &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; kuma_sd_configs is configured in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-promscrape.config&amp;#39;&lt;/span&gt; file. See https://docs.victoriametrics.com/sd_configs/#kuma_sd_configs &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.maxDroppedTargets int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of droppedTargets to show at /api/v1/targets page. Increase this value &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; your setup drops more scrape targets during relabeling and you need investigating labels &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; all the dropped targets. Note that the increased number of tracked dropped targets may result in increased memory usage &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 10000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.maxResponseHeadersSize size
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum size of http response headers from Prometheus scrape targets
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports the following optional suffixes &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 4096&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.maxScrapeSize size
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum size of scrape response in bytes to process from Prometheus targets. Bigger responses are rejected
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports the following optional suffixes &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 16777216&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.minResponseSizeForStreamParse size
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The minimum target response size &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; automatic switching to stream parsing mode, which can reduce memory usage. See https://docs.victoriametrics.com/vmagent/#stream-parsing-mode
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports the following optional suffixes &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 1000000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-promscrape.noStaleMarkers
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to disable sending Prometheus stale markers &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; metrics when scrape target disappears. This option may reduce memory usage &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; stale markers aren&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;t needed for your setup. This option also disables populating the scrape_series_added metric. See https://prometheus.io/docs/concepts/jobs_instances/#automatically-generated-labels-and-time-series
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.nomad.waitTime duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Wait time used by Nomad service discovery. Default value is used if not set
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.nomadSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Interval for checking for changes in Nomad. This works only if nomad_sd_configs is configured in &amp;#39;&lt;/span&gt;-promscrape.config&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; file. See https://docs.victoriametrics.com/sd_configs/#nomad_sd_configs for details (default 30s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.openstackSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Interval for checking for changes in openstack API server. This works only if openstack_sd_configs is configured in &amp;#39;&lt;/span&gt;-promscrape.config&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; file. See https://docs.victoriametrics.com/sd_configs/#openstack_sd_configs for details (default 30s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.seriesLimitPerTarget int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Optional limit on the number of unique time series a single scrape target can expose. See https://docs.victoriametrics.com/vmagent/#cardinality-limiter for more info
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.streamParse
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to enable stream parsing for metrics obtained from scrape targets. This may be useful for reducing memory usage when millions of metrics are exposed per each scrape target. It is possible to set &amp;#39;&lt;/span&gt;stream_parse: true&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; individually per each &amp;#39;&lt;/span&gt;scrape_config&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; section in &amp;#39;&lt;/span&gt;-promscrape.config&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; for fine-grained control
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.suppressDuplicateScrapeTargetErrors
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to suppress &amp;#39;&lt;/span&gt;duplicate scrape target&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; errors; see https://docs.victoriametrics.com/vmagent/#troubleshooting for details
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.suppressScrapeErrors
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to suppress scrape errors logging. The last error for each target is always available at &amp;#39;&lt;/span&gt;/targets&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; page even if scrape errors logging is suppressed. See also -promscrape.suppressScrapeErrorsDelay
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.suppressScrapeErrorsDelay duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The delay for suppressing repeated scrape errors logging per each scrape targets. This may be used for reducing the number of log lines related to scrape errors. See also -promscrape.suppressScrapeErrors
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-promscrape.yandexcloudSDCheckInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Interval for checking for changes in Yandex Cloud API. This works only if yandexcloud_sd_configs is configured in &amp;#39;&lt;/span&gt;-promscrape.config&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; file. See https://docs.victoriametrics.com/sd_configs/#yandexcloud_sd_configs for details (default 30s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-pushmetrics.disableCompression
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to disable request body compression when pushing metrics to every -pushmetrics.url
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-pushmetrics.extraLabel array
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Optional labels to add to metrics pushed to every -pushmetrics.url . For example, -pushmetrics.extraLabel=&amp;#39;&lt;/span&gt;instance&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;foo&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; adds instance=&amp;#34;foo&amp;#34; label to all the metrics pushed to every -pushmetrics.url
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Value can contain comma inside single-quoted or double-quoted string, {}, [] and () braces.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-pushmetrics.header array
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Optional HTTP request header to send to every -pushmetrics.url . For example, -pushmetrics.header=&amp;#39;&lt;/span&gt;Authorization: Basic foobar&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; adds &amp;#39;&lt;/span&gt;Authorization: Basic foobar&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; header to every request to every -pushmetrics.url
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Value can contain comma inside single-quoted or double-quoted string, {}, [] and () braces.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-pushmetrics.interval duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Interval for pushing metrics to every -pushmetrics.url (default 10s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-pushmetrics.url array
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Optional URL to push metrics exposed at /metrics page. See https://docs.victoriametrics.com/#push-metrics . By default, metrics exposed at /metrics page aren&amp;#39;&lt;/span&gt;t pushed to any remote storage
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Value can contain comma inside single-quoted or double-quoted string, &lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; and &lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; braces.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-relabelConfig string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Optional path to a file with relabeling rules, which are applied to all the ingested metrics. The path can point either to local file or to http url. See https://docs.victoriametrics.com/#relabeling &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details. The config is reloaded on SIGHUP signal
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-reloadAuthKey value
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Auth key &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; /-/reload http endpoint. It must be passed via authKey query arg. It overrides -httpAuth.*
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Flag value can be read from the given file when using -reloadAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file:///abs/path/to/file or -reloadAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file://./relative/path/to/file . Flag value can be read from the given http/https url when using -reloadAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;http://host/path or -reloadAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://host/path
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-retentionFilter array
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Retention filter in the format &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;filter:retention&amp;#39;&lt;/span&gt;. For example, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;{env=&amp;#34;dev&amp;#34;}:3d&amp;#39;&lt;/span&gt; configures the retention &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; time series with env&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dev&amp;#34;&lt;/span&gt; label to &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; days. See https://docs.victoriametrics.com/#retention-filters &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details. This flag is available only in VictoriaMetrics enterprise. See https://docs.victoriametrics.com/enterprise/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Value can contain comma inside single-quoted or double-quoted string, &lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; and &lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; braces.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-retentionPeriod value
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Data with timestamps outside the retentionPeriod is automatically deleted. The minimum retentionPeriod is 24h or 1d. See also -retentionFilter
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The following optional suffixes are supported: s &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;second&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, m &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;minute&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, h &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;hour&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, d &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;day&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, w &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;week&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;year&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;. If suffix isn&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;t set, then the duration is counted in months (default 1)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-retentionTimezoneOffset duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The offset for performing indexdb rotation. If set to 0, then the indexdb rotation is performed at 4am UTC time per each -retentionPeriod. If set to 2h, then the indexdb rotation is performed at 4am EET time (the timezone with +2h offset)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.cacheTimestampOffset duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum duration since the current time for response data, which is always queried from the original raw data, without using the response cache. Increase this value if you see gaps in responses due to time synchronization issues between VictoriaMetrics and data sources. See also -search.disableAutoCacheReset (default 5m0s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.disableAutoCacheReset
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to disable automatic response cache reset if a sample with timestamp outside -search.cacheTimestampOffset is inserted into VictoriaMetrics
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.disableCache
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to disable response caching. This may be useful when ingesting historical data. See https://docs.victoriametrics.com/#backfilling . See also -search.resetRollupResultCacheOnStartup
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.disableImplicitConversion
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Whether to return an error for queries that rely on implicit subquery conversions, see https://docs.victoriametrics.com/metricsql/#subqueries for details. See also -search.logImplicitConversion
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.graphiteMaxPointsPerSeries int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum number of points per series Graphite render API can return (default 1000000)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.graphiteStorageStep duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The interval between datapoints stored in the database. It is used at Graphite Render API handler for normalizing the interval between datapoints in case it isn&amp;#39;&lt;/span&gt;t normalized. It can be overridden by sending &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;storage_step&amp;#39;&lt;/span&gt; query arg to /render API or by sending the desired interval via &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Storage-Step&amp;#39;&lt;/span&gt; http header during querying /render API &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 10s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.ignoreExtraFiltersAtLabelsAPI
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to ignore match&lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;, extra_filters&lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; and extra_label query args at /api/v1/labels and /api/v1/label/.../values . This may be useful &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; decreasing load on VictoriaMetrics when extra filters match too many time series. The downside is that superfluous labels or series could be returned, which &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt; not match the extra filters. See also -search.maxLabelsAPISeries and -search.maxLabelsAPIDuration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.latencyOffset duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The time when data points become visible in query results after the collection. It can be overridden on per-query basis via latency_offset arg. Too small value can result in incomplete last points &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; query results &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.logImplicitConversion
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to log queries with implicit subquery conversions, see https://docs.victoriametrics.com/metricsql/#subqueries &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details. Such conversion can be disabled using -search.disableImplicitConversion
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.logQueryMemoryUsage size
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Log query and increment vm_memory_intensive_queries_total metric each time the query requires more memory than specified by this flag. This may help detecting and optimizing heavy queries. Query logging is disabled by default. See also -search.logSlowQueryDuration and -search.maxMemoryPerQuery
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports the following optional suffixes &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 0&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.logSlowQueryDuration duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Log queries with execution time exceeding this value. Zero disables slow query logging. See also -search.logQueryMemoryUsage &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 5s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxConcurrentRequests int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of concurrent search requests. It shouldn&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;t be high, since a single request can saturate all the CPU cores, while many concurrently executed requests may require high amounts of memory. See also -search.maxQueueDuration and -search.maxMemoryPerQuery (default 16)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.maxExportDuration duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum duration for /api/v1/export call (default 720h0m0s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.maxExportSeries int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum number of time series, which can be returned from /api/v1/export* APIs. This option allows limiting memory usage (default 10000000)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.maxFederateSeries int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum number of time series, which can be returned from /federate. This option allows limiting memory usage (default 1000000)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.maxGraphiteSeries int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum number of time series, which can be scanned during queries to Graphite Render API. See https://docs.victoriametrics.com/#graphite-render-api-usage (default 300000)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.maxGraphiteTagKeys int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum number of tag keys returned from Graphite API, which returns tags. See https://docs.victoriametrics.com/#graphite-tags-api-usage (default 100000)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.maxGraphiteTagValues int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum number of tag values returned from Graphite API, which returns tag values. See https://docs.victoriametrics.com/#graphite-tags-api-usage (default 100000)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.maxLabelsAPIDuration duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum duration for /api/v1/labels, /api/v1/label/.../values and /api/v1/series requests. See also -search.maxLabelsAPISeries and -search.ignoreExtraFiltersAtLabelsAPI (default 5s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.maxLabelsAPISeries int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum number of time series, which could be scanned when searching for the matching time series at /api/v1/labels and /api/v1/label/.../values. This option allows limiting memory usage and CPU usage. See also -search.maxLabelsAPIDuration, -search.maxTagKeys, -search.maxTagValues and -search.ignoreExtraFiltersAtLabelsAPI (default 1000000)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.maxLookback duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Synonym to -search.lookback-delta from Prometheus. The value is dynamically detected from interval between time series datapoints if not set. It can be overridden on per-query basis via max_lookback arg. See also &amp;#39;&lt;/span&gt;-search.maxStalenessInterval&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; flag, which has the same meaning due to historical reasons
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.maxMemoryPerQuery size
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum amounts of memory a single query may consume. Queries requiring more memory are rejected. The total memory limit for concurrently executed queries can be estimated as -search.maxMemoryPerQuery multiplied by -search.maxConcurrentRequests . See also -search.logQueryMemoryUsage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Supports the following optional suffixes for size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB (default 0)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.maxPointsPerTimeseries int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The maximum points per a single timeseries returned from /api/v1/query_range. This option doesn&amp;#39;&lt;/span&gt;t limit the number of scanned raw samples in the database. The main purpose of this option is to limit the number of per-series points returned to graphing UI such as VMUI or Grafana. There is no sense in setting this limit to values bigger than the horizontal resolution of the graph. See also -search.maxResponseSeries &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxPointsSubqueryPerTimeseries int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of points per series, which can be generated by subquery. See https://valyala.medium.com/prometheus-subqueries-in-victoriametrics-9b1492b720b3 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 100000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxQueryDuration duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum duration &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; query execution. It can be overridden on a per-query basis via &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;timeout&amp;#39;&lt;/span&gt; query arg &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxQueryLen size
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum search query length in bytes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports the following optional suffixes &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 16384&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxQueueDuration duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum time the request waits &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; execution when -search.maxConcurrentRequests limit is reached; see also -search.maxQueryDuration &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 10s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxResponseSeries int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of time series which can be returned from /api/v1/query and /api/v1/query_range . The limit is disabled &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; it equals to 0. See also -search.maxPointsPerTimeseries and -search.maxUniqueTimeseries
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxSamplesPerQuery int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of raw samples a single query can process across all time series. This protects from heavy queries, which &lt;span style=&#34;color:#66d9ef&#34;&gt;select&lt;/span&gt; unexpectedly high number of raw samples. See also -search.maxSamplesPerSeries &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 1000000000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxSamplesPerSeries int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of raw samples a single query can scan per each time series. This option allows limiting memory usage &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30000000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxSeries int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of time series, which can be returned from /api/v1/series. This option allows limiting memory usage &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 30000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxSeriesPerAggrFunc int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of time series an aggregate MetricsQL &lt;span style=&#34;color:#66d9ef&#34;&gt;function&lt;/span&gt; can generate &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 1000000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxStalenessInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; staleness calculations. By default, it is automatically calculated from the median interval between samples. This flag could be useful &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; tuning Prometheus data model closer to Influx-style data model. See https://prometheus.io/docs/prometheus/latest/querying/basics/#staleness &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; details. See also &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-search.setLookbackToStep&amp;#39;&lt;/span&gt; flag
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxStatusRequestDuration duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum duration &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; /api/v1/status/* requests &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 5m0s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxStepForPointsAdjustment duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum step when /api/v1/query_range handler adjusts points with timestamps closer than -search.latencyOffset to the current time. The adjustment is needed because such points may contain incomplete data &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 1m0s&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxTSDBStatusSeries int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of time series, which can be processed during the call to /api/v1/status/tsdb. This option allows limiting memory usage &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 10000000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxTagKeys int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of tag keys returned from /api/v1/labels . See also -search.maxLabelsAPISeries and -search.maxLabelsAPIDuration &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 100000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxTagValueSuffixesPerSearch int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of tag value suffixes returned from /metrics/find &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 100000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxTagValues int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of tag values returned from /api/v1/label/&amp;lt;label_name&amp;gt;/values . See also -search.maxLabelsAPISeries and -search.maxLabelsAPIDuration &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 100000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxUniqueTimeseries int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of unique time series, which can be selected during /api/v1/query and /api/v1/query_range queries. This option allows limiting memory usage &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 300000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.maxWorkersPerQuery int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of CPU cores a single query can use. The default value should work good &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; most cases. The flag can be set to lower values &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; improving performance of big number of concurrently executed queries. The flag can be set to bigger values &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; improving performance of heavy queries, which scan big number of time series &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&amp;gt;10K&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; and/or big number of samples &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&amp;gt;100M&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;. There is no sense in setting this flag to values bigger than the number of CPU cores available on the system &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 16&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.minStalenessInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The minimum interval &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; staleness calculations. This flag could be useful &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; removing gaps on graphs generated from time series with irregular intervals between samples. See also &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-search.maxStalenessInterval&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.minWindowForInstantRollupOptimization value
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Enable cache-based optimization &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; repeated queries to /api/v1/query &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;aka instant queries&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, which contain rollup functions with lookbehind window exceeding the given value
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The following optional suffixes are supported: s &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;second&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, m &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;minute&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, h &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;hour&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, d &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;day&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, w &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;week&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, y &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;year&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;. If suffix isn&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;t set, then the duration is counted in months (default 3h)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-search.noStaleMarkers
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Set this flag to true if the database doesn&amp;#39;&lt;/span&gt;t contain Prometheus stale markers, so there is no need in spending additional CPU time on its handling. Staleness markers may exist only in data obtained from Prometheus scrape targets
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.queryStats.lastQueriesCount int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Query stats &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; /api/v1/status/top_queries is tracked on this number of last queries. Zero value disables query stats tracking &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 20000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.queryStats.minQueryDuration duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The minimum duration &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; queries to track in query stats at /api/v1/status/top_queries. Queries with lower duration are ignored in query stats &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 1ms&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.resetCacheAuthKey value
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Optional authKey &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; resetting rollup cache via /internal/resetRollupResultCache call
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Flag value can be read from the given file when using -search.resetCacheAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file:///abs/path/to/file or -search.resetCacheAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;file://./relative/path/to/file . Flag value can be read from the given http/https url when using -search.resetCacheAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;http://host/path or -search.resetCacheAuthKey&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;https://host/path
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.resetRollupResultCacheOnStartup
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to reset rollup result cache on startup. See https://docs.victoriametrics.com/#rollup-result-cache . See also -search.disableCache
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.setLookbackToStep
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to fix lookback interval to &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;step&amp;#39;&lt;/span&gt; query arg value. If set to true, the query model becomes closer to InfluxDB data model. If set to true, &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt; -search.maxLookback and -search.maxStalenessInterval are ignored
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-search.treatDotsAsIsInRegexps
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to treat dots as is in regexp label filters used in queries. For example, foo&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;bar&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;~&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;a.b.c&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; will be automatically converted to foo&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;bar&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;~&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;a\\.b\\.c&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;, i.e. all the dots in regexp filters will be automatically escaped in order to match only dot char instead of matching any char. Dots in &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;.+&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;.*&amp;#34;&lt;/span&gt; and &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;.{n}&amp;#34;&lt;/span&gt; regexps aren&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;t escaped. This option is DEPRECATED in favor of {__graphite__=&amp;#34;a.*.c&amp;#34;} syntax for selecting metrics matching the given Graphite metrics filter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-selfScrapeInstance string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Value for &amp;#39;&lt;/span&gt;instance&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; label, which is added to self-scraped metrics (default &amp;#34;self&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-selfScrapeInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Interval for self-scraping own metrics at /metrics page
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-selfScrapeJob string
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Value for &amp;#39;&lt;/span&gt;job&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; label, which is added to self-scraped metrics (default &amp;#34;victoria-metrics&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-smallMergeConcurrency int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Deprecated: this flag does nothing
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-snapshotAuthKey value
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   authKey, which must be passed in query string to /snapshot* pages
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Flag value can be read from the given file when using -snapshotAuthKey=file:///abs/path/to/file or -snapshotAuthKey=file://./relative/path/to/file . Flag value can be read from the given http/https url when using -snapshotAuthKey=http://host/path or -snapshotAuthKey=https://host/path
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-snapshotCreateTimeout duration
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Deprecated: this flag does nothing
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-snapshotsMaxAge value
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Automatically delete snapshots older than -snapshotsMaxAge if it is set to non-zero duration. Make sure that backup process has enough time to finish the backup before the corresponding snapshot is automatically deleted
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   The following optional suffixes are supported: s (second), m (minute), h (hour), d (day), w (week), y (year). If suffix isn&amp;#39;&lt;/span&gt;t set, &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt; the duration is counted in months &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 0&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-sortLabels
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to sort labels &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; incoming samples before writing them to storage. This may be needed &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; reducing memory usage at storage when the order of labels in incoming samples is random. For example, &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; m&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;k1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;v1&amp;#34;&lt;/span&gt;,k2&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;v2&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; may be sent as m&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;k2&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;v2&amp;#34;&lt;/span&gt;,k1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;v1&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;. Enabled sorting &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; labels can slow down ingestion performance a bit
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-storage.cacheSizeIndexDBDataBlocks size
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Overrides max size &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; indexdb/dataBlocks cache. See https://docs.victoriametrics.com/single-server-victoriametrics/#cache-tuning
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports the following optional suffixes &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 0&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-storage.cacheSizeIndexDBIndexBlocks size
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Overrides max size &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; indexdb/indexBlocks cache. See https://docs.victoriametrics.com/single-server-victoriametrics/#cache-tuning
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports the following optional suffixes &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 0&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-storage.cacheSizeIndexDBTagFilters size
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Overrides max size &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; indexdb/tagFiltersToMetricIDs cache. See https://docs.victoriametrics.com/single-server-victoriametrics/#cache-tuning
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports the following optional suffixes &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 0&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-storage.cacheSizeStorageTSID size
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Overrides max size &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; storage/tsid cache. See https://docs.victoriametrics.com/single-server-victoriametrics/#cache-tuning
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports the following optional suffixes &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 0&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-storage.maxDailySeries int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of unique series can be added to the storage during the last &lt;span style=&#34;color:#ae81ff&#34;&gt;24&lt;/span&gt; hours. Excess series are logged and dropped. This can be useful &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; limiting series churn rate. See https://docs.victoriametrics.com/#cardinality-limiter . See also -storage.maxHourlySeries
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-storage.maxHourlySeries int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The maximum number of unique series can be added to the storage during the last hour. Excess series are logged and dropped. This can be useful &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; limiting series cardinality. See https://docs.victoriametrics.com/#cardinality-limiter . See also -storage.maxDailySeries
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-storage.minFreeDiskSpaceBytes size
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The minimum free disk space at -storageDataPath after which the storage stops accepting new data
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports the following optional suffixes &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; size values: KB, MB, GB, TB, KiB, MiB, GiB, TiB &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default 10000000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-storageDataPath string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Path to storage data &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;default &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;victoria-metrics-data&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-streamAggr.config string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Optional path to file with stream aggregation config. See https://docs.victoriametrics.com/stream-aggregation/ . See also -streamAggr.keepInput, -streamAggr.dropInput and -streamAggr.dedupInterval
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-streamAggr.dedupInterval duration
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Input samples are de-duplicated with this interval before optional aggregation with -streamAggr.config . See also -streamAggr.dropInputLabels and -dedup.minScrapeInterval and https://docs.victoriametrics.com/stream-aggregation/#deduplication
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-streamAggr.dropInput
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to drop all the input samples after the aggregation with -streamAggr.config. By default, only aggregated samples are dropped, &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; the remaining samples are stored in the database. See also -streamAggr.keepInput and https://docs.victoriametrics.com/stream-aggregation/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-streamAggr.dropInputLabels array
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   An optional list of labels to drop from samples before stream de-duplication and aggregation . See https://docs.victoriametrics.com/stream-aggregation/#dropping-unneeded-labels
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Value can contain comma inside single-quoted or double-quoted string, &lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; and &lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; braces.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-streamAggr.ignoreFirstIntervals int
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Number of aggregation intervals to skip after the start. Increase this value &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; you observe incorrect aggregation results after restarts. It could be caused by receiving unordered delayed data from clients pushing data into the database. See https://docs.victoriametrics.com/stream-aggregation/#ignore-aggregation-intervals-on-start
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-streamAggr.ignoreOldSamples
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to ignore input samples with old timestamps outside the current aggregation interval. See https://docs.victoriametrics.com/stream-aggregation/#ignoring-old-samples
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-streamAggr.keepInput
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to keep all the input samples after the aggregation with -streamAggr.config. By default, only aggregated samples are dropped, &lt;span style=&#34;color:#66d9ef&#34;&gt;while&lt;/span&gt; the remaining samples are stored in the database. See also -streamAggr.dropInput and https://docs.victoriametrics.com/stream-aggregation/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-tls array
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to enable TLS &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; incoming HTTP requests at the given -httpListenAddr &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;aka https&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;. -tlsCertFile and -tlsKeyFile must be set &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; -tls is set. See also -mtls
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Empty values are set to false.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-tlsAutocertCacheDir string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Directory to store TLS certificates issued via Let&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s Encrypt. Certificates are lost on restarts if this flag isn&amp;#39;&lt;/span&gt;t set. This flag is available only in Enterprise binaries. See https://docs.victoriametrics.com/enterprise/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-tlsAutocertEmail string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Contact email &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; the issued Let&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s Encrypt TLS certificates. See also -tlsAutocertHosts and -tlsAutocertCacheDir .This flag is available only in Enterprise binaries. See https://docs.victoriametrics.com/enterprise/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-tlsAutocertHosts array
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;   Optional hostnames for automatic issuing of Let&amp;#39;&lt;/span&gt;s Encrypt TLS certificates. These hostnames must be reachable at -httpListenAddr . The -httpListenAddr must listen tcp port &lt;span style=&#34;color:#ae81ff&#34;&gt;443&lt;/span&gt; . The -tlsAutocertHosts overrides -tlsCertFile and -tlsKeyFile . See also -tlsAutocertEmail and -tlsAutocertCacheDir . This flag is available only in Enterprise binaries. See https://docs.victoriametrics.com/enterprise/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Value can contain comma inside single-quoted or double-quoted string, &lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; and &lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; braces.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-tlsCertFile array
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Path to file with TLS certificate &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; the corresponding -httpListenAddr &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; -tls is set. Prefer ECDSA certs instead of RSA certs as RSA certs are slower. The provided certificate file is automatically re-read every second, so it can be dynamically updated. See also -tlsAutocertHosts
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Value can contain comma inside single-quoted or double-quoted string, &lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; and &lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; braces.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-tlsCipherSuites array
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Optional list of TLS cipher suites &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; incoming requests over HTTPS &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; -tls is set. See the list of supported cipher suites at https://pkg.go.dev/crypto/tls#pkg-constants
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Value can contain comma inside single-quoted or double-quoted string, &lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; and &lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; braces.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-tlsKeyFile array
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Path to file with TLS key &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; the corresponding -httpListenAddr &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; -tls is set. The provided key file is automatically re-read every second, so it can be dynamically updated. See also -tlsAutocertHosts
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Value can contain comma inside single-quoted or double-quoted string, &lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; and &lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; braces.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-tlsMinVersion array
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Optional minimum TLS version to use &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; the corresponding -httpListenAddr &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; -tls is set. Supported values: TLS10, TLS11, TLS12, TLS13
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Supports an array of values separated by comma or specified via multiple flags.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Value can contain comma inside single-quoted or double-quoted string, &lt;span style=&#34;color:#f92672&#34;&gt;{}&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; and &lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; braces.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-usePromCompatibleNaming
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Whether to replace characters unsupported by Prometheus with underscores in the ingested metric names and label names. For example, foo.bar&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;a.b&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; is transformed into foo_bar&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;a_b&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;c&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt; during data ingestion &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; this flag is set. See https://prometheus.io/docs/concepts/data_model/#metric-names-and-labels
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-version
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Show VictoriaMetrics version
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-vmalert.proxyURL string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Optional URL &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; proxying requests to vmalert. For example, &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; -vmalert.proxyURL&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;http://vmalert:8880 , &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt; alerting API requests such as /api/v1/rules from Grafana will be proxied to http://vmalert:8880/api/v1/rules
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-vmui.customDashboardsPath string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   Optional path to vmui dashboards. See https://github.com/VictoriaMetrics/VictoriaMetrics/tree/master/app/vmui/packages/vmui/public/dashboards
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-vmui.defaultTimezone string
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   The default timezone to be used in vmui. Timezone must be a valid IANA Time Zone. For example: America/New_York, Europe/Berlin, Etc/GMT+3 or Local&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;

      </description>
    </item>
    
    <item>
      <title>如何处理机器故障</title>
      <link>http://localhost:1313/docs/ops/node-crash/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/ops/node-crash/</guid>
      <description>
        
        
        
      </description>
    </item>
    
    <item>
      <title>对比PromQL</title>
      <link>http://localhost:1313/docs/query/metricsql/promql-diff/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/query/metricsql/promql-diff/</guid>
      <description>
        
        
        &lt;p&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MetricsQL&lt;/a&gt; is a query language inspired by &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/basics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PromQL&lt;/a&gt;. It is used as a primary query language in &lt;a href=&#34;https://github.com/victoriaMetrics/victoriaMetrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics&lt;/a&gt;, time series database and monitoring solution. MetricsQL claims to be backward-compatible with PromQL, so Grafana dashboards backed by a Prometheus datasource should work the same after switching from Prometheus to VictoriaMetrics.&lt;/p&gt;
&lt;p&gt;However, VictoriaMetrics is not 100% compatible with PromQL and never will be. Please read on and we will discuss why that is.&lt;/p&gt;
&lt;p&gt;For a long time, there was no way to measure compatibility with PromQL. There was not even a fully defined &lt;a href=&#34;https://promlabs.com/blog/2020/08/06/comparing-promql-correctness-across-vendors#what-is-correct-in-the-absence-of-a-specification&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PromQL specification&lt;/a&gt;. But, some time ago, the &lt;a href=&#34;https://prometheus.io/blog/2021/05/03/introducing-prometheus-conformance-program/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus Conformance Program&lt;/a&gt; was announced with the aim to certify software with a mark of compatibility with Prometheus — “Upon reaching 100%, the mark will be granted&amp;quot;. The open-source tool, &lt;a href=&#34;https://github.com/prometheus/compliance&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prometheus/compliance&lt;/a&gt; was created to check for compatibility.&lt;/p&gt;
&lt;p&gt;Compatibility is measured in quite a simple way— the tool requires a configuration file with a &lt;a href=&#34;https://github.com/prometheus/compliance/blob/6d63e44ca06d317c879b7406ec24b01a82213aa0/promql/promql-compliance-tester.yml#L107&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;list of PromQL queries to run&lt;/a&gt;, a Prometheus server to use as a reference and any other software meant to be tested. The tool sends PromQL queries to both Prometheus and the tested software, and if their responses don&amp;rsquo;t match — it marks the query as having failed.&lt;/p&gt;
&lt;h1&gt;兼容性测试&lt;/h1&gt;&lt;p&gt;We ran compatibility testing between Prometheus &lt;a href=&#34;https://github.com/prometheus/prometheus/releases/tag/v2.30.0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;v2.30.0&lt;/a&gt; and VictoriaMetrics &lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/releases/tag/v1.67.0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;v1.67.0&lt;/a&gt; and got the following result:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;====================================================================
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;General query tweaks:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;*  VictoriaMetrics aligns incoming query timestamps to a multiple of the query resolution step.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;====================================================================
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Total: 385 / 529 (72.78%) passed, 0 unsupported&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;According to the test, VictoriaMetrics failed 149 tests and was compatible with Prometheus by 72.59% of the time. Let’s take a closer look at the queries that failed.&lt;/p&gt;
&lt;h1&gt;Keeping metric name&lt;/h1&gt;&lt;p&gt;According to PromQL, functions that transform a metric&amp;rsquo;s data should &lt;a href=&#34;https://github.com/prometheus/prometheus/issues/380&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;drop the metric name from the result&lt;/a&gt;, since the meaning of the initial metric has changed. However, this approach has some drawbacks. For example, the &lt;code&gt;max_over_time&lt;/code&gt; function calculates the max value of the series without changing its physical meaning. Therefore, MetricsQL &lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/issues/674&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keeps the metric name for such functions&lt;/a&gt;. It also enables queries over multiple metric names: &lt;code&gt;max_over_time({__name__=~&amp;quot;process_(resident|virtual)_memory_bytes&amp;quot;}[1h])&lt;/code&gt;. While in PromQL such query fails with &lt;code&gt;vector cannot contain metrics with the same labelset&lt;/code&gt; error.&lt;/p&gt;
&lt;p&gt;Hence, test suit functions like &lt;code&gt;*_over_time&lt;/code&gt;, &lt;code&gt;ceil&lt;/code&gt; , &lt;code&gt;floor&lt;/code&gt; , &lt;code&gt;round&lt;/code&gt; , &lt;code&gt;clamp_*&lt;/code&gt; , &lt;code&gt;holt_winters&lt;/code&gt; , &lt;code&gt;predict_linear&lt;/code&gt; in VictoriaMetrics do intentionally contain the metric name in the results:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;QUERY: avg_over_time(demo_memory_usage_bytes[1s])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-      Metric: s`{instance=&amp;#34;demo.promlabs.com:10002&amp;#34;, job=&amp;#34;demo&amp;#34;, type=&amp;#34;buffers&amp;#34;}`,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+     Metric: s`demo_memory_usage_bytes{instance=&amp;#34;demo.promlabs.com:10002&amp;#34;, job=&amp;#34;demo&amp;#34;, type=&amp;#34;buffers&amp;#34;}`,&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;There were 92 (~17% of 529 tests total) such queries in the test suite which failed because the metric name is present in the response from VictoriaMetrics, while the values in the response are identical. VictoriaMetrics isn&amp;rsquo;t going to change this behavior as their users find this is more logical and &lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/issues/1384&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rely on it&lt;/a&gt;.&lt;/p&gt;
&lt;h1&gt;Better rate()&lt;/h1&gt;&lt;p&gt;凡是涉及对回溯窗口样本值首尾样本值进行计算的 rollup 函数，比如 &lt;code&gt;rate&lt;/code&gt;、&lt;code&gt;delta&lt;/code&gt;、&lt;code&gt;increase&lt;/code&gt; 等函数；其MetricsQL 和 PromQL 都存在统一的计算差异。因此 VictoriaMetrics 使用 &lt;code&gt;xxx_prometheus&lt;/code&gt; 的命名提供了兼容 Prometheus 统计方式的 rollup 函数，如 &lt;code&gt;rate_prometheus&lt;/code&gt;、&lt;code&gt;delta_prometheus&lt;/code&gt;、&lt;code&gt;increase_prometheus&lt;/code&gt; 等。而默认则使用 MetricsQL 的统计方式。&lt;/p&gt;
&lt;p&gt;以 increase 函数为例，MetricsQL 的计算方式更加精准，如下图所示。&lt;/p&gt;
&lt;p&gt;假设我们有5个样本值，当回溯窗口大小是&lt;code&gt;$__interval&lt;/code&gt; 时，我们期望得到的就是&lt;code&gt;V3-V1&lt;/code&gt;和&lt;code&gt;V5-V3&lt;/code&gt;两个值。即当前回溯窗口的最后一个样本值应该与前一个回溯窗口的最后一个样本值计算，而不是和本窗口的第一个样本值计算。&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../promql-diff-demo-1.png&#34; alt=&#34;MetricsQL&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;再看 Prometheus 的计算方式，如下图所示。它使用一个回溯窗口的最后一个样本值，与该窗口的第一个值进行计算。因为 V1 样本不在第一个窗口内，V3 不再第二个窗口内，这就导致 Prometheus 计算出来的值是&lt;code&gt;V3-V2&lt;/code&gt;和&lt;code&gt;V5-V4&lt;/code&gt;，结果并不正确。&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../promql-diff-demo-2.png&#34; alt=&#34;PromQL&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;此外，Prometheus 的这种统计方式还有另外一个问题。就是如果&lt;code&gt;$_interval&lt;/code&gt;大小的时间窗口内只有一个样本值，那么&lt;code&gt;rate&lt;/code&gt;和&lt;code&gt;increase&lt;/code&gt;这种汇总函数的结果为空。&lt;/p&gt;
&lt;p&gt;MetricsQL doesn&amp;rsquo;t apply extrapolation when calculating &lt;code&gt;rate&lt;/code&gt; and &lt;code&gt;increase&lt;/code&gt;. This solves the issue of fractional &lt;code&gt;increase()&lt;/code&gt; results over integer counters:&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../promql-diff-demo-3.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;increase() query over time series generated by integer counter results in decimal values for Prometheus due to extrapolation.&lt;/p&gt;
&lt;p&gt;It is &lt;a href=&#34;https://www.robustperception.io/what-range-should-i-use-with-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;quite important&lt;/a&gt; to choose the correct lookbehind window for &lt;code&gt;rate&lt;/code&gt; and &lt;code&gt;increase&lt;/code&gt; in Prometheus. Otherwise, incorrect or no data may be returned. &lt;a href=&#34;https://grafana.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Grafana&lt;/a&gt; even introduced a special variable &lt;a href=&#34;https://grafana.com/blog/2020/09/28/new-in-grafana-7.2-__rate_interval-for-prometheus-rate-queries-that-just-work/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;$__rate_interval&lt;/a&gt; to address this issue, but it may cause more problems than it solves:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Users need to configure the scrape interval value in datasource settings to get it to work;&lt;/li&gt;
&lt;li&gt;Users still need to add &lt;code&gt;$__rate_interval&lt;/code&gt; manually to every query that uses &lt;code&gt;rate&lt;/code&gt;;&lt;/li&gt;
&lt;li&gt;It won&amp;rsquo;t work if the datasource stores metrics with different scrape intervals (e.g. global view across multiple datasources);&lt;/li&gt;
&lt;li&gt;It only works in Grafana.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In MetricsQL, a lookbehind window in square brackets may be omitted. VictoriaMetrics automatically selects the lookbehind window depending on the current step, so &lt;code&gt;rate(node_network_receive_bytes_total)&lt;/code&gt; works just as &lt;code&gt;rate(node_network_receive_bytes_total[$__interval])&lt;/code&gt;. And even if the interval is too small to capture enough data points, MetricsQL will automatically expand it. That&amp;rsquo;s why queries like &lt;code&gt;deriv(demo_disk_usage_bytes[1s])&lt;/code&gt; return no data for Prometheus and VictoriaMetrics expands the lookbehind window prior to making calculations.&lt;/p&gt;
&lt;p&gt;There are 39 (~7% of 529 tests total) queries (rate, increase, deriv, changes, irate, idelta, resets, etc.) exercising this logic which cause the difference in results between VictoriaMetrics and Prometheus:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;QUERY: rate(demo_cpu_usage_seconds_total[5m])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-           Value:     Inverse(TranslateFloat64, float64(1.9953032056421414)),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+           Value:     Inverse(TranslateFloat64, float64(1.993400981075324)),&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;For more details about how rate/increase works in MetricsQL please check &lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;docs&lt;/a&gt; and &lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/issues/1215#issuecomment-850305711&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;example on github&lt;/a&gt;.&lt;/p&gt;
&lt;h1&gt;NaNs&lt;/h1&gt;&lt;p&gt;NaNs are unexpectedly complicated. Let&amp;rsquo;s begin with the fact that in &lt;a href=&#34;https://www.robustperception.io/get-thee-to-a-nannary&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus there are two types of NaNs&lt;/a&gt;: &lt;a href=&#34;https://github.com/prometheus/prometheus/blob/19152a45d8a8f841206d321f79a60ab6d365a98f/pkg/value/value.go#L22&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;normal NaN&lt;/a&gt; and &lt;a href=&#34;https://github.com/prometheus/prometheus/blob/19152a45d8a8f841206d321f79a60ab6d365a98f/pkg/value/value.go#L28&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;stale NaN&lt;/a&gt;. Stale NaNs are used as &amp;ldquo;staleness makers&amp;rdquo; — special values used to identify a time series that had become stale. VictoriaMetrics didn&amp;rsquo;t initially support this because VictoriaMetrics needed to integrate with many systems beyond just Prometheus and had to have a way to detect staleness uniformly for series ingested via Graphite, Influx, OpenTSDB and other supported data ingestion protocols. Support of Prometheus staleness markers was &lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/issues/1526&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;recently added&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Normal NaNs are results of mathematical operations, e.g. &lt;code&gt;0/0=NaN&lt;/code&gt;. However, in OpenMetrics there is &lt;a href=&#34;https://github.com/OpenObservability/OpenMetrics/blob/main/specification/OpenMetrics.md#nan&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;no special meaning or use case for NaNs&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;While NaNs are expected when evaluating mathematical expressions, it is not clear how useful they are for users, or if there are any benefits to return NaNs in the result. It looks like the opposite is true because users are &lt;a href=&#34;https://stackoverflow.com/questions/53430836/prometheus-sum-one-nan-value-result-into-nan-how-to-avoid-it&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;often&lt;/a&gt;&lt;a href=&#34;https://github.com/prometheus/prometheus/issues/7637&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;confused&lt;/a&gt;&lt;a href=&#34;https://github.com/prometheus/prometheus/issues/6780&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;with&lt;/a&gt; the &lt;a href=&#34;https://github.com/prometheus/prometheus/issues/6645&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;received&lt;/a&gt;&lt;a href=&#34;https://stackoverflow.com/questions/47056557/how-to-gracefully-avoid-divide-by-zero-in-prometheus&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;results&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;MetricsQL consistently deletes NaN from query responses. This behavior is intentional because there is no meaningful way to use such results. That&amp;rsquo;s why testing queries such as &lt;code&gt;demo_num_cpus * NaN&lt;/code&gt; or &lt;code&gt;sqrt(-demo_num_cpus)&lt;/code&gt; return an empty response in MetricsQL, and returns NaNs in PromQL.&lt;/p&gt;
&lt;p&gt;There were 6 (~1% of 529 tests total) queries in thetest suite expecting NaNs in responses: &lt;code&gt;sqrt(-metric)&lt;/code&gt; , &lt;code&gt;ln(-metric)&lt;/code&gt; , &lt;code&gt;log2(-metric)&lt;/code&gt; , &lt;code&gt;log10(-metric)&lt;/code&gt; and &lt;code&gt;metric * NaN&lt;/code&gt; .&lt;/p&gt;
&lt;h1&gt;Negative offsets&lt;/h1&gt;&lt;p&gt;VictoriaMetrics supports negative offsets and Prometheus also does as well starting with version &lt;a href=&#34;https://github.com/prometheus/prometheus/releases/tag/v2.26.0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2.26&lt;/a&gt; if a specific feature flag is enabled. However, query results are different even with the enabled feature flag due to the fact that Prometheus continues the last value of the metric during the additional 5min:&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../promql-diff-demo-4.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;VictoriaMetrics vs Prometheus negative offset query. VictoriaMetrics response value is shifted by 1e7 to show the difference between the lines visually. Without this shift, they are identical except the last 5min.&lt;/p&gt;
&lt;p&gt;Such behavior was unexpected to us. To get more details about it please check the following discussion:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/prometheus/prometheus/discussions/9428&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Series with negative offset are continued with the last value up to 5min · Discussion #9428 ·…You can&amp;rsquo;t perform that action at this time. You signed in with another tab or window. You signed out in another tab or…github.com&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;VictoriaMetrics isn&amp;rsquo;t going to change the logic of negative offsets because this feature was released &lt;a href=&#34;https://github.com/prometheus/prometheus/issues/6282#issuecomment-564301756&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;2 years before&lt;/a&gt; Prometheus did it and users rely on that.&lt;/p&gt;
&lt;p&gt;There were 3 (~0.5% of 529 tests total) queries for -1m, -5m, -10m offsets in the test suite:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;QUERY: demo_memory_usage_bytes offset -1m
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RESULT: FAILED: Query succeeded, but should have failed.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h1&gt;Precision loss&lt;/h1&gt;&lt;p&gt;VictoriaMetrics fails the following test case:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;QUERY: demo_memory_usage_bytes % 1.2345
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Timestamp: s&amp;#34;1633073960&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;- Value: Inverse(TranslateFloat64, float64(0.038788650870683394)),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;+ Value: Inverse(TranslateFloat64, float64(0.038790081382158004)),&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;The result is indeed different. It is off on the 5th digit after the decimal point and the reason for this is not in MetricsQL but in VictoriaMetrics itself. The query result isn&amp;rsquo;t correct because the raw data point value for this specific metric doesn&amp;rsquo;t match between Prometheus and VictoriaMetrics:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl  --data-urlencode &amp;#39;query=demo_memory_usage_bytes{instance=&amp;#34;demo.promlabs.com:10000&amp;#34;, type=&amp;#34;buffers&amp;#34;}&amp;#39; --data-urlencode &amp;#39;time=1633504838&amp;#39; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...&amp;#34;value&amp;#34;:[1633504838,&amp;#34;148164507.40843752&amp;#34;]}]}}%                                                                                  curl  --data-urlencode &amp;#39;query=demo_memory_usage_bytes{instance=&amp;#34;demo.promlabs.com:10000&amp;#34;, type=&amp;#34;buffers&amp;#34;}&amp;#39; --data-urlencode &amp;#39;time=1633504838&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;...&amp;#34;value&amp;#34;:[1633504838,&amp;#34;148164507.4084375&amp;#34;]}]}}%&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;VictoriaMetrics may reduce the precision of values with more than 15 decimal digits due to the &lt;a href=&#34;https://faun.pub/victoriametrics-achieving-better-compression-for-time-series-data-than-gorilla-317bc1f95932&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;used compression algorithm&lt;/a&gt;. If you want to get more details about how and why this happens, please read the &amp;ldquo;Precision loss&amp;rdquo; section in &lt;a href=&#34;https://medium.com/@valyala/evaluating-performance-and-correctness-victoriametrics-response-e27315627e87&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Evaluating Performance and Correctness&lt;/a&gt;. In fact, any solution that works with floating point values has precision loss issues because of the nature of &lt;a href=&#34;https://en.wikipedia.org/wiki/Floating-point_arithmetic&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;floating-point arithmetic&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;While such precision loss may be important in rare cases, it doesn&amp;rsquo;t matter in most practical cases because the &lt;a href=&#34;https://en.wikipedia.org/wiki/Observational_error&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;measurement error&lt;/a&gt; is usually much larger than the precision loss.&lt;/p&gt;
&lt;p&gt;While VictoriaMetrics does have higher precision loss than Prometheus, we believe it is completely justified by the &lt;a href=&#34;https://valyala.medium.com/prometheus-vs-victoriametrics-benchmark-on-node-exporter-metrics-4ca29c75590f&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;compression gains&lt;/a&gt; our solution generates. Moreover, only 3 (~0.5% of 529 tests total) queries from the test suite fail due to precision loss.&lt;/p&gt;
&lt;h1&gt;Query succeeded, but should have failed&lt;/h1&gt;&lt;p&gt;The following query fails for PromQL but works in MetricsQL:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;QUERY: {__name__=~&amp;#34;.*&amp;#34;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RESULT: FAILED: Query succeeded, but should have failed.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;PromQL rejects such a query to prevent database overload because query &lt;a href=&#34;https://github.com/prometheus/prometheus/issues/2162&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;selects all the metrics&lt;/a&gt; from it. At the same time, PromQL does not prevent a user from running an almost identical query&lt;code&gt;{__name__=~&amp;quot;.+&amp;quot;}&lt;/code&gt; , which serves the same purpose.&lt;/p&gt;
&lt;p&gt;The other example of a failing query is the following:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;QUERY: label_replace(demo_num_cpus, &amp;#34;~invalid&amp;#34;, &amp;#34;&amp;#34;, &amp;#34;src&amp;#34;, &amp;#34;(.*)&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;RESULT: FAILED: Query succeeded, but should have failed.&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;The query fails for PromQL because it doesn&amp;rsquo;t allow using &lt;code&gt;~&lt;/code&gt; char in label names. VictoriaMetrics accepts data ingestion from various protocols and systems where such char is allowed, so it &lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/issues/672#issuecomment-670189308&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;has to support&lt;/a&gt; a wider list of allowed chars.&lt;/p&gt;
&lt;p&gt;There were 2 (~0.3% of 529 tests total) queries that failed because of incompatibility but we can’t imagine a situation where it would harm a user’s experience.&lt;/p&gt;
&lt;h1&gt;Summary&lt;/h1&gt;&lt;p&gt;There are differences between MetricsQL and PromQL. MetricsQL was created long after the PromQL with the goal of improving the user experience and making the language easier to use and understand.&lt;/p&gt;
&lt;p&gt;How compatibility is measured in the &lt;a href=&#34;https://prometheus.io/blog/2021/05/03/introducing-prometheus-conformance-program/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus Conformance Program&lt;/a&gt; isn&amp;rsquo;t ideal because it really only shows if the tested software uses Prometheus PromQL library under the hood or not. This is particularly complicated for solutions written in programming languages other than Go.&lt;/p&gt;
&lt;p&gt;By the way, the percentage of failing tests is easy to increase or decrease by changing the number of range intervals (e.g. 1m, 5m etc.) in tests. In the case of VictoriaMetrics, about 90 tests have failed not because of wrong calculations, but because of the metric name present in the response. Of course, there is no ideal way to be fair to everyone. That&amp;rsquo;s why this post exists to explain the differences.&lt;/p&gt;
&lt;p&gt;We also want to say a big thank you to &lt;a href=&#34;https://github.com/juliusv&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Julius Volz&lt;/a&gt;, the author of these &lt;a href=&#34;https://promlabs.com/promql-compliance-tests/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;compliance tests&lt;/a&gt;. Thanks to his work and patience we were able to fix most of the real incompatibility issues in MetricsQL.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>聚合统计</title>
      <link>http://localhost:1313/docs/query/metricsql/functions/aggregation/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/query/metricsql/functions/aggregation/</guid>
      <description>
        
        
        &lt;p&gt;&lt;strong&gt;Aggregate functions&lt;/strong&gt; calculate aggregates over groups of &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup results&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Additional details:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;By default, a single group is used for aggregation. Multiple independent groups can be set up by specifying grouping labels in &lt;code&gt;by&lt;/code&gt; and &lt;code&gt;without&lt;/code&gt; modifiers. For example, &lt;code&gt;count(up) by (job)&lt;/code&gt; would group &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup results&lt;/a&gt; by &lt;code&gt;job&lt;/code&gt; label value and calculate the &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#count&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count&lt;/a&gt; aggregate function independently per each group, while &lt;code&gt;count(up) without (instance)&lt;/code&gt; would group &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup results&lt;/a&gt; by all the labels except &lt;code&gt;instance&lt;/code&gt; before calculating &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#count&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count&lt;/a&gt; aggregate function independently per each group. Multiple labels can be put in &lt;code&gt;by&lt;/code&gt; and &lt;code&gt;without&lt;/code&gt; modifiers.&lt;/li&gt;
&lt;li&gt;If the aggregate function is applied directly to a &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series_selector&lt;/a&gt;, then the &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#default_rollup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;default_rollup()&lt;/a&gt; function is automatically applied before calculating the aggregate. For example, &lt;code&gt;count(up)&lt;/code&gt; is implicitly transformed to &lt;code&gt;count(default_rollup(up))&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Aggregate functions accept arbitrary number of args. For example, &lt;code&gt;avg(q1, q2, q3)&lt;/code&gt; would return the average values for every point across time series returned by &lt;code&gt;q1&lt;/code&gt;, &lt;code&gt;q2&lt;/code&gt; and &lt;code&gt;q3&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Aggregate functions support optional &lt;code&gt;limit N&lt;/code&gt; suffix, which can be used for limiting the number of output groups. For example, &lt;code&gt;sum(x) by (y) limit 3&lt;/code&gt; limits the number of groups for the aggregation to 3. All the other groups are ignored.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#implicit-query-conversions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;implicit query conversions&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The list of supported aggregate functions:&lt;/p&gt;
&lt;h4&gt;any &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#any&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;any-httpsdocsvictoriametricscommetricsqlany&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#any-httpsdocsvictoriametricscommetricsqlany&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;any(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns a single series per &lt;code&gt;group_labels&lt;/code&gt; out of time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#group&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;group&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;avg &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#avg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;avg-httpsdocsvictoriametricscommetricsqlavg&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#avg-httpsdocsvictoriametricscommetricsqlavg&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;avg(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns the average value per &lt;code&gt;group_labels&lt;/code&gt; for time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;bottomk &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;bottomk-httpsdocsvictoriametricscommetricsqlbottomk&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#bottomk-httpsdocsvictoriametricscommetricsqlbottomk&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;bottomk(k, q)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; points with the smallest values across all the time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;topk&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk_min&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bottomk_min&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk_last&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#bottomk_last&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;bottomk_avg &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk_avg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;bottomk_avg-httpsdocsvictoriametricscommetricsqlbottomk_avg&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#bottomk_avg-httpsdocsvictoriametricscommetricsqlbottomk_avg&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;bottomk_avg(k, q, &amp;quot;other_label=other_value&amp;quot;)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; time series from &lt;code&gt;q&lt;/code&gt; with the smallest averages. If an optional &lt;code&gt;other_label=other_value&lt;/code&gt; arg is set, then the sum of the remaining time series is returned with the given label. For example, &lt;code&gt;bottomk_avg(3, sum(process_resident_memory_bytes) by (job), &amp;quot;job=other&amp;quot;)&lt;/code&gt; would return up to 3 time series with the smallest averages plus a time series with &lt;code&gt;{job=&amp;quot;other&amp;quot;}&lt;/code&gt; label with the sum of the remaining series if any.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk_avg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;topk_avg&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;bottomk_last &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk_last&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;bottomk_last-httpsdocsvictoriametricscommetricsqlbottomk_last&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#bottomk_last-httpsdocsvictoriametricscommetricsqlbottomk_last&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;bottomk_last(k, q, &amp;quot;other_label=other_value&amp;quot;)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; time series from &lt;code&gt;q&lt;/code&gt; with the smallest last values. If an optional &lt;code&gt;other_label=other_value&lt;/code&gt; arg is set, then the sum of the remaining time series is returned with the given label. For example, &lt;code&gt;bottomk_max(3, sum(process_resident_memory_bytes) by (job), &amp;quot;job=other&amp;quot;)&lt;/code&gt; would return up to 3 time series with the smallest maximums plus a time series with &lt;code&gt;{job=&amp;quot;other&amp;quot;}&lt;/code&gt; label with the sum of the remaining series if any.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk_last&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;topk_last&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;bottomk_max &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk_max&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;bottomk_max-httpsdocsvictoriametricscommetricsqlbottomk_max&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#bottomk_max-httpsdocsvictoriametricscommetricsqlbottomk_max&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;bottomk_max(k, q, &amp;quot;other_label=other_value&amp;quot;)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; time series from &lt;code&gt;q&lt;/code&gt; with the smallest maximums. If an optional &lt;code&gt;other_label=other_value&lt;/code&gt; arg is set, then the sum of the remaining time series is returned with the given label. For example, &lt;code&gt;bottomk_max(3, sum(process_resident_memory_bytes) by (job), &amp;quot;job=other&amp;quot;)&lt;/code&gt; would return up to 3 time series with the smallest maximums plus a time series with &lt;code&gt;{job=&amp;quot;other&amp;quot;}&lt;/code&gt; label with the sum of the remaining series if any.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk_max&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;topk_max&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;bottomk_median &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk_median&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;bottomk_median-httpsdocsvictoriametricscommetricsqlbottomk_median&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#bottomk_median-httpsdocsvictoriametricscommetricsqlbottomk_median&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;bottomk_median(k, q, &amp;quot;other_label=other_value&amp;quot;)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; time series from &lt;code&gt;q&lt;/code&gt; with the smallest medians. If an optional&lt;code&gt;other_label=other_value&lt;/code&gt; arg is set, then the sum of the remaining time series is returned with the given label. For example, &lt;code&gt;bottomk_median(3, sum(process_resident_memory_bytes) by (job), &amp;quot;job=other&amp;quot;)&lt;/code&gt; would return up to 3 time series with the smallest medians plus a time series with &lt;code&gt;{job=&amp;quot;other&amp;quot;}&lt;/code&gt; label with the sum of the remaining series if any.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk_median&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;topk_median&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;bottomk_min &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk_min&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;bottomk_min-httpsdocsvictoriametricscommetricsqlbottomk_min&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#bottomk_min-httpsdocsvictoriametricscommetricsqlbottomk_min&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;bottomk_min(k, q, &amp;quot;other_label=other_value&amp;quot;)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; time series from &lt;code&gt;q&lt;/code&gt; with the smallest minimums. If an optional &lt;code&gt;other_label=other_value&lt;/code&gt; arg is set, then the sum of the remaining time series is returned with the given label. For example, &lt;code&gt;bottomk_min(3, sum(process_resident_memory_bytes) by (job), &amp;quot;job=other&amp;quot;)&lt;/code&gt; would return up to 3 time series with the smallest minimums plus a time series with &lt;code&gt;{job=&amp;quot;other&amp;quot;}&lt;/code&gt; label with the sum of the remaining series if any.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk_min&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;topk_min&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;count &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#count&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;count-httpsdocsvictoriametricscommetricsqlcount&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#count-httpsdocsvictoriametricscommetricsqlcount&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;count(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns the number of non-empty points per &lt;code&gt;group_labels&lt;/code&gt; for time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;count_values &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#count_values&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;count_values-httpsdocsvictoriametricscommetricsqlcount_values&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#count_values-httpsdocsvictoriametricscommetricsqlcount_values&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;count_values(&amp;quot;label&amp;quot;, q)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which counts the number of points with the same value and stores the counts in a time series with an additional &lt;code&gt;label&lt;/code&gt;, which contains each initial value. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#count_values_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;count_values_over_time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_match&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_match&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;distinct &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#distinct&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;distinct-httpsdocsvictoriametricscommetricsqldistinct&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#distinct-httpsdocsvictoriametricscommetricsqldistinct&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;distinct(q)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which calculates the number of unique values per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#distinct_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;distinct_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;geomean &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#geomean&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;geomean-httpsdocsvictoriametricscommetricsqlgeomean&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#geomean-httpsdocsvictoriametricscommetricsqlgeomean&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;geomean(q)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which calculates geometric mean per each group of points with the same timestamp.&lt;/p&gt;
&lt;h4&gt;group &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#group&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;group-httpsdocsvictoriametricscommetricsqlgroup&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#group-httpsdocsvictoriametricscommetricsqlgroup&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;group(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns &lt;code&gt;1&lt;/code&gt; per each &lt;code&gt;group_labels&lt;/code&gt; for time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL. See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#any&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;any&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;histogram &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;histogram-httpsdocsvictoriametricscommetricsqlhistogram&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#histogram-httpsdocsvictoriametricscommetricsqlhistogram&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;histogram(q)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which calculates &lt;a href=&#34;https://valyala.medium.com/improving-histogram-usability-for-prometheus-and-grafana-bc7e5df0e350&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics histogram&lt;/a&gt; per each group of points with the same timestamp. Useful for visualizing big number of time series via a heatmap. See &lt;a href=&#34;https://medium.com/@valyala/improving-histogram-usability-for-prometheus-and-grafana-bc7e5df0e350&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;this article&lt;/a&gt; for more details.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram_over_time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_quantile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram_quantile&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;limitk &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#limitk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;limitk-httpsdocsvictoriametricscommetricsqllimitk&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#limitk-httpsdocsvictoriametricscommetricsqllimitk&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;limitk(k, q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; time series per each &lt;code&gt;group_labels&lt;/code&gt; out of time series returned by &lt;code&gt;q&lt;/code&gt;. The returned set of time series remain the same across calls.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#limit_offset&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;limit_offset&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;mad &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#mad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;mad-httpsdocsvictoriametricscommetricsqlmad&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#mad-httpsdocsvictoriametricscommetricsqlmad&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;mad(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns the &lt;a href=&#34;https://en.wikipedia.org/wiki/Median_absolute_deviation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Median absolute deviation&lt;/a&gt; per each &lt;code&gt;group_labels&lt;/code&gt; for all the time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_mad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_mad&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#mad_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mad_over_time&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outliers_mad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outliers_mad&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#stddev&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;stddev&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;max &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#max&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;max-httpsdocsvictoriametricscommetricsqlmax&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#max-httpsdocsvictoriametricscommetricsqlmax&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;max(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns the maximum value per each &lt;code&gt;group_labels&lt;/code&gt; for all the time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;median &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#median&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;median-httpsdocsvictoriametricscommetricsqlmedian&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#median-httpsdocsvictoriametricscommetricsqlmedian&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;median(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns the median value per each &lt;code&gt;group_labels&lt;/code&gt; for all the time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;h4&gt;min &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#min&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;min-httpsdocsvictoriametricscommetricsqlmin&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#min-httpsdocsvictoriametricscommetricsqlmin&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;min(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns the minimum value per each &lt;code&gt;group_labels&lt;/code&gt; for all the time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;mode &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#mode&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;mode-httpsdocsvictoriametricscommetricsqlmode&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#mode-httpsdocsvictoriametricscommetricsqlmode&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;mode(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Mode_%28statistics%29&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mode&lt;/a&gt; per each &lt;code&gt;group_labels&lt;/code&gt; for all the time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;h4&gt;outliers_iqr &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outliers_iqr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;outliers_iqr-httpsdocsvictoriametricscommetricsqloutliers_iqr&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#outliers_iqr-httpsdocsvictoriametricscommetricsqloutliers_iqr&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;outliers_iqr(q)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns time series from &lt;code&gt;q&lt;/code&gt; with at least a single point outside e.g. &lt;a href=&#34;https://en.wikipedia.org/wiki/Interquartile_range&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Interquartile range outlier bounds&lt;/a&gt; &lt;code&gt;[q25-1.5*iqr .. q75+1.5*iqr]&lt;/code&gt; comparing to other time series at the given point, where:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;iqr&lt;/code&gt; is an &lt;a href=&#34;https://en.wikipedia.org/wiki/Interquartile_range&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Interquartile range&lt;/a&gt; calculated independently per each point on the graph across &lt;code&gt;q&lt;/code&gt; series.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;q25&lt;/code&gt; and &lt;code&gt;q75&lt;/code&gt; are 25th and 75th &lt;a href=&#34;https://en.wikipedia.org/wiki/Percentile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;percentiles&lt;/a&gt; calculated independently per each point on the graph across &lt;code&gt;q&lt;/code&gt; series.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The &lt;code&gt;outliers_iqr()&lt;/code&gt; is useful for detecting anomalous series in the group of series. For example, &lt;code&gt;outliers_iqr(temperature) by (country)&lt;/code&gt; returns per-country series with anomalous outlier values comparing to the rest of per-country series.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outliers_mad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outliers_mad&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outliersk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outliersk&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outlier_iqr_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outlier_iqr_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;outliers_mad &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outliers_mad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;outliers_mad-httpsdocsvictoriametricscommetricsqloutliers_mad&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#outliers_mad-httpsdocsvictoriametricscommetricsqloutliers_mad&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;outliers_mad(tolerance, q)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns time series from &lt;code&gt;q&lt;/code&gt; with at least a single point outside &lt;a href=&#34;https://en.wikipedia.org/wiki/Median_absolute_deviation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Median absolute deviation&lt;/a&gt; (aka MAD) multiplied by &lt;code&gt;tolerance&lt;/code&gt;. E.g. it returns time series with at least a single point below &lt;code&gt;median(q) - mad(q)&lt;/code&gt; or a single point above &lt;code&gt;median(q) + mad(q)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outliers_iqr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outliers_iqr&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outliersk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outliersk&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#mad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mad&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;outliersk &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outliersk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;outliersk-httpsdocsvictoriametricscommetricsqloutliersk&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#outliersk-httpsdocsvictoriametricscommetricsqloutliersk&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;outliersk(k, q)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; time series with the biggest standard deviation (aka outliers) out of time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outliers_iqr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outliers_iqr&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outliers_mad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outliers_mad&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;quantile &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#quantile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;quantile-httpsdocsvictoriametricscommetricsqlquantile&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#quantile-httpsdocsvictoriametricscommetricsqlquantile&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;quantile(phi, q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which calculates &lt;code&gt;phi&lt;/code&gt;-quantile per each &lt;code&gt;group_labels&lt;/code&gt; for all the time series returned by &lt;code&gt;q&lt;/code&gt;. &lt;code&gt;phi&lt;/code&gt; must be in the range &lt;code&gt;[0...1]&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#quantiles&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;quantiles&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_quantile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram_quantile&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;quantiles &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#quantiles&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;quantiles-httpsdocsvictoriametricscommetricsqlquantiles&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#quantiles-httpsdocsvictoriametricscommetricsqlquantiles&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;quantiles(&amp;quot;phiLabel&amp;quot;, phi1, ..., phiN, q)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which calculates &lt;code&gt;phi*&lt;/code&gt;-quantiles for all the time series returned by &lt;code&gt;q&lt;/code&gt; and return them in time series with &lt;code&gt;{phiLabel=&amp;quot;phi*&amp;quot;}&lt;/code&gt; label. &lt;code&gt;phi*&lt;/code&gt; must be in the range &lt;code&gt;[0...1]&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#quantile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;quantile&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;share &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#share&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;share-httpsdocsvictoriametricscommetricsqlshare&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#share-httpsdocsvictoriametricscommetricsqlshare&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;share(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns shares in the range &lt;code&gt;[0..1]&lt;/code&gt; for every non-negative points returned by &lt;code&gt;q&lt;/code&gt; per each timestamp, so the sum of shares per each &lt;code&gt;group_labels&lt;/code&gt; equals 1.&lt;/p&gt;
&lt;p&gt;This function is useful for normalizing &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#histogram&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram bucket&lt;/a&gt; shares into &lt;code&gt;[0..1]&lt;/code&gt; range:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;share(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  sum(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    rate(http_request_duration_seconds_bucket[5m])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ) by (le, vmrange)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;&lt;!-- raw HTML omitted --&gt;MetricsQL&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;&lt;!-- raw HTML omitted --&gt;Copy&lt;!-- raw HTML omitted --&gt;&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_normalize&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_normalize&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;stddev &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#stddev&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;stddev-httpsdocsvictoriametricscommetricsqlstddev&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#stddev-httpsdocsvictoriametricscommetricsqlstddev&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;stddev(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which calculates standard deviation per each &lt;code&gt;group_labels&lt;/code&gt; for all the time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;stdvar &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#stdvar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;stdvar-httpsdocsvictoriametricscommetricsqlstdvar&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#stdvar-httpsdocsvictoriametricscommetricsqlstdvar&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;stdvar(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which calculates standard variance per each &lt;code&gt;group_labels&lt;/code&gt; for all the time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;sum &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sum&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sum-httpsdocsvictoriametricscommetricsqlsum&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sum-httpsdocsvictoriametricscommetricsqlsum&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;sum(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns the sum per each &lt;code&gt;group_labels&lt;/code&gt; for all the time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;sum2 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sum2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sum2-httpsdocsvictoriametricscommetricsqlsum2&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sum2-httpsdocsvictoriametricscommetricsqlsum2&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;sum2(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which calculates the sum of squares per each &lt;code&gt;group_labels&lt;/code&gt; for all the time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;h4&gt;topk &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;topk-httpsdocsvictoriametricscommetricsqltopk&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#topk-httpsdocsvictoriametricscommetricsqltopk&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;topk(k, q)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; points with the biggest values across all the time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bottomk&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk_max&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;topk_max&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk_last&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;topk_last&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;topk_avg &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk_avg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;topk_avg-httpsdocsvictoriametricscommetricsqltopk_avg&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#topk_avg-httpsdocsvictoriametricscommetricsqltopk_avg&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;topk_avg(k, q, &amp;quot;other_label=other_value&amp;quot;)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; time series from &lt;code&gt;q&lt;/code&gt; with the biggest averages. If an optional &lt;code&gt;other_label=other_value&lt;/code&gt; arg is set, then the sum of the remaining time series is returned with the given label. For example, &lt;code&gt;topk_avg(3, sum(process_resident_memory_bytes) by (job), &amp;quot;job=other&amp;quot;)&lt;/code&gt; would return up to 3 time series with the biggest averages plus a time series with &lt;code&gt;{job=&amp;quot;other&amp;quot;}&lt;/code&gt; label with the sum of the remaining series if any.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk_avg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bottomk_avg&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;topk_last &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk_last&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;topk_last-httpsdocsvictoriametricscommetricsqltopk_last&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#topk_last-httpsdocsvictoriametricscommetricsqltopk_last&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;topk_last(k, q, &amp;quot;other_label=other_value&amp;quot;)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; time series from &lt;code&gt;q&lt;/code&gt; with the biggest last values. If an optional &lt;code&gt;other_label=other_value&lt;/code&gt; arg is set, then the sum of the remaining time series is returned with the given label. For example, &lt;code&gt;topk_max(3, sum(process_resident_memory_bytes) by (job), &amp;quot;job=other&amp;quot;)&lt;/code&gt; would return up to 3 time series with the biggest maximums plus a time series with &lt;code&gt;{job=&amp;quot;other&amp;quot;}&lt;/code&gt; label with the sum of the remaining series if any.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk_last&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bottomk_last&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;topk_max &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk_max&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;topk_max-httpsdocsvictoriametricscommetricsqltopk_max&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#topk_max-httpsdocsvictoriametricscommetricsqltopk_max&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;topk_max(k, q, &amp;quot;other_label=other_value&amp;quot;)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; time series from &lt;code&gt;q&lt;/code&gt; with the biggest maximums. If an optional &lt;code&gt;other_label=other_value&lt;/code&gt; arg is set, then the sum of the remaining time series is returned with the given label. For example, &lt;code&gt;topk_max(3, sum(process_resident_memory_bytes) by (job), &amp;quot;job=other&amp;quot;)&lt;/code&gt; would return up to 3 time series with the biggest maximums plus a time series with &lt;code&gt;{job=&amp;quot;other&amp;quot;}&lt;/code&gt; label with the sum of the remaining series if any.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk_max&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bottomk_max&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;topk_median &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk_median&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;topk_median-httpsdocsvictoriametricscommetricsqltopk_median&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#topk_median-httpsdocsvictoriametricscommetricsqltopk_median&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;topk_median(k, q, &amp;quot;other_label=other_value&amp;quot;)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; time series from &lt;code&gt;q&lt;/code&gt; with the biggest medians. If an optional &lt;code&gt;other_label=other_value&lt;/code&gt; arg is set, then the sum of the remaining time series is returned with the given label. For example, &lt;code&gt;topk_median(3, sum(process_resident_memory_bytes) by (job), &amp;quot;job=other&amp;quot;)&lt;/code&gt; would return up to 3 time series with the biggest medians plus a time series with &lt;code&gt;{job=&amp;quot;other&amp;quot;}&lt;/code&gt; label with the sum of the remaining series if any.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk_median&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bottomk_median&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;topk_min &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#topk_min&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;topk_min-httpsdocsvictoriametricscommetricsqltopk_min&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#topk_min-httpsdocsvictoriametricscommetricsqltopk_min&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;topk_min(k, q, &amp;quot;other_label=other_value&amp;quot;)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns up to &lt;code&gt;k&lt;/code&gt; time series from &lt;code&gt;q&lt;/code&gt; with the biggest minimums. If an optional &lt;code&gt;other_label=other_value&lt;/code&gt; arg is set, then the sum of the remaining time series is returned with the given label. For example, &lt;code&gt;topk_min(3, sum(process_resident_memory_bytes) by (job), &amp;quot;job=other&amp;quot;)&lt;/code&gt; would return up to 3 time series with the biggest minimums plus a time series with &lt;code&gt;{job=&amp;quot;other&amp;quot;}&lt;/code&gt; label with the sum of the remaining series if any.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bottomk_min&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bottomk_min&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;zscore &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#zscore&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;zscore-httpsdocsvictoriametricscommetricsqlzscore&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#zscore-httpsdocsvictoriametricscommetricsqlzscore&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;zscore(q) by (group_labels)&lt;/code&gt; is &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aggregate function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Standard_score&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;z-score&lt;/a&gt; values per each &lt;code&gt;group_labels&lt;/code&gt; for all the time series returned by &lt;code&gt;q&lt;/code&gt;. The aggregate is calculated individually per each group of points with the same timestamp. This function is useful for detecting anomalies in the group of related time series.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#zscore_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;zscore_over_time&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_trim_zscore&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_trim_zscore&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#outliers_iqr&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;outliers_iqr&lt;/a&gt;.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>如何补写历史数据</title>
      <link>http://localhost:1313/docs/ops/write-history/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/ops/write-history/</guid>
      <description>
        
        
        
      </description>
    </item>
    
    <item>
      <title>数值转换</title>
      <link>http://localhost:1313/docs/query/metricsql/functions/transmit/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/query/metricsql/functions/transmit/</guid>
      <description>
        
        
        &lt;p&gt;&lt;strong&gt;Transform functions&lt;/strong&gt; calculate transformations over &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rollup-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup results&lt;/a&gt;. For example, &lt;code&gt;abs(delta(temperature[24h]))&lt;/code&gt; calculates the absolute value for every point of every time series returned from the rollup &lt;code&gt;delta(temperature[24h])&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Additional details:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If transform function is applied directly to a &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#filtering&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series selector&lt;/a&gt;, then the &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#default_rollup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;default_rollup()&lt;/a&gt; function is automatically applied before calculating the transformations. For example, &lt;code&gt;abs(temperature)&lt;/code&gt; is implicitly transformed to &lt;code&gt;abs(default_rollup(temperature))&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;All the transform functions accept optional &lt;code&gt;keep_metric_names&lt;/code&gt; modifier. If it is set, then the function doesn’t drop metric names from the resulting time series. See &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#implicit-query-conversions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;implicit query conversions&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;abs &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#abs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;abs-httpsdocsvictoriametricscommetricsqlabs&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#abs-httpsdocsvictoriametricscommetricsqlabs&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;abs(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the absolute value for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;absent &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#absent&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;absent-httpsdocsvictoriametricscommetricsqlabsent&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#absent-httpsdocsvictoriametricscommetricsqlabsent&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;absent(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns 1 if &lt;code&gt;q&lt;/code&gt; has no points. Otherwise, returns an empty result.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#absent_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;absent_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;acos &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#acos&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;acos-httpsdocsvictoriametricscommetricsqlacos&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#acos-httpsdocsvictoriametricscommetricsqlacos&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;acos(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Inverse_trigonometric_functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;inverse cosine&lt;/a&gt; for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#asin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;asin&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#cos&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cos&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;acosh &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#acosh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;acosh-httpsdocsvictoriametricscommetricsqlacosh&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#acosh-httpsdocsvictoriametricscommetricsqlacosh&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;acosh(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Inverse_hyperbolic_functions#Inverse_hyperbolic_cosine&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;inverse hyperbolic cosine&lt;/a&gt; for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#cosh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sinh&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;asin &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#asin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;asin-httpsdocsvictoriametricscommetricsqlasin&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#asin-httpsdocsvictoriametricscommetricsqlasin&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;asin(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Inverse_trigonometric_functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;inverse sine&lt;/a&gt; for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#acos&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;acos&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sin&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;asinh &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#asinh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;asinh-httpsdocsvictoriametricscommetricsqlasinh&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#asinh-httpsdocsvictoriametricscommetricsqlasinh&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;asinh(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Inverse_hyperbolic_functions#Inverse_hyperbolic_sine&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;inverse hyperbolic sine&lt;/a&gt; for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sinh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sinh&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;atan &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#atan&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;atan-httpsdocsvictoriametricscommetricsqlatan&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#atan-httpsdocsvictoriametricscommetricsqlatan&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;atan(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Inverse_trigonometric_functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;inverse tangent&lt;/a&gt; for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#tan&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tan&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;atanh &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#atanh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;atanh-httpsdocsvictoriametricscommetricsqlatanh&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#atanh-httpsdocsvictoriametricscommetricsqlatanh&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;atanh(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Inverse_hyperbolic_functions#Inverse_hyperbolic_tangent&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;inverse hyperbolic tangent&lt;/a&gt; for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#tanh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tanh&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;bitmap_and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bitmap_and&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;bitmap_and-httpsdocsvictoriametricscommetricsqlbitmap_and&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#bitmap_and-httpsdocsvictoriametricscommetricsqlbitmap_and&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;bitmap_and(q, mask)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates bitwise &lt;code&gt;v &amp;amp; mask&lt;/code&gt; for every &lt;code&gt;v&lt;/code&gt; point of every time series returned from &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;h4&gt;bitmap_or &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bitmap_or&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;bitmap_or-httpsdocsvictoriametricscommetricsqlbitmap_or&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#bitmap_or-httpsdocsvictoriametricscommetricsqlbitmap_or&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;bitmap_or(q, mask)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates bitwise &lt;code&gt;v | mask&lt;/code&gt; for every &lt;code&gt;v&lt;/code&gt; point of every time series returned from &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;h4&gt;bitmap_xor &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#bitmap_xor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;bitmap_xor-httpsdocsvictoriametricscommetricsqlbitmap_xor&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#bitmap_xor-httpsdocsvictoriametricscommetricsqlbitmap_xor&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;bitmap_xor(q, mask)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates bitwise &lt;code&gt;v ^ mask&lt;/code&gt; for every &lt;code&gt;v&lt;/code&gt; point of every time series returned from &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;h4&gt;buckets_limit &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#buckets_limit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;buckets_limit-httpsdocsvictoriametricscommetricsqlbuckets_limit&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#buckets_limit-httpsdocsvictoriametricscommetricsqlbuckets_limit&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;buckets_limit(limit, buckets)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which limits the number of &lt;a href=&#34;https://valyala.medium.com/improving-histogram-usability-for-prometheus-and-grafana-bc7e5df0e350&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram buckets&lt;/a&gt; to the given &lt;code&gt;limit&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#prometheus_buckets&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;prometheus_buckets&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_quantile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram_quantile&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;ceil &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#ceil&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;ceil-httpsdocsvictoriametricscommetricsqlceil&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ceil-httpsdocsvictoriametricscommetricsqlceil&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;ceil(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which rounds every point for every time series returned by &lt;code&gt;q&lt;/code&gt; to the upper nearest integer.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#floor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;floor&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#round&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;round&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;clamp &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#clamp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;clamp-httpsdocsvictoriametricscommetricsqlclamp&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#clamp-httpsdocsvictoriametricscommetricsqlclamp&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;clamp(q, min, max)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which clamps every point for every time series returned by &lt;code&gt;q&lt;/code&gt; with the given &lt;code&gt;min&lt;/code&gt; and &lt;code&gt;max&lt;/code&gt; values.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#clamp_min&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;clamp_min&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#clamp_max&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;clamp_max&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;clamp_max &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#clamp_max&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;clamp_max-httpsdocsvictoriametricscommetricsqlclamp_max&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#clamp_max-httpsdocsvictoriametricscommetricsqlclamp_max&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;clamp_max(q, max)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which clamps every point for every time series returned by &lt;code&gt;q&lt;/code&gt; with the given &lt;code&gt;max&lt;/code&gt; value.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#clamp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;clamp&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#clamp_min&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;clamp_min&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;clamp_min &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#clamp_min&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;clamp_min-httpsdocsvictoriametricscommetricsqlclamp_min&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#clamp_min-httpsdocsvictoriametricscommetricsqlclamp_min&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;clamp_min(q, min)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which clamps every point for every time series returned by &lt;code&gt;q&lt;/code&gt; with the given &lt;code&gt;min&lt;/code&gt; value.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#clamp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;clamp&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#clamp_max&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;clamp_max&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;cos &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#cos&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;cos-httpsdocsvictoriametricscommetricsqlcos&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#cos-httpsdocsvictoriametricscommetricsqlcos&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;cos(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;code&gt;cos(v)&lt;/code&gt; for every &lt;code&gt;v&lt;/code&gt; point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sin&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;cosh &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#cosh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;cosh-httpsdocsvictoriametricscommetricsqlcosh&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#cosh-httpsdocsvictoriametricscommetricsqlcosh&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;cosh(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Hyperbolic_functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;hyperbolic cosine&lt;/a&gt; for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#acosh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;acosh&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;day_of_month &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#day_of_month&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;day_of_month-httpsdocsvictoriametricscommetricsqlday_of_month&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#day_of_month-httpsdocsvictoriametricscommetricsqlday_of_month&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;day_of_month(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the day of month for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;. It is expected that &lt;code&gt;q&lt;/code&gt; returns unix timestamps. The returned values are in the range &lt;code&gt;[1...31]&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#day_of_week&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;day_of_week&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#day_of_year&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;day_of_year&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;day_of_week &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#day_of_week&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;day_of_week-httpsdocsvictoriametricscommetricsqlday_of_week&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#day_of_week-httpsdocsvictoriametricscommetricsqlday_of_week&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;day_of_week(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the day of week for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;. It is expected that &lt;code&gt;q&lt;/code&gt; returns unix timestamps. The returned values are in the range &lt;code&gt;[0...6]&lt;/code&gt;, where &lt;code&gt;0&lt;/code&gt; means Sunday and &lt;code&gt;6&lt;/code&gt; means Saturday.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#day_of_month&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;day_of_month&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#day_of_year&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;day_of_year&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;day_of_year &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#day_of_year&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;day_of_year-httpsdocsvictoriametricscommetricsqlday_of_year&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#day_of_year-httpsdocsvictoriametricscommetricsqlday_of_year&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;day_of_year(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the day of year for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;. It is expected that &lt;code&gt;q&lt;/code&gt; returns unix timestamps. The returned values are in the range &lt;code&gt;[1...365]&lt;/code&gt; for non-leap years, and &lt;code&gt;[1 to 366]&lt;/code&gt; in leap years.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#day_of_week&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;day_of_week&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#day_of_month&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;day_of_month&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;days_in_month &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#days_in_month&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;days_in_month-httpsdocsvictoriametricscommetricsqldays_in_month&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#days_in_month-httpsdocsvictoriametricscommetricsqldays_in_month&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;days_in_month(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the number of days in the month identified by every point of every time series returned by &lt;code&gt;q&lt;/code&gt;. It is expected that &lt;code&gt;q&lt;/code&gt; returns unix timestamps. The returned values are in the range &lt;code&gt;[28...31]&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;deg &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#deg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;deg-httpsdocsvictoriametricscommetricsqldeg&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#deg-httpsdocsvictoriametricscommetricsqldeg&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;deg(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which converts &lt;a href=&#34;https://en.wikipedia.org/wiki/Radian#Conversions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Radians to degrees&lt;/a&gt; for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rad&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;drop_empty_series &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#drop_empty_series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;drop_empty_series-httpsdocsvictoriametricscommetricsqldrop_empty_series&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#drop_empty_series-httpsdocsvictoriametricscommetricsqldrop_empty_series&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;drop_empty_series(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which drops empty series from &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This function can be used when &lt;code&gt;default&lt;/code&gt; operator should be applied only to non-empty series. For example, &lt;code&gt;drop_empty_series(temperature &amp;lt; 30) default 42&lt;/code&gt; returns series, which have at least a single sample smaller than 30 on the selected time range, while filling gaps in the returned series with 42.&lt;/p&gt;
&lt;p&gt;On the other hand &lt;code&gt;(temperature &amp;lt; 30) default 40&lt;/code&gt; returns all the &lt;code&gt;temperature&lt;/code&gt; series, even if they have no samples smaller than 30, by replacing all the values bigger or equal to 30 with 40.&lt;/p&gt;
&lt;h4&gt;end &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#end&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;end-httpsdocsvictoriametricscommetricsqlend&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#end-httpsdocsvictoriametricscommetricsqlend&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;end()&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the unix timestamp in seconds for the last point. It is known as &lt;code&gt;end&lt;/code&gt; query arg passed to &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#range-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/query_range&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#start&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;start&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#now&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;now&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;exp &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#exp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;exp-httpsdocsvictoriametricscommetricsqlexp&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#exp-httpsdocsvictoriametricscommetricsqlexp&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;exp(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the &lt;code&gt;e^v&lt;/code&gt; for every point &lt;code&gt;v&lt;/code&gt; of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#ln&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ln&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;floor &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#floor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;floor-httpsdocsvictoriametricscommetricsqlfloor&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#floor-httpsdocsvictoriametricscommetricsqlfloor&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;floor(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which rounds every point for every time series returned by &lt;code&gt;q&lt;/code&gt; to the lower nearest integer.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#ceil&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ceil&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#round&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;round&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;histogram_avg &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_avg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;histogram_avg-httpsdocsvictoriametricscommetricsqlhistogram_avg&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#histogram_avg-httpsdocsvictoriametricscommetricsqlhistogram_avg&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;histogram_avg(buckets)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the average value for the given &lt;code&gt;buckets&lt;/code&gt;. It can be used for calculating the average over the given time range across multiple time series. For example, &lt;code&gt;histogram_avg(sum(histogram_over_time(response_time_duration_seconds[5m])) by (vmrange,job))&lt;/code&gt; would return the average response time per each &lt;code&gt;job&lt;/code&gt; over the last 5 minutes.&lt;/p&gt;
&lt;h4&gt;histogram_quantile &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_quantile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;histogram_quantile-httpsdocsvictoriametricscommetricsqlhistogram_quantile&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#histogram_quantile-httpsdocsvictoriametricscommetricsqlhistogram_quantile&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;histogram_quantile(phi, buckets)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates &lt;code&gt;phi&lt;/code&gt;-&lt;a href=&#34;https://en.wikipedia.org/wiki/Percentile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;percentile&lt;/a&gt; over the given &lt;a href=&#34;https://valyala.medium.com/improving-histogram-usability-for-prometheus-and-grafana-bc7e5df0e350&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram buckets&lt;/a&gt;. &lt;code&gt;phi&lt;/code&gt; must be in the range &lt;code&gt;[0...1]&lt;/code&gt;. For example, &lt;code&gt;histogram_quantile(0.5, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))&lt;/code&gt; would return median request duration for all the requests during the last 5 minutes.&lt;/p&gt;
&lt;p&gt;The function accepts optional third arg - &lt;code&gt;boundsLabel&lt;/code&gt;. In this case it returns &lt;code&gt;lower&lt;/code&gt; and &lt;code&gt;upper&lt;/code&gt; bounds for the estimated percentile with the given &lt;code&gt;boundsLabel&lt;/code&gt; label. See &lt;a href=&#34;https://github.com/prometheus/prometheus/issues/5706&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;this issue for details&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;When the &lt;a href=&#34;https://en.wikipedia.org/wiki/Percentile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;percentile&lt;/a&gt; is calculated over multiple histograms, then all the input histograms &lt;strong&gt;must&lt;/strong&gt; have buckets with identical boundaries, e.g. they must have the same set of &lt;code&gt;le&lt;/code&gt; or &lt;code&gt;vmrange&lt;/code&gt; labels. Otherwise, the returned result may be invalid. See &lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/issues/3231&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;this issue&lt;/a&gt; for details.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL (except of the &lt;code&gt;boundLabel&lt;/code&gt; arg).&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_quantiles&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram_quantiles&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_share&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram_share&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#quantile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;quantile&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;histogram_quantiles &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_quantiles&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;histogram_quantiles-httpsdocsvictoriametricscommetricsqlhistogram_quantiles&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#histogram_quantiles-httpsdocsvictoriametricscommetricsqlhistogram_quantiles&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;histogram_quantiles(&amp;quot;phiLabel&amp;quot;, phi1, ..., phiN, buckets)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the given &lt;code&gt;phi*&lt;/code&gt;-quantiles over the given &lt;a href=&#34;https://valyala.medium.com/improving-histogram-usability-for-prometheus-and-grafana-bc7e5df0e350&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram buckets&lt;/a&gt;. Argument &lt;code&gt;phi*&lt;/code&gt; must be in the range &lt;code&gt;[0...1]&lt;/code&gt;. For example, &lt;code&gt;histogram_quantiles(&#39;le&#39;, 0.3, 0.5, sum(rate(http_request_duration_seconds_bucket[5m]) by (le))&lt;/code&gt;. Each calculated quantile is returned in a separate time series with the corresponding &lt;code&gt;{phiLabel=&amp;quot;phi*&amp;quot;}&lt;/code&gt; label.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_quantile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram_quantile&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;histogram_share &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_share&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;histogram_share-httpsdocsvictoriametricscommetricsqlhistogram_share&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#histogram_share-httpsdocsvictoriametricscommetricsqlhistogram_share&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;histogram_share(le, buckets)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the share (in the range &lt;code&gt;[0...1]&lt;/code&gt;) for &lt;code&gt;buckets&lt;/code&gt; that fall below &lt;code&gt;le&lt;/code&gt;. This function is useful for calculating SLI and SLO. This is inverse to &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_quantile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram_quantile&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The function accepts optional third arg - &lt;code&gt;boundsLabel&lt;/code&gt;. In this case it returns &lt;code&gt;lower&lt;/code&gt; and &lt;code&gt;upper&lt;/code&gt; bounds for the estimated share with the given &lt;code&gt;boundsLabel&lt;/code&gt; label.&lt;/p&gt;
&lt;h4&gt;histogram_stddev &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_stddev&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;histogram_stddev-httpsdocsvictoriametricscommetricsqlhistogram_stddev&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#histogram_stddev-httpsdocsvictoriametricscommetricsqlhistogram_stddev&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;histogram_stddev(buckets)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates standard deviation for the given &lt;code&gt;buckets&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;histogram_stdvar &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_stdvar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;histogram_stdvar-httpsdocsvictoriametricscommetricsqlhistogram_stdvar&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#histogram_stdvar-httpsdocsvictoriametricscommetricsqlhistogram_stdvar&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;histogram_stdvar(buckets)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates standard variance for the given &lt;code&gt;buckets&lt;/code&gt;. It can be used for calculating standard deviation over the given time range across multiple time series. For example, &lt;code&gt;histogram_stdvar(sum(histogram_over_time(temperature[24])) by (vmrange,country))&lt;/code&gt; would return standard deviation for the temperature per each country over the last 24 hours.&lt;/p&gt;
&lt;h4&gt;hour &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#hour&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;hour-httpsdocsvictoriametricscommetricsqlhour&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#hour-httpsdocsvictoriametricscommetricsqlhour&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;hour(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the hour for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;. It is expected that &lt;code&gt;q&lt;/code&gt; returns unix timestamps. The returned values are in the range &lt;code&gt;[0...23]&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;interpolate &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#interpolate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;interpolate-httpsdocsvictoriametricscommetricsqlinterpolate&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#interpolate-httpsdocsvictoriametricscommetricsqlinterpolate&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;interpolate(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which fills gaps with linearly interpolated values calculated from the last and the next non-empty points per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_last_value&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_last_value&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_next_value&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_next_value&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;keep_last_value &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_last_value&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;keep_last_value-httpsdocsvictoriametricscommetricsqlkeep_last_value&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#keep_last_value-httpsdocsvictoriametricscommetricsqlkeep_last_value&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;keep_last_value(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which fills gaps with the value of the last non-empty point in every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_next_value&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_next_value&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#interpolate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;interpolate&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;keep_next_value &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_next_value&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;keep_next_value-httpsdocsvictoriametricscommetricsqlkeep_next_value&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#keep_next_value-httpsdocsvictoriametricscommetricsqlkeep_next_value&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;keep_next_value(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which fills gaps with the value of the next non-empty point in every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_last_value&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_last_value&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#interpolate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;interpolate&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;limit_offset &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#limit_offset&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;limit_offset-httpsdocsvictoriametricscommetricsqllimit_offset&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#limit_offset-httpsdocsvictoriametricscommetricsqllimit_offset&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;limit_offset(limit, offset, q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which skips &lt;code&gt;offset&lt;/code&gt; time series from series returned by &lt;code&gt;q&lt;/code&gt; and then returns up to &lt;code&gt;limit&lt;/code&gt; of the remaining time series per each group.&lt;/p&gt;
&lt;p&gt;This allows implementing simple paging for &lt;code&gt;q&lt;/code&gt; time series. See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#limitk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;limitk&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;ln &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#ln&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;ln-httpsdocsvictoriametricscommetricsqlln&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ln-httpsdocsvictoriametricscommetricsqlln&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;ln(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates &lt;code&gt;ln(v)&lt;/code&gt; for every point &lt;code&gt;v&lt;/code&gt; of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#exp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;exp&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#log2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;log2&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;log2 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#log2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;log2-httpsdocsvictoriametricscommetricsqllog2&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#log2-httpsdocsvictoriametricscommetricsqllog2&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;log2(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates &lt;code&gt;log2(v)&lt;/code&gt; for every point &lt;code&gt;v&lt;/code&gt; of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#log10&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;log10&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#ln&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ln&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;log10 &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#log10&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;log10-httpsdocsvictoriametricscommetricsqllog10&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#log10-httpsdocsvictoriametricscommetricsqllog10&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;log10(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates &lt;code&gt;log10(v)&lt;/code&gt; for every point &lt;code&gt;v&lt;/code&gt; of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#log2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;log2&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#ln&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ln&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;minute &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#minute&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;minute-httpsdocsvictoriametricscommetricsqlminute&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#minute-httpsdocsvictoriametricscommetricsqlminute&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;minute(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the minute for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;. It is expected that &lt;code&gt;q&lt;/code&gt; returns unix timestamps. The returned values are in the range &lt;code&gt;[0...59]&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;month &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#month&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;month-httpsdocsvictoriametricscommetricsqlmonth&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#month-httpsdocsvictoriametricscommetricsqlmonth&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;month(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the month for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;. It is expected that &lt;code&gt;q&lt;/code&gt; returns unix timestamps. The returned values are in the range &lt;code&gt;[1...12]&lt;/code&gt;, where &lt;code&gt;1&lt;/code&gt; means January and &lt;code&gt;12&lt;/code&gt; means December.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;now &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#now&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;now-httpsdocsvictoriametricscommetricsqlnow&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#now-httpsdocsvictoriametricscommetricsqlnow&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;now()&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the current timestamp as a floating-point value in seconds.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;pi &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#pi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;pi-httpsdocsvictoriametricscommetricsqlpi&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#pi-httpsdocsvictoriametricscommetricsqlpi&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;pi()&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Pi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pi number&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;rad &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rad-httpsdocsvictoriametricscommetricsqlrad&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rad-httpsdocsvictoriametricscommetricsqlrad&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;rad(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which converts &lt;a href=&#34;https://en.wikipedia.org/wiki/Radian#Conversions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;degrees to Radians&lt;/a&gt; for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#deg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;deg&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;prometheus_buckets &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#prometheus_buckets&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;prometheus_buckets-httpsdocsvictoriametricscommetricsqlprometheus_buckets&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#prometheus_buckets-httpsdocsvictoriametricscommetricsqlprometheus_buckets&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;prometheus_buckets(buckets)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which converts &lt;a href=&#34;https://valyala.medium.com/improving-histogram-usability-for-prometheus-and-grafana-bc7e5df0e350&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics histogram buckets&lt;/a&gt; with &lt;code&gt;vmrange&lt;/code&gt; labels to Prometheus histogram buckets with &lt;code&gt;le&lt;/code&gt; labels. This may be useful for building heatmaps in Grafana.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#histogram_quantile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;histogram_quantile&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#buckets_limit&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;buckets_limit&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;rand &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rand&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rand-httpsdocsvictoriametricscommetricsqlrand&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rand-httpsdocsvictoriametricscommetricsqlrand&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;rand(seed)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns pseudo-random numbers on the range &lt;code&gt;[0...1]&lt;/code&gt; with even distribution. Optional &lt;code&gt;seed&lt;/code&gt; can be used as a seed for pseudo-random number generator.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rand_normal&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rand_normal&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rand_exponential&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rand_exponential&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;rand_exponential &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rand_exponential&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rand_exponential-httpsdocsvictoriametricscommetricsqlrand_exponential&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rand_exponential-httpsdocsvictoriametricscommetricsqlrand_exponential&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;rand_exponential(seed)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns pseudo-random numbers with &lt;a href=&#34;https://en.wikipedia.org/wiki/Exponential_distribution&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;exponential distribution&lt;/a&gt;. Optional &lt;code&gt;seed&lt;/code&gt; can be used as a seed for pseudo-random number generator.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rand&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rand&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rand_normal&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rand_normal&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;rand_normal &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rand_normal&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;rand_normal-httpsdocsvictoriametricscommetricsqlrand_normal&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#rand_normal-httpsdocsvictoriametricscommetricsqlrand_normal&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;rand_normal(seed)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns pseudo-random numbers with &lt;a href=&#34;https://en.wikipedia.org/wiki/Normal_distribution&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;normal distribution&lt;/a&gt;. Optional &lt;code&gt;seed&lt;/code&gt; can be used as a seed for pseudo-random number generator.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rand&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rand&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#rand_exponential&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rand_exponential&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;range_avg &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_avg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_avg-httpsdocsvictoriametricscommetricsqlrange_avg&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_avg-httpsdocsvictoriametricscommetricsqlrange_avg&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_avg(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the avg value across points per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;range_first &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_first&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_first-httpsdocsvictoriametricscommetricsqlrange_first&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_first-httpsdocsvictoriametricscommetricsqlrange_first&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_first(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the value for the first point per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;range_last &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_last&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_last-httpsdocsvictoriametricscommetricsqlrange_last&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_last-httpsdocsvictoriametricscommetricsqlrange_last&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_last(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the value for the last point per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;range_linear_regression &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_linear_regression&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_linear_regression-httpsdocsvictoriametricscommetricsqlrange_linear_regression&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_linear_regression-httpsdocsvictoriametricscommetricsqlrange_linear_regression&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_linear_regression(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates &lt;a href=&#34;https://en.wikipedia.org/wiki/Simple_linear_regression&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;simple linear regression&lt;/a&gt; over the selected time range per each time series returned by &lt;code&gt;q&lt;/code&gt;. This function is useful for capacity planning and predictions.&lt;/p&gt;
&lt;h4&gt;range_mad &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_mad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_mad-httpsdocsvictoriametricscommetricsqlrange_mad&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_mad-httpsdocsvictoriametricscommetricsqlrange_mad&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_mad(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the &lt;a href=&#34;https://en.wikipedia.org/wiki/Median_absolute_deviation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;median absolute deviation&lt;/a&gt; across points per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#mad&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mad&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#mad_over_time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;mad_over_time&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;range_max &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_max&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_max-httpsdocsvictoriametricscommetricsqlrange_max&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_max-httpsdocsvictoriametricscommetricsqlrange_max&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_max(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the max value across points per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;range_median &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_median&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_median-httpsdocsvictoriametricscommetricsqlrange_median&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_median-httpsdocsvictoriametricscommetricsqlrange_median&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_median(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the median value across points per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;range_min &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_min&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_min-httpsdocsvictoriametricscommetricsqlrange_min&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_min-httpsdocsvictoriametricscommetricsqlrange_min&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_min(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the min value across points per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;range_normalize &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_normalize&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_normalize-httpsdocsvictoriametricscommetricsqlrange_normalize&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_normalize-httpsdocsvictoriametricscommetricsqlrange_normalize&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_normalize(q1, ...)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which normalizes values for time series returned by &lt;code&gt;q1, ...&lt;/code&gt; into &lt;code&gt;[0 ... 1]&lt;/code&gt; range. This function is useful for correlating time series with distinct value ranges.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#share&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;share&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;range_quantile &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_quantile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_quantile-httpsdocsvictoriametricscommetricsqlrange_quantile&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_quantile-httpsdocsvictoriametricscommetricsqlrange_quantile&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_quantile(phi, q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;code&gt;phi&lt;/code&gt;-quantile across points per each time series returned by &lt;code&gt;q&lt;/code&gt;. &lt;code&gt;phi&lt;/code&gt; must be in the range &lt;code&gt;[0...1]&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;range_stddev &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_stddev&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_stddev-httpsdocsvictoriametricscommetricsqlrange_stddev&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_stddev-httpsdocsvictoriametricscommetricsqlrange_stddev&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_stddev(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates &lt;a href=&#34;https://en.wikipedia.org/wiki/Standard_deviation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;standard deviation&lt;/a&gt; per each time series returned by &lt;code&gt;q&lt;/code&gt; on the selected time range.&lt;/p&gt;
&lt;h4&gt;range_stdvar &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_stdvar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_stdvar-httpsdocsvictoriametricscommetricsqlrange_stdvar&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_stdvar-httpsdocsvictoriametricscommetricsqlrange_stdvar&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_stdvar(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates &lt;a href=&#34;https://en.wikipedia.org/wiki/Variance&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;standard variance&lt;/a&gt; per each time series returned by &lt;code&gt;q&lt;/code&gt; on the selected time range.&lt;/p&gt;
&lt;h4&gt;range_sum &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_sum&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_sum-httpsdocsvictoriametricscommetricsqlrange_sum&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_sum-httpsdocsvictoriametricscommetricsqlrange_sum&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_sum(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the sum of points per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;range_trim_outliers &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_trim_outliers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_trim_outliers-httpsdocsvictoriametricscommetricsqlrange_trim_outliers&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_trim_outliers-httpsdocsvictoriametricscommetricsqlrange_trim_outliers&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_trim_outliers(k, q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which drops points located farther than &lt;code&gt;k*range_mad(q)&lt;/code&gt; from the &lt;code&gt;range_median(q)&lt;/code&gt;. E.g. it is equivalent to the following query: &lt;code&gt;q ifnot (abs(q - range_median(q)) &amp;gt; k*range_mad(q))&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_trim_spikes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_trim_spikes&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_trim_zscore&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_trim_zscore&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;range_trim_spikes &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_trim_spikes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_trim_spikes-httpsdocsvictoriametricscommetricsqlrange_trim_spikes&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_trim_spikes-httpsdocsvictoriametricscommetricsqlrange_trim_spikes&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_trim_spikes(phi, q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which drops &lt;code&gt;phi&lt;/code&gt; percent of biggest spikes from time series returned by &lt;code&gt;q&lt;/code&gt;. The &lt;code&gt;phi&lt;/code&gt; must be in the range &lt;code&gt;[0..1]&lt;/code&gt;, where &lt;code&gt;0&lt;/code&gt; means &lt;code&gt;0%&lt;/code&gt; and &lt;code&gt;1&lt;/code&gt; means &lt;code&gt;100%&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_trim_outliers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_trim_outliers&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_trim_zscore&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_trim_zscore&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;range_trim_zscore &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_trim_zscore&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_trim_zscore-httpsdocsvictoriametricscommetricsqlrange_trim_zscore&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_trim_zscore-httpsdocsvictoriametricscommetricsqlrange_trim_zscore&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_trim_zscore(z, q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which drops points located farther than &lt;code&gt;z*range_stddev(q)&lt;/code&gt; from the &lt;code&gt;range_avg(q)&lt;/code&gt;. E.g. it is equivalent to the following query: &lt;code&gt;q ifnot (abs(q - range_avg(q)) &amp;gt; z*range_avg(q))&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_trim_outliers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_trim_outliers&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_trim_spikes&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;range_trim_spikes&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;range_zscore &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#range_zscore&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;range_zscore-httpsdocsvictoriametricscommetricsqlrange_zscore&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#range_zscore-httpsdocsvictoriametricscommetricsqlrange_zscore&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;range_zscore(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates &lt;a href=&#34;https://en.wikipedia.org/wiki/Standard_score&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;z-score&lt;/a&gt; for points returned by &lt;code&gt;q&lt;/code&gt;, e.g. it is equivalent to the following query: &lt;code&gt;(q - range_avg(q)) / range_stddev(q)&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;remove_resets &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#remove_resets&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;remove_resets-httpsdocsvictoriametricscommetricsqlremove_resets&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#remove_resets-httpsdocsvictoriametricscommetricsqlremove_resets&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;remove_resets(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which removes counter resets from time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;round &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#round&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;round-httpsdocsvictoriametricscommetricsqlround&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#round-httpsdocsvictoriametricscommetricsqlround&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;round(q, nearest)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which rounds every point of every time series returned by &lt;code&gt;q&lt;/code&gt; to the &lt;code&gt;nearest&lt;/code&gt; multiple. If &lt;code&gt;nearest&lt;/code&gt; is missing then the rounding is performed to the nearest integer.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#floor&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;floor&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#ceil&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ceil&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;ru &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#ru&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;ru-httpsdocsvictoriametricscommetricsqlru&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ru-httpsdocsvictoriametricscommetricsqlru&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;ru(free, max)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates resource utilization in the range &lt;code&gt;[0%...100%]&lt;/code&gt; for the given &lt;code&gt;free&lt;/code&gt; and &lt;code&gt;max&lt;/code&gt; resources. For instance, &lt;code&gt;ru(node_memory_MemFree_bytes, node_memory_MemTotal_bytes)&lt;/code&gt; returns memory utilization over &lt;a href=&#34;https://github.com/prometheus/node_exporter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;node_exporter&lt;/a&gt; metrics.&lt;/p&gt;
&lt;h4&gt;running_avg &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#running_avg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;running_avg-httpsdocsvictoriametricscommetricsqlrunning_avg&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#running_avg-httpsdocsvictoriametricscommetricsqlrunning_avg&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;running_avg(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the running avg per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;running_max &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#running_max&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;running_max-httpsdocsvictoriametricscommetricsqlrunning_max&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#running_max-httpsdocsvictoriametricscommetricsqlrunning_max&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;running_max(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the running max per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;running_min &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#running_min&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;running_min-httpsdocsvictoriametricscommetricsqlrunning_min&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#running_min-httpsdocsvictoriametricscommetricsqlrunning_min&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;running_min(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the running min per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;running_sum &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#running_sum&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;running_sum-httpsdocsvictoriametricscommetricsqlrunning_sum&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#running_sum-httpsdocsvictoriametricscommetricsqlrunning_sum&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;running_sum(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates the running sum per each time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;scalar &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#scalar&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;scalar-httpsdocsvictoriametricscommetricsqlscalar&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#scalar-httpsdocsvictoriametricscommetricsqlscalar&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;scalar(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;code&gt;q&lt;/code&gt; if &lt;code&gt;q&lt;/code&gt; contains only a single time series. Otherwise, it returns nothing.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;sgn &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sgn&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sgn-httpsdocsvictoriametricscommetricsqlsgn&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sgn-httpsdocsvictoriametricscommetricsqlsgn&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;sgn(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;code&gt;1&lt;/code&gt; if &lt;code&gt;v&amp;gt;0&lt;/code&gt;, &lt;code&gt;-1&lt;/code&gt; if &lt;code&gt;v&amp;lt;0&lt;/code&gt; and &lt;code&gt;0&lt;/code&gt; if &lt;code&gt;v==0&lt;/code&gt; for every point &lt;code&gt;v&lt;/code&gt; of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;sin &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sin&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sin-httpsdocsvictoriametricscommetricsqlsin&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sin-httpsdocsvictoriametricscommetricsqlsin&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;sin(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;code&gt;sin(v)&lt;/code&gt; for every &lt;code&gt;v&lt;/code&gt; point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by MetricsQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#cos&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cos&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;sinh &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sinh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sinh-httpsdocsvictoriametricscommetricsqlsinh&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sinh-httpsdocsvictoriametricscommetricsqlsinh&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;sinh(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Hyperbolic_functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;hyperbolic sine&lt;/a&gt; for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by MetricsQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#cosh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cosh&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;tan &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#tan&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;tan-httpsdocsvictoriametricscommetricsqltan&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#tan-httpsdocsvictoriametricscommetricsqltan&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;tan(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;code&gt;tan(v)&lt;/code&gt; for every &lt;code&gt;v&lt;/code&gt; point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by MetricsQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#atan&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;atan&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;tanh &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#tanh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;tanh-httpsdocsvictoriametricscommetricsqltanh&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#tanh-httpsdocsvictoriametricscommetricsqltanh&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;tanh(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;a href=&#34;https://en.wikipedia.org/wiki/Hyperbolic_functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;hyperbolic tangent&lt;/a&gt; for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by MetricsQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#atanh&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;atanh&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;smooth_exponential &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#smooth_exponential&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;smooth_exponential-httpsdocsvictoriametricscommetricsqlsmooth_exponential&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#smooth_exponential-httpsdocsvictoriametricscommetricsqlsmooth_exponential&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;smooth_exponential(q, sf)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which smooths points per each time series returned by &lt;code&gt;q&lt;/code&gt; using &lt;a href=&#34;https://en.wikipedia.org/wiki/Moving_average#Exponential_moving_average&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;exponential moving average&lt;/a&gt; with the given smooth factor &lt;code&gt;sf&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;sort &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sort&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sort-httpsdocsvictoriametricscommetricsqlsort&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sort-httpsdocsvictoriametricscommetricsqlsort&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;sort(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which sorts series in ascending order by the last point in every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sort_desc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sort_desc&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sort_by_label&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sort_by_label&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;sort_desc &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sort_desc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sort_desc-httpsdocsvictoriametricscommetricsqlsort_desc&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sort_desc-httpsdocsvictoriametricscommetricsqlsort_desc&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;sort_desc(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which sorts series in descending order by the last point in every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sort&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sort&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sort_by_label_desc&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sort_by_label&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;sqrt &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#sqrt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;sqrt-httpsdocsvictoriametricscommetricsqlsqrt&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sqrt-httpsdocsvictoriametricscommetricsqlsqrt&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;sqrt(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which calculates square root for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;start &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#start&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;start-httpsdocsvictoriametricscommetricsqlstart&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#start-httpsdocsvictoriametricscommetricsqlstart&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;start()&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns unix timestamp in seconds for the first point.&lt;/p&gt;
&lt;p&gt;It is known as &lt;code&gt;start&lt;/code&gt; query arg passed to &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#range-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/query_range&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#end&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;end&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#now&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;now&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;step &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#step&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;step-httpsdocsvictoriametricscommetricsqlstep&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#step-httpsdocsvictoriametricscommetricsqlstep&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;step()&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the step in seconds (aka interval) between the returned points. It is known as &lt;code&gt;step&lt;/code&gt; query arg passed to &lt;a href=&#34;https://docs.victoriametrics.com/keyconcepts/#range-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/query_range&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#start&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;start&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#end&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;end&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;time &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#time&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;time-httpsdocsvictoriametricscommetricsqltime&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#time-httpsdocsvictoriametricscommetricsqltime&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;time()&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns unix timestamp for every returned point.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;p&gt;See also &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#timestamp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;timestamp&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#now&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;now&lt;/a&gt;, &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#start&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;start&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#end&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;end&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;timezone_offset &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#timezone_offset&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;timezone_offset-httpsdocsvictoriametricscommetricsqltimezone_offset&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#timezone_offset-httpsdocsvictoriametricscommetricsqltimezone_offset&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;timezone_offset(tz)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns offset in seconds for the given timezone &lt;code&gt;tz&lt;/code&gt; relative to UTC. This can be useful when combining with datetime-related functions. For example, &lt;code&gt;day_of_week(time()+timezone_offset(&amp;quot;America/Los_Angeles&amp;quot;))&lt;/code&gt; would return weekdays for &lt;code&gt;America/Los_Angeles&lt;/code&gt; time zone.&lt;/p&gt;
&lt;p&gt;Special &lt;code&gt;Local&lt;/code&gt; time zone can be used for returning an offset for the time zone set on the host where VictoriaMetrics runs.&lt;/p&gt;
&lt;p&gt;See &lt;a href=&#34;https://en.wikipedia.org/wiki/List_of_tz_database_time_zones&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the list of supported timezones&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;ttf &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#ttf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;ttf-httpsdocsvictoriametricscommetricsqlttf&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ttf-httpsdocsvictoriametricscommetricsqlttf&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;ttf(free)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which estimates the time in seconds needed to exhaust &lt;code&gt;free&lt;/code&gt; resources. For instance, &lt;code&gt;ttf(node_filesystem_avail_byte)&lt;/code&gt; returns the time to storage space exhaustion. This function may be useful for capacity planning.&lt;/p&gt;
&lt;h4&gt;union &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#union&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;union-httpsdocsvictoriametricscommetricsqlunion&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#union-httpsdocsvictoriametricscommetricsqlunion&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;union(q1, ..., qN)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns a union of time series returned from &lt;code&gt;q1&lt;/code&gt;, …, &lt;code&gt;qN&lt;/code&gt;. The &lt;code&gt;union&lt;/code&gt; function name can be skipped - the following queries are equivalent: &lt;code&gt;union(q1, q2)&lt;/code&gt; and &lt;code&gt;(q1, q2)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;It is expected that each &lt;code&gt;q*&lt;/code&gt; query returns time series with unique sets of labels. Otherwise, only the first time series out of series with identical set of labels is returned. Use &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#alias&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;alias&lt;/a&gt; and &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#label_set&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label_set&lt;/a&gt; functions for giving unique labelsets per each &lt;code&gt;q*&lt;/code&gt; query:&lt;/p&gt;
&lt;h4&gt;vector &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#vector&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;vector-httpsdocsvictoriametricscommetricsqlvector&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#vector-httpsdocsvictoriametricscommetricsqlvector&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;vector(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns &lt;code&gt;q&lt;/code&gt;, e.g. it does nothing in MetricsQL.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;
&lt;h4&gt;year &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#year&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;#&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;year-httpsdocsvictoriametricscommetricsqlyear&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#year-httpsdocsvictoriametricscommetricsqlyear&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;year(q)&lt;/code&gt; is a &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#transform-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;transform function&lt;/a&gt;, which returns the year for every point of every time series returned by &lt;code&gt;q&lt;/code&gt;. It is expected that &lt;code&gt;q&lt;/code&gt; returns unix timestamps.&lt;/p&gt;
&lt;p&gt;Metric names are stripped from the resulting series. Add &lt;a href=&#34;https://docs.victoriametrics.com/metricsql/#keep_metric_names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;keep_metric_names&lt;/a&gt; modifier in order to keep metric names.&lt;/p&gt;
&lt;p&gt;This function is supported by PromQL.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>集群版本</title>
      <link>http://localhost:1313/docs/cluster/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/cluster/</guid>
      <description>
        
        
        &lt;h2&gt;架构概览&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;架构概览&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%9e%b6%e6%9e%84%e6%a6%82%e8%a7%88&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;VictoriaMetrics 集群版本由以下几个服务组成：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;vmstorage&lt;/code&gt; - 存储原始数据，并返回在给定时间范围内针对给定 Label 筛选器查询的数据。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vminsert&lt;/code&gt; - 接受摄入的数据，并 根据对度量名称及其所有标签的一致散列，将数据分散到 &lt;code&gt;vmstorage&lt;/code&gt; 节点中&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmselect&lt;/code&gt; - 通过从所有已配置的 &lt;code&gt;vmstorage&lt;/code&gt; 节点获取所需数据来执行接收到的查询请求。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;每项服务都可独立扩展，并可在最合适的硬件上运行。 &lt;code&gt;vmstorage&lt;/code&gt; 节点之间互不相识，互不通信，也不共享任何数据。 这是一种&lt;a href=&#34;https://en.wikipedia.org/wiki/Shared-nothing_architecture&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;共享无架构&lt;/a&gt; 。 它提高了集群的可用性，简化了集群维护和集群扩展。&lt;/p&gt;
&lt;h2&gt;多租户&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;多租户&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a4%9a%e7%a7%9f%e6%88%b7&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;VictoriaMetrics集群支持多个隔离的租户（即命名空间）。租户通过accountID或accountID:projectID进行标识，这些标识符被置于请求URL中。详情请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#url-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;关于VictoriaMetrics中租户的一些事实：&lt;/p&gt;
&lt;p&gt;每个accountID和projectID均由一个任意的32位整数标识，范围为&lt;code&gt;[0..2^32)&lt;/code&gt;。如果projectID缺失，则自动分配为0。预期其他关于租户的信息，如身份验证令牌、租户名称、限制、会计等，存储在一个独立的关系数据库中。该数据库必须由位于VictoriaMetrics集群前端的独立服务进行管理，例如&lt;a href=&#34;https://docs.victoriametrics.com/vmauth.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmauth&lt;/a&gt;或&lt;a href=&#34;https://docs.victoriametrics.com/vmgateway.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmgateway&lt;/a&gt;。如果您需要此类服务的协助，请联系我们。&lt;/p&gt;
&lt;p&gt;当第一个数据点被写入给定的租户时，租户会被自动创建。&lt;/p&gt;
&lt;p&gt;所有租户的数据均匀分布在可用的&lt;code&gt;vmstorage&lt;/code&gt;节点之间。这保证了当不同租户拥有不同数量的数据和不同的查询负载时，&lt;code&gt;vmstorage&lt;/code&gt;节点之间的负载也是均匀的。&lt;/p&gt;
&lt;p&gt;数据库的性能和资源使用情况并不取决于租户的数量，而主要取决于所有租户中活跃时间序列的总数。如果一个时间序列在过去的一小时中至少接收了一个样本，或者在过去的一小时中被查询访问过，那么它就被认为是活跃的。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics不支持在单一请求中查询多个租户。&lt;/p&gt;
&lt;p&gt;已注册租户的列表可以通过&lt;code&gt;http://&amp;lt;vmselect&amp;gt;:8481/admin/tenants&lt;/code&gt; URL获取。请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#url-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics通过指标公开了各种按租户划分的统计数据——请参阅&lt;a href=&#34;https://docs.victoriametrics.com/PerTenantStatistic.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;也可以看下&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#multitenancy-via-labels&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;通过 labels 实现多租户&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;通过 labels 实现多租户&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;通过-labels-实现多租户&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%80%9a%e8%bf%87-labels-%e5%ae%9e%e7%8e%b0%e5%a4%9a%e7%a7%9f%e6%88%b7&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;vminsert&lt;/code&gt;可以从多个租户通过一个特殊的&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#multitenancy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;多租户&lt;/a&gt;端点&lt;code&gt;http://vminsert:8480/insert/multitenant/&amp;lt;suffix&amp;gt;&lt;/code&gt;接收数据，其中可以替换为从此列表中获取数据的任何受支持的&lt;code&gt;&amp;lt;suffix&amp;gt;&lt;/code&gt;。在这种情况下，AccountID 和ProjectID是从传入样本的可选 &lt;code&gt;vm_account_id&lt;/code&gt; 和 &lt;code&gt;vm_project_id&lt;/code&gt; 标签中获取的。如果 vm_account_id 或 vm_project_id 标签缺失或无效，则相应的AccountID 或ProjectID 将设置为 0。在将样本转发到&lt;code&gt;vmstorage&lt;/code&gt;之前，会自动从样本中删除这些Label。例如，如果将以下样本写入 &lt;code&gt;http://vminsert:8480/insert/multitenant/prometheus/api/v1/write&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;http_requests_total{path=&amp;#34;/foo&amp;#34;,vm_account_id=&amp;#34;42&amp;#34;} 12
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;http_requests_total{path=&amp;#34;/bar&amp;#34;,vm_account_id=&amp;#34;7&amp;#34;,vm_project_id=&amp;#34;9&amp;#34;} 34&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;然后&lt;code&gt;http_requests_total｛path=“/foo”｝12&lt;/code&gt;将被存储在租户&lt;code&gt;accountID=42，projectID=0&lt;/code&gt;中，而&lt;code&gt;http_requests_total{path=“/bar”｝34&lt;/code&gt;将被存储到租户&lt;code&gt;accountID=7，projectID=9&lt;/code&gt;中。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vm_account_id&lt;/code&gt;和&lt;code&gt;vm_project_id&lt;/code&gt; labels 是在通过&lt;code&gt;-rebelConfig&lt;/code&gt;命令行标志应用 &lt;a href=&#34;https://docs.victoriametrics.com/relabeling.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;relabeling&lt;/a&gt; 集后提取的，因此可以在此阶段设置这些 label。&lt;/p&gt;
&lt;p&gt;安全提示：建议将对多租户端点的访问限制为仅限可信源，因为不可信源可能会通过向任意租户写入不需要的样本来破坏每个租户的数据。&lt;/p&gt;
&lt;h2&gt;二进制&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;二进制&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%ba%8c%e8%bf%9b%e5%88%b6&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;集群版本的编译二进制文件可在&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;发布页面&lt;/a&gt;的 assets 部分中找到。另请参阅包含单词“集群”的档案。&lt;/p&gt;
&lt;p&gt;集群版本的 Docker 镜像可在此处找到：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;vminsert&lt;/code&gt; - &lt;a href=&#34;https://hub.docker.com/r/victoriametrics/vminsert/tags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://hub.docker.com/r/victoriametrics/vminsert/tags&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmselect&lt;/code&gt; - &lt;a href=&#34;https://hub.docker.com/r/victoriametrics/vmselect/tags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://hub.docker.com/r/victoriametrics/vmselect/tags&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmstorage&lt;/code&gt; - &lt;a href=&#34;https://hub.docker.com/r/victoriametrics/vmstorage/tags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://hub.docker.com/r/victoriametrics/vmstorage/tags&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;源码构建&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;源码构建&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%ba%90%e7%a0%81%e6%9e%84%e5%bb%ba&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;集群版本的源代码可在&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/tree/cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cluster分支&lt;/a&gt;中获取。&lt;/p&gt;
&lt;h3&gt;生产环境构建&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;生产环境构建&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83%e6%9e%84%e5%bb%ba&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;无需在主机系统上安装 Go，因为二进制文件是在 &lt;a href=&#34;https://hub.docker.com/_/golang&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Go 的官方 docker 容器&lt;/a&gt;内构建的。这允许可重现的构建。因此，&lt;a href=&#34;https://docs.docker.com/install/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;安装 docker&lt;/a&gt; 并运行以下命令：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;make vminsert-prod vmselect-prod vmstorage-prod&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;生产二进制文件内置于静态链接二进制文件中。它们被放入带有 &lt;code&gt;-prod&lt;/code&gt; 后缀的 &lt;code&gt;bin&lt;/code&gt; 文件夹中：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ make vminsert-prod vmselect-prod vmstorage-prod
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ ls -1 bin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vminsert-prod
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vmselect-prod
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;vmstorage-prod&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h3&gt;开发环境构建&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;开发环境构建&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83%e6%9e%84%e5%bb%ba&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://golang.org/doc/install&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;安装Go&lt;/a&gt;，最低支持版本是 Go1.18。&lt;/li&gt;
&lt;li&gt;从&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;仓库根目录&lt;/a&gt;运行 &lt;code&gt;make&lt;/code&gt;。它应该构建 &lt;code&gt;vmstorage&lt;/code&gt;、&lt;code&gt;vmselect&lt;/code&gt; 和 &lt;code&gt;vminsert&lt;/code&gt; 二进制文件并将它们放入 bin 文件夹中。&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;构建 docker 镜像&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;构建-docker-镜像&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%9e%84%e5%bb%ba-docker-%e9%95%9c%e5%83%8f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;执行 &lt;code&gt;make package&lt;/code&gt;命令，会在本地构建下面几个 docker 镜像：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;victoriametrics/vminsert:&amp;lt;PKG_TAG&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;victoriametrics/vmselect:&amp;lt;PKG_TAG&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;victoriametrics/vmstorage:&amp;lt;PKG_TAG&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;PKG_TAG&amp;gt;&lt;/code&gt; 是根据&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;仓库中的源码&lt;/a&gt;自动生产的 image tag。&lt;code&gt;&amp;lt;PKG_TAG&amp;gt;&lt;/code&gt; 可以使用环境变量来指定，比如：&lt;code&gt;PKG_TAG=foobar make package&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;默认情况下，为了提高可调试性，image 是在 &lt;a href=&#34;https://hub.docker.com/_/scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;alpine image&lt;/a&gt; 之上构建的。可以通过 &amp;lt;ROOT_IMAGE&amp;gt; 环境变量设置，在任何其他基础镜像之上构建镜像。例如，以下命令在&lt;a href=&#34;https://hub.docker.com/_/scratch&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;临时镜像&lt;/a&gt;之上构建镜像：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ROOT_IMAGE=scratch make package&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;h2&gt;运维&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;运维&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e8%bf%90%e7%bb%b4&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h2&gt;部署集群&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;部署集群&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%83%a8%e7%bd%b2%e9%9b%86%e7%be%a4&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;一个集群至少包含下面几项：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一个 &lt;code&gt;vmstorage&lt;/code&gt; 节点，需要指定 &lt;code&gt;-retentionPeriod&lt;/code&gt; 和 &lt;code&gt;-storageDataPath&lt;/code&gt; 参数&lt;/li&gt;
&lt;li&gt;一个 &lt;code&gt;vminsert&lt;/code&gt; 节点，需要指定 &lt;code&gt;-storageNode=&amp;lt;vmstorage_host&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;一个 &lt;code&gt;vmselect&lt;/code&gt; 节点，需要指定 &lt;code&gt;-storageNode=&amp;lt;vmstorage_host&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;建议每个服务至少运行两个实例，以实现高可用性。在这种情况下，当单个节点暂时不可用时，群集仍可继续工作，其余节点可处理增加的工作量。在底层硬件损坏、软件升级、迁移或其他维护任务期间，节点可能会暂时不可用。&lt;/p&gt;
&lt;p&gt;最好运行许多小型 vmstorage 节点而不是少数大型 vmstorage 节点，因为当某些 vmstorage 节点暂时不可用时，这可以减少剩余 vmstorage 节点上的工作负载增加。&lt;/p&gt;
&lt;p&gt;必须在 vminsert 和 vmselect 节点前放置一个 http 负载均衡器，例如 &lt;a href=&#34;https://docs.victoriametrics.com/vmauth.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmauth&lt;/a&gt; 或 nginx。它必须根据 &lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#url-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;url 格式&lt;/a&gt;包含以下路由配置：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;带有 &lt;code&gt;/insert&lt;/code&gt; 前缀的请求必须被路由到 vminsert 实例的 8480 端口数。&lt;/li&gt;
&lt;li&gt;带有 &lt;code&gt;/select&lt;/code&gt; 前缀的请求必须被路由到 vmselect 实例的 8481 端口数。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;端口可以通过在相应节点上通过 &lt;code&gt;-httpListenAddr&lt;/code&gt; 参数来设定。&lt;/p&gt;
&lt;p&gt;建议为集群配置上&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#monitoring&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;监控&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;下面的工具可以简化集群部署：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/blob/master/deployment/docker/docker-compose-cluster.yml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;An example docker-compose config for VictoriaMetrics cluster&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/VictoriaMetrics/helm-charts&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Helm charts for VictoriaMetrics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/VictoriaMetrics/operator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes operator for VictoriaMetrics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可以在单个主机上手动设置一个玩具集群。在这种情况下，每个集群组件 - vminsert、vmselect 和 vmstorage - 必须使用 &lt;code&gt;-httpListenAddr&lt;/code&gt; 命令行参数指定不同的端口。此参数指定用于接受用于&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#monitoring&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;监控&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#profiling&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Profiling&lt;/a&gt; http 请求的 http 地址。&lt;code&gt;vmstorage&lt;/code&gt; 节点必须具有以下附加命令行参数的不同值，以防止资源使用冲突：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-storageDataPath&lt;/code&gt; - 每个 &lt;code&gt;vmstorage&lt;/code&gt; 实例都不行有一个专用的数据存储路径。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-vminsertAddr&lt;/code&gt; - 每个 &lt;code&gt;vmstorage&lt;/code&gt; 实例必须监听一个 tcp 地址，用来接受 vminsert 发送过来的数据。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-vmselectAddr&lt;/code&gt; - 每个 &lt;code&gt;vmstorage&lt;/code&gt; 实例必须监听一个 tcp 地址，用来处理 vmselect 发送过来的查询请求。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;环境变量&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;环境变量&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;所有的 VictoriaMetrics 组件都可以在命令行参数中使用&lt;code&gt;%{ENV_VAR}&lt;/code&gt;语法来引用环境变量。比如，如果 VictoriaMetrics 启动的时候存在环境变量&lt;code&gt;METRICS_AUTH_KEY=top-secret&lt;/code&gt; ，那么&lt;code&gt;-metricsAuthKey=%{METRICS_AUTH_KEY}&lt;/code&gt; 参数会自动转换成 &lt;code&gt;-metricsAuthKey=top-secret&lt;/code&gt;。这个转换是 VictoriaMetrics 内部自己完成的。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics 在启动的时候会递归式的对&lt;code&gt;%{ENV_VAR}&lt;/code&gt; 进行环境变量引用转换。比如，当存在环境变量 &lt;code&gt;BAR=a%{BAZ}&lt;/code&gt; 和 &lt;code&gt;BAZ=bc&lt;/code&gt;时，&lt;code&gt;FOO=%{BAR}&lt;/code&gt; 环境变量会被转换为 &lt;code&gt;FOO=abc&lt;/code&gt; 。&lt;/p&gt;
&lt;p&gt;所有的 VictoriaMetrics 组件都支持通过上述的环境变量方式来设置参数，前提是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;必须使用&lt;code&gt;-envflag.enable&lt;/code&gt; 参数开启该特性。&lt;/li&gt;
&lt;li&gt;命令行参数中的 &lt;code&gt;.&lt;/code&gt; 必须用下划线&lt;code&gt;_&lt;/code&gt;替换 (比如 &lt;code&gt;-insert.maxQueueDuration &amp;lt;duration&amp;gt;&lt;/code&gt; 对应的环境变量是 &lt;code&gt;insert_maxQueueDuration=&amp;lt;duration&amp;gt;&lt;/code&gt;)。&lt;/li&gt;
&lt;li&gt;对于可重复的指定的参数，可用逗号&lt;code&gt;,&lt;/code&gt;分隔符进行链接。 (比如 &lt;code&gt;-storageNode &amp;lt;nodeA&amp;gt; -storageNode &amp;lt;nodeB&amp;gt;&lt;/code&gt; 对应的环境变量是 &lt;code&gt;storageNode=&amp;lt;nodeA&amp;gt;,&amp;lt;nodeB&amp;gt;&lt;/code&gt;)。&lt;/li&gt;
&lt;li&gt;可以使用 &lt;code&gt;-envflag.prefix&lt;/code&gt; 参数来指定环境变量前缀，例如使用了 &lt;code&gt;-envflag.prefix=VM_&lt;/code&gt;参数，那么环境变量名就都必须以 &lt;code&gt;VM_&lt;/code&gt; 开头。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;vmstorage 自动发现&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;vmstorage-自动发现&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#vmstorage-%e8%87%aa%e5%8a%a8%e5%8f%91%e7%8e%b0&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;只有企业版支持&lt;code&gt;vminsert &lt;/code&gt;和&lt;code&gt;vmselect&lt;/code&gt;对&lt;code&gt; vmstorage&lt;/code&gt;实例自动服务发现，开源版的话需要进行二次开发。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics 的代码质量很高，所以二次开发也比较简单。只需要参考&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/blob/cluster/app/vminsert/netstorage/netstorage.go#L507&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;netstorage.Init&lt;/a&gt;实现即可，仅有 2 行代码。这里给出一个代码实现参考：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// ResetStorageNodes initializing new storageNodes by using new addrs, and replace the old global storageNodes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;func ResetStorageNodes(addrs []string, hashSeed uint64) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	if len(addrs) == 0 {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		return
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	prevSnb := getStorageNodesBucket()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	snb := initStorageNodes(addrs, hashSeed)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	setStorageNodesBucket(snb)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	if prevSnb != nil {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		go func() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			logger.Infof(&amp;#34;Storage nodes updated, stopping previous storage nodes&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			mustStopStorageNodes(prevSnb)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			logger.Infof(&amp;#34;Previous storage nodes already stopped&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;自己实现发现实例列表的库，在库里面调用该&lt;code&gt;ResetStorageNodes&lt;/code&gt;方法即可。&lt;/p&gt;
&lt;h2&gt;安全&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;安全&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%ae%89%e5%85%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;一般的安全建议：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;所有 VictoriaMetrics 集群组件都必须在受保护的私有网络中运行，并且不能被互联网等不受信任的网络直接访问。&lt;/li&gt;
&lt;li&gt;外部客户端必须通过身份验证代理（例如 &lt;a href=&#34;https://docs.victoriametrics.com/vmauth.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmauth&lt;/a&gt; 或 &lt;a href=&#34;https://docs.victoriametrics.com/vmgateway.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmgateway&lt;/a&gt;）访问 vminsert 和 vmselect。&lt;/li&gt;
&lt;li&gt;为了保护身份验证令牌不被窃听，身份验证代理必须仅通过 https 接受来自不受信任网络的身份验证令牌。&lt;/li&gt;
&lt;li&gt;建议对不同的&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#multitenancy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;租户&lt;/a&gt;使用不同的身份验证令牌，以减少某些租户的身份验证令牌被泄露时造成的潜在损害。&lt;/li&gt;
&lt;li&gt;在 &lt;code&gt;vminsert&lt;/code&gt; 和 &lt;code&gt;vmselect&lt;/code&gt; 之前配置身份验证代理时，最好使用允许的 API 接口白名单，同时禁止访问其他接口。这可以最大限度地减少攻击面。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;也可以参考 &lt;a href=&#34;https://docs.victoriametrics.com/#security&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;security recommendation for single-node VictoriaMetrics&lt;/a&gt; 和 &lt;a href=&#34;https://victoriametrics.com/security/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the general security page at VictoriaMetrics website&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;监控&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;监控&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e7%9b%91%e6%8e%a7&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;所有集群组件均在 &lt;code&gt;-httpListenAddr&lt;/code&gt; 命令行参数中设置的 TCP 端口上的 &lt;code&gt;/metrics&lt;/code&gt; 页面上以 Prometheus 兼容格式公开各种指标。默认情况下，使用以下 TCP 端口：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;vminsert&lt;/code&gt; - 8480&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmselect&lt;/code&gt; - 8481&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmstorage&lt;/code&gt; - 8482&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;建议使用 &lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent&lt;/a&gt; 或 Prometheus 以从所有集群组件中抓取 &lt;code&gt;/metrics&lt;/code&gt; 页面，这样就可以使用 VictoriaMetrics 集群的&lt;a href=&#34;https://grafana.com/grafana/dashboards/11176-victoriametrics-cluster/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;官方 Grafana 大盘&lt;/a&gt;或 &lt;a href=&#34;https://grafana.com/grafana/dashboards/11831&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics 集群大盘&lt;/a&gt;来监控和分析它们。这些仪表板上的图表包含有用的提示 - 将鼠标悬停在每个图表左上角的 &lt;code&gt;i&lt;/code&gt; 图标上即可阅读。&lt;/p&gt;
&lt;p&gt;建议通过&lt;a href=&#34;https://github.com/VictoriaMetrics/VictoriaMetrics/blob/cluster/deployment/docker/alerts.yml&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;此配置&lt;/a&gt;在 &lt;a href=&#34;https://docs.victoriametrics.com/vmalert.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmalert&lt;/a&gt; 或 Prometheus 中设置告警。更多详细信息请参阅文章 &lt;a href=&#34;https://victoriametrics.com/blog/victoriametrics-monitoring/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics 监控&lt;/a&gt;。 基数限制。&lt;/p&gt;
&lt;h2&gt;基数限制&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;基数限制&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%9f%ba%e6%95%b0%e9%99%90%e5%88%b6&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;vmstorage&lt;/code&gt; 实例可以通过下面的命令行来限制所有租户总共 series 的数量&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-storage.maxHourlySeries&lt;/code&gt; 限制最近1小时的&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-an-active-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;活跃时间序列&lt;/a&gt;的数量。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-storage.maxDailySeries&lt;/code&gt; 限制最近一天的&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-an-active-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;活跃时间序列&lt;/a&gt;的数量。这个限制可以用于限制天级别的 &lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;time series churn rate&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;请注意，这些限制是针对集群中的每个 vmstorage 实例的。因此，如果集群有 &lt;code&gt;N&lt;/code&gt; 个 &lt;code&gt;vmstorage&lt;/code&gt; 节点，则整个集群级限制将比每个 &lt;code&gt;vmstorage&lt;/code&gt; 限制大 &lt;code&gt;N&lt;/code&gt; 倍。&lt;/p&gt;
&lt;p&gt;关于更多的基数限制可以看&lt;a href=&#34;https://docs.victoriametrics.com/#cardinality-limiter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;问题排查&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;问题排查&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%97%ae%e9%a2%98%e6%8e%92%e6%9f%a5&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;请看&lt;a href=&#34;https://docs.victoriametrics.com/Troubleshooting.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;问题排查文档&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;只读模式&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;只读模式&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%8f%aa%e8%af%bb%e6%a8%a1%e5%bc%8f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;当 &lt;code&gt;-storageDataPath&lt;/code&gt; 指向的目录包含的可用空间少于 &lt;code&gt;-storage.minFreeDiskSpaceBytes&lt;/code&gt; 时，vmstorage 节点会自动切换到只读模式。&lt;code&gt;vminsert&lt;/code&gt; 节点停止向此类节点发送数据，并开始将数据重新路由到剩余的 vmstorage 节点。&lt;/p&gt;
&lt;p&gt;当 &lt;code&gt;vmstorage&lt;/code&gt; 进入只读模式时，它会将 http://vmstorage:8482/metrics 上的 &lt;code&gt;vm_storage_is_read_only&lt;/code&gt; 指标设置为 &lt;code&gt;1&lt;/code&gt;。当 &lt;code&gt;vmstorage&lt;/code&gt; 未处于只读模式时，该指标值为 &lt;code&gt;0&lt;/code&gt;。&lt;/p&gt;
&lt;h2&gt;API接口&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;api接口&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#api%e6%8e%a5%e5%8f%a3&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;集群版本和&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;单机版&lt;/a&gt;的API接口主要区别是数据的读取和写入是由独立组件完成的，而且也有了租户的支持。集群版本也支持&lt;code&gt;/prometheus/api/v1&lt;/code&gt;来接收 &lt;code&gt;jsonl&lt;/code&gt;, &lt;code&gt;csv&lt;/code&gt;, &lt;code&gt;native&lt;/code&gt; 和 &lt;code&gt;prometheus&lt;/code&gt;数据格式，而不仅仅是&lt;code&gt;prometheus&lt;/code&gt;数据格式。可以在&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这里&lt;/a&gt;查看VictoriaMetrics的API的使用范例。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;用于数据写入的 URLs 是：&lt;code&gt;http://&amp;lt;vminsert&amp;gt;:8480/insert/&amp;lt;accountID&amp;gt;/&amp;lt;suffix&amp;gt;&lt;/code&gt;，其中：&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;accountID&amp;gt;&lt;/code&gt; 是一个任意的32位数字，用来表示数据写入的空间（即租户）。也可以设置成&lt;code&gt;accountID:projectID&lt;/code&gt;格式，其中 &lt;code&gt;projectID&lt;/code&gt; 也是一个任意的32位数字。如果 &lt;code&gt;projectID&lt;/code&gt; 没有指定,则默认是&lt;code&gt;0&lt;/code&gt;。更多信息可以看&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#multitenancy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;多租户文档&lt;/a&gt;。 这里的&lt;code&gt;&amp;lt;accountID&amp;gt;&lt;/code&gt; 可以使用字符串 &lt;code&gt;multitenant&lt;/code&gt; ， 比如 &lt;code&gt;http://&amp;lt;vminsert&amp;gt;:8480/insert/multitenant/&amp;lt;suffix&amp;gt;&lt;/code&gt;，该 URL 接受到的数据会将数据的 &lt;code&gt;vm_account_id&lt;/code&gt; 和 &lt;code&gt;vm_project_id&lt;/code&gt; label 视为租户信息。更多信息请看&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#multitenancy-via-labels&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;通过label实现多租户&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;suffix&amp;gt;&lt;/code&gt; 可以是以下这些内容：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;prometheus&lt;/code&gt; 和 &lt;code&gt;prometheus/api/v1/write&lt;/code&gt; - 用来写入 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/configuration/configuration/#remote_write&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus Remote Write&lt;/a&gt; 数据协议的接口。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;prometheus/api/v1/import&lt;/code&gt; - 用来导入通过&lt;code&gt;vmselect&lt;/code&gt;的 &lt;code&gt;api/v1/export&lt;/code&gt; 接口导出来的数据（见下文）, 是 JSON line 的格式.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;prometheus/api/v1/import/native&lt;/code&gt; - 用来导入通过vmselect的&lt;code&gt;api/v1/export/native&lt;/code&gt; 接口导出的数据（见下文）。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;prometheus/api/v1/import/csv&lt;/code&gt; - 用来导入 CSV 数据。详细信息见&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-csv-data&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;prometheus/api/v1/import/prometheus&lt;/code&gt; - 用来导入 &lt;a href=&#34;https://github.com/prometheus/docs/blob/master/content/docs/instrumenting/exposition_formats.md#text-based-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus text exposition&lt;/a&gt; 或 &lt;a href=&#34;https://github.com/OpenObservability/OpenMetrics/blob/master/specification/OpenMetrics.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenMetrics&lt;/a&gt;格式的数据。该接口也支持 &lt;a href=&#34;https://github.com/prometheus/pushgateway#url&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Pushgateway 协议&lt;/a&gt;。 更多信息看&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-data-in-prometheus-exposition-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;datadog/api/v1/series&lt;/code&gt; - 用来写入 &lt;a href=&#34;https://docs.datadoghq.com/api/latest/metrics/#submit-metrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DataDog submit metrics&lt;/a&gt;接口。 更多信息见&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-send-data-from-datadog-agent&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;influx/write&lt;/code&gt; and &lt;code&gt;influx/api/v2/write&lt;/code&gt; - 用来写入 &lt;a href=&#34;https://docs.influxdata.com/influxdb/v1.7/write_protocols/line_protocol_tutorial/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;InfluxDB line protocol&lt;/a&gt;的数据，更多信息见&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-send-data-from-influxdb-compatible-agents-such-as-telegraf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;opentsdb/api/put&lt;/code&gt; - 用来处理 &lt;a href=&#34;http://opentsdb.net/docs/build/html/api_http/put.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenTSDB HTTP /api/put 请求&lt;/a&gt;。这个接口默认是关闭的。他是通过一个独立的 TCP 地址暴露的，改地址可通过&lt;code&gt;-opentsdbHTTPListenAddr&lt;/code&gt; 命令行参数指定。更多信息见&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#sending-opentsdb-data-via-http-apiput-requests&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus 查询 API&lt;/a&gt;: &lt;code&gt;http://&amp;lt;vmselect&amp;gt;:8481/select/&amp;lt;accountID&amp;gt;/prometheus/&amp;lt;suffix&amp;gt;&lt;/code&gt;, 其中:
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;accountID&amp;gt;&lt;/code&gt; 是一个任意32位数字，用来标识查询的空间（即租户）。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;suffix&amp;gt;&lt;/code&gt; 可以是一下的内容：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;api/v1/query&lt;/code&gt; - 执行 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#instant-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PromQL instant&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/query_range&lt;/code&gt; - 执行 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#range-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PromQL range 查询&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/series&lt;/code&gt; - 执行 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#finding-series-by-label-matchers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series 查询&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/labels&lt;/code&gt; - 返回 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#getting-label-names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label 名称列表&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/label/&amp;lt;label_name&amp;gt;/values&lt;/code&gt; - 返回指定 &lt;code&gt;&amp;lt;label_name&amp;gt;&lt;/code&gt; 的所有值，参考&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#querying-label-values&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这个 API&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;federate&lt;/code&gt; - 返回 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/federation/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;federated metrics&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/export&lt;/code&gt; - 导出 JSON line 格式的原始数据，更多信息看&lt;a href=&#34;https://medium.com/@valyala/analyzing-prometheus-data-with-external-tools-5f3e5e147639&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这篇文章&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/export/native&lt;/code&gt; - 导出原生二进制格式的原始数据，该数据可以通过另一个接口&lt;code&gt;api/v1/import/native&lt;/code&gt;导入到 VictoriaMetrics (见上文).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/export/csv&lt;/code&gt; - 导出 CSV 格式原始数据。它可以使用另外一个接口 &lt;code&gt;api/v1/import/csv&lt;/code&gt; 导入到 VictoriaMetrics（见上文）。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/series/count&lt;/code&gt; - 返回 series 的总数。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/status/tsdb&lt;/code&gt; - 返回时序数据的统计信息。更多详细信息见&lt;a href=&#34;https://docs.victoriametrics.com/#tsdb-stats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/status/active_queries&lt;/code&gt; - 返回当前活跃的查询请求。逐一每个 &lt;code&gt;vmselect&lt;/code&gt; 实例都有独立的活跃查询列表。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/status/top_queries&lt;/code&gt; - 返回执行频率最高以及查询耗时最长的查询列表。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;metric-relabel-debug&lt;/code&gt; - 用于对 &lt;a href=&#34;https://docs.victoriametrics.com/relabeling.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;relabeling 规则&lt;/a&gt; Debug。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://graphite-api.readthedocs.io/en/latest/api.html#the-metrics-api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Graphite Metrics API&lt;/a&gt;：&lt;code&gt;http://&amp;lt;vmselect&amp;gt;:8481/select/&amp;lt;accountID&amp;gt;/graphite/&amp;lt;suffix&amp;gt;&lt;/code&gt;, 其中:
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;accountID&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;是一个任意32位数字，用来标识查询的空间（即租户）。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;suffix&amp;gt;&lt;/code&gt; 可以是一下的内容：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;render&lt;/code&gt; - 实现 Graphite Render API. 看 &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/render_api.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;metrics/find&lt;/code&gt; - 搜索 Graphite metrics. See &lt;a href=&#34;https://graphite-api.readthedocs.io/en/latest/api.html#metrics-find&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;metrics/expand&lt;/code&gt; - 扩展 Graphite metrics. See &lt;a href=&#34;https://graphite-api.readthedocs.io/en/latest/api.html#metrics-expand&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;metrics/index.json&lt;/code&gt; - returns 所有的 names. See &lt;a href=&#34;https://graphite-api.readthedocs.io/en/latest/api.html#metrics-index-json&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/tagSeries&lt;/code&gt; - 注册 time series. See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#adding-series-to-the-tagdb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/tagMultiSeries&lt;/code&gt; - 批量注册 time series. See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#adding-series-to-the-tagdb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags&lt;/code&gt; - 返回 tag 名称列表. See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#exploring-tags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/&amp;lt;tag_name&amp;gt;&lt;/code&gt; - 返回指定 &lt;code&gt;&amp;lt;tag_name&amp;gt;&lt;/code&gt;的值列表 See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#exploring-tags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/findSeries&lt;/code&gt; - 返回匹配&lt;code&gt;expr&lt;/code&gt;的 series，&lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#exploring-tags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/autoComplete/tags&lt;/code&gt; - 返回匹配 &lt;code&gt;tagPrefix&lt;/code&gt; 和/或 &lt;code&gt;expr&lt;/code&gt;的tag名称列表。 See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#auto-complete-support&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/autoComplete/values&lt;/code&gt; - 返回匹配 &lt;code&gt;valuePrefix&lt;/code&gt; 和/或 &lt;code&gt;expr&lt;/code&gt; tag值列表 See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#auto-complete-support&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/delSeries&lt;/code&gt; - deletes series matching the given &lt;code&gt;path&lt;/code&gt;. See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#removing-series-from-the-tagdb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;基础的 Web UI: &lt;code&gt;http://&amp;lt;vmselect&amp;gt;:8481/select/&amp;lt;accountID&amp;gt;/vmui/&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;统计所有租户的查询：&lt;code&gt;http://&amp;lt;vmselect&amp;gt;:8481/api/v1/status/top_queries&lt;/code&gt;。它会列出请求最频繁，以及执行时间最长的查询列表。&lt;/li&gt;
&lt;li&gt;删除时间序列：&lt;code&gt;http://&amp;lt;vmselect&amp;gt;:8481/delete/&amp;lt;accountID&amp;gt;/prometheus/api/v1/admin/tsdb/delete_series?match[]=&amp;lt;timeseries_selector_for_delete&amp;gt;&lt;/code&gt;。 请注意，&lt;code&gt;delete_series&lt;/code&gt; 处理程序应仅在特殊情况下使用，例如删除意外提取的错误时间序列。它不应定期使用，因为它会带来额外的系统开销。&lt;/li&gt;
&lt;li&gt;列出在给定时间范围内已提取数据的租户： &lt;code&gt;http://&amp;lt;vmselect&amp;gt;:8481/admin/tenants?start=...&amp;amp;end=...&lt;/code&gt;。&lt;code&gt;start&lt;/code&gt; 和 &lt;code&gt;end&lt;/code&gt; 参数是可选的。默认返回 VictoriaMetrics 集群中至少包含一条数据的租户列表。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/vmalert.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmalerts&lt;/a&gt; UI 界面： &lt;code&gt;http://&amp;lt;vmselect&amp;gt;:8481/select/&amp;lt;accountID&amp;gt;/prometheus/vmalert/&lt;/code&gt;。这个 URL works only 只有在指定了 &lt;code&gt;-vmalert.proxyURL&lt;/code&gt; 参数时才有效。关于 vmalert 的跟多内容&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#vmalert&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;参考这里&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmstorage&lt;/code&gt; 在 8482 端口上提供了如下接口：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/internal/force_merge&lt;/code&gt; - 强制启动 vmstorage 实例的&lt;a href=&#34;https://docs.victoriametrics.com/#forced-merge&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;数据合并压缩&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/snapshot/create&lt;/code&gt; - 创建&lt;a href=&#34;https://medium.com/@valyala/how-victoriametrics-makes-instant-snapshots-for-multi-terabyte-time-series-data-e1f3fb0e0282&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;实例快照&lt;/a&gt;，可用于后台备份。快照在&lt;code&gt;&amp;lt;storageDataPath&amp;gt;/snapshots&lt;/code&gt; 文件夹中创建，其中&lt;code&gt;&amp;lt;storageDataPath&amp;gt;&lt;/code&gt;是通过相应的命令行参数指定。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/snapshot/list&lt;/code&gt; - 列出可用的快照。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/snapshot/delete?snapshot=&amp;lt;id&amp;gt;&lt;/code&gt; - 删除给定的快照。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/snapshot/delete_all&lt;/code&gt; - 删除所有快照。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;快照可以在每个 &lt;code&gt;vmstorage&lt;/code&gt; 节点上独立创建。无需在 &lt;code&gt;vmstorage&lt;/code&gt; 节点之间同步快照的创建。&lt;/p&gt;
&lt;h2&gt;集群扩缩容&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;集群扩缩容&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%9b%86%e7%be%a4%e6%89%a9%e7%bc%a9%e5%ae%b9&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;集群的性能和容量有两种提升方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;为先有的实例节点增加计算资源（CPU，内存，磁盘IO，磁盘空间，网络带宽），即垂直扩容。&lt;/li&gt;
&lt;li&gt;为集群增加更多的实例节点，即水平扩容。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一些扩容建议：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;向现有 &lt;code&gt;vmselect&lt;/code&gt; 节点添加更多 CPU 和 RAM 可提高重度查询的性能，这些查询会处理大量时间序列和大量原始样本。请&lt;a href=&#34;https://valyala.medium.com/how-to-optimize-promql-and-metricsql-queries-85a1b75bf986&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;参阅本文&lt;/a&gt;，了解如何检测和优化重度查询。&lt;/li&gt;
&lt;li&gt;添加更多 &lt;code&gt;vmstorage&lt;/code&gt; 节点以增加集群可以处理的&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-an-active-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;活动时间序列&lt;/a&gt;的数量。这还会提高&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高流失率&lt;/a&gt;时间序列的查询性能。集群稳定性也会随着 &lt;code&gt;vmstorage&lt;/code&gt; 节点数量的增加而提高，因为当某些 vmstorage 节点不可用时，活动 &lt;code&gt;vmstorage&lt;/code&gt; 节点需要处理的额外工作负载较少。&lt;/li&gt;
&lt;li&gt;向现有 &lt;code&gt;vmstorage&lt;/code&gt; 节点添加更多 CPU 和 RAM 会增加集群可以处理的&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-an-active-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;活动时间序列&lt;/a&gt;的数量。与向现有 &lt;code&gt;vmstorage&lt;/code&gt; 节点添加更多 CPU 和 RAM 相比，添加更多 &lt;code&gt;vmstorage&lt;/code&gt; 节点是更好的选择，因为 &lt;code&gt;vmstorage&lt;/code&gt; 节点数量越多，集群稳定性就越高，并且会提高&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高流失率&lt;/a&gt;时间序列的查询性能。&lt;/li&gt;
&lt;li&gt;添加更多 &lt;code&gt;vminsert&lt;/code&gt; 节点会增加最大可能的数据提取速度，因为提取的数据可能会在更多数量的 &lt;code&gt;vminsert&lt;/code&gt; 节点之间分配。&lt;/li&gt;
&lt;li&gt;添加更多 &lt;code&gt;vmselect&lt;/code&gt; 节点会增加最大可能的查询率，因为传入的并发请求可能会在更多 &lt;code&gt;vmselect&lt;/code&gt; 节点之间分配。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;新增 &lt;code&gt;vmstorage&lt;/code&gt; 节点的步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;启动具有与集群中现有节点相同的 &lt;code&gt;-retentionPeriod&lt;/code&gt; 的新 &lt;code&gt;vmstorage&lt;/code&gt; 节点。&lt;/li&gt;
&lt;li&gt;平滑启动 vmselect 节点，并在&lt;code&gt;-storageNode&lt;/code&gt; 参数中把 &lt;code&gt;&amp;lt;new_vmstorage_host&amp;gt;&lt;/code&gt;加上。&lt;/li&gt;
&lt;li&gt;平滑启动 vminsert 节点，并在&lt;code&gt;-storageNode&lt;/code&gt; 参数中把 &lt;code&gt;&amp;lt;new_vmstorage_host&amp;gt;&lt;/code&gt;加上。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;升级集群节点&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;升级集群节点&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%8d%87%e7%ba%a7%e9%9b%86%e7%be%a4%e8%8a%82%e7%82%b9&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;所有节点类型 - &lt;code&gt;vminsert&lt;/code&gt;、&lt;code&gt;vmselect&lt;/code&gt; 和 &lt;code&gt;vmstorage&lt;/code&gt; - 都可以通过启停进行更新。向相应进程发送 &lt;code&gt;SIGINT&lt;/code&gt; 信号，等待其退出，然后使用新配置启动新版本。&lt;/p&gt;
&lt;p&gt;存在以下集群更新/升级方法：&lt;/p&gt;
&lt;h3&gt;无停机策略&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;无停机策略&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%97%a0%e5%81%9c%e6%9c%ba%e7%ad%96%e7%95%a5&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;使用更新的配置/升级的二进制文件逐个重新启动集群中的每个节点。&lt;/p&gt;
&lt;p&gt;建议按以下顺序重新启动节点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;重启 &lt;code&gt;vmstorage&lt;/code&gt; nodes.&lt;/li&gt;
&lt;li&gt;重启 &lt;code&gt;vminsert&lt;/code&gt; nodes.&lt;/li&gt;
&lt;li&gt;重启 &lt;code&gt;vmselect&lt;/code&gt; nodes.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;如果满足以下条件，此策略允许在不停机的情况下升级集群：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;集群至少有两个及以上实例（每种类型都有 &lt;code&gt;vminsert&lt;/code&gt;、&lt;code&gt;vmselect&lt;/code&gt; 和 &lt;code&gt;vmstorage&lt;/code&gt;），因此当单个节点在重启期间暂时不可用时，其它实例可以继续接受新数据并处理传入请求。有关详细信息，请参阅&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#cluster-availability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群可用性&lt;/a&gt;文档。&lt;/li&gt;
&lt;li&gt;当任何类型的单个节点（&lt;code&gt;vminsert&lt;/code&gt;、&lt;code&gt;vmselect&lt;/code&gt; 或 &lt;code&gt;vmstorage&lt;/code&gt;）在重启期间暂时不可用时，集群具有足够的计算资源（CPU、RAM、网络带宽、磁盘 IO）来处理当前工作负载。&lt;/li&gt;
&lt;li&gt;更新后的的二进制文件与集群中的其余组件兼容。请参阅 &lt;a href=&#34;https://docs.victoriametrics.com/CHANGELOG.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CHANGELOG&lt;/a&gt; 了解不同版本之间的兼容性说明。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;只要有一个条件不满足，则滚动重启可能会导致在升级期间集群不可用。在这种情况下，建议采用以下策略。&lt;/p&gt;
&lt;h3&gt;最短停机策略&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;最短停机策略&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%9c%80%e7%9f%ad%e5%81%9c%e6%9c%ba%e7%ad%96%e7%95%a5&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;并发停止所有的 &lt;code&gt;vminsert&lt;/code&gt; 和 &lt;code&gt;vmselect&lt;/code&gt; 实例。&lt;/li&gt;
&lt;li&gt;并发重启所有的&lt;code&gt;vmstorage&lt;/code&gt; 实例。&lt;/li&gt;
&lt;li&gt;并发重启所有的&lt;code&gt;vminsert&lt;/code&gt; 和 &lt;code&gt;vmselect&lt;/code&gt; 实例。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;执行上述步骤时，集群无法进行数据提取和查询。通过在上述每个步骤中并行重启集群节点，可以最大限度地减少停机时间。与无停机策略相比，最短停机时间策略具有以下优势：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当以前的版本与新版本不兼容时，它允许以最小的中断完成升级。&lt;/li&gt;
&lt;li&gt;当集群没有足够的计算资源（CPU、RAM、磁盘 IO、网络带宽）进行滚动升级时，它允许以最小的中断完成版本升级。&lt;/li&gt;
&lt;li&gt;对于具有大量节点的集群或具有大量 vmstorage 节点的集群，它允许最短升级的持续时间，因为它需要很长时间才能平滑重启。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;集群可用性&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;集群可用性&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%9b%86%e7%be%a4%e5%8f%af%e7%94%a8%e6%80%a7&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;VictoriaMetrics 集群架构优先考虑可用性而不是数据一致性。这意味着，如果集群的某些组件暂时不可用，集群仍可用于数据提取和数据查询。&lt;/p&gt;
&lt;p&gt;如果满足以下条件，VictoriaMetrics 集群将保持可用：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HTTP 负载平衡器必须停止将请求路由到不可用的 vminsert 和 vmselect 节点（&lt;a href=&#34;https://docs.victoriametrics.com/vmauth.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmauth&lt;/a&gt; 停止将请求路由到不可用的节点）。&lt;/li&gt;
&lt;li&gt;集群中必须至少有一个 vminsert 节点可用于处理数据提取工作负载。其余可用的的 vminsert 节点必须具有足够的计算能力（CPU、RAM、网络带宽）来处理当前的数据写入工作负载。如果其余可用的 vminsert 节点没有足够的资源来处理数据提取工作负载，则数据提取期间可能会出现任意延迟。有关更多详细信息，请参阅&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#capacity-planning&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;容量规划&lt;/a&gt;和&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#cluster-resizing-and-scalability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群扩缩容&lt;/a&gt;文档。&lt;/li&gt;
&lt;li&gt;集群中必须至少有一个 vmselect 节点可用于处理查询工作负载。其余活动的 vmselect 节点必须具有足够的计算能力（CPU、RAM、网络带宽、磁盘 IO）来处理当前的查询工作负载。如果剩余的活动 vmselect 节点没有足够的资源来处理查询工作负载，则在查询处理期间可能会发生任意故障和延迟。有关更多详细信息，请参阅&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#capacity-planning&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;容量规划&lt;/a&gt;和&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#cluster-resizing-and-scalability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群扩缩容&lt;/a&gt;文档。&lt;/li&gt;
&lt;li&gt;集群中必须至少有一个 vmstorage 节点可用，以接受新提取的数据和处理传入的查询。剩余的活动 vmstorage 节点必须具有足够的计算能力（CPU、RAM、网络带宽、磁盘 IO、可用磁盘空间）来处理当前工作负载。如果剩余的活动 vmstorage 节点没有足够的资源来处理查询工作负载，则在数据提取和查询处理期间可能会发生任意故障和延迟。有关更多详细信息，请参阅&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#capacity-planning&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;容量规划&lt;/a&gt;和&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#cluster-resizing-and-scalability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群扩缩容&lt;/a&gt;文档。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;当某些 vmstorage 节点不可用时，集群的工作方式如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;vminsert 将新写入的数据从不可用的 vmstorage 节点重新路由到剩余的健康 vmstorage 节点。如果健康的 vmstorage 节点具有足够的 CPU、RAM、磁盘 IO 和网络带宽来处理新增加的数据量，就可确保新写入的数据得以正确保存。vminsert 会在健康的 vmstorage 节点之间均匀分布额外的数据，以便均匀分布这些节点上增加的负载。&lt;/li&gt;
&lt;li&gt;只要有一个 vmstorage 节点可用，vmselect 将继续提供查询。它会将其余健康 vmstorage 节点提供的查询的响应标记为部分响应，因为此类响应可能会丢失存储在暂时不可用的 vmstorage 节点上的历史数据。每个部分 JSON 响应都包含&lt;code&gt;“isPartial”：true&lt;/code&gt; 选项。如果您更喜欢一致性而不是可用性，请使用 &lt;code&gt;-search.denyPartialResponse&lt;/code&gt; 命令行参数运行 vmselect 节点。在这种情况下，只要有一个 vmstorage 节点不可用，vmselect 将返回错误。另一个选项是在vmselect的查询请求中加上&lt;code&gt;deny_partial_response=1&lt;/code&gt; 参数。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;vmselect 还接受 &lt;code&gt;-replicationFactor=N&lt;/code&gt; 命令行参数。此参数表示 vmselect 在查询期间如果少于 &lt;code&gt;-replicationFactor&lt;/code&gt; 个 vmstorage 节点不可用则返回完整响应，因为它假定剩余的 vmstorage 节点包含完整数据。有关详细信息，请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#replication-and-data-safety&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;vmselect 不会为返回原始数据点的 API 处理程序提供部分响应 - &lt;code&gt;/api/v1/export*&lt;/code&gt;&lt;a href=&#34;https://docs.victoriametrics.com/#how-to-export-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;接口&lt;/a&gt;，因为用户通常希望这些数据始终是完整的。&lt;/p&gt;
&lt;p&gt;数据副本可用于提高存储耐用性。有关详细信息，请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#replication-and-data-safety&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;容量规划&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;容量规划&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%ae%b9%e9%87%8f%e8%a7%84%e5%88%92&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;根据我们的&lt;a href=&#34;https://docs.victoriametrics.com/CaseStudies.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;案例研究&lt;/a&gt;，与竞争解决方案（Prometheus、Thanos、Cortex、TimescaleDB、InfluxDB、QuestDB、M3DB）相比，VictoriaMetrics 在生产工作负载上使用的 CPU、RAM 和存储空间更少。&lt;/p&gt;
&lt;p&gt;每种节点类型（&lt;code&gt;vminsert&lt;/code&gt;、&lt;code&gt;vmselect&lt;/code&gt; 和 &lt;code&gt;vmstorage&lt;/code&gt;）都可以在最合适的硬件上运行。集群容量随可用资源线性扩展。每种节点类型所需的 CPU 和 RAM 数量高度依赖于工作负载 - &lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-an-active-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;活动时间序列&lt;/a&gt;的数量、&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;序列流失率&lt;/a&gt;、查询类型、查询 qps 等。建议为您的生产工作负载设置一个测试 VictoriaMetrics 集群，并迭代扩展每个节点的资源和每个节点类型的节点数量，直到集群稳定下来。建议为&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#monitoring&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群设置监控&lt;/a&gt;。它有助于确定集群设置中的瓶颈。还建议遵循&lt;a href=&#34;https://docs.victoriametrics.com/#troubleshooting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;故障排除&lt;/a&gt;文档。&lt;/p&gt;
&lt;p&gt;给定保留期所需的存储空间（保留期通过 vmstorage 上的 &lt;code&gt;-retentionPeriod&lt;/code&gt; 命令行标志设置）可以根据测试运行中的磁盘空间使用情况推断出来。例如，如果在生产工作负载上进行一天的测试运行后存储空间使用量为 10GB，那么在 &lt;code&gt;-retentionPeriod=100d&lt;/code&gt;（100 天保留期）的情况下，至少需要 &lt;code&gt;10GB*100=1TB&lt;/code&gt; 的磁盘空间。可以使用 VictoriaMetrics 集群的&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#monitoring&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;官方 Grafana 大盘&lt;/a&gt;监控存储空间使用情况。&lt;/p&gt;
&lt;p&gt;建议保留以下数量的备用资源：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;所有节点类型均有 50% 的可用 RAM，用于降低工作负载暂时激增期间出现 OOM（内存不足）崩溃和速度减速的概率。&lt;/li&gt;
&lt;li&gt;所有节点类型均有 50% 的备用 CPU，以降低工作负载临时激增期间出现速度变慢的可能性。&lt;/li&gt;
&lt;li&gt;vmstorage 节点的 &lt;code&gt;-storageDataPath&lt;/code&gt; 命令行参数指向的目录中至少有 20% 的可用存储空间。另请参阅 vmstorage 的 &lt;code&gt;-storage.minFreeDiskSpaceBytes&lt;/code&gt; 命令行&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#list-of-command-line-flags-for-vmstorage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;参数描述&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;VictoriaMetrics 集群的一些容量规划技巧：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#replication-and-data-safety&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;多副本&lt;/a&gt;可将集群所需的资源量增加多达 &lt;code&gt;N&lt;/code&gt; 倍，其中 &lt;code&gt;N&lt;/code&gt; 是副本数。这是因为 &lt;code&gt;vminsert&lt;/code&gt; 将每个摄取样本的 N 个副本存储在不同的 &lt;code&gt;vmstorage&lt;/code&gt; 节点上。查询期间，&lt;code&gt;vmselect&lt;/code&gt; 会对这些副本进行重复数据删除。数据持久性最具成本和性能的解决方案是依赖高可用磁盘（例如 &lt;a href=&#34;https://cloud.google.com/compute/docs/disks#pdspecs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Compute 持久磁盘&lt;/a&gt;），而不是使用 &lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#replication-and-data-safety&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;VictoriaMetrics 级别的复制机制&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;建议构建一个由众多小型 vmstorage 节点组成的集群，而非少数大型 vmstorage 节点。这样，在进行维护操作（如升级、配置更改或迁移）时，若部分 vmstorage 节点临时离线，集群更有可能保持高可用性和稳定性。举例来说，若一个集群拥有10个vmstorage节点，其中一个节点临时不可用，其余9个节点的负载将增加约11%（即1/9）。而如果集群仅由3个vmstorage节点构成，单个节点离线时，其余两个节点的负载将激增50%（即1/2）。在这种情况下，剩余节点可能无法承受额外的工作负载，导致集群过载，进而影响可用性和稳定性。&lt;/li&gt;
&lt;li&gt;增加每个vmstorage节点的RAM和CPU资源，或者添加新的vmstorage节点，可以提高集群对&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-an-active-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;活跃时间序列&lt;/a&gt;的处理能力。&lt;/li&gt;
&lt;li&gt;提高每个vmselect节点的CPU资源可以降低查询延迟，因为每个传入查询都由单个vmselect节点处理。vmselect节点的可用CPU核心数越多，其处理查询中涉及的时间序列的性能就越好。&lt;/li&gt;
&lt;li&gt;如果集群需要高速处理传入查询，可以通过添加更多vmselect节点来提高其处理能力，这样传入查询就可以分散到更多的vmselect节点上。&lt;/li&gt;
&lt;li&gt;默认情况下，vminsert会压缩发送给vmstorage的数据，以减少网络带宽使用。压缩过程会消耗vminsert节点额外的CPU资源。如果vminsert节点的CPU资源有限，可以通过在vminsert节点上传递&lt;code&gt;-rpc.disableCompression&lt;/code&gt;命令行标志来禁用压缩。&lt;/li&gt;
&lt;li&gt;默认情况下，vmstorage在查询期间会压缩发送给vmselect的数据，以减少网络带宽使用。压缩过程会消耗vmstorage节点额外的CPU资源。如果vmstorage节点的CPU资源有限，可以通过在vmstorage节点上传递&lt;code&gt;-rpc.disableCompression&lt;/code&gt;命令行参数来禁用压缩。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;也可以参阅&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#resource-usage-limits&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;资源使用限制文档&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;资源使用限制&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;资源使用限制&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e8%b5%84%e6%ba%90%e4%bd%bf%e7%94%a8%e9%99%90%e5%88%b6&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;默认情况下，VictoriaMetrics 的集群组件会根据典型工作负载的最佳资源使用情况进行调整。某些工作负载可能需要细粒度的资源使用限制。在这种情况下，以下命令行参数可能会有用：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-memory.allowedPercent&lt;/code&gt; 和 &lt;code&gt;-memory.allowedBytes&lt;/code&gt; 限制所有的 VictoriaMetrics 集群组件里的各种内部 cache 会使用的内存用量 —— &lt;code&gt;vminsert&lt;/code&gt;, &lt;code&gt;vmselect&lt;/code&gt; 和 &lt;code&gt;vmstorage&lt;/code&gt;。请注意，VictoriaMetrics 组件可能会占用更多内存，因为这些参数并不限制其他地方消耗的内存，比如可能是查询请求消耗的。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxMemoryPerQuery&lt;/code&gt; 限制 vmselect 实例执行一次查询请求所使用的内存总量。申请超限的内存会被拒绝。查询大量时间序列的重查询，可能会超查询内存限制一点点。并发查询的内存总限制差不多等于&lt;code&gt;-search.maxMemoryPerQuery&lt;/code&gt; 和 &lt;code&gt;-search.maxConcurrentRequests&lt;/code&gt; 的乘机。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmselect&lt;/code&gt;组件的&lt;code&gt;-search.maxUniqueTimeseries&lt;/code&gt; 参数限制了单词查询能够查询并计算多少个独立时间序列。&lt;code&gt;vmselect&lt;/code&gt; 会将该限制参数传递给 &lt;code&gt;vmstorage&lt;/code&gt; 组件，&lt;code&gt;vmstorage&lt;/code&gt; 在内存中记录每个查询请求检索到的时间序列的元信息，并消耗一定的 CPU 来处理检索到的时间序列。这意味着在 &lt;code&gt;vmstorage&lt;/code&gt; 中，单个查询可使用的最大内存使用量和 CPU 使用量与 &lt;code&gt;-search.maxUniqueTimeseries&lt;/code&gt; 成比例。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmselect&lt;/code&gt;的&lt;code&gt;-search.maxQueryDuration&lt;/code&gt; 参数限制了一个查询的执行时间。如果一个查询耗时超出了指定的限制，就会被取消执行。这可以使&lt;code&gt;vmselect&lt;/code&gt; 和 &lt;code&gt;vmstorage&lt;/code&gt; 遇到非预期的重查询时，避免 CPU 和 内存的重度消耗。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmselect&lt;/code&gt;和&lt;code&gt;vmstorage&lt;/code&gt;的&lt;code&gt;-search.maxConcurrentRequests&lt;/code&gt; 参数限制单个&lt;code&gt;vmselect&lt;/code&gt;和&lt;code&gt;vmstorage&lt;/code&gt;实例可以同时执行多少个查询。更大的并发数通常意味着需要消耗更多的内存。比如，如果一个查询在执行期间需要额外消耗 100MiB 的内存，那么100个并行的查询就需要&lt;code&gt;100 * 100 MiB = 10 GiB&lt;/code&gt;的额外内存。所以最好限制一下请求并发数，这样会把超出并发限制的请求挂起排队。&lt;code&gt;vmselect&lt;/code&gt;和&lt;code&gt;vmstorage&lt;/code&gt;同时提供了&lt;code&gt;-search.maxQueueDuration&lt;/code&gt;命令行参数来限制请求排队的最长时间。同时也看下&lt;code&gt;vmselect&lt;/code&gt;的&lt;code&gt;-search.maxMemoryPerQuery&lt;/code&gt;参数。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmselect&lt;/code&gt;和&lt;code&gt;vmstorage&lt;/code&gt;的&lt;code&gt;-search.maxQueueDuration&lt;/code&gt; 限制查询因超出并发数限制而挂起等待的最长时间。上面提到了&lt;code&gt;-search.maxConcurrentRequests&lt;/code&gt;参数指定了允许的最大并发数量。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmselect&lt;/code&gt;的&lt;code&gt;-search.maxSamplesPerSeries&lt;/code&gt; 限制了对于一个时间序列能够处理的最大原始样本值的数量。在执行查询时，&lt;code&gt;vmselect&lt;/code&gt;会顺序第处理每个检索到的时间序列中的原始样本值。它将每个时间序列的指定时间范围内的原始样本解压到内存，然后对齐执行&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#rollup-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rollup函数&lt;/a&gt;。&lt;code&gt;-search.maxSamplesPerSeries&lt;/code&gt; .可以限制内存用量，以免vmselect处理的&lt;code&gt;start-end&lt;/code&gt;时间范围内每个时间序列都包含上一条原始样本数据。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmselect&lt;/code&gt;的&lt;code&gt;-search.maxSamplesPerQuery&lt;/code&gt;限制一个查询最大处理的原始样本数。可以限制 &lt;code&gt;vmselect&lt;/code&gt;遇到重查询时的CPU用量。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxPointsPerTimeseries&lt;/code&gt;限制了&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#range-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;范围查询(query range)&lt;/a&gt;中每个时间序列最终返回的最多数据点数。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxPointsSubqueryPerTimeseries&lt;/code&gt; 限制了每个&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#subqueries&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;子查询&lt;/a&gt;执行时所产生的最大数据点数。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxSeriesPerAggrFunc&lt;/code&gt; 限制一次查询由&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MetricsQL聚合&lt;/a&gt;&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html#aggregate-functions&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;函数&lt;/a&gt;所产生的最大时间序列数量。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmselect&lt;/code&gt;的&lt;code&gt;-search.maxSeries&lt;/code&gt;参数限制&lt;code&gt;/api/v1/series&lt;/code&gt;接口最多返回的series数量。这个接口主要用于 Grafana 自动补全 Metric 名称，Label 名称 和 Label 值。如果数据库中因为&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高基数&lt;/a&gt;存储了大量的时间序列，那么这个接口会消耗&lt;code&gt;vmstorage&lt;/code&gt;和&lt;code&gt;vmselect&lt;/code&gt;的大量CPU。所以在这种情况下需要使用&lt;code&gt;-search.maxSeries&lt;/code&gt;来限制下CPU和内存的过度消耗。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-search.maxTagKeys&lt;/code&gt; at &lt;code&gt;vmstorage&lt;/code&gt; limits the number of items, which may be returned from &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#getting-label-names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/labels&lt;/a&gt;. This endpoint is used mostly by Grafana for auto-completion of label names. Queries to this endpoint may take big amounts of CPU time and memory at &lt;code&gt;vmstorage&lt;/code&gt; and &lt;code&gt;vmselect&lt;/code&gt; when the database contains big number of unique time series because of &lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;high churn rate&lt;/a&gt;. In this case it might be useful to set the &lt;code&gt;-search.maxTagKeys&lt;/code&gt; to quite low value in order to limit CPU and memory usage.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmstorage&lt;/code&gt;的&lt;code&gt;-search.maxTagKeys&lt;/code&gt;限制&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#getting-label-names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/labels&lt;/a&gt;接口返回的label总数量。这个接口主要用于 Grafana 自动补全 Label 名称。如果数据库中因为&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高基数&lt;/a&gt;存储了大量的时间序列，那么这个接口会消耗&lt;code&gt;vmstorage&lt;/code&gt;和&lt;code&gt;vmselect&lt;/code&gt;的大量CPU。所以在这种情况下需要使用&lt;code&gt;-search.maxTagKeys&lt;/code&gt;来限制下CPU和内存的过度消耗。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmstorage&lt;/code&gt;的&lt;code&gt;-search.maxTagKeys&lt;/code&gt;限制&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#querying-label-values&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/label/…/values&lt;/a&gt;接口返回的label值总数量。这个接口主要用于 Grafana 自动补全 Label 值。如果数据库中因为&lt;a href=&#34;https://docs.victoriametrics.com/FAQ.html#what-is-high-churn-rate&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;高基数&lt;/a&gt;存储了大量的时间序列，那么这个接口会消耗&lt;code&gt;vmstorage&lt;/code&gt;和&lt;code&gt;vmselect&lt;/code&gt;的大量CPU。所以在这种情况下需要使用&lt;code&gt;-search.maxTagValues&lt;/code&gt;来限制下CPU和内存的过度消耗。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;vmstorage&lt;/code&gt;的&lt;code&gt;-storage.maxDailySeries&lt;/code&gt;可以用于限制每天最多创建多少个新时间序列。见&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#cardinality-limiter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;限制文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;vmstorage的&lt;code&gt;-storage.maxHourlySeries&lt;/code&gt;可以用于限制活跃时间序列的数量。见&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#cardinality-limiter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;限制文档&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;也可以参考&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#capacity-planning&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;容量规划文档&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html#cardinality-limiter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent的基数显示器&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;高可用&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;高可用&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%ab%98%e5%8f%af%e7%94%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;如果数据库在部分组件暂时不可用时仍能接收新数据并处理传入查询，则被认为是高可用的。VictoriaMetrics集群符合这一定义，请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#cluster-availability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群可用性文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;建议在具有高带宽、低延迟和低错误率的同一子网络中运行单个集群的所有组件，这可以提高集群的性能和可用性。不建议将单个集群的组件分布在多个可用区（AZ）中，因为跨AZ网络通常带宽较低、延迟较高、错误率也较高，相比之下，单个AZ内的网络表现更好。&lt;/p&gt;
&lt;p&gt;如果你需要跨多个AZ的设置，建议在每个AZ中运行独立的集群，并在这些集群前设置&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent&lt;/a&gt;，以便它能将传入数据复制到所有集群中，详情请参阅&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html#multitenancy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;相关文档&lt;/a&gt;。此外，可以配置额外的vmselect节点，以便根据&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#multi-level-cluster-setup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;从多个集群中读取数据。&lt;/p&gt;
&lt;h2&gt;多层联邦部署&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;多层联邦部署&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a4%9a%e5%b1%82%e8%81%94%e9%82%a6%e9%83%a8%e7%bd%b2&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;当vmselect节点运行时带有&lt;code&gt;-clusternativeListenAddr&lt;/code&gt;命令行标志，它们可以被其他vmselect节点查询。例如，如果vmselect以&lt;code&gt;-clusternativeListenAddr=:8401&lt;/code&gt;启动，那么它可以在TCP端口8401上接受来自其他vmselect节点的查询，就像vmstorage节点一样。这允许vmselect节点进行链式连接，并构建多层集群拓扑。例如，顶层vmselect节点可以查询不同可用区（AZ）中的第二层vmselect节点，而第二层vmselect节点可以查询本地AZ中的vmstorage节点。&lt;/p&gt;
&lt;p&gt;当vminsert节点运行时带有&lt;code&gt;-clusternativeListenAddr&lt;/code&gt;命令行标志，它们可以接受来自其他vminsert节点的数据。例如，如果vminsert以&lt;code&gt;-clusternativeListenAddr=:8400&lt;/code&gt;启动，那么它可以在TCP端口8400上接受来自其他vminsert节点的数据，就像vmstorage节点一样。这允许vminsert节点进行链式连接，并构建多层集群拓扑。例如，顶层vminsert节点可以将数据复制到位于不同可用区（AZ）的第二层vminsert节点中，而第二层vminsert节点可以将数据分散到本地AZ中的vmstorage节点。&lt;/p&gt;
&lt;p&gt;由于同步复制和数据分片，vminsert节点的多层集群设置存在以下缺点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;数据写入速度受限于连接到AZ的最慢链路。&lt;/li&gt;
&lt;li&gt;当某些可用区（AZ）暂时不可用时，顶层的&lt;code&gt;vminsert&lt;/code&gt;节点会将传入数据重新路由到剩余的AZ中。这会导致在暂时不可用的AZ中出现数据缺口。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;当&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent&lt;/a&gt;以&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html#multitenancy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;多租户模式&lt;/a&gt;运行时，这些问题得到了解决。当特定AZ暂时不可用时，vmagent会缓冲必须发送到该AZ的数据。缓冲区存储在磁盘上。一旦AZ变得可用，缓冲的数据就会被发送到AZ。&lt;/p&gt;
&lt;h2&gt;Helm&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;helm&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#helm&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Helm图表简化了在Kubernetes中管理VictoriaMetrics集群版本的过程。它可在&lt;a href=&#34;https://github.com/VictoriaMetrics/helm-charts&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;helm-charts&lt;/a&gt;仓库中获得。&lt;/p&gt;
&lt;h2&gt;Kubernetes operator&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;kubernetes-operator&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#kubernetes-operator&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/VictoriaMetrics/operator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;K8s operator&lt;/a&gt; 简化了在Kubernetes中管理VictoriaMetrics组件的过程。&lt;/p&gt;
&lt;h2&gt;副本和数据安全&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;副本和数据安全&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%89%af%e6%9c%ac%e5%92%8c%e6%95%b0%e6%8d%ae%e5%ae%89%e5%85%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;默认情况下，VictoriaMetrics将复制工作卸载到由-storageDataPath指定的底层存储上，如&lt;a href=&#34;https://cloud.google.com/compute/docs/disks#pdspecs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google计算引擎的持久磁盘&lt;/a&gt;，这保证了数据的持久性。如果出于某种原因无法使用复制的持久磁盘，VictoriaMetrics支持应用级别的复制。&lt;/p&gt;
&lt;p&gt;通过向vminsert传递&lt;code&gt;-replicationFactor=N&lt;/code&gt;命令行标志可以启用复制，这指示vminsert在N个不同的vmstorage节点上存储每个摄入样本的N份副本。这保证了即使有最多N-1个vmstorage节点不可用，所有存储的数据仍然可用于查询。&lt;/p&gt;
&lt;p&gt;向vmselect传递&lt;code&gt;-replicationFactor=N&lt;/code&gt;命令行标志指示它不在查询期间如果少于&lt;code&gt;-replicationFactor&lt;/code&gt;个vmstorage节点不可用时将响应标记为部分响应。详情请参阅&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/ji-qun-ban-ben#high-availability&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;集群可用性文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;为了在&lt;code&gt;N-1&lt;/code&gt;个存储节点不可用时保持对新摄入数据的给定复制因子，集群必须包含至少&lt;code&gt;2*N-1&lt;/code&gt;个&lt;code&gt;vmstorage&lt;/code&gt;节点，其中N是复制因子。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics以毫秒精度存储时间戳，因此在启用复制时必须向vmselect节点传递&lt;code&gt;-dedup.minScrapeInterval=1ms&lt;/code&gt;命令行参数，这样它们在查询期间可以从不同的vmstorage节点上去重复制的样本。如果从配置相同的&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/xi-tong-zu-jian/vmagent&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent&lt;/a&gt;实例或Prometheus实例向VictoriaMetrics推送了重复数据，则根据&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#deduplication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;去重文档&lt;/a&gt;，&lt;code&gt;-dedup.minScrapeInterval&lt;/code&gt;必须设置为抓取配置中的&lt;code&gt;scrape_interval&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;注意，&lt;a href=&#34;https://medium.com/@valyala/speeding-up-backups-for-big-time-series-databases-533c1a927883&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;复制不能防止灾难&lt;/a&gt;，因此建议定期进行备份。详情请参阅&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#backups&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;注意，复制会增加资源使用——CPU、RAM、磁盘空间、网络带宽——最多可达&lt;code&gt;-replicationFactor=N&lt;/code&gt;倍，因为vminsert将N份摄入数据存储到不同的vmstorage节点上，并且vmselect在查询期间需要去重从vmstorage节点获得的复制数据。因此，将复制工作卸载到由&lt;code&gt;-storageDataPath&lt;/code&gt;指定的底层复制的持久存储上，如&lt;a href=&#34;https://cloud.google.com/compute/docs/disks/#pdspecs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google计算引擎的持久磁盘&lt;/a&gt;，这可以防止数据丢失和数据损坏，更加成本效益。它还提供持续的高性能，并且可以在不停机的情况下&lt;a href=&#34;https://cloud.google.com/compute/docs/disks/add-persistent-disk&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;调整大小&lt;/a&gt;。基于HDD的持久磁盘应该足以满足大多数用例。建议在Kubernetes中使用耐用的复制持久卷。&lt;/p&gt;
&lt;h2&gt;去重机制&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;去重机制&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%8e%bb%e9%87%8d%e6%9c%ba%e5%88%b6&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;VictoriaMetrics的集群版本支持数据去重，与单节点版本的方式相同。详情请参阅&lt;a href=&#34;https://docs.victoriametrics.com/#deduplication&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。唯一的区别是，由于以下方面，相同的-dedup.minScrapeInterval命令行标志值必须同时传递给vmselect和vmstorage节点：&lt;/p&gt;
&lt;p&gt;默认情况下，vminsert尝试将单个时间序列的所有样本路由到单个vmstorage节点。但在某些条件下，单个时间序列的样本可能会分布在多个vmstorage节点上：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当添加/移除vmstorage节点时。此时，部分时间序列的新样本将被路由到其他vmstorage节点；&lt;/li&gt;
&lt;li&gt;当vmstorage节点暂时不可用（例如，在它们重启期间）。此时，新样本将被重新路由到剩余的可用vmstorage节点；&lt;/li&gt;
&lt;li&gt;当vmstorage节点没有足够的能力处理传入的数据流时。此时，vminsert将新样本重新路由到其他vmstorage节点。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;备份&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;备份&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a4%87%e4%bb%bd&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;建议定期从&lt;a href=&#34;https://medium.com/@valyala/how-victoriametrics-makes-instant-snapshots-for-multi-terabyte-time-series-data-e1f3fb0e0282&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;即时快照&lt;/a&gt;进行备份，以防止用户错误，如意外删除数据。&lt;/p&gt;
&lt;p&gt;创建备份时，必须对每个vmstorage节点执行以下步骤：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过导航到/snapshot/create HTTP处理器创建即时快照。它将创建快照并返回其名称。&lt;/li&gt;
&lt;li&gt;使用&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/xi-tong-zu-jian/vmbackup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmbackup&lt;/a&gt;从&lt;code&gt;&amp;lt;storageDataPath&amp;gt;/snapshots/&amp;lt;snapshot_name&amp;gt;&lt;/code&gt;文件夹归档创建的快照。归档过程不会干扰vmstorage的工作，因此可以在任何合适的时间进行。&lt;/li&gt;
&lt;li&gt;通过&lt;code&gt;/snapshot/delete?snapshot=&amp;lt;snapshot_name&amp;gt;&lt;/code&gt;或&lt;code&gt;/snapshot/delete_all&lt;/code&gt;删除未使用的快照，以释放占用的存储空间。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;无需在所有vmstorage节点之间同步备份。&lt;/p&gt;
&lt;p&gt;从备份中恢复数据：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;kill -INT&lt;/code&gt;命令关停 &lt;code&gt;vmstorage&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;使用 &lt;a href=&#34;https://docs.victoriametrics.com/vmrestore.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmrestore&lt;/a&gt; 将备份数据恢复到 &lt;code&gt;-storageDataPath&lt;/code&gt; 指定的目录。&lt;/li&gt;
&lt;li&gt;启动 &lt;code&gt;vmstorage&lt;/code&gt; 节点.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;保存时间过滤器&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;保存时间过滤器&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bf%9d%e5%ad%98%e6%97%b6%e9%97%b4%e8%bf%87%e6%bb%a4%e5%99%a8&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;VictoriaMetrics 企业版支持通过 label filter 来配置多种数据保留时间，通过 vmstorage 的命令行参数 &lt;code&gt;-retentionFilter&lt;/code&gt; 来指定。&lt;/p&gt;
&lt;p&gt;例如，以下配置将 accountID 从 42 开始的租户的保留期设置为 1 天，然后将任何租户的标签 env=&amp;ldquo;dev&amp;rdquo; 或 env=&amp;ldquo;prod&amp;rdquo; 的时间序列的保留期设置为 3 天，而其余租户的保留期为 4 周：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;-retentionFilter=&amp;#39;{vm_account_id=~&amp;#34;42.*&amp;#34;}:1d&amp;#39; -retentionFilter=&amp;#39;{env=~&amp;#34;dev|staging&amp;#34;}:3d&amp;#39; -retentionPeriod=4w&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;更多关于保存时间过滤器的详细内容，可以阅读&lt;a href=&#34;https://docs.victoriametrics.com/#retention-filters&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;h2&gt;性能分析&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;性能分析&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;All the cluster components provide the following handlers for &lt;a href=&#34;https://blog.golang.org/profiling-go-programs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;profiling&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;http://vminsert:8480/debug/pprof/heap&lt;/code&gt; 内存剖析和&lt;code&gt;http://vminsert:8480/debug/pprof/profile&lt;/code&gt; CPU 剖析&lt;/li&gt;
&lt;li&gt;&lt;code&gt;http://vmselect:8481/debug/pprof/heap&lt;/code&gt; 内存剖析和&lt;code&gt;http://vmselect:8481/debug/pprof/profile&lt;/code&gt; CPU 剖析&lt;/li&gt;
&lt;li&gt;&lt;code&gt;http://vmstorage:8482/debug/pprof/heap&lt;/code&gt; 内存剖析和&lt;code&gt;http://vmstorage:8482/debug/pprof/profile&lt;/code&gt; CPU 剖析&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;从vmstorage收集CPU剖析示例命令（使用 &lt;code&gt;vmstorage&lt;/code&gt; 的 hostname 替换掉 &lt;code&gt;0.0.0.0）&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Copycurl http://0.0.0.0:8482/debug/pprof/profile &amp;gt; cpu.pprof&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;从 vminsert 收集内存剖析实例命令（使用 &lt;code&gt;vminsert&lt;/code&gt; 的 hostname 替换掉 &lt;code&gt;0.0.0.0）&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Copycurl http://0.0.0.0:8480/debug/pprof/heap &amp;gt; mem.pprof&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;从安全角度来看，共享收集的剖析是安全的，因为它们不包含敏感信息。&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>HTTP 查询接口</title>
      <link>http://localhost:1313/docs/query/http/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/query/http/</guid>
      <description>
        
        
        &lt;h2&gt;单机版&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;单机版&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%8d%95%e6%9c%ba%e7%89%88&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Prometheus 查询接口&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;prometheus-查询接口&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#prometheus-%e6%9f%a5%e8%af%a2%e6%8e%a5%e5%8f%a3&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics 支持下面这些 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus 查询 API&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#instant-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/query&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#range-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/query_range&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#finding-series-by-label-matchers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/series&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#getting-label-names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/labels&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#querying-label-values&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/label/…/values&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#tsdb-stats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/status/tsdb&lt;/a&gt;. See &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#tsdb-stats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for details.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#targets&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/targets&lt;/a&gt; - see &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-scrape-prometheus-exporters-such-as-node-exporter&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for more details.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/federation/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/federate&lt;/a&gt; - see &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#federation&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt; for more details.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些接口可以被Prometheus兼容的客户端（如Grafana或curl）查询。所有Prometheus查询API处理程序都可以使用&lt;code&gt;/prometheus&lt;/code&gt;前缀进行查询。例如，&lt;code&gt;/prometheus/api/v1/query&lt;/code&gt;和&lt;code&gt;/api/v1/query&lt;/code&gt;都可以正常工作。&lt;/p&gt;
&lt;h4&gt;查询优化&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;查询优化&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e6%9f%a5%e8%af%a2%e4%bc%98%e5%8c%96&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;VictoriaMetrics 接受&lt;code&gt;extra_label=&amp;lt;label_name&amp;gt;=&amp;lt;label_value&amp;gt;&lt;/code&gt;查询参数（可选），可以用于强制使用额外 Label 过滤器执行查询。例如，&lt;code&gt;/api/v1/query_range?extra_label=user_id=123&amp;amp;extra_label=group_id=456&amp;amp;query=&amp;lt;query&amp;gt;&lt;/code&gt;会自动将&lt;code&gt;{user_id=&amp;quot;123&amp;quot;,group_id=&amp;quot;456&amp;quot;}&lt;/code&gt;Label 过滤器添加到给定的查询中。此功能可用于限制给定租户可见的 timeseries 范围。一般&lt;code&gt;extra_label&lt;/code&gt;查询参数由位于 VictoriaMetrics 前面的查询代理服务自动设置。例如，可以参考使用 &lt;a href=&#34;https://docs.victoriametrics.com/vmauth.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmauth&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/vmgateway.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmgateway&lt;/a&gt; 作为查询代理的示例。&lt;/li&gt;
&lt;li&gt;VictoriaMetrics 接受&lt;code&gt;extra_filters[]=series_selector&lt;/code&gt;查询参数（可选），可用于对查询强制执行任意的 Label 过滤器。例如，&lt;code&gt;/api/v1/query_range?extra_filters[]={env=~&amp;quot;prod|staging&amp;quot;,user=&amp;quot;xyz&amp;quot;}&amp;amp;query=&amp;lt;query&amp;gt;&lt;/code&gt;将自动将&lt;code&gt;{env=~&amp;quot;prod|staging&amp;quot;,user=&amp;quot;xyz&amp;quot;}&lt;/code&gt;Label 过滤器添加到给定的查询中。此功能可用于限制给定租户可见的 timeseries 范围。我们建议在 VictoriaMetrics 前面的查询代理自动设置&lt;code&gt;extra_filters[]&lt;/code&gt;查询参数。您可以将&lt;a href=&#34;https://docs.victoriametrics.com/vmauth.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmauth&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/vmgateway.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmgateway&lt;/a&gt;作为这种代理的示例。&lt;/li&gt;
&lt;li&gt;VictoriaMetrics 接受多种格式的 &lt;code&gt;time&lt;/code&gt;，&lt;code&gt;start&lt;/code&gt; 和 &lt;code&gt;end&lt;/code&gt; 查询参数，可参考&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#timestamp-formats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;VictoriaMetrics对于&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#instant-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/query&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#range-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/query_range&lt;/a&gt;接口支持&lt;code&gt;round_digits&lt;/code&gt;查询参数。它可用于指定返回的指标值的保留小数点位数。例如，&lt;code&gt;/api/v1/query?query=avg_over_time(temperature[1h])&amp;amp;round_digits=2&lt;/code&gt;会将让返回的指标值保留小数点后面 2 位。&lt;/li&gt;
&lt;li&gt;VictoriaMetrics允许在&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#apiv1labels&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/labels&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#apiv1labelvalues&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/label/&lt;!-- raw HTML omitted --&gt;/values&lt;/a&gt;接口中使用&lt;code&gt;limit&lt;/code&gt;查询参数来限制返回的条目数量。例如，对&lt;code&gt;/api/v1/labels?limit=5&lt;/code&gt;的查询请求最多返回5个唯一的 Label 值，并忽略其他 Label。如果提供的&lt;code&gt;limit&lt;/code&gt;值超过了相应的&lt;code&gt;-command-line&lt;/code&gt;命令行参数&lt;code&gt;-search.maxTagKeys&lt;/code&gt;或&lt;code&gt;-search.maxTagValues&lt;/code&gt;，则会使用命令行参数中指定的限制。&lt;/li&gt;
&lt;li&gt;默认情况下，VictoriaMetrics从&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#apiv1series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/series&lt;/a&gt;、&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#apiv1labels&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/labels&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#apiv1labelvalues&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/label/&lt;!-- raw HTML omitted --&gt;/values&lt;/a&gt;返回最近一天从00:00 UTC开始的 series 数据，而Prometheus API默认返回所有时间的数据。如果要选择特定的时间范围的 series 数据，可使用 &lt;code&gt;start&lt;/code&gt; 和 &lt;code&gt;end&lt;/code&gt; 参数指定。由于性能优化的考虑，VictoriaMetrics会将指定的 &lt;code&gt;start..end&lt;/code&gt; 时间范围舍入到天的粒度。如果您需要在给定时间范围内获取精确的 Label 集合，请将查询发送到&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#instant-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/query&lt;/a&gt;或&lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#range-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/query_range&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;VictoriaMetrics在&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html#apiv1series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/api/v1/series&lt;/a&gt;中接受&lt;code&gt;limit&lt;/code&gt;查询参数，用于限制返回的条目数量。例如，对&lt;code&gt;/api/v1/series?limit=5&lt;/code&gt;的查询将最多返回5个 series，并忽略其余的时间序列。如果提供的&lt;code&gt;limit&lt;/code&gt;值超过了相应的命令行参数&lt;code&gt;-search.maxSeries&lt;/code&gt;的值，则会使用命令行中指定的限制。&lt;/li&gt;
&lt;li&gt;此外，VictoriaMetrics还提供了以下接口：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/vmui&lt;/code&gt; - 基本的 Web UI 界面，阅读&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#vmui&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/api/v1/series/count&lt;/code&gt; - 返回数据库中 time series 的总数量。注意：
&lt;ul&gt;
&lt;li&gt;该接口扫描了整个数据库的倒排索引，所以如果数据库包含数千万个 series 时间序列，它可能会变慢。&lt;/li&gt;
&lt;li&gt;该接口可能把&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-delete-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;删除 time series&lt;/a&gt; 计算在内，这是内部实现导致的。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/api/v1/status/active_queries&lt;/code&gt; - 返回当前正在执行的查询。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/api/v1/status/top_queries&lt;/code&gt; - 返回下面几个查询列表:
&lt;ul&gt;
&lt;li&gt;执行最频繁的查询列表 - &lt;code&gt;topByCount&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;平均执行时间最长的查询列表 - &lt;code&gt;topByAvgDuration&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;执行时间最长的查询列表 - &lt;code&gt;topBySumDuration&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;返回的查询个数可以使用 &lt;code&gt;topN&lt;/code&gt; 参数进行限制。历史查询可以使用 &lt;code&gt;maxLifetime&lt;/code&gt; 参数过滤掉。比如，请求&lt;code&gt;/api/v1/status/top_queries?topN=5&amp;amp;maxLifetime=30s&lt;/code&gt;返回最近 30 秒内每个类型的 Top5 个查询列表。VictoriaMetrics 会跟踪统计最近&lt;code&gt;-s earch.queryStats.lastQueriesCount&lt;/code&gt;时间内，且执行时间大于&lt;code&gt;search.queryStats.minQueryDuration&lt;/code&gt;的查询。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Timestamp 格式&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;timestamp-格式&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#timestamp-%e6%a0%bc%e5%bc%8f&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;VictoriaMetrics 接受下面这些格式的 &lt;code&gt;time&lt;/code&gt;, &lt;code&gt;start&lt;/code&gt; and &lt;code&gt;end&lt;/code&gt; 参数， 在 &lt;a href=&#34;https://docs.victoriametrics.com/#prometheus-querying-api-usage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;query APIs&lt;/a&gt; 和 &lt;a href=&#34;https://docs.victoriametrics.com/#how-to-export-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;export APIs&lt;/a&gt; 中皆是如此。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Unix 秒级时间戳&lt;/strong&gt;，float 类型，小数部分代表的是毫秒。比如，&lt;code&gt;1562529662.678&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Unix 毫秒级时间戳&lt;/strong&gt;。比如，&lt;code&gt;1562529662678&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.ietf.org/rfc/rfc3339.txt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;strong&gt;RFC3339&lt;/strong&gt;&lt;/a&gt;。比如， &lt;code&gt;2022-03-29T01:02:03Z&lt;/code&gt; or &lt;code&gt;2022-03-29T01:02:03+02:30&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RFC3339 的省略格式&lt;/strong&gt;。比如：&lt;code&gt;2022&lt;/code&gt;, &lt;code&gt;2022-03&lt;/code&gt;, &lt;code&gt;2022-03-29&lt;/code&gt;, &lt;code&gt;2022-03-29T01&lt;/code&gt;, &lt;code&gt;2022-03-29T01:02&lt;/code&gt;, &lt;code&gt;2022-03-29T01:02:03&lt;/code&gt;。该 RFC3339 格式默认是使用 UTC 时区的。可以使用 &lt;code&gt;+hh:mm&lt;/code&gt; or &lt;code&gt;-hh:mm&lt;/code&gt; 后缀来指定时区。比如，&lt;code&gt;2022-03-01+06:30&lt;/code&gt; 代表 &lt;code&gt;2022-03-01&lt;/code&gt; 是 &lt;code&gt;06:30&lt;/code&gt; 时区。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;基于当前时间的相对时间&lt;/strong&gt;。比如，&lt;code&gt;1h5m&lt;/code&gt;, &lt;code&gt;-1h5m&lt;/code&gt;或 &lt;code&gt;now-1h5m&lt;/code&gt; 均代表 1小时5分钟之前，这里的 now 表示当前时间。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Graphite API&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;graphite-api&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#graphite-api&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;VictoriaMetrics支持Graphite协议的数据摄入——详见&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-send-data-from-graphite-compatible-agents-such-as-statsd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。VictoriaMetrics支持以下Graphite查询API，这些API对于Grafana中的&lt;a href=&#34;https://grafana.com/docs/grafana/latest/datasources/graphite/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Graphite数据源&lt;/a&gt;是必需的：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Render API - 看 &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#graphite-render-api-usage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;Metrics API - 看 &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#graphite-render-api-usage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;Tags API - 看 &lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#graphite-render-api-usage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所有Graphite处理程序都可以使用&lt;code&gt;/graphite&lt;/code&gt;前缀。例如，&lt;code&gt;/graphite/metrics/find&lt;/code&gt;和&lt;code&gt;/metrics/find&lt;/code&gt;都应该有效。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics接受可选查询参数：&lt;code&gt;extra_label=&amp;lt;标签名&amp;gt;=&amp;lt;标签值&amp;gt;&lt;/code&gt;和&lt;code&gt;extra_filters[]=series_selector&lt;/code&gt;，这些参数适用于所有Graphite API。这些参数可用于限制给定租户可见的时间序列范围。预计&lt;code&gt;extra_label&lt;/code&gt;查询参数将由位于VictoriaMetrics前方的身份验证代理自动设置。&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/xi-tong-zu-jian/vmauth&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmauth&lt;/a&gt;和&lt;a href=&#34;https://docs.victoriametrics.com/vmgateway.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmgateway&lt;/a&gt;是此类代理的示例。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics支持&lt;code&gt;__graphite__&lt;/code&gt;伪标签，用于在&lt;a href=&#34;https://docs.victoriametrics.com/MetricsQL.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;MetricsQL&lt;/a&gt;中使用与Graphite兼容的过滤器过滤时间序列。详见&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#selecting-graphite-metrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/p&gt;
&lt;h4&gt;Graphite Render API 用法&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;graphite-render-api-用法&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#graphite-render-api-%e7%94%a8%e6%b3%95&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;VictoriaMetrics在&lt;code&gt;/render&lt;/code&gt; url 上支持&lt;a href=&#34;https://graphite.readthedocs.io/en/stable/render_api.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Graphite Render API&lt;/a&gt;子集，Grafana中的Graphite数据源会使用这一功能。在Grafana中配置&lt;a href=&#34;https://grafana.com/docs/grafana/latest/datasources/graphite/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Graphite数据源&lt;/a&gt;时，必须将&lt;code&gt;Storage-Step&lt;/code&gt; HTTP请求头设置为VictoriaMetrics中存储的Graphite数据点之间的步长。例如，&lt;code&gt;Storage-Step: 10s&lt;/code&gt;表示VictoriaMetrics中存储的Graphite数据点之间相隔10秒。&lt;/p&gt;
&lt;h4&gt;Graphite Metrics API 用法&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;graphite-metrics-api-用法&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#graphite-metrics-api-%e7%94%a8%e6%b3%95&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;VictoriaMetrics 支持 &lt;a href=&#34;https://graphite-api.readthedocs.io/en/latest/api.html#the-metrics-api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Graphite Metrics API&lt;/a&gt; 中的一下接口：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://graphite-api.readthedocs.io/en/latest/api.html#metrics-find&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/metrics/find&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://graphite-api.readthedocs.io/en/latest/api.html#metrics-expand&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/metrics/expand&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://graphite-api.readthedocs.io/en/latest/api.html#metrics-index-json&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/metrics/index.json&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;VictoriaMetrics &lt;code&gt;/metrics/find&lt;/code&gt; 和 &lt;code&gt;/metrics/expand&lt;/code&gt;接口上支持以下额外的参数:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;label&lt;/code&gt; - 用于选择任意标签值。默认情况下，&lt;code&gt;label=__name__&lt;/code&gt;，即选择度量名称。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;delimiter&lt;/code&gt; - 用于在度量名称层次结构中使用不同的分隔符。例如，&lt;code&gt;/metrics/find?delimiter=``&amp;amp;query=node``*&lt;/code&gt; 将返回所有以&lt;code&gt;node_&lt;/code&gt;开头的度量名称前缀。默认情况下，&lt;code&gt;delimiter=.&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Graphite Tags API usage&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;graphite-tags-api-usage&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#graphite-tags-api-usage&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;VictoriaMetrics 支持下面这些 &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Graphite Tags API&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#adding-series-to-the-tagdb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/tags/tagSeries&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#adding-series-to-the-tagdb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/tags/tagMultiSeries&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#exploring-tags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/tags&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#exploring-tags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/tags/{tag_name}&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#exploring-tags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/tags/findSeries&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#auto-complete-support&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/tags/autoComplete/tags&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#auto-complete-support&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/tags/autoComplete/values&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#removing-series-from-the-tagdb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;/tags/delSeries&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;集群版&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;集群版&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%9b%86%e7%be%a4%e7%89%88&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;集群版本和&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;单机版&lt;/a&gt;的API接口主要区别是数据的读取和写入是由独立组件完成的，而且也有了租户的支持。集群版本也支持&lt;code&gt;/prometheus/api/v1&lt;/code&gt;来接收 &lt;code&gt;jsonl&lt;/code&gt;, &lt;code&gt;csv&lt;/code&gt;, &lt;code&gt;native&lt;/code&gt; 和 &lt;code&gt;prometheus&lt;/code&gt;数据格式，而不仅仅是&lt;code&gt;prometheus&lt;/code&gt;数据格式。可以在&lt;a href=&#34;https://docs.victoriametrics.com/url-examples.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这里&lt;/a&gt;查看VictoriaMetrics的API的使用范例。&lt;/p&gt;
&lt;h3&gt;&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus 查询 API&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;prometheus-查询-apihttpsprometheusiodocsprometheuslatestqueryingapi&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#prometheus-%e6%9f%a5%e8%af%a2-apihttpsprometheusiodocsprometheuslatestqueryingapi&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;http://&amp;lt;vmselect&amp;gt;:8481/select/&amp;lt;accountID&amp;gt;/prometheus/&amp;lt;suffix&amp;gt;&lt;/code&gt;, 其中:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;accountID&amp;gt;&lt;/code&gt; 是一个任意32位数字，用来标识查询的空间（即租户）。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;suffix&amp;gt;&lt;/code&gt; 可以是一下的内容：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;api/v1/query&lt;/code&gt; - 执行 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#instant-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PromQL instant&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/query_range&lt;/code&gt; - 执行 &lt;a href=&#34;https://docs.victoriametrics.com/keyConcepts.html#range-query&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PromQL range 查询&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/series&lt;/code&gt; - 执行 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#finding-series-by-label-matchers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;series 查询&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/labels&lt;/code&gt; - 返回 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#getting-label-names&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;label 名称列表&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/label/&amp;lt;label_name&amp;gt;/values&lt;/code&gt; - 返回指定 &lt;code&gt;&amp;lt;label_name&amp;gt;&lt;/code&gt; 的所有值，参考&lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/querying/api/#querying-label-values&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这个 API&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;federate&lt;/code&gt; - 返回 &lt;a href=&#34;https://prometheus.io/docs/prometheus/latest/federation/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;federated metrics&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/export&lt;/code&gt; - 导出 JSON line 格式的原始数据，更多信息看&lt;a href=&#34;https://medium.com/@valyala/analyzing-prometheus-data-with-external-tools-5f3e5e147639&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这篇文章&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/export/native&lt;/code&gt; - 导出原生二进制格式的原始数据，该数据可以通过另一个接口&lt;code&gt;api/v1/import/native&lt;/code&gt;导入到 VictoriaMetrics (见上文).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/export/csv&lt;/code&gt; - 导出 CSV 格式原始数据。它可以使用另外一个接口 &lt;code&gt;api/v1/import/csv&lt;/code&gt; 导入到 VictoriaMetrics（见上文）。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/series/count&lt;/code&gt; - 返回 series 的总数。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/status/tsdb&lt;/code&gt; - 返回时序数据的统计信息。更多详细信息见&lt;a href=&#34;https://docs.victoriametrics.com/#tsdb-stats&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;这些文档&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/status/active_queries&lt;/code&gt; - 返回当前活跃的查询请求。逐一每个 &lt;code&gt;vmselect&lt;/code&gt; 实例都有独立的活跃查询列表。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;api/v1/status/top_queries&lt;/code&gt; - 返回执行频率最高以及查询耗时最长的查询列表。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;metric-relabel-debug&lt;/code&gt; - 用于对 &lt;a href=&#34;https://docs.victoriametrics.com/relabeling.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;relabeling 规则&lt;/a&gt; Debug。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;a href=&#34;https://graphite-api.readthedocs.io/en/latest/api.html#the-metrics-api&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Graphite Metrics API&lt;/a&gt;&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;graphite-metrics-apihttpsgraphite-apireadthedocsioenlatestapihtmlthe-metrics-api&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#graphite-metrics-apihttpsgraphite-apireadthedocsioenlatestapihtmlthe-metrics-api&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;http://&amp;lt;vmselect&amp;gt;:8481/select/&amp;lt;accountID&amp;gt;/graphite/&amp;lt;suffix&amp;gt;&lt;/code&gt;, 其中:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;accountID&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;是一个任意32位数字，用来标识查询的空间（即租户）。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;suffix&amp;gt;&lt;/code&gt; 可以是一下的内容：
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;render&lt;/code&gt; - 实现 Graphite Render API. 看 &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/render_api.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;metrics/find&lt;/code&gt; - 搜索 Graphite metrics. See &lt;a href=&#34;https://graphite-api.readthedocs.io/en/latest/api.html#metrics-find&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;metrics/expand&lt;/code&gt; - 扩展 Graphite metrics. See &lt;a href=&#34;https://graphite-api.readthedocs.io/en/latest/api.html#metrics-expand&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;metrics/index.json&lt;/code&gt; - returns 所有的 names. See &lt;a href=&#34;https://graphite-api.readthedocs.io/en/latest/api.html#metrics-index-json&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/tagSeries&lt;/code&gt; - 注册 time series. See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#adding-series-to-the-tagdb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/tagMultiSeries&lt;/code&gt; - 批量注册 time series. See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#adding-series-to-the-tagdb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags&lt;/code&gt; - 返回 tag 名称列表. See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#exploring-tags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/&amp;lt;tag_name&amp;gt;&lt;/code&gt; - 返回指定 &lt;code&gt;&amp;lt;tag_name&amp;gt;&lt;/code&gt;的值列表 See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#exploring-tags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/findSeries&lt;/code&gt; - 返回匹配&lt;code&gt;expr&lt;/code&gt;的 series，&lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#exploring-tags&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/autoComplete/tags&lt;/code&gt; - 返回匹配 &lt;code&gt;tagPrefix&lt;/code&gt; 和/或 &lt;code&gt;expr&lt;/code&gt;的tag名称列表。 See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#auto-complete-support&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/autoComplete/values&lt;/code&gt; - 返回匹配 &lt;code&gt;valuePrefix&lt;/code&gt; 和/或 &lt;code&gt;expr&lt;/code&gt; tag值列表 See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#auto-complete-support&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tags/delSeries&lt;/code&gt; - deletes series matching the given &lt;code&gt;path&lt;/code&gt;. See &lt;a href=&#34;https://graphite.readthedocs.io/en/stable/tags.html#removing-series-from-the-tagdb&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;these docs&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>有效利用一机多盘</title>
      <link>http://localhost:1313/docs/ops/multi-disk/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/ops/multi-disk/</guid>
      <description>
        
        
        
      </description>
    </item>
    
    <item>
      <title>数据写入</title>
      <link>http://localhost:1313/docs/write/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/write/</guid>
      <description>
        
        
        &lt;p&gt;VictoriaMetrics 支持当今监控应用的 2 种主流写入模式：Push 和 Pull。&lt;/p&gt;
&lt;h2&gt;Push 模型&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;push-模型&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#push-%e6%a8%a1%e5%9e%8b&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;客户端定期以推送模式将收集到的指标数据发送给服务端：&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../push-model.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;客户端（应用程序）决定何时何地发送其指标。VictoriaMetrics支持以下数据摄取协议（也称为推送协议）：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#prometheus-setup&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus remote write API&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-data-in-prometheus-exposition-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Prometheus text exposition format&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-send-data-from-datadog-agent&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DataDog protocol&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-send-data-from-influxdb-compatible-agents-such-as-telegraf&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;InfluxDB line protocol&lt;/a&gt; over HTTP, TCP and UDP.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-send-data-from-graphite-compatible-agents-such-as-statsd&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Graphite plaintext protocol&lt;/a&gt; with &lt;a href=&#34;https://graphite.readthedocs.io/en/latest/tags.html#carbon&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tags&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#sending-data-via-telnet-put-protocol&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OpenTSDB put message&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#sending-opentsdb-data-via-http-apiput-requests&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HTTP OpenTSDB /api/put requests&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-data-in-json-line-format&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;JSON line format&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Single-server-VictoriaMetrics.html#how-to-import-csv-data&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Arbitrary CSV data&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所有协议都与VictoriaMetrics&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/he-xin-gai-nian&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;数据模型&lt;/a&gt;完全兼容，可以在生产环境中使用。我们建议使用&lt;a href=&#34;https://github.com/VictoriaMetrics/metrics&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;github.com/VictoriaMetrics/metrics&lt;/a&gt;包将应用程序指标推送到VictoriaMetrics。还可以使用已经存在的与上述协议兼容的客户端，例如&lt;code&gt;Telegraf&lt;/code&gt;用的 InfluxDB line protocol。&lt;/p&gt;
&lt;p&gt;创建自定义客户端或为指标编写应用程序非常简单，只需发送一个POST请求即可：&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code&#34;&gt;
  

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -d &amp;#39;{&amp;#34;metric&amp;#34;:{&amp;#34;__name__&amp;#34;:&amp;#34;foo&amp;#34;,&amp;#34;job&amp;#34;:&amp;#34;node_exporter&amp;#34;},&amp;#34;values&amp;#34;:[0,1,2],&amp;#34;timestamps&amp;#34;:[1549891472010,1549891487724,1549891503438]}&amp;#39; -X POST &amp;#39;http://localhost:8428/api/v1/import&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
    &lt;div class=&#34;success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;

  
&lt;/div&gt;
&lt;p&gt;允许将指标推送/写入&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;单机版VictoriaMetrics&lt;/a&gt;、集群组件vminsert 和 &lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/xi-tong-zu-jian/vmagent&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Push 模型的优点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在VictoriaMetrics方面，配置更简单 - 无需为监控应用程序配置VictoriaMetrics的位置。不需要复杂的服务发现方案。&lt;/li&gt;
&lt;li&gt;安全设置更简单 - 无需设置从VictoriaMetrics到每个监控应用程序的访问权限。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;详细了解Percona为什么从 Pull 模式转向 Push 模式，请参阅 &lt;a href=&#34;https://www.percona.com/blog/2020/12/01/foiled-by-the-firewall-a-tale-of-transition-from-prometheus-to-victoriametrics/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Foiled by the Firewall: A Tale of Transition From Prometheus to VictoriaMetrics&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Push 模型的缺点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;增加了对被监控应用程序的配置复杂性。每个应用程序都需要独立配置与度量系统交付指标数据的地址。还需要配置指标推送间隔以及在指标传递失败时采取的策略。&lt;/li&gt;
&lt;li&gt;将指标数据推送给多个监控系统可能会比较麻烦。&lt;/li&gt;
&lt;li&gt;很难判断是应用程序崩溃还是由于其他原因停止发送指标数据。&lt;/li&gt;
&lt;li&gt;如果应用程序以太短间隔推送指标数据，可能会使监控系统负载过重。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Pull 模型&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;pull-模型&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#pull-%e6%a8%a1%e5%9e%8b&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Pull 模型是由Prometheus推广的一种方法，其中监控系统决定何时以及从哪里拉取指标：&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../pull-model.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;在 Pull 模型中，监控系统需要知道所有需要监控的应用程序的地址。指标是定期从已知的应用程序（也称为抓取目标）通过HTTP协议进行抓取（拉取）。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics支持发现与Prometheus兼容的目标，并以与Prometheus相同的方式从这些目标中抓取指标-请参阅这些文档。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;单机版VictoriaMetrics&lt;/a&gt;和&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/xi-tong-zu-jian/vmagent&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;vmagent&lt;/a&gt;都支持指标抓取。&lt;/p&gt;
&lt;p&gt;Pull 模型的优点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;更易于调试-VictoriaMetrics了解所有被监视的应用程序（即抓取目标）。 &lt;code&gt;up == 0&lt;/code&gt;查询立即显示不可用的抓取目标。有关抓取目标的实际信息可以在&lt;code&gt;http://victoriametrics:8428/targets&lt;/code&gt;和&lt;code&gt;http://vmagent:8429/targets&lt;/code&gt;上找到。&lt;/li&gt;
&lt;li&gt;监控系统可以控制指标采集频率，因此更容易控制其负载。&lt;/li&gt;
&lt;li&gt;应用程序不知道监控系统，并且无需实现指标传递逻辑。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pull 模型的缺点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;较难设置安全性-监控系统需要访问它所监视的应用程序。&lt;/li&gt;
&lt;li&gt;Pull 模型重度依赖于服务发现方案。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;常见的数据收集方法&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;常见的数据收集方法&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%b8%b8%e8%a7%81%e7%9a%84%e6%95%b0%e6%8d%ae%e6%94%b6%e9%9b%86%e6%96%b9%e6%b3%95&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;VictoriaMetrics支持数据收集的 Push 和 Pull 模式。许多场景只使用其中一种模式，或同时使用两种模式。&lt;/p&gt;
&lt;p&gt;对于数据收集来说，最常见的方法是同时使用这两种模式：&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../pull-and-push.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;在这种方法中，使用了额外的组件 - vmagent。vmagent是一个轻量级代理程序，其主要目的是收集、过滤、重新标记和发送指标给VictoriaMetrics。它支持上述提到的所有Push和Pull协议。&lt;/p&gt;
&lt;p&gt;关于VictoriaMetrics和vmagent的基本监控设置已在示例docker-compose清单中进行了描述。在这个示例中，vmagent会抓取一系列目标，并将收集到的数据转发给VictoriaMetrics。然后，VictoriaMetrics被作为Grafana上的一个Prometheus类型数据源，以查询收集到的数据。&lt;/p&gt;
&lt;p&gt;VictoriaMetrics组件允许构建更高级的拓扑结构。例如，vmagents可以从不同数据中心推送指标到中央的VictoriaMetrics：&lt;/p&gt;
&lt;p&gt;
    &lt;img src=&#34;../pull-and-push-2.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;在这个例子中，VictoriaMetrics可以是单机版的VictoriaMetrics或者是集群版本VictoriaMetrics。vmagent还允许将相同的数据复制到多个目标。&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>FAQ</title>
      <link>http://localhost:1313/docs/faq/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/docs/faq/</guid>
      <description>
        
        
        &lt;h2&gt;什么是活跃时间序列?&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;什么是活跃时间序列&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e6%b4%bb%e8%b7%83%e6%97%b6%e9%97%b4%e5%ba%8f%e5%88%97&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;时间序列通过其名称和一组标签来唯一标识。例如，&lt;code&gt;temperature{city=&amp;quot;NY&amp;quot;,country=&amp;quot;US&amp;quot;}&lt;/code&gt; 和 &lt;code&gt;temperature{city=&amp;quot;SF&amp;quot;,country=&amp;quot;US&amp;quot;}&lt;/code&gt; 是两个不同的序列，因为它们在城市标签上有所区别。如果一个时间序列在最近一小时内至少接收到一个新样本，则被视为活跃。&lt;/p&gt;
&lt;h2&gt;高流失率是指什么？&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;高流失率是指什么&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e9%ab%98%e6%b5%81%e5%a4%b1%e7%8e%87%e6%98%af%e6%8c%87%e4%bb%80%e4%b9%88&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;如果旧的时间序列以高频率被新的时间序列不断替换，那么这种状态被称为高流失率。高流失率会带来以下负面影响：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;数据库中存储的时间序列总数增加。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;倒排索引（存储在&lt;code&gt;&amp;lt;storageDataPath&amp;gt;/indexdb&lt;/code&gt;）的大小增加，因为倒排索引包含了每个标签至少有一个摄入样本的所有时间序列的条目。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查询跨多天时变慢。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;导致高流失率的主要原因是具有频繁更改值的度量标签。以下是一些示例：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;queryid&lt;/code&gt;，在&lt;code&gt;postgres_exporter&lt;/code&gt;中每次查询都会更改。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;app_name&lt;/code&gt;或&lt;code&gt;deployment_id&lt;/code&gt;，在Kubernetes中每次部署都会更改。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;从当前时间派生出来的标签，例如&lt;code&gt;timestamp&lt;/code&gt;、&lt;code&gt;minute&lt;/code&gt;或&lt;code&gt;hour&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;经常更改的&lt;code&gt;hash&lt;/code&gt;或&lt;code&gt;uuid&lt;/code&gt;标签。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;解决高流失率问题需要识别和消除具有频繁更改值的标签。Cardinality explorer可以帮助确定这些标签。&lt;/p&gt;
&lt;h2&gt;什么是高基数&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;什么是高基数&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e9%ab%98%e5%9f%ba%e6%95%b0&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;高基数通常意味着&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/faq#what-is-an-active-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;活跃时间序列&lt;/a&gt;的数量很多。高基数可能导致内存使用量增加和/或慢速插入的比例较高。高基数的来源通常是具有大量唯一值的标签，这些标签占了被摄取时间序列的很大比例。解决方案是通过基数探索器来识别和移除高基数的来源。&lt;/p&gt;
&lt;h2&gt;什么是慢写入&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;什么是慢写入&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%af%e6%85%a2%e5%86%99%e5%85%a5&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;VictoriaMetrics在内存中维护了一个缓存，用于将&lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/faq#what-is-an-active-time-series&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;活跃时间序列&lt;/a&gt;映射为内部系列ID。缓存的大小取决于主机系统中可用的VictoriaMetrics内存。如果所有活跃时间序列的信息无法适应缓存，则VictoriaMetrics需要在每个进入样本时从磁盘上读取和解压缩不在缓存中的时间序列信息。这个操作比缓存查找要慢得多，因此这种插入被称为&lt;code&gt;慢写入&lt;/code&gt;。官方仪表板上出现大量慢写入表示当前活跃时间序列数量存在内存不足问题。这种情况通常会导致数据摄取严重减慢，并显著增加磁盘IO和CPU使用率。解决方法是增加更多内存或减少活跃时间序列的数量。Cardinality Explorer可以帮助定位高数量活跃时间序列的来源。&lt;/p&gt;
&lt;h2&gt;如何限制 VictoriaMetrics 组件的内存&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何限制-victoriametrics-组件的内存&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e9%99%90%e5%88%b6-victoriametrics-%e7%bb%84%e4%bb%b6%e7%9a%84%e5%86%85%e5%ad%98&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;所有的VictoriaMetrics组件都提供了命令行参数来控制内部缓冲区和缓存的大小：&lt;code&gt;-memory.allowedPercent&lt;/code&gt; 和 &lt;code&gt;-memory.allowedBytes&lt;/code&gt;（在任何一个VictoriaMetrics组件中使用&lt;code&gt;-help &lt;/code&gt;查看这些参数的描述）。这些限制不考虑可能需要用于处理传入查询的额外内存。硬限制只能通过操作系统通过&lt;a href=&#34;https://en.wikipedia.org/wiki/Cgroups&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;cgroups&lt;/a&gt;、&lt;a href=&#34;https://docs.docker.com/config/containers/resource_constraints&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Docker&lt;/a&gt;或&lt;a href=&#34;https://kubernetes.io/docs/concepts/configuration/manage-resources-containers&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Kubernetes&lt;/a&gt;来强制执行。&lt;/p&gt;
&lt;p&gt;根据以下文档，可以调整VictoriaMetrics组件的内存使用情况：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/#resource-usage-limits&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Resource usage limits for single-node VictoriaMetrics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/Cluster-VictoriaMetrics.html#resource-usage-limits&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Resource usage limits for cluster VictoriaMetrics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/vmagent.html#troubleshooting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Troubleshooting for vmagent&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.victoriametrics.com/#troubleshooting&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Troubleshooting for single-node VictoriaMetrics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;如何删除数据&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;如何删除数据&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#%e5%a6%82%e4%bd%95%e5%88%a0%e9%99%a4%e6%95%b0%e6%8d%ae&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;请阅读 &lt;a href=&#34;https://www.victoriametrics.com.cn/victoriametrics/dan-ji-ban-ben#ru-he-shan-chu-timeseries&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;如何删除 Timeseries&lt;/a&gt;。&lt;/p&gt;

      </description>
    </item>
    
  </channel>
</rss>
